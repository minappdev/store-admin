(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["subscription-list"],{3825:function(e,t,n){"use strict";n.r(t);var s,a,i=n("80bf"),r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"subscription"},[n("div",{staticClass:"container"},[n("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,size:"small"}},[n("el-form-item",[n("el-input",{attrs:{placeholder:"请输入周期购名称"},model:{value:e.params.name,callback:function(t){e.$set(e.params,"name",t)},expression:"params.name"}})],1),n("el-button",{attrs:{size:"small"},on:{click:e.onSearch}},[e._v("搜索")]),n("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){e.$router.push({name:"subscription-edit"})}}},[e._v("新增周期购")])],1)],1),n("div",{staticClass:"container fr-aic fr-jcsb"},[n("comp-tab",{attrs:{data:[{label:"全部周期购",value:null},{label:"生效中",value:2},{label:"已结束",value:1}]},model:{value:e.params.enabled,callback:function(t){e.$set(e.params,"enabled",t)},expression:"params.enabled"}})],1),n("div",{staticClass:"container"},[n("el-table",{attrs:{data:e.list}},[n("el-table-column",{attrs:{prop:"name",label:"周期购名称"}}),n("el-table-column",{attrs:{prop:"productidlistList",label:"适用商品"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.productlist,function(t){return n("el-tag",{key:t.id,staticClass:"product",attrs:{size:"small"}},[e._v(e._s(t.name))])})}}])}),n("el-table-column",{attrs:{prop:"kind",label:"配送周期"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",[e._v("\n            "+e._s(e.getTypeText(t.row.kind))+"\n            "),n("span",{directives:[{name:"show",rawName:"v-show",value:1!==t.row.kind,expression:"scope.row.kind !== 1"}]},[e._v("|")]),2===t.row.kind?[e._v("\n              每周"),e._l(t.row.weeklistList,function(t){return n("span",{key:t,staticClass:"date"},[e._v("周"+e._s(e.getWeekday(t)))])}),e._v("配送\n            ")]:e._e(),3===t.row.kind?[e._v("\n              每月"),e._l(t.row.datelistList,function(t){return n("span",{key:t,staticClass:"date"},[e._v(e._s(t)+"日")])}),e._v("配送\n            ")]:e._e()],2)]}}])}),n("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{size:"small",type:"text"},on:{click:function(){e.$router.push({name:"subscription-edit",query:{id:t.row.id}})}}},[e._v("编辑")]),n("el-button",{directives:[{name:"show",rawName:"v-show",value:2===t.row.enabled,expression:"scope.row.enabled === 2"}],attrs:{size:"small",type:"text"},on:{click:function(n){e.disable(t.row)}}},[e._v("停用")]),n("el-button",{directives:[{name:"show",rawName:"v-show",value:1===t.row.enabled,expression:"scope.row.enabled === 1"}],attrs:{size:"small",type:"text"},on:{click:function(n){e.enable(t.row)}}},[e._v("启用")])]}}])})],1)],1),n("div",{staticClass:"container",staticStyle:{"text-align":"center"}},[n("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.noMore,expression:"!noMore"}],attrs:{size:"small",type:"primary"},on:{click:function(){return e.getList(!0)}}},[e._v("加载更多")]),n("span",{directives:[{name:"show",rawName:"v-show",value:e.noMore,expression:"noMore"}],staticStyle:{color:"#ccc","font-size":"12px"}},[e._v("已加载全部，没有更多了")])],1)])},c=[],o=(n("7f7f"),n("7514"),n("55dd"),n("ac6a"),n("96cf"),n("1da1")),u=n("be94"),l=n("e8e1"),p=n("8e44"),d=n("73cd"),b=n("ab1c"),f={components:{"comp-tab":b["a"]},data:function(){return{list:[],params:{name:"",enabled:null},noMore:!1}},watch:{"params.enabled":function(){this.getList()}},created:function(){this.getList()},methods:{getTypeText:function(e){switch(e){case 1:return"每日一期";case 2:return"每周一期";case 3:return"每月一期";default:return""}},getWeekday:function(e){switch(e){case 1:return"一";case 2:return"二";case 3:return"三";case 4:return"四";case 5:return"五";case 6:return"六";case 7:return"日";default:return""}},getList:function(e){var t=this;Object(p["a"])("StoreSubscriptionService.GetSubscriptionList",Object(l["a"])("SubscriptionListQueryRequest",Object(u["a"])({token:Object(l["a"])("Token",{token:Object(d["e"])()})},this.params,{count:20,idlessthan:e&&this.list.length?this.list[this.list.length-1].id:null}))).then(function(){var n=Object(o["a"])(regeneratorRuntime.mark(function n(s){var a;return regeneratorRuntime.wrap(function(n){while(1)switch(n.prev=n.next){case 0:a=s.subscriptionlistList,a&&(t.list=e?t.list.concat(a):a,t.list.forEach(function(e){e.datelistList&&e.datelistList.length&&e.datelistList.sort(function(e,t){return e-t}),e.weeklistList&&e.weeklistList.length&&e.weeklistList.sort(function(e,t){return e-t})}),a.length?t.noMore=!1:e&&(t.noMore=!0,t.$message({type:"info",message:"没有更多了"})),t.resolveProducts());case 2:case"end":return n.stop()}},n,this)}));return function(e){return n.apply(this,arguments)}}())},resolveProducts:function(){var e=Object(o["a"])(regeneratorRuntime.mark(function e(){var t,n,s=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=this.list.reduce(function(e,t){return e.concat(t.productidlistList)},[]),e.next=3,Object(p["a"])("StoreProductService.GetProductList",Object(l["a"])("ProductListQueryRequest",{token:Object(l["a"])("Token",{token:Object(d["e"])()}),idlistList:t,count:t.length}));case 3:n=e.sent,this.list.forEach(function(e){s.$set(e,"productlist",e.productidlistList.map(function(e){return n.productlistList.find(function(t){return t.id===e})}))});case 5:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),disable:function(e){var t=this;this.$confirm("确定要停用周期购“".concat(e.name,"”吗？"),"停用周期购",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){Object(p["a"])("StoreSubscriptionService.UpdateSubscription",Object(l["a"])("SubscriptionWithTokenRequest",{token:Object(l["a"])("Token",{token:Object(d["e"])()}),subscription:Object(l["a"])("Subscription",Object(u["a"])({},e,{enabled:1}))})).then(function(e){e&&(t.getList(),t.$message({type:"success",message:"停用成功!"}))})}).catch(function(){})},enable:function(e){var t=this;Object(p["a"])("StoreSubscriptionService.UpdateSubscription",Object(l["a"])("SubscriptionWithTokenRequest",{token:Object(l["a"])("Token",{token:Object(d["e"])()}),subscription:Object(l["a"])("Subscription",Object(u["a"])({},e,{enabled:2}))})).then(function(e){e&&(t.getList(),t.$message({type:"success",message:"启用成功!"}))})}}},m=f,v=(n("693e"),n("2877")),h=Object(v["a"])(m,r,c,!1,null,"0a06f5ec",null),w=h.exports,k={_:w},_={4:"_"},y=Object(i["a"])({name:"subscription-entry",components:k,map:_}),g=y,j=Object(v["a"])(g,s,a,!1,null,null,null);t["default"]=j.exports},"56ee":function(e,t,n){"use strict";var s=n("bff6"),a=n.n(s);a.a},"693e":function(e,t,n){"use strict";var s=n("c2d7"),a=n.n(s);a.a},"80bf":function(e,t,n){"use strict";n("96cf");var s=n("1da1"),a=(n("7f7f"),n("a3fb"));t["a"]=function(e){var t=e.name,n=e.components,i=e.map;return{name:t,components:n,data:function(){return{store:{}}},created:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(a["b"])();case 2:this.store=e.sent;case 3:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),render:function(e){return e(i[this.store.kind])}}}},ab1c:function(e,t,n){"use strict";var s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tab"},e._l(e.data,function(t){return n("div",{key:t.label,class:["tab-item",{active:e.value===t.value}],on:{click:function(n){e.onClickItem(t.value)}}},[e._v(e._s(t.label))])}))},a=[],i={props:{data:{type:Array,default:function(){return[{label:"test",value:0},{label:"test2",value:1}]},required:!0},value:{default:"",required:!0}},methods:{onClickItem:function(e){this.$emit("input",e)}}},r=i,c=(n("56ee"),n("2877")),o=Object(c["a"])(r,s,a,!1,null,"5e44c4ee",null);t["a"]=o.exports},bff6:function(e,t,n){},c2d7:function(e,t,n){}}]);
//# sourceMappingURL=subscription-list.556a6a29.js.map