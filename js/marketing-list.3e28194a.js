(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["marketing-list"],{"0954":function(t,e,n){},"137a":function(t,e,n){"use strict";n.r(e);var i,a,s=n("80bf"),r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"container fr-aic fr-jcsb"},[n("comp-tab",{attrs:{data:[{label:"全部营销规则",value:2},{label:"已删除",value:1}]},model:{value:t.params.isdeleted,callback:function(e){t.$set(t.params,"isdeleted",e)},expression:"params.isdeleted"}}),n("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){t.$router.push({name:"marketing-edit"})}}},[t._v("新建营销规则")])],1),n("div",{staticClass:"container"},[n("el-row",{attrs:{gutter:"8"}},[n("el-col",{attrs:{span:"4"}},[n("el-input",{attrs:{placeholder:"输入营销规则ID搜索","prefix-icon":"el-icon-search",size:"small"},model:{value:t.params.id,callback:function(e){t.$set(t.params,"id",e)},expression:"params.id"}})],1),n("el-col",{attrs:{span:"4"}},[n("el-button",{attrs:{size:"small"},on:{click:t.onSearch}},[t._v("搜索")])],1)],1)],1),n("div",{staticClass:"container"},[n("el-table",{staticStyle:{width:"100%"},attrs:{data:t.list,border:""}},[n("el-table-column",{attrs:{align:"center",label:"ID",prop:"id",width:"50"}}),n("el-table-column",{attrs:{label:"营销规则名称",prop:"name"}}),n("el-table-column",{attrs:{label:"规则类型"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[0===i.kind?n("div",[t._v("用户手动领券")]):t._e(),1===i.kind?n("div",[t._v("订单满减")]):t._e(),2===i.kind?n("div",[t._v("订单满赠")]):t._e(),3===i.kind?n("div",[t._v("订单满免运费")]):t._e()]}}])}),n("el-table-column",{attrs:{label:"适用范围"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[0!==i.kind&&0==i.producttype?n("span",[t._v("作用于所有商品")]):t._e(),0!==i.kind&&1==i.producttype?n("span",[t._v("作用于部分商品")]):t._e(),0!==i.kind&&2==i.producttype?n("span",[t._v("不作用于部分商品")]):t._e(),0===i.kind&&0===i.newuser&&0==i.producttype?n("span",[t._v("展示在所有商品")]):t._e(),0===i.kind&&0===i.newuser&&1==i.producttype?n("span",[t._v("展示在部分商品")]):t._e(),0===i.kind&&0===i.newuser&&2==i.producttype?n("span",[t._v("不展示在部分商品")]):t._e(),0===i.kind&&1===i.newuser?n("span",[t._v("仅限新用户领取")]):t._e()]}}])}),n("el-table-column",{attrs:{label:"赠品"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[i.coupontemplate?n("div",{staticClass:"marketing-link",on:{click:function(e){t.$router.push({name:"marketing-coupon-template-detail",query:{id:i.coupontemplate.id}})}}},[t._v("(券)"+t._s(i.coupontemplate.name))]):t._e(),i.product?n("div",{staticClass:"marketing-link",on:{click:function(e){t.onClickProduct(i.product)}}},[t._v("(商品)"+t._s(i.product.name))]):t._e()]}}])}),n("el-table-column",{attrs:{label:"有效期"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[i.begintime>0||i.endtime>0?n("div",[t._v(t._s(new Date(1e3*i.begintime).toLocaleString("zh-CN",{timeZone:"Asia/Shanghai"}))+" - "+t._s(new Date(1e3*i.endtime).toLocaleString("zh-CN",{timeZone:"Asia/Shanghai"})))]):t._e(),0==i.begintime&&0==i.endtime?n("div",[t._v("不限制")]):t._e()]}}])}),n("el-table-column",{attrs:{align:"center",label:"操作",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-button",{attrs:{size:"small",type:"text"},on:{click:function(n){t.$router.push({name:"marketing-detail",query:{id:e.row.id}})}}},[t._v("明细")]),e.row.deletedat?t._e():n("el-button",{attrs:{size:"small",type:"text"},on:{click:function(n){t.onClickDel(e.row)}}},[t._v("删除")]),e.row.deletedat?n("el-button",{attrs:{size:"small",type:"text"},on:{click:function(n){t.onClickCopy(e.row)}}},[t._v("复制")]):t._e()]}}])})],1),n("div",{staticClass:"table-bottom"},[t.hasMore?n("el-button",{attrs:{loading:t.loadmore,size:"small",type:"primary"},on:{click:t.getMarketings}},[t._v("加载更多")]):n("span",{staticStyle:{color:"#ccc","font-size":"12px"}},[t._v("已经加载全部，没有更多了")])],1)],1)])},o=[],l=(n("20d6"),n("7514"),n("ac6a"),n("5df3"),n("be94")),c=(n("96cf"),n("1da1")),u=n("ab1c"),d=n("e8e1"),p=n("8e44"),k=n("73cd"),m={components:{"comp-tab":u["a"]},data:function(){return{params:{id:"",kind:-1,isdeleted:2,idlessthan:0,count:20},list:[],loadmore:!1,hasMore:!0,token:""}},created:function(){this.token=Object(k["e"])(),this.getMarketings()},watch:{"params.isdeleted":function(){this.list=[],this.getMarketings()}},methods:{getMarketings:function(){var t=Object(c["a"])(regeneratorRuntime.mark(function t(){var e,n,i,a,s,r;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return this.loadmore=!0,e=window,n=e.scrollY,this.params.idlessthan=this.list.length?this.list[this.list.length-1].id:0,t.next=5,Object(p["a"])("StoreMarketingService.GetMarketingList",Object(d["a"])("MarketingListQueryRequest",Object(l["a"])({token:Object(d["a"])("Token",{token:this.token})},this.params)));case 5:return i=t.sent,a=[],s=[],i.marketinglistList.map(function(t){0===t.kind&&a.push(t.giftid),2===t.kind&&0===t.gifttype&&a.push(t.giftid),2===t.kind&&1===t.gifttype&&s.push(t.giftid)}),t.next=11,Promise.all([a.length?Object(p["a"])("StoreCouponTemplateService.GetCouponTemplateList",Object(d["a"])("CouponTemplateListQueryRequest",{token:Object(d["a"])("Token",{token:this.token}),idlistList:a,count:a.length})):null,s.length?Object(p["a"])("StoreProductService.GetProductList",Object(d["a"])("ProductListQueryRequest",{token:Object(d["a"])("Token",{token:this.token}),idlistList:s,count:s.length,sortby:1,sort:1})):null]);case 11:r=t.sent,i.marketinglistList.forEach(function(t){t.coupontemplate=null,t.product=null,0===t.kind&&(t.coupontemplate=r[0].coupontemplatelistList.find(function(e){return e.id===t.giftid})),2===t.kind&&0===t.gifttype&&(t.coupontemplate=r[0].coupontemplatelistList.find(function(e){return e.id===t.giftid})),2===t.kind&&1===t.gifttype&&(t.product=r[1].productlistList.find(function(e){return e.id===t.giftid}))}),this.list=this.list.concat(i.marketinglistList),this.hasMore=i.marketinglistList.length,0!==this.params.idlessthan&&window.scroll(0,n),this.loadmore=!1;case 17:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),onClickDel:function(t){var e=this;t=JSON.parse(JSON.stringify(t)),t.deletedat=parseInt(Date.now()/1e3),Object(p["a"])("StoreMarketingService.UpdateMarketing",Object(d["a"])("MarketingWithTokenRequest",{token:Object(d["a"])("Token",{token:this.token}),marketing:Object(d["a"])("Marketing",t)})).then(function(t){e.list.splice(e.list.findIndex(function(e){return e.id===t.id}),1,t),e.$message({message:"操作成功",type:"success"})})},onClickProduct:function(t){this.$router.push({name:"products-edit",query:{id:t.id,type:"edit"}})},onClickCopy:function(){var t=Object(c["a"])(regeneratorRuntime.mark(function t(e){var n;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e=JSON.parse(JSON.stringify(e)),e.deletedat=0,t.next=4,Object(p["a"])("StoreMarketingService.CreateMarketing",Object(d["a"])("MarketingWithTokenRequest",{token:Object(d["a"])("Token",{token:this.token}),marketing:Object(d["a"])("Marketing",e)}));case 4:if(n=t.sent,n.coupontemplate=null,n.product=null,2!==n.kind||0!==n.gifttype){t.next=11;break}return t.next=10,Object(p["a"])("StoreCouponTemplateService.GetCouponTemplate",Object(d["a"])("IDWithTokenRequest",{token:Object(d["a"])("Token",{token:this.token}),id:n.giftid}));case 10:n.coupontemplate=t.sent;case 11:if(2!==n.kind||1!==n.gifttype){t.next=15;break}return t.next=14,Object(p["a"])("StoreProductService.GetProduct",Object(d["a"])("IDWithTokenRequest",{token:Object(d["a"])("Token",{token:this.token}),id:n.giftid}));case 14:n.product=t.sent;case 15:this.list.splice(0,0,n),this.$message({message:"操作成功",type:"success"});case 17:case"end":return t.stop()}},t,this)}));function e(e){return t.apply(this,arguments)}return e}(),onSearch:function(){this.list=[],this.getMarketings()}}},f=m,h=(n("bf76"),n("2877")),g=Object(h["a"])(f,r,o,!1,null,null,null),b=g.exports,v=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"container fr-aic fr-jcsb"},[n("comp-tab",{attrs:{data:[{label:"全部营销规则",value:2},{label:"已删除",value:1}]},model:{value:t.params.isdeleted,callback:function(e){t.$set(t.params,"isdeleted",e)},expression:"params.isdeleted"}}),n("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){t.$router.push({name:"marketing-edit"})}}},[t._v("新建营销规则")])],1),n("div",{staticClass:"container"},[n("el-row",{attrs:{gutter:"8"}},[n("el-col",{attrs:{span:"4"}},[n("el-input",{attrs:{placeholder:"输入营销规则ID搜索","prefix-icon":"el-icon-search",size:"small"},model:{value:t.params.id,callback:function(e){t.$set(t.params,"id",e)},expression:"params.id"}})],1),n("el-col",{attrs:{span:"4"}},[n("el-button",{attrs:{size:"small"},on:{click:t.onSearch}},[t._v("搜索")])],1)],1)],1),n("div",{staticClass:"container"},[n("el-table",{staticStyle:{width:"100%"},attrs:{data:t.list,border:""}},[n("el-table-column",{attrs:{align:"center",label:"ID",prop:"id",width:"50"}}),n("el-table-column",{attrs:{label:"营销规则名称",prop:"name"}}),n("el-table-column",{attrs:{label:"规则类型"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[0===i.kind?n("div",[t._v("用户手动领券")]):t._e(),1===i.kind?n("div",[t._v("订单满减")]):t._e(),2===i.kind?n("div",[t._v("订单满赠")]):t._e()]}}])}),n("el-table-column",{attrs:{label:"适用范围"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[0!==i.kind&&0==i.producttype?n("span",[t._v("作用于所有商品")]):t._e(),0!==i.kind&&1==i.producttype?n("span",[t._v("作用于部分商品")]):t._e(),0!==i.kind&&2==i.producttype?n("span",[t._v("不作用于部分商品")]):t._e(),0===i.kind&&0===i.newuser&&0==i.producttype?n("span",[t._v("展示在所有商品")]):t._e(),0===i.kind&&0===i.newuser&&1==i.producttype?n("span",[t._v("展示在部分商品")]):t._e(),0===i.kind&&0===i.newuser&&2==i.producttype?n("span",[t._v("不展示在部分商品")]):t._e(),0===i.kind&&1===i.newuser?n("span",[t._v("仅限新用户领取")]):t._e()]}}])}),n("el-table-column",{attrs:{label:"赠品"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[i.coupontemplate?n("div",{staticClass:"marketing-link",on:{click:function(e){t.$router.push({name:"marketing-coupon-template-detail",query:{id:i.coupontemplate.id}})}}},[t._v("(券)"+t._s(i.coupontemplate.name))]):t._e(),i.product?n("div",{staticClass:"marketing-link",on:{click:function(e){t.onClickProduct(i.product)}}},[t._v("(商品)"+t._s(i.product.name))]):t._e()]}}])}),n("el-table-column",{attrs:{label:"有效期"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[i.begintime>0||i.endtime>0?n("div",[t._v(t._s(new Date(1e3*i.begintime).toLocaleString("zh-CN",{timeZone:"Asia/Shanghai"}))+" - "+t._s(new Date(1e3*i.endtime).toLocaleString("zh-CN",{timeZone:"Asia/Shanghai"})))]):t._e(),0==i.begintime&&0==i.endtime?n("div",[t._v("不限制")]):t._e()]}}])}),n("el-table-column",{attrs:{align:"center",label:"操作",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-button",{attrs:{size:"small",type:"text"},on:{click:function(n){t.$router.push({name:"marketing-detail",query:{id:e.row.id}})}}},[t._v("明细")]),e.row.deletedat?t._e():n("el-button",{attrs:{size:"small",type:"text"},on:{click:function(n){t.onClickDel(e.row)}}},[t._v("删除")]),e.row.deletedat?n("el-button",{attrs:{size:"small",type:"text"},on:{click:function(n){t.onClickCopy(e.row)}}},[t._v("复制")]):t._e()]}}])})],1),n("div",{staticClass:"table-bottom"},[t.hasMore?n("el-button",{attrs:{loading:t.loadmore,size:"small",type:"primary"},on:{click:t.getMarketings}},[t._v("加载更多")]):n("span",{staticStyle:{color:"#ccc","font-size":"12px"}},[t._v("已经加载全部，没有更多了")])],1)],1)])},_=[],y={components:{"comp-tab":u["a"]},data:function(){return{params:{id:"",kind:-1,isdeleted:2,idlessthan:0,count:20},list:[],loadmore:!1,hasMore:!0,token:""}},created:function(){this.token=Object(k["e"])(),this.getMarketings()},watch:{"params.isdeleted":function(){this.list=[],this.getMarketings()}},methods:{getMarketings:function(){var t=Object(c["a"])(regeneratorRuntime.mark(function t(){var e,n,i,a,s,r;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return this.loadmore=!0,e=window,n=e.scrollY,this.params.idlessthan=this.list.length?this.list[this.list.length-1].id:0,t.next=5,Object(p["a"])("StoreMarketingService.GetMarketingList",Object(d["a"])("MarketingListQueryRequest",Object(l["a"])({token:Object(d["a"])("Token",{token:this.token})},this.params)));case 5:return i=t.sent,a=[],s=[],i.marketinglistList.map(function(t){0===t.kind&&a.push(t.giftid),2===t.kind&&0===t.gifttype&&a.push(t.giftid),2===t.kind&&1===t.gifttype&&s.push(t.giftid)}),t.next=11,Promise.all([a.length?Object(p["a"])("StoreCouponTemplateService.GetCouponTemplateList",Object(d["a"])("CouponTemplateListQueryRequest",{token:Object(d["a"])("Token",{token:this.token}),idlistList:a,count:a.length})):null,s.length?Object(p["a"])("StoreProductService.GetProductList",Object(d["a"])("ProductListQueryRequest",{token:Object(d["a"])("Token",{token:this.token}),idlistList:s,count:s.length,sortby:1,sort:1})):null]);case 11:r=t.sent,i.marketinglistList.forEach(function(t){t.coupontemplate=null,t.product=null,0===t.kind&&(t.coupontemplate=r[0].coupontemplatelistList.find(function(e){return e.id===t.giftid})),2===t.kind&&0===t.gifttype&&(t.coupontemplate=r[0].coupontemplatelistList.find(function(e){return e.id===t.giftid})),2===t.kind&&1===t.gifttype&&(t.product=r[1].productlistList.find(function(e){return e.id===t.giftid}))}),this.list=this.list.concat(i.marketinglistList),this.hasMore=i.marketinglistList.length,0!==this.params.idlessthan&&window.scroll(0,n),this.loadmore=!1;case 17:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),onClickDel:function(t){var e=this;t=JSON.parse(JSON.stringify(t)),t.deletedat=parseInt(Date.now()/1e3),Object(p["a"])("StoreMarketingService.UpdateMarketing",Object(d["a"])("MarketingWithTokenRequest",{token:Object(d["a"])("Token",{token:this.token}),marketing:Object(d["a"])("Marketing",t)})).then(function(t){e.list.splice(e.list.findIndex(function(e){return e.id===t.id}),1,t),e.$message({message:"操作成功",type:"success"})})},onClickProduct:function(t){this.$router.push({name:"products-edit",query:{id:t.id,type:"edit"}})},onClickCopy:function(){var t=Object(c["a"])(regeneratorRuntime.mark(function t(e){var n;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e=JSON.parse(JSON.stringify(e)),e.deletedat=0,t.next=4,Object(p["a"])("StoreMarketingService.CreateMarketing",Object(d["a"])("MarketingWithTokenRequest",{token:Object(d["a"])("Token",{token:this.token}),marketing:Object(d["a"])("Marketing",e)}));case 4:if(n=t.sent,n.coupontemplate=null,n.product=null,2!==n.kind||0!==n.gifttype){t.next=11;break}return t.next=10,Object(p["a"])("StoreCouponTemplateService.GetCouponTemplate",Object(d["a"])("IDWithTokenRequest",{token:Object(d["a"])("Token",{token:this.token}),id:n.giftid}));case 10:n.coupontemplate=t.sent;case 11:if(2!==n.kind||1!==n.gifttype){t.next=15;break}return t.next=14,Object(p["a"])("StoreProductService.GetProduct",Object(d["a"])("IDWithTokenRequest",{token:Object(d["a"])("Token",{token:this.token}),id:n.giftid}));case 14:n.product=t.sent;case 15:this.list.splice(0,0,n),this.$message({message:"操作成功",type:"success"});case 17:case"end":return t.stop()}},t,this)}));function e(e){return t.apply(this,arguments)}return e}(),onSearch:function(){this.list=[],this.getMarketings()}}},O=y,w=(n("aeb5"),Object(h["a"])(O,v,_,!1,null,null,null)),S=w.exports,j=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"container fr-aic fr-jcsb"},[n("comp-tab",{attrs:{data:[{label:"全部营销规则",value:2},{label:"已删除",value:1}]},model:{value:t.params.isdeleted,callback:function(e){t.$set(t.params,"isdeleted",e)},expression:"params.isdeleted"}}),n("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){t.$router.push({name:"marketing-edit"})}}},[t._v("新建营销规则")])],1),n("div",{staticClass:"container"},[n("el-row",{attrs:{gutter:"8"}},[n("el-col",{attrs:{span:"4"}},[n("el-input",{attrs:{placeholder:"输入营销规则ID搜索","prefix-icon":"el-icon-search",size:"small"},model:{value:t.params.id,callback:function(e){t.$set(t.params,"id",e)},expression:"params.id"}})],1),n("el-col",{attrs:{span:"4"}},[n("el-button",{attrs:{size:"small"},on:{click:t.onSearch}},[t._v("搜索")])],1)],1)],1),n("div",{staticClass:"container"},[n("el-table",{staticStyle:{width:"100%"},attrs:{data:t.list,border:""}},[n("el-table-column",{attrs:{align:"center",label:"ID",prop:"id",width:"50"}}),n("el-table-column",{attrs:{label:"营销规则名称",prop:"name"}}),n("el-table-column",{attrs:{label:"规则类型"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[0===i.kind?n("div",[t._v("用户手动领券")]):t._e(),1===i.kind?n("div",[t._v("订单满减")]):t._e(),2===i.kind?n("div",[t._v("订单满赠")]):t._e(),3===i.kind?n("div",[t._v("订单满免运费")]):t._e()]}}])}),n("el-table-column",{attrs:{label:"适用范围"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[0!==i.kind&&0==i.producttype?n("span",[t._v("作用于所有商品")]):t._e(),0!==i.kind&&1==i.producttype?n("span",[t._v("作用于部分商品")]):t._e(),0!==i.kind&&2==i.producttype?n("span",[t._v("不作用于部分商品")]):t._e(),0===i.kind&&0===i.newuser&&0==i.producttype?n("span",[t._v("展示在所有商品")]):t._e(),0===i.kind&&0===i.newuser&&1==i.producttype?n("span",[t._v("展示在部分商品")]):t._e(),0===i.kind&&0===i.newuser&&2==i.producttype?n("span",[t._v("不展示在部分商品")]):t._e(),0===i.kind&&1===i.newuser?n("span",[t._v("仅限新用户领取")]):t._e()]}}])}),n("el-table-column",{attrs:{label:"赠品"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[i.coupontemplate?n("div",{staticClass:"marketing-link",on:{click:function(e){t.$router.push({name:"marketing-coupon-template-detail",query:{id:i.coupontemplate.id}})}}},[t._v("(券)"+t._s(i.coupontemplate.name))]):t._e(),i.product?n("div",{staticClass:"marketing-link",on:{click:function(e){t.onClickProduct(i.product)}}},[t._v("(商品)"+t._s(i.product.name))]):t._e()]}}])}),n("el-table-column",{attrs:{label:"有效期"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[i.begintime>0||i.endtime>0?n("div",[t._v(t._s(new Date(1e3*i.begintime).toLocaleString("zh-CN",{timeZone:"Asia/Shanghai"}))+" - "+t._s(new Date(1e3*i.endtime).toLocaleString("zh-CN",{timeZone:"Asia/Shanghai"})))]):t._e(),0==i.begintime&&0==i.endtime?n("div",[t._v("不限制")]):t._e()]}}])}),n("el-table-column",{attrs:{align:"center",label:"操作",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-button",{attrs:{size:"small",type:"text"},on:{click:function(n){t.$router.push({name:"marketing-detail",query:{id:e.row.id}})}}},[t._v("明细")]),e.row.deletedat?t._e():n("el-button",{attrs:{size:"small",type:"text"},on:{click:function(n){t.onClickDel(e.row)}}},[t._v("删除")]),e.row.deletedat?n("el-button",{attrs:{size:"small",type:"text"},on:{click:function(n){t.onClickCopy(e.row)}}},[t._v("复制")]):t._e()]}}])})],1),n("div",{staticClass:"table-bottom"},[t.hasMore?n("el-button",{attrs:{loading:t.loadmore,size:"small",type:"primary"},on:{click:t.getMarketings}},[t._v("加载更多")]):n("span",{staticStyle:{color:"#ccc","font-size":"12px"}},[t._v("已经加载全部，没有更多了")])],1)],1)])},C=[],M={components:{"comp-tab":u["a"]},data:function(){return{params:{id:"",kind:-1,isdeleted:2,idlessthan:0,count:20},list:[],loadmore:!1,hasMore:!0,token:""}},created:function(){this.token=Object(k["e"])(),this.getMarketings()},watch:{"params.isdeleted":function(){this.list=[],this.getMarketings()}},methods:{getMarketings:function(){var t=Object(c["a"])(regeneratorRuntime.mark(function t(){var e,n,i,a,s,r;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return this.loadmore=!0,e=window,n=e.scrollY,this.params.idlessthan=this.list.length?this.list[this.list.length-1].id:0,t.next=5,Object(p["a"])("StoreMarketingService.GetMarketingList",Object(d["a"])("MarketingListQueryRequest",Object(l["a"])({token:Object(d["a"])("Token",{token:this.token})},this.params)));case 5:return i=t.sent,a=[],s=[],i.marketinglistList.map(function(t){0===t.kind&&a.push(t.giftid),2===t.kind&&0===t.gifttype&&a.push(t.giftid),2===t.kind&&1===t.gifttype&&s.push(t.giftid)}),t.next=11,Promise.all([a.length?Object(p["a"])("StoreCouponTemplateService.GetCouponTemplateList",Object(d["a"])("CouponTemplateListQueryRequest",{token:Object(d["a"])("Token",{token:this.token}),idlistList:a,count:a.length})):null,s.length?Object(p["a"])("StoreProductService.GetProductList",Object(d["a"])("ProductListQueryRequest",{token:Object(d["a"])("Token",{token:this.token}),idlistList:s,count:s.length,sortby:1,sort:1})):null]);case 11:r=t.sent,i.marketinglistList.forEach(function(t){t.coupontemplate=null,t.product=null,0===t.kind&&(t.coupontemplate=r[0].coupontemplatelistList.find(function(e){return e.id===t.giftid})),2===t.kind&&0===t.gifttype&&(t.coupontemplate=r[0].coupontemplatelistList.find(function(e){return e.id===t.giftid})),2===t.kind&&1===t.gifttype&&(t.product=r[1].productlistList.find(function(e){return e.id===t.giftid}))}),this.list=this.list.concat(i.marketinglistList),this.hasMore=i.marketinglistList.length,0!==this.params.idlessthan&&window.scroll(0,n),this.loadmore=!1;case 17:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),onClickDel:function(t){var e=this;t=JSON.parse(JSON.stringify(t)),t.deletedat=parseInt(Date.now()/1e3),Object(p["a"])("StoreMarketingService.UpdateMarketing",Object(d["a"])("MarketingWithTokenRequest",{token:Object(d["a"])("Token",{token:this.token}),marketing:Object(d["a"])("Marketing",t)})).then(function(t){e.list.splice(e.list.findIndex(function(e){return e.id===t.id}),1,t),e.$message({message:"操作成功",type:"success"})})},onClickProduct:function(t){this.$router.push({name:"products-edit",query:{id:t.id,type:"edit"}})},onClickCopy:function(){var t=Object(c["a"])(regeneratorRuntime.mark(function t(e){var n;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e=JSON.parse(JSON.stringify(e)),e.deletedat=0,t.next=4,Object(p["a"])("StoreMarketingService.CreateMarketing",Object(d["a"])("MarketingWithTokenRequest",{token:Object(d["a"])("Token",{token:this.token}),marketing:Object(d["a"])("Marketing",e)}));case 4:if(n=t.sent,n.coupontemplate=null,n.product=null,2!==n.kind||0!==n.gifttype){t.next=11;break}return t.next=10,Object(p["a"])("StoreCouponTemplateService.GetCouponTemplate",Object(d["a"])("IDWithTokenRequest",{token:Object(d["a"])("Token",{token:this.token}),id:n.giftid}));case 10:n.coupontemplate=t.sent;case 11:if(2!==n.kind||1!==n.gifttype){t.next=15;break}return t.next=14,Object(p["a"])("StoreProductService.GetProduct",Object(d["a"])("IDWithTokenRequest",{token:Object(d["a"])("Token",{token:this.token}),id:n.giftid}));case 14:n.product=t.sent;case 15:this.list.splice(0,0,n),this.$message({message:"操作成功",type:"success"});case 17:case"end":return t.stop()}},t,this)}));function e(e){return t.apply(this,arguments)}return e}(),onSearch:function(){this.list=[],this.getMarketings()}}},x=M,L=(n("ec7b"),Object(h["a"])(x,j,C,!1,null,null,null)),T=L.exports,R=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"container fr-aic fr-jcsb"},[n("comp-tab",{attrs:{data:[{label:"全部营销规则",value:2},{label:"已删除",value:1}]},model:{value:t.params.isdeleted,callback:function(e){t.$set(t.params,"isdeleted",e)},expression:"params.isdeleted"}}),n("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){t.$router.push({name:"marketing-edit"})}}},[t._v("新建营销规则")])],1),n("div",{staticClass:"container"},[n("el-row",{attrs:{gutter:"8"}},[n("el-col",{attrs:{span:"4"}},[n("el-input",{attrs:{placeholder:"输入营销规则ID搜索","prefix-icon":"el-icon-search",size:"small"},model:{value:t.params.id,callback:function(e){t.$set(t.params,"id",e)},expression:"params.id"}})],1),n("el-col",{attrs:{span:"4"}},[n("el-button",{attrs:{size:"small"},on:{click:t.onSearch}},[t._v("搜索")])],1)],1)],1),n("div",{staticClass:"container"},[n("el-table",{staticStyle:{width:"100%"},attrs:{data:t.list,border:""}},[n("el-table-column",{attrs:{align:"center",label:"ID",prop:"id",width:"50"}}),n("el-table-column",{attrs:{label:"营销规则名称",prop:"name"}}),n("el-table-column",{attrs:{label:"规则类型"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[0===i.kind?n("div",[t._v("用户手动领券")]):t._e(),1===i.kind?n("div",[t._v("订单满减")]):t._e(),2===i.kind?n("div",[t._v("订单满赠")]):t._e()]}}])}),n("el-table-column",{attrs:{label:"适用范围"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[0!==i.kind&&0==i.producttype?n("span",[t._v("作用于所有商品")]):t._e(),0!==i.kind&&1==i.producttype?n("span",[t._v("作用于部分商品")]):t._e(),0!==i.kind&&2==i.producttype?n("span",[t._v("不作用于部分商品")]):t._e(),0===i.kind&&0===i.newuser&&0==i.producttype?n("span",[t._v("展示在所有商品")]):t._e(),0===i.kind&&0===i.newuser&&1==i.producttype?n("span",[t._v("展示在部分商品")]):t._e(),0===i.kind&&0===i.newuser&&2==i.producttype?n("span",[t._v("不展示在部分商品")]):t._e(),0===i.kind&&1===i.newuser?n("span",[t._v("仅限新用户领取")]):t._e()]}}])}),n("el-table-column",{attrs:{label:"赠品"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[i.coupontemplate?n("div",{staticClass:"marketing-link",on:{click:function(e){t.$router.push({name:"marketing-coupon-template-detail",query:{id:i.coupontemplate.id}})}}},[t._v("(券)"+t._s(i.coupontemplate.name))]):t._e(),i.product?n("div",{staticClass:"marketing-link",on:{click:function(e){t.onClickProduct(i.product)}}},[t._v("(商品)"+t._s(i.product.name))]):t._e()]}}])}),n("el-table-column",{attrs:{label:"有效期"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[i.begintime>0||i.endtime>0?n("div",[t._v(t._s(new Date(1e3*i.begintime).toLocaleString("zh-CN",{timeZone:"Asia/Shanghai"}))+" - "+t._s(new Date(1e3*i.endtime).toLocaleString("zh-CN",{timeZone:"Asia/Shanghai"})))]):t._e(),0==i.begintime&&0==i.endtime?n("div",[t._v("不限制")]):t._e()]}}])}),n("el-table-column",{attrs:{align:"center",label:"操作",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-button",{attrs:{size:"small",type:"text"},on:{click:function(n){t.$router.push({name:"marketing-detail",query:{id:e.row.id}})}}},[t._v("明细")]),e.row.deletedat?t._e():n("el-button",{attrs:{size:"small",type:"text"},on:{click:function(n){t.onClickDel(e.row)}}},[t._v("删除")]),e.row.deletedat?n("el-button",{attrs:{size:"small",type:"text"},on:{click:function(n){t.onClickCopy(e.row)}}},[t._v("复制")]):t._e()]}}])})],1),n("div",{staticClass:"table-bottom"},[t.hasMore?n("el-button",{attrs:{loading:t.loadmore,size:"small",type:"primary"},on:{click:t.getMarketings}},[t._v("加载更多")]):n("span",{staticStyle:{color:"#ccc","font-size":"12px"}},[t._v("已经加载全部，没有更多了")])],1)],1)])},q=[],z={components:{"comp-tab":u["a"]},data:function(){return{params:{id:"",kind:-1,isdeleted:2,idlessthan:0,count:20},list:[],loadmore:!1,hasMore:!0,token:""}},created:function(){this.token=Object(k["e"])(),this.getMarketings()},watch:{"params.isdeleted":function(){this.list=[],this.getMarketings()}},methods:{getMarketings:function(){var t=Object(c["a"])(regeneratorRuntime.mark(function t(){var e,n,i,a,s,r;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return this.loadmore=!0,e=window,n=e.scrollY,this.params.idlessthan=this.list.length?this.list[this.list.length-1].id:0,t.next=5,Object(p["a"])("StoreMarketingService.GetMarketingList",Object(d["a"])("MarketingListQueryRequest",Object(l["a"])({token:Object(d["a"])("Token",{token:this.token})},this.params)));case 5:return i=t.sent,a=[],s=[],i.marketinglistList.map(function(t){0===t.kind&&a.push(t.giftid),2===t.kind&&0===t.gifttype&&a.push(t.giftid),2===t.kind&&1===t.gifttype&&s.push(t.giftid)}),t.next=11,Promise.all([a.length?Object(p["a"])("StoreCouponTemplateService.GetCouponTemplateList",Object(d["a"])("CouponTemplateListQueryRequest",{token:Object(d["a"])("Token",{token:this.token}),idlistList:a,count:a.length})):null,s.length?Object(p["a"])("StoreProductService.GetProductList",Object(d["a"])("ProductListQueryRequest",{token:Object(d["a"])("Token",{token:this.token}),idlistList:s,count:s.length,sortby:1,sort:1})):null]);case 11:r=t.sent,i.marketinglistList.forEach(function(t){t.coupontemplate=null,t.product=null,0===t.kind&&(t.coupontemplate=r[0].coupontemplatelistList.find(function(e){return e.id===t.giftid})),2===t.kind&&0===t.gifttype&&(t.coupontemplate=r[0].coupontemplatelistList.find(function(e){return e.id===t.giftid})),2===t.kind&&1===t.gifttype&&(t.product=r[1].productlistList.find(function(e){return e.id===t.giftid}))}),this.list=this.list.concat(i.marketinglistList),this.hasMore=i.marketinglistList.length,0!==this.params.idlessthan&&window.scroll(0,n),this.loadmore=!1;case 17:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),onClickDel:function(t){var e=this;t=JSON.parse(JSON.stringify(t)),t.deletedat=parseInt(Date.now()/1e3),Object(p["a"])("StoreMarketingService.UpdateMarketing",Object(d["a"])("MarketingWithTokenRequest",{token:Object(d["a"])("Token",{token:this.token}),marketing:Object(d["a"])("Marketing",t)})).then(function(t){e.list.splice(e.list.findIndex(function(e){return e.id===t.id}),1,t),e.$message({message:"操作成功",type:"success"})})},onClickProduct:function(t){this.$router.push({name:"products-edit",query:{id:t.id,type:"edit"}})},onClickCopy:function(){var t=Object(c["a"])(regeneratorRuntime.mark(function t(e){var n;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e=JSON.parse(JSON.stringify(e)),e.deletedat=0,t.next=4,Object(p["a"])("StoreMarketingService.CreateMarketing",Object(d["a"])("MarketingWithTokenRequest",{token:Object(d["a"])("Token",{token:this.token}),marketing:Object(d["a"])("Marketing",e)}));case 4:if(n=t.sent,n.coupontemplate=null,n.product=null,2!==n.kind||0!==n.gifttype){t.next=11;break}return t.next=10,Object(p["a"])("StoreCouponTemplateService.GetCouponTemplate",Object(d["a"])("IDWithTokenRequest",{token:Object(d["a"])("Token",{token:this.token}),id:n.giftid}));case 10:n.coupontemplate=t.sent;case 11:if(2!==n.kind||1!==n.gifttype){t.next=15;break}return t.next=14,Object(p["a"])("StoreProductService.GetProduct",Object(d["a"])("IDWithTokenRequest",{token:Object(d["a"])("Token",{token:this.token}),id:n.giftid}));case 14:n.product=t.sent;case 15:this.list.splice(0,0,n),this.$message({message:"操作成功",type:"success"});case 17:case"end":return t.stop()}},t,this)}));function e(e){return t.apply(this,arguments)}return e}(),onSearch:function(){this.list=[],this.getMarketings()}}},$=z,D=(n("859a"),Object(h["a"])($,R,q,!1,null,null,null)),P=D.exports,I=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"container fr-aic fr-jcsb"},[n("comp-tab",{attrs:{data:[{label:"全部营销规则",value:2},{label:"已删除",value:1}]},model:{value:t.params.isdeleted,callback:function(e){t.$set(t.params,"isdeleted",e)},expression:"params.isdeleted"}}),n("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){t.$router.push({name:"marketing-edit"})}}},[t._v("新建营销规则")])],1),n("div",{staticClass:"container"},[n("el-row",{attrs:{gutter:"8"}},[n("el-col",{attrs:{span:"4"}},[n("el-input",{attrs:{placeholder:"输入营销规则ID搜索","prefix-icon":"el-icon-search",size:"small"},model:{value:t.params.id,callback:function(e){t.$set(t.params,"id",e)},expression:"params.id"}})],1),n("el-col",{attrs:{span:"4"}},[n("el-button",{attrs:{size:"small"},on:{click:t.onSearch}},[t._v("搜索")])],1)],1)],1),n("div",{staticClass:"container"},[n("el-table",{staticStyle:{width:"100%"},attrs:{data:t.list,border:""}},[n("el-table-column",{attrs:{align:"center",label:"ID",prop:"id",width:"50"}}),n("el-table-column",{attrs:{label:"营销规则名称",prop:"name"}}),n("el-table-column",{attrs:{label:"规则类型"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[0===i.kind?n("div",[t._v("用户手动领券")]):t._e(),1===i.kind?n("div",[t._v("订单满减")]):t._e(),2===i.kind?n("div",[t._v("订单满赠")]):t._e(),3===i.kind?n("div",[t._v("订单满免运费")]):t._e()]}}])}),n("el-table-column",{attrs:{label:"适用范围"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[0!==i.kind&&0==i.producttype?n("span",[t._v("作用于所有商品")]):t._e(),0!==i.kind&&1==i.producttype?n("span",[t._v("作用于部分商品")]):t._e(),0!==i.kind&&2==i.producttype?n("span",[t._v("不作用于部分商品")]):t._e(),0===i.kind&&0===i.newuser&&0==i.producttype?n("span",[t._v("展示在所有商品")]):t._e(),0===i.kind&&0===i.newuser&&1==i.producttype?n("span",[t._v("展示在部分商品")]):t._e(),0===i.kind&&0===i.newuser&&2==i.producttype?n("span",[t._v("不展示在部分商品")]):t._e(),0===i.kind&&1===i.newuser?n("span",[t._v("仅限新用户领取")]):t._e()]}}])}),n("el-table-column",{attrs:{label:"赠品"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[i.coupontemplate?n("div",{staticClass:"marketing-link",on:{click:function(e){t.$router.push({name:"marketing-coupon-template-detail",query:{id:i.coupontemplate.id}})}}},[t._v("(券)"+t._s(i.coupontemplate.name))]):t._e(),i.product?n("div",{staticClass:"marketing-link",on:{click:function(e){t.onClickProduct(i.product)}}},[t._v("(商品)"+t._s(i.product.name))]):t._e()]}}])}),n("el-table-column",{attrs:{label:"有效期"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[i.begintime>0||i.endtime>0?n("div",[t._v(t._s(new Date(1e3*i.begintime).toLocaleString("zh-CN",{timeZone:"Asia/Shanghai"}))+" - "+t._s(new Date(1e3*i.endtime).toLocaleString("zh-CN",{timeZone:"Asia/Shanghai"})))]):t._e(),0==i.begintime&&0==i.endtime?n("div",[t._v("不限制")]):t._e()]}}])}),n("el-table-column",{attrs:{align:"center",label:"操作",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-button",{attrs:{size:"small",type:"text"},on:{click:function(n){t.$router.push({name:"marketing-detail",query:{id:e.row.id}})}}},[t._v("明细")]),e.row.deletedat?t._e():n("el-button",{attrs:{size:"small",type:"text"},on:{click:function(n){t.onClickDel(e.row)}}},[t._v("删除")]),e.row.deletedat?n("el-button",{attrs:{size:"small",type:"text"},on:{click:function(n){t.onClickCopy(e.row)}}},[t._v("复制")]):t._e()]}}])})],1),n("div",{staticClass:"table-bottom"},[t.hasMore?n("el-button",{attrs:{loading:t.loadmore,size:"small",type:"primary"},on:{click:t.getMarketings}},[t._v("加载更多")]):n("span",{staticStyle:{color:"#ccc","font-size":"12px"}},[t._v("已经加载全部，没有更多了")])],1)],1)])},N=[],G={components:{"comp-tab":u["a"]},data:function(){return{params:{id:"",kind:-1,isdeleted:2,idlessthan:0,count:20},list:[],loadmore:!1,hasMore:!0,token:""}},created:function(){this.token=Object(k["e"])(),this.getMarketings()},watch:{"params.isdeleted":function(){this.list=[],this.getMarketings()}},methods:{getMarketings:function(){var t=Object(c["a"])(regeneratorRuntime.mark(function t(){var e,n,i,a,s,r;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return this.loadmore=!0,e=window,n=e.scrollY,this.params.idlessthan=this.list.length?this.list[this.list.length-1].id:0,t.next=5,Object(p["a"])("StoreMarketingService.GetMarketingList",Object(d["a"])("MarketingListQueryRequest",Object(l["a"])({token:Object(d["a"])("Token",{token:this.token})},this.params)));case 5:return i=t.sent,a=[],s=[],i.marketinglistList.map(function(t){0===t.kind&&a.push(t.giftid),2===t.kind&&0===t.gifttype&&a.push(t.giftid),2===t.kind&&1===t.gifttype&&s.push(t.giftid)}),t.next=11,Promise.all([a.length?Object(p["a"])("StoreCouponTemplateService.GetCouponTemplateList",Object(d["a"])("CouponTemplateListQueryRequest",{token:Object(d["a"])("Token",{token:this.token}),idlistList:a,count:a.length})):null,s.length?Object(p["a"])("StoreProductService.GetProductList",Object(d["a"])("ProductListQueryRequest",{token:Object(d["a"])("Token",{token:this.token}),idlistList:s,count:s.length,sortby:1,sort:1})):null]);case 11:r=t.sent,i.marketinglistList.forEach(function(t){t.coupontemplate=null,t.product=null,0===t.kind&&(t.coupontemplate=r[0].coupontemplatelistList.find(function(e){return e.id===t.giftid})),2===t.kind&&0===t.gifttype&&(t.coupontemplate=r[0].coupontemplatelistList.find(function(e){return e.id===t.giftid})),2===t.kind&&1===t.gifttype&&(t.product=r[1].productlistList.find(function(e){return e.id===t.giftid}))}),this.list=this.list.concat(i.marketinglistList),this.hasMore=i.marketinglistList.length,0!==this.params.idlessthan&&window.scroll(0,n),this.loadmore=!1;case 17:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),onClickDel:function(t){var e=this;t=JSON.parse(JSON.stringify(t)),t.deletedat=parseInt(Date.now()/1e3),Object(p["a"])("StoreMarketingService.UpdateMarketing",Object(d["a"])("MarketingWithTokenRequest",{token:Object(d["a"])("Token",{token:this.token}),marketing:Object(d["a"])("Marketing",t)})).then(function(t){e.list.splice(e.list.findIndex(function(e){return e.id===t.id}),1,t),e.$message({message:"操作成功",type:"success"})})},onClickProduct:function(t){this.$router.push({name:"products-edit",query:{id:t.id,type:"edit"}})},onClickCopy:function(){var t=Object(c["a"])(regeneratorRuntime.mark(function t(e){var n;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e=JSON.parse(JSON.stringify(e)),e.deletedat=0,t.next=4,Object(p["a"])("StoreMarketingService.CreateMarketing",Object(d["a"])("MarketingWithTokenRequest",{token:Object(d["a"])("Token",{token:this.token}),marketing:Object(d["a"])("Marketing",e)}));case 4:if(n=t.sent,n.coupontemplate=null,n.product=null,2!==n.kind||0!==n.gifttype){t.next=11;break}return t.next=10,Object(p["a"])("StoreCouponTemplateService.GetCouponTemplate",Object(d["a"])("IDWithTokenRequest",{token:Object(d["a"])("Token",{token:this.token}),id:n.giftid}));case 10:n.coupontemplate=t.sent;case 11:if(2!==n.kind||1!==n.gifttype){t.next=15;break}return t.next=14,Object(p["a"])("StoreProductService.GetProduct",Object(d["a"])("IDWithTokenRequest",{token:Object(d["a"])("Token",{token:this.token}),id:n.giftid}));case 14:n.product=t.sent;case 15:this.list.splice(0,0,n),this.$message({message:"操作成功",type:"success"});case 17:case"end":return t.stop()}},t,this)}));function e(e){return t.apply(this,arguments)}return e}(),onSearch:function(){this.list=[],this.getMarketings()}}},J=G,W=(n("2695"),Object(h["a"])(J,I,N,!1,null,null,null)),Q=W.exports,A=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"container fr-aic fr-jcsb"},[n("comp-tab",{attrs:{data:[{label:"全部营销规则",value:2},{label:"已删除",value:1}]},model:{value:t.params.isdeleted,callback:function(e){t.$set(t.params,"isdeleted",e)},expression:"params.isdeleted"}}),n("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){t.$router.push({name:"marketing-edit"})}}},[t._v("新建营销规则")])],1),n("div",{staticClass:"container"},[n("el-row",{attrs:{gutter:"8"}},[n("el-col",{attrs:{span:"4"}},[n("el-input",{attrs:{placeholder:"输入营销规则ID搜索","prefix-icon":"el-icon-search",size:"small"},model:{value:t.params.id,callback:function(e){t.$set(t.params,"id",e)},expression:"params.id"}})],1),n("el-col",{attrs:{span:"4"}},[n("el-button",{attrs:{size:"small"},on:{click:t.onSearch}},[t._v("搜索")])],1)],1)],1),n("div",{staticClass:"container"},[n("el-table",{staticStyle:{width:"100%"},attrs:{data:t.list,border:""}},[n("el-table-column",{attrs:{align:"center",label:"ID",prop:"id",width:"50"}}),n("el-table-column",{attrs:{label:"营销规则名称",prop:"name"}}),n("el-table-column",{attrs:{label:"规则类型"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[0===i.kind?n("div",[t._v("用户手动领券")]):t._e(),1===i.kind?n("div",[t._v("订单满减")]):t._e(),2===i.kind?n("div",[t._v("订单满赠")]):t._e(),3===i.kind?n("div",[t._v("订单满免运费")]):t._e()]}}])}),n("el-table-column",{attrs:{label:"适用范围"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[0!==i.kind&&0==i.producttype?n("span",[t._v("作用于所有商品")]):t._e(),0!==i.kind&&1==i.producttype?n("span",[t._v("作用于部分商品")]):t._e(),0!==i.kind&&2==i.producttype?n("span",[t._v("不作用于部分商品")]):t._e(),0===i.kind&&0===i.newuser?n("span",[t._v("任何用户均可领取")]):t._e(),0===i.kind&&1===i.newuser?n("span",[t._v("仅限新用户领取")]):t._e()]}}])}),n("el-table-column",{attrs:{label:"赠品"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[i.coupontemplate?n("div",{staticClass:"marketing-link",on:{click:function(e){t.$router.push({name:"marketing-coupon-template-detail",query:{id:i.coupontemplate.id}})}}},[t._v("(券)"+t._s(i.coupontemplate.name))]):t._e(),i.product?n("div",{staticClass:"marketing-link",on:{click:function(e){t.onClickProduct(i.product)}}},[t._v("(商品)"+t._s(i.product.name))]):t._e()]}}])}),n("el-table-column",{attrs:{label:"有效期"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[i.begintime>0||i.endtime>0?n("div",[t._v(t._s(new Date(1e3*i.begintime).toLocaleString("zh-CN",{timeZone:"Asia/Shanghai"}))+" - "+t._s(new Date(1e3*i.endtime).toLocaleString("zh-CN",{timeZone:"Asia/Shanghai"})))]):t._e(),0==i.begintime&&0==i.endtime?n("div",[t._v("不限制")]):t._e()]}}])}),n("el-table-column",{attrs:{align:"center",label:"操作",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-button",{attrs:{size:"small",type:"text"},on:{click:function(n){t.$router.push({name:"marketing-detail",query:{id:e.row.id}})}}},[t._v("明细")]),e.row.deletedat?t._e():n("el-button",{attrs:{size:"small",type:"text"},on:{click:function(n){t.onClickDel(e.row)}}},[t._v("删除")]),e.row.deletedat?n("el-button",{attrs:{size:"small",type:"text"},on:{click:function(n){t.onClickCopy(e.row)}}},[t._v("复制")]):t._e()]}}])})],1),n("div",{staticClass:"table-bottom"},[t.hasMore?n("el-button",{attrs:{loading:t.loadmore,size:"small",type:"primary"},on:{click:t.getMarketings}},[t._v("加载更多")]):n("span",{staticStyle:{color:"#ccc","font-size":"12px"}},[t._v("已经加载全部，没有更多了")])],1)],1)])},E=[],Z={components:{"comp-tab":u["a"]},data:function(){return{params:{id:"",kind:-1,isdeleted:2,idlessthan:0,count:20},list:[],loadmore:!1,hasMore:!0,token:""}},created:function(){this.token=Object(k["e"])(),this.getMarketings()},watch:{"params.isdeleted":function(){this.list=[],this.getMarketings()}},methods:{getMarketings:function(){var t=Object(c["a"])(regeneratorRuntime.mark(function t(){var e,n,i,a,s,r;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return this.loadmore=!0,e=window,n=e.scrollY,this.params.idlessthan=this.list.length?this.list[this.list.length-1].id:0,t.next=5,Object(p["a"])("StoreMarketingService.GetMarketingList",Object(d["a"])("MarketingListQueryRequest",Object(l["a"])({token:Object(d["a"])("Token",{token:this.token})},this.params)));case 5:return i=t.sent,a=[],s=[],i.marketinglistList.map(function(t){0===t.kind&&a.push(t.giftid),2===t.kind&&0===t.gifttype&&a.push(t.giftid),2===t.kind&&1===t.gifttype&&s.push(t.giftid)}),t.next=11,Promise.all([a.length?Object(p["a"])("StoreCouponTemplateService.GetCouponTemplateList",Object(d["a"])("CouponTemplateListQueryRequest",{token:Object(d["a"])("Token",{token:this.token}),idlistList:a,count:a.length})):null,s.length?Object(p["a"])("StoreProductService.GetProductList",Object(d["a"])("ProductListQueryRequest",{token:Object(d["a"])("Token",{token:this.token}),idlistList:s,count:s.length,sortby:1,sort:1})):null]);case 11:r=t.sent,i.marketinglistList.forEach(function(t){t.coupontemplate=null,t.product=null,0===t.kind&&(t.coupontemplate=r[0].coupontemplatelistList.find(function(e){return e.id===t.giftid})),2===t.kind&&0===t.gifttype&&(t.coupontemplate=r[0].coupontemplatelistList.find(function(e){return e.id===t.giftid})),2===t.kind&&1===t.gifttype&&(t.product=r[1].productlistList.find(function(e){return e.id===t.giftid}))}),this.list=this.list.concat(i.marketinglistList),this.hasMore=i.marketinglistList.length,0!==this.params.idlessthan&&window.scroll(0,n),this.loadmore=!1;case 17:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),onClickDel:function(t){var e=this;t=JSON.parse(JSON.stringify(t)),t.deletedat=parseInt(Date.now()/1e3),Object(p["a"])("StoreMarketingService.UpdateMarketing",Object(d["a"])("MarketingWithTokenRequest",{token:Object(d["a"])("Token",{token:this.token}),marketing:Object(d["a"])("Marketing",t)})).then(function(t){e.list.splice(e.list.findIndex(function(e){return e.id===t.id}),1,t),e.$message({message:"操作成功",type:"success"})})},onClickProduct:function(t){this.$router.push({name:"products-edit",query:{id:t.id,type:"edit"}})},onClickCopy:function(){var t=Object(c["a"])(regeneratorRuntime.mark(function t(e){var n;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e=JSON.parse(JSON.stringify(e)),e.deletedat=0,t.next=4,Object(p["a"])("StoreMarketingService.CreateMarketing",Object(d["a"])("MarketingWithTokenRequest",{token:Object(d["a"])("Token",{token:this.token}),marketing:Object(d["a"])("Marketing",e)}));case 4:if(n=t.sent,n.coupontemplate=null,n.product=null,2!==n.kind||0!==n.gifttype){t.next=11;break}return t.next=10,Object(p["a"])("StoreCouponTemplateService.GetCouponTemplate",Object(d["a"])("IDWithTokenRequest",{token:Object(d["a"])("Token",{token:this.token}),id:n.giftid}));case 10:n.coupontemplate=t.sent;case 11:if(2!==n.kind||1!==n.gifttype){t.next=15;break}return t.next=14,Object(p["a"])("StoreProductService.GetProduct",Object(d["a"])("IDWithTokenRequest",{token:Object(d["a"])("Token",{token:this.token}),id:n.giftid}));case 14:n.product=t.sent;case 15:this.list.splice(0,0,n),this.$message({message:"操作成功",type:"success"});case 17:case"end":return t.stop()}},t,this)}));function e(e){return t.apply(this,arguments)}return e}(),onSearch:function(){this.list=[],this.getMarketings()}}},U=Z,Y=(n("38c3"),Object(h["a"])(U,A,E,!1,null,null,null)),F=Y.exports,B=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"container fr-aic fr-jcsb"},[n("comp-tab",{attrs:{data:[{label:"全部营销规则",value:2},{label:"已删除",value:1}]},model:{value:t.params.isdeleted,callback:function(e){t.$set(t.params,"isdeleted",e)},expression:"params.isdeleted"}}),n("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){t.$router.push({name:"marketing-edit"})}}},[t._v("新建营销规则")])],1),n("div",{staticClass:"container"},[n("el-row",{attrs:{gutter:"8"}},[n("el-col",{attrs:{span:"4"}},[n("el-input",{attrs:{placeholder:"输入营销规则ID搜索","prefix-icon":"el-icon-search",size:"small"},model:{value:t.params.id,callback:function(e){t.$set(t.params,"id",e)},expression:"params.id"}})],1),n("el-col",{attrs:{span:"4"}},[n("el-button",{attrs:{size:"small"},on:{click:t.onSearch}},[t._v("搜索")])],1)],1)],1),n("div",{staticClass:"container"},[n("el-table",{staticStyle:{width:"100%"},attrs:{data:t.list,border:""}},[n("el-table-column",{attrs:{align:"center",label:"ID",prop:"id",width:"50"}}),n("el-table-column",{attrs:{label:"营销规则名称",prop:"name"}}),n("el-table-column",{attrs:{label:"规则类型"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[0===i.kind?n("div",[t._v("用户手动领券")]):t._e(),1===i.kind?n("div",[t._v("订单满减")]):t._e(),2===i.kind?n("div",[t._v("订单满赠")]):t._e(),3===i.kind?n("div",[t._v("订单满免运费")]):t._e()]}}])}),n("el-table-column",{attrs:{label:"适用范围"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[0!==i.kind&&0==i.producttype?n("span",[t._v("作用于所有商品")]):t._e(),0!==i.kind&&1==i.producttype?n("span",[t._v("作用于部分商品")]):t._e(),0!==i.kind&&2==i.producttype?n("span",[t._v("不作用于部分商品")]):t._e(),0===i.kind&&0===i.newuser?n("span",[t._v("任何用户均可领取")]):t._e(),0===i.kind&&1===i.newuser?n("span",[t._v("仅限新用户领取")]):t._e()]}}])}),n("el-table-column",{attrs:{label:"赠品"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[i.coupontemplate?n("div",{staticClass:"marketing-link",on:{click:function(e){t.$router.push({name:"marketing-coupon-template-detail",query:{id:i.coupontemplate.id}})}}},[t._v("(券)"+t._s(i.coupontemplate.name))]):t._e(),i.product?n("div",{staticClass:"marketing-link",on:{click:function(e){t.onClickProduct(i.product)}}},[t._v("(商品)"+t._s(i.product.name))]):t._e()]}}])}),n("el-table-column",{attrs:{label:"有效期"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[i.begintime>0||i.endtime>0?n("div",[t._v(t._s(new Date(1e3*i.begintime).toLocaleString("zh-CN",{timeZone:"Asia/Shanghai"}))+" - "+t._s(new Date(1e3*i.endtime).toLocaleString("zh-CN",{timeZone:"Asia/Shanghai"})))]):t._e(),0==i.begintime&&0==i.endtime?n("div",[t._v("不限制")]):t._e()]}}])}),n("el-table-column",{attrs:{align:"center",label:"操作",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-button",{attrs:{size:"small",type:"text"},on:{click:function(n){t.$router.push({name:"marketing-detail",query:{id:e.row.id}})}}},[t._v("明细")]),e.row.deletedat?t._e():n("el-button",{attrs:{size:"small",type:"text"},on:{click:function(n){t.onClickDel(e.row)}}},[t._v("删除")]),e.row.deletedat?n("el-button",{attrs:{size:"small",type:"text"},on:{click:function(n){t.onClickCopy(e.row)}}},[t._v("复制")]):t._e()]}}])})],1),n("div",{staticClass:"table-bottom"},[t.hasMore?n("el-button",{attrs:{loading:t.loadmore,size:"small",type:"primary"},on:{click:t.getMarketings}},[t._v("加载更多")]):n("span",{staticStyle:{color:"#ccc","font-size":"12px"}},[t._v("已经加载全部，没有更多了")])],1)],1)])},H=[],K={components:{"comp-tab":u["a"]},data:function(){return{params:{id:"",kind:-1,isdeleted:2,idlessthan:0,count:20},list:[],loadmore:!1,hasMore:!0,token:""}},created:function(){this.token=Object(k["e"])(),this.getMarketings()},watch:{"params.isdeleted":function(){this.list=[],this.getMarketings()}},methods:{getMarketings:function(){var t=Object(c["a"])(regeneratorRuntime.mark(function t(){var e,n,i,a,s,r;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return this.loadmore=!0,e=window,n=e.scrollY,this.params.idlessthan=this.list.length?this.list[this.list.length-1].id:0,t.next=5,Object(p["a"])("StoreMarketingService.GetMarketingList",Object(d["a"])("MarketingListQueryRequest",Object(l["a"])({token:Object(d["a"])("Token",{token:this.token})},this.params)));case 5:return i=t.sent,a=[],s=[],i.marketinglistList.map(function(t){0===t.kind&&a.push(t.giftid),2===t.kind&&0===t.gifttype&&a.push(t.giftid),2===t.kind&&1===t.gifttype&&s.push(t.giftid)}),t.next=11,Promise.all([a.length?Object(p["a"])("StoreCouponTemplateService.GetCouponTemplateList",Object(d["a"])("CouponTemplateListQueryRequest",{token:Object(d["a"])("Token",{token:this.token}),idlistList:a,count:a.length})):null,s.length?Object(p["a"])("StoreProductService.GetProductList",Object(d["a"])("ProductListQueryRequest",{token:Object(d["a"])("Token",{token:this.token}),idlistList:s,count:s.length,sortby:1,sort:1})):null]);case 11:r=t.sent,i.marketinglistList.forEach(function(t){t.coupontemplate=null,t.product=null,0===t.kind&&(t.coupontemplate=r[0].coupontemplatelistList.find(function(e){return e.id===t.giftid})),2===t.kind&&0===t.gifttype&&(t.coupontemplate=r[0].coupontemplatelistList.find(function(e){return e.id===t.giftid})),2===t.kind&&1===t.gifttype&&(t.product=r[1].productlistList.find(function(e){return e.id===t.giftid}))}),this.list=this.list.concat(i.marketinglistList),this.hasMore=i.marketinglistList.length,0!==this.params.idlessthan&&window.scroll(0,n),this.loadmore=!1;case 17:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),onClickDel:function(t){var e=this;t=JSON.parse(JSON.stringify(t)),t.deletedat=parseInt(Date.now()/1e3),Object(p["a"])("StoreMarketingService.UpdateMarketing",Object(d["a"])("MarketingWithTokenRequest",{token:Object(d["a"])("Token",{token:this.token}),marketing:Object(d["a"])("Marketing",t)})).then(function(t){e.list.splice(e.list.findIndex(function(e){return e.id===t.id}),1,t),e.$message({message:"操作成功",type:"success"})})},onClickProduct:function(t){this.$router.push({name:"products-edit",query:{id:t.id,type:"edit"}})},onClickCopy:function(){var t=Object(c["a"])(regeneratorRuntime.mark(function t(e){var n;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e=JSON.parse(JSON.stringify(e)),e.deletedat=0,t.next=4,Object(p["a"])("StoreMarketingService.CreateMarketing",Object(d["a"])("MarketingWithTokenRequest",{token:Object(d["a"])("Token",{token:this.token}),marketing:Object(d["a"])("Marketing",e)}));case 4:if(n=t.sent,n.coupontemplate=null,n.product=null,2!==n.kind||0!==n.gifttype){t.next=11;break}return t.next=10,Object(p["a"])("StoreCouponTemplateService.GetCouponTemplate",Object(d["a"])("IDWithTokenRequest",{token:Object(d["a"])("Token",{token:this.token}),id:n.giftid}));case 10:n.coupontemplate=t.sent;case 11:if(2!==n.kind||1!==n.gifttype){t.next=15;break}return t.next=14,Object(p["a"])("StoreProductService.GetProduct",Object(d["a"])("IDWithTokenRequest",{token:Object(d["a"])("Token",{token:this.token}),id:n.giftid}));case 14:n.product=t.sent;case 15:this.list.splice(0,0,n),this.$message({message:"操作成功",type:"success"});case 17:case"end":return t.stop()}},t,this)}));function e(e){return t.apply(this,arguments)}return e}(),onSearch:function(){this.list=[],this.getMarketings()}}},V=K,X=(n("87bc"),Object(h["a"])(V,B,H,!1,null,null,null)),tt=X.exports,et={_0:b,_1:S,_2:T,_3:P,_4:Q,_6:F,_7:tt},nt={0:"_0",1:"_1",2:"_2",3:"_3",4:"_4",6:"_6",7:"_7"},it=Object(s["a"])({name:"marketing-list-entry",components:et,map:nt}),at=it,st=Object(h["a"])(at,i,a,!1,null,null,null);e["default"]=st.exports},"20d6":function(t,e,n){"use strict";var i=n("5ca1"),a=n("0a49")(6),s="findIndex",r=!0;s in[]&&Array(1)[s](function(){r=!1}),i(i.P+i.F*r,"Array",{findIndex:function(t){return a(this,t,arguments.length>1?arguments[1]:void 0)}}),n("9c6c")(s)},2695:function(t,e,n){"use strict";var i=n("8f16"),a=n.n(i);a.a},"38c3":function(t,e,n){"use strict";var i=n("ac71"),a=n.n(i);a.a},4945:function(t,e,n){},"56ee":function(t,e,n){"use strict";var i=n("bff6"),a=n.n(i);a.a},"5df3":function(t,e,n){"use strict";var i=n("02f4")(!0);n("01f9")(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,e=this._t,n=this._i;return n>=e.length?{value:void 0,done:!0}:(t=i(e,n),this._i+=t.length,{value:t,done:!1})})},"67cc":function(t,e,n){},"761c":function(t,e,n){},"80bf":function(t,e,n){"use strict";n("96cf");var i=n("1da1"),a=(n("7f7f"),n("a3fb"));e["a"]=function(t){var e=t.name,n=t.components,s=t.map;return{name:e,components:n,data:function(){return{store:{}}},created:function(){var t=Object(i["a"])(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(a["b"])();case 2:this.store=t.sent;case 3:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),render:function(t){return t(s[this.store.kind])}}}},8464:function(t,e,n){},"859a":function(t,e,n){"use strict";var i=n("761c"),a=n.n(i);a.a},"87bc":function(t,e,n){"use strict";var i=n("4945"),a=n.n(i);a.a},"8f16":function(t,e,n){},ab1c:function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"tab"},t._l(t.data,function(e){return n("div",{key:e.label,class:["tab-item",{active:t.value===e.value}],on:{click:function(n){t.onClickItem(e.value)}}},[t._v(t._s(e.label))])}))},a=[],s={props:{data:{type:Array,default:function(){return[{label:"test",value:0},{label:"test2",value:1}]},required:!0},value:{default:"",required:!0}},methods:{onClickItem:function(t){this.$emit("input",t)}}},r=s,o=(n("56ee"),n("2877")),l=Object(o["a"])(r,i,a,!1,null,"5e44c4ee",null);e["a"]=l.exports},ac71:function(t,e,n){},aeb5:function(t,e,n){"use strict";var i=n("67cc"),a=n.n(i);a.a},bf76:function(t,e,n){"use strict";var i=n("8464"),a=n.n(i);a.a},bff6:function(t,e,n){},ec7b:function(t,e,n){"use strict";var i=n("0954"),a=n.n(i);a.a}}]);
//# sourceMappingURL=marketing-list.3e28194a.js.map