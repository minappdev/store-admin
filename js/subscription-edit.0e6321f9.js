(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["subscription-edit"],{"04ec":function(t,e,i){"use strict";var r=i("479b"),n=i.n(r);n.a},"1fe6":function(t,e,i){},"20d6":function(t,e,i){"use strict";var r=i("5ca1"),n=i("0a49")(6),s="findIndex",o=!0;s in[]&&Array(1)[s](function(){o=!1}),r(r.P+r.F*o,"Array",{findIndex:function(t){return n(this,t,arguments.length>1?arguments[1]:void 0)}}),i("9c6c")(s)},2909:function(t,e,i){"use strict";function r(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}function n(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function s(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function o(t){return r(t)||n(t)||s()}i.d(e,"a",function(){return o})},"479b":function(t,e,i){},"51ea":function(t,e,i){"use strict";i.d(e,"a",function(){return r});i("6b54"),i("a481"),i("28a5");var r=function(){var t=(new Date).getTime(),e="xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,function(e){var i=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"===e?i:7&i|8).toString(16)});return e}},"5dbc":function(t,e,i){var r=i("d3f4"),n=i("8b97").set;t.exports=function(t,e,i){var s,o=e.constructor;return o!==i&&"function"==typeof o&&(s=o.prototype)!==i.prototype&&r(s)&&n&&n(t,s),t}},6788:function(t,e,i){"use strict";i.r(e);var r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"subscription-edit"},[i("div",{staticClass:"container"},[i("el-button",{attrs:{size:"small"},on:{click:function(e){t.$router.back()}}},[t._v("返回")])],1),i("div",{staticClass:"container"},[i("el-form",{attrs:{"label-width":"100px","label-position":"left"}},[i("el-form-item",{attrs:{label:"适用商品"}},[i("el-col",{attrs:{span:"16"}},[t._l(t.selectedProducts,function(e,r){return i("el-tag",{key:e.id,staticClass:"selected-product-tag",attrs:{closable:""},on:{close:function(){return t.selectedProducts.splice(r,1)}}},[t._v(t._s(e.name))])}),i("el-button",{staticClass:"add-products-btn",attrs:{size:"small",icon:"el-icon-plus"},on:{click:function(){return t.productListVisible=!0}}}),i("el-dialog",{attrs:{title:"添加商品",visible:t.productListVisible,width:"80%"},on:{"update:visible":function(e){t.productListVisible=e}}},[i("el-input",{staticStyle:{width:"260px"},attrs:{placeholder:"输入商品名称进行搜索",size:"small"},model:{value:t.productName,callback:function(e){t.productName=e},expression:"productName"}}),i("el-button",{staticStyle:{"margin-left":"10px"},attrs:{size:"small"},on:{click:function(){return t.searchProduct()}}},[t._v("搜索")]),i("ul",{staticClass:"product-list"},t._l(t.products,function(e){return i("li",{key:e.id},[i("div",{staticClass:"product-card",class:t.tempList.find(function(t){return e.id===t.id})?"selected":"",on:{click:function(){return t.toggleProduct(e)}}},[i("div",{staticClass:"product-image",style:{backgroundImage:"url("+(e.imagesList&&e.imagesList.length?e.imagesList[0]:"")+")"}}),i("p",{staticClass:"product-name"},[t._v(t._s(e.name))])])])})),i("div",{staticStyle:{"text-align":"center"}},[i("el-button",{attrs:{plain:"",disabled:t.noMoreProducts,size:"small"},on:{click:function(){return t.searchProduct(!0)}}},[t._v("加载更多")])],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"small"},on:{click:function(e){t.productListVisible=!1}}},[t._v("取 消")]),i("el-button",{attrs:{size:"small",type:"primary"},on:{click:t.addProduct}},[t._v("确 定")])],1)],1)],2)],1),i("el-form-item",{attrs:{label:"周期购名"}},[i("el-col",{attrs:{span:"12"}},[i("el-input",{model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1)],1),i("el-form-item",{attrs:{label:"补充简述"}},[i("el-col",{attrs:{span:"12"}},[i("el-input",{attrs:{type:"textarea"},model:{value:t.form.description,callback:function(e){t.$set(t.form,"description",e)},expression:"form.description"}})],1)],1),i("el-form-item",{attrs:{label:"配送周期"}},[i("el-radio",{attrs:{label:1},model:{value:t.form.kind,callback:function(e){t.$set(t.form,"kind",e)},expression:"form.kind"}},[t._v("每日一期")]),i("el-radio",{attrs:{label:2},model:{value:t.form.kind,callback:function(e){t.$set(t.form,"kind",e)},expression:"form.kind"}},[t._v("每周一期")]),i("el-radio",{attrs:{label:3},model:{value:t.form.kind,callback:function(e){t.$set(t.form,"kind",e)},expression:"form.kind"}},[t._v("每月一期")])],1),2===t.form.kind?i("el-form-item",{attrs:{label:"支持周几配送"}},[i("el-col",{attrs:{span:"12"}},t._l(t.days,function(e,r){return i("el-tag",{key:r,staticClass:"day-tag",attrs:{effect:-1===t.form.weeklistList.indexOf(r+1)?"plain":"light"},on:{click:function(){return t.toggleDay(r+1)}}},[t._v("周"+t._s(e))])}))],1):t._e(),3===t.form.kind?i("el-form-item",{attrs:{label:"支持几号配送"}},[i("el-col",{attrs:{span:"12"}},t._l(31,function(e){return i("el-tag",{key:e,staticClass:"date-tag",attrs:{effect:-1===t.form.datelistList.indexOf(e)?"plain":"light"},on:{click:function(){return t.toggleDate(e)}}},[t._v(t._s(e)+"号")])}))],1):t._e(),i("el-form-item",{attrs:{label:"配送提前期"}},[t._v("\n        买家需提前\n        "),i("el-input-number",{staticStyle:{width:"120px"},attrs:{size:"small",min:1},model:{value:t.form.beforedaycount,callback:function(e){t.$set(t.form,"beforedaycount",e)},expression:"form.beforedaycount"}}),t._v("\n        天, 并在\n        "),i("el-input-number",{staticStyle:{width:"120px"},attrs:{size:"small",min:1,max:24},model:{value:t.form.beforeoftheclock,callback:function(e){t.$set(t.form,"beforeoftheclock",e)},expression:"form.beforeoftheclock"}}),t._v("\n        点前下单, 才能在最近的配送周期内送达\n      ")],1),i("el-form-item",{attrs:{label:"起送期数"}},[t._v("\n        订单最少满\n        "),i("el-input-number",{staticStyle:{width:"120px"},attrs:{size:"small",type:""},model:{value:t.form.minissuecount,callback:function(e){t.$set(t.form,"minissuecount",e)},expression:"form.minissuecount"}}),t._v("\n        期起送\n      ")],1)],1)],1),i("div",{staticClass:"container"},[i("div",{staticClass:"buttons"},[t.$route.query.id?i("el-button",{attrs:{type:"primary"},on:{click:t.onUpdate}},[t._v("更新")]):t._e(),t.$route.query.id?t._e():i("el-button",{attrs:{type:"primary"},on:{click:t.onCreate}},[t._v("创建")])],1)])])},n=[],s=(i("20d6"),i("96cf"),i("1da1")),o=i("2909"),a=i("e8e1"),c=i("8e44"),l=i("73cd"),u=i("fbcf"),d={components:{uploadFile:u["a"]},data:function(){return{token:Object(l["e"])(),selectedProducts:[],tempList:[],productListVisible:!1,productName:"",form:{id:this.$route.query.id||null,productidlistList:[],name:"",description:"",kind:1,weeklistList:[],datelistList:[],minissuecount:0,beforedaycount:0,beforeoftheclock:0,enabled:2},fetchProductLoading:!1,products:[],noMoreProducts:!1,days:["一","二","三","四","五","六","日"]}},watch:{productListVisible:function(t){var e=this;t&&(this.tempList=Object(o["a"])(this.selectedProducts),this.$nextTick(function(){e.searchProduct()}))},selectedProducts:function(t){this.form.productidlistList=t.map(function(t){return t.id})}},created:function(){var t=this;this.$route.query.id&&Object(c["a"])("StoreSubscriptionService.GetSubscription",Object(a["a"])("IDWithTokenRequest",{token:Object(a["a"])("Token",{token:Object(l["e"])()}),id:this.$route.query.id})).then(function(e){t.form=e,t.resolveProducts()})},methods:{resolveProducts:function(){var t=Object(s["a"])(regeneratorRuntime.mark(function t(){var e,i;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e=this.form.productidlistList,t.next=3,Object(c["a"])("StoreProductService.GetProductList",Object(a["a"])("ProductListQueryRequest",{token:Object(a["a"])("Token",{token:Object(l["e"])()}),idlistList:e,count:e.length}));case 3:i=t.sent,this.selectedProducts=i.productlistList;case 5:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),searchProduct:function(t){var e=this,i=this.$loading();Object(c["b"])("StoreProductService.GetProductList",Object(a["a"])("ProductListQueryRequest",{token:Object(a["a"])("Token",{token:Object(l["e"])()}),name:this.productName||null,isonline:1,sortby:1,sort:1,count:20,idlessthan:t&&this.products.length?this.products[this.products.length-1].id:null})).then(function(r){i.close(),i=null,r&&r.productlistList&&(e.products=t?e.products.concat(r.productlistList):r.productlistList,r.productlistList.length?e.noMoreProducts=!1:(e.noMoreProducts=!0,e.$message({message:"没有更多了！",type:"info"})))})},onCreate:function(){var t=this,e=JSON.parse(JSON.stringify(this.form));Object(c["a"])("StoreSubscriptionService.CreateSubscription",Object(a["a"])("SubscriptionWithTokenRequest",{token:Object(a["a"])("Token",{token:Object(l["e"])()}),subscription:Object(a["a"])("Subscription",e)})).then(function(e){t.$router.back()})},onUpdate:function(){var t=this,e=JSON.parse(JSON.stringify(this.form));Object(c["a"])("StoreSubscriptionService.UpdateSubscription",Object(a["a"])("SubscriptionWithTokenRequest",{token:Object(a["a"])("Token",{token:Object(l["e"])()}),subscription:Object(a["a"])("Subscription",e)})).then(function(e){t.form=e,t.$message({message:"更新成功",type:"success"})})},toggleProduct:function(t){var e=this.tempList.findIndex(function(e){return e.id===t.id});-1!==e?this.tempList.splice(e,1):this.tempList.push(t)},addProduct:function(){this.selectedProducts=Object(o["a"])(this.tempList),this.productListVisible=!1},toggleDay:function(t){var e=this.form.weeklistList.indexOf(t);-1!==e?this.form.weeklistList.splice(e,1):this.form.weeklistList.push(t)},toggleDate:function(t){var e=this.form.datelistList.indexOf(t);-1!==e?this.form.datelistList.splice(e,1):this.form.datelistList.push(t)}}},f=d,p=(i("04ec"),i("2877")),h=Object(p["a"])(f,r,n,!1,null,"4f6cc634",null);e["default"]=h.exports},7761:function(t,e,i){},"86fe":function(t,e,i){"use strict";var r=i("7761"),n=i.n(r);n.a},"8b97":function(t,e,i){var r=i("d3f4"),n=i("cb7c"),s=function(t,e){if(n(t),!r(e)&&null!==e)throw TypeError(e+": can't set as prototype!")};t.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(t,e,r){try{r=i("9b43")(Function.call,i("11e9").f(Object.prototype,"__proto__").set,2),r(t,[]),e=!(t instanceof Array)}catch(n){e=!0}return function(t,i){return s(t,i),e?t.__proto__=i:r(t,i),t}}({},!1):void 0),check:s}},a481:function(t,e,i){"use strict";var r=i("cb7c"),n=i("4bf8"),s=i("9def"),o=i("4588"),a=i("0390"),c=i("5f1b"),l=Math.max,u=Math.min,d=Math.floor,f=/\$([$&`']|\d\d?|<[^>]*>)/g,p=/\$([$&`']|\d\d?)/g,h=function(t){return void 0===t?t:String(t)};i("214f")("replace",2,function(t,e,i,m){return[function(r,n){var s=t(this),o=void 0==r?void 0:r[e];return void 0!==o?o.call(r,s,n):i.call(String(s),r,n)},function(t,e){var n=m(i,t,this,e);if(n.done)return n.value;var d=r(t),f=String(this),p="function"===typeof e;p||(e=String(e));var b=d.global;if(b){var g=d.unicode;d.lastIndex=0}var y=[];while(1){var x=c(d,f);if(null===x)break;if(y.push(x),!b)break;var k=String(x[0]);""===k&&(d.lastIndex=a(f,s(d.lastIndex),g))}for(var w="",_=0,S=0;S<y.length;S++){x=y[S];for(var O=String(x[0]),L=l(u(o(x.index),f.length),0),j=[],C=1;C<x.length;C++)j.push(h(x[C]));var $=x.groups;if(p){var P=[O].concat(j,L,f);void 0!==$&&P.push($);var I=String(e.apply(void 0,P))}else I=v(O,f,L,j,$,e);L>=_&&(w+=f.slice(_,L)+I,_=L+O.length)}return w+f.slice(_)}];function v(t,e,r,s,o,a){var c=r+t.length,l=s.length,u=p;return void 0!==o&&(o=n(o),u=f),i.call(a,u,function(i,n){var a;switch(n.charAt(0)){case"$":return"$";case"&":return t;case"`":return e.slice(0,r);case"'":return e.slice(c);case"<":a=o[n.slice(1,-1)];break;default:var u=+n;if(0===u)return n;if(u>l){var f=d(u/10);return 0===f?n:f<=l?void 0===s[f-1]?n.charAt(1):s[f-1]+n.charAt(1):n}a=s[u-1]}return void 0===a?"":a})}})},aa77:function(t,e,i){var r=i("5ca1"),n=i("be13"),s=i("79e5"),o=i("fdef"),a="["+o+"]",c="​",l=RegExp("^"+a+a+"*"),u=RegExp(a+a+"*$"),d=function(t,e,i){var n={},a=s(function(){return!!o[t]()||c[t]()!=c}),l=n[t]=a?e(f):o[t];i&&(n[i]=l),r(r.P+r.F*a,"String",n)},f=d.trim=function(t,e){return t=String(n(t)),1&e&&(t=t.replace(l,"")),2&e&&(t=t.replace(u,"")),t};t.exports=d},c5f6:function(t,e,i){"use strict";var r=i("7726"),n=i("69a8"),s=i("2d95"),o=i("5dbc"),a=i("6a99"),c=i("79e5"),l=i("9093").f,u=i("11e9").f,d=i("86cc").f,f=i("aa77").trim,p="Number",h=r[p],m=h,v=h.prototype,b=s(i("2aeb")(v))==p,g="trim"in String.prototype,y=function(t){var e=a(t,!1);if("string"==typeof e&&e.length>2){e=g?e.trim():f(e,3);var i,r,n,s=e.charCodeAt(0);if(43===s||45===s){if(i=e.charCodeAt(2),88===i||120===i)return NaN}else if(48===s){switch(e.charCodeAt(1)){case 66:case 98:r=2,n=49;break;case 79:case 111:r=8,n=55;break;default:return+e}for(var o,c=e.slice(2),l=0,u=c.length;l<u;l++)if(o=c.charCodeAt(l),o<48||o>n)return NaN;return parseInt(c,r)}}return+e};if(!h(" 0o1")||!h("0b1")||h("+0x1")){h=function(t){var e=arguments.length<1?0:t,i=this;return i instanceof h&&(b?c(function(){v.valueOf.call(i)}):s(i)!=p)?o(new m(y(e)),i,h):y(e)};for(var x,k=i("9e1e")?l(m):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),w=0;k.length>w;w++)n(m,x=k[w])&&!n(h,x)&&d(h,x,u(m,x));h.prototype=v,v.constructor=h,i("2aba")(r,p,h)}},f865:function(t,e,i){"use strict";var r=i("1fe6"),n=i.n(r);n.a},fbcf:function(t,e,i){"use strict";var r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"upload-file"},[i("div",{staticClass:"preview-list"},[t._l(t.list,function(e){return i("div",{key:e,staticClass:"preview-item",style:t.previewStyle},[t.disabled?i("div",{staticClass:"preview-cover"}):t._e(),t._t("preview",[i("div",{style:t.previewStyle},[i("comp-imger",{attrs:{src:e}})],1)]),t.disabled?t._e():t._t("hover",[i("div",{staticClass:"preview-del",style:t.previewStyle},[i("div",{staticClass:"preview-box"},[i("div",{staticClass:"preview-text",on:{click:function(i){t.onClickImg(e)}}},[t._v("删除")]),i("div",{staticClass:"preview-text",on:{click:function(i){t.onClickPreviewImg(e)}}},[t._v("预览")])])])])],2)}),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.hideUpLoadTrigger,expression:"!hideUpLoadTrigger"}],ref:"addBtn",staticClass:"trigger-container",style:t.previewStyle},[i("label",{style:t.previewStyle,attrs:{for:""+t.counter+t.previews.length}},[t._t("trigger",[i("div",{staticClass:"upload-trigger",style:t.previewStyle},[t._v("+")])])],2)])],2),t._l(t.previews.length+1,function(e,r){return i("input",{key:""+r+t.counter,attrs:{accept:t.accept,id:""+t.counter+r,multiple:1!==t.limit,hidden:"",type:"file"},on:{change:t.onChange}})})],2)},n=[],s=i("2909"),o=(i("ac6a"),i("20d6"),i("a481"),i("6b54"),i("c5f6"),i("28a5"),i("f6b5")),a=i.n(o),c=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.show?i("div",{staticClass:"comp-frame_cover",on:{click:function(e){return e.target!==e.currentTarget?null:t.hide(e)}}},[i("div",{staticClass:"comp-frame_content"},["image"===t.type?i("img",{staticClass:"comp-frame_content",attrs:{src:t.src}}):i("video",{staticClass:"comp-frame_content",attrs:{src:t.src,autoplay:"",controls:""}})])]):t._e()},l=[],u={data:function(){return{show:!1,src:"",type:"image"}},methods:{hide:function(){this.show=!1}}},d=u,f=(i("86fe"),i("2877")),p=Object(f["a"])(d,c,l,!1,null,null,null),h=p.exports,m=a.a.extend(h),v=new m({el:document.createElement("div")});document.body.appendChild(v.$el);var b={show:function(t){v.show=!0,v.src=t.src,v.type=(t.type||"image/").split("/")[0]}},g=b,y=i("51ea"),x=i("a1bc"),k={inject:{elForm:{default:""},elFormItem:{default:""}},props:{accept:{type:String},limit:{type:Number,default:1,required:!0},value:{default:""},fileurl:{default:""},width:{default:120},height:{default:120}},watch:{value:function(t){var e=[];"string"===typeof t&&t&&e.push(t),"[object Array]"===Object.prototype.toString.apply(t)&&(e=t),this.previews=e}},computed:{list:function(){return this.previews.length?this.previews:[]},hideUpLoadTrigger:function(){return this.limit<=this.previews.length},disabled:function(){return this.elForm.disabled||this.elFormItem.disabled}},data:function(){var t=[];"string"===typeof this.value&&this.value&&t.push(this.value),"[object Array]"===Object.prototype.toString.apply(this.value)&&(t=this.value);var e="string"===typeof this.width?this.width:"".concat(this.width,"px"),i="string"===typeof this.height?this.height:"".concat(this.height,"px"),r="".concat(Number(Math.max(e.replace("px",""),i.replace("px","")))/5,"px");return{previews:t,previewStyle:{width:e,height:i,fontSize:r},counter:Object(y["a"])(),loading:null}},methods:{onClickImg:function(t){this.counter=Object(y["a"])();var e=this.previews.findIndex(function(e){return e===t});this.previews.splice(e,1),this.$emit("input",this.previews)},onClickPreviewImg:function(t){this.accept?g.show({src:t,type:this.accept}):g.show({src:t})},onChange:function(t){var e=this;t.target.files.length>this.limit?this.$message("限制为".concat(this.limit,"个文件")):Object(s["a"])(t.target.files).forEach(function(t){return e.upload(t)})},upload:function(t){var e=this;this.loading=this.$loading({target:this.$refs.addBtn});var i=new FormData;i.append("file",t),fetch("https://"+x["a"].domain+"/up",{method:"POST",body:i,headers:{Accept:"application/json"}}).then(function(t){return e.loading&&e.loading.close(),e.loading=null,t.json()}).then(function(t){var i="".concat(e.fileurl).concat(t.file);e.previews.push(i),1===e.limit?(e.$emit("input",i),e.$emit("success",i)):(e.$emit("input",e.previews),e.$emit("success",e.previews))}).catch(function(){e.loading&&e.loading.close(),e.loading=null})}}},w=k,_=(i("f865"),Object(f["a"])(w,r,n,!1,null,null,null));e["a"]=_.exports},fdef:function(t,e){t.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"}}]);
//# sourceMappingURL=subscription-edit.0e6321f9.js.map