(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["order-index"],{"0e8a":function(e,t,i){},"13df":function(e,t,i){},"1acf":function(e,t,i){},"20d6":function(e,t,i){"use strict";var s=i("5ca1"),r=i("0a49")(6),a="findIndex",n=!0;a in[]&&Array(1)[a](function(){n=!1}),s(s.P+s.F*n,"Array",{findIndex:function(e){return r(this,e,arguments.length>1?arguments[1]:void 0)}}),i("9c6c")(a)},"56ee":function(e,t,i){"use strict";var s=i("bff6"),r=i.n(s);r.a},"5df3":function(e,t,i){"use strict";var s=i("02f4")(!0);i("01f9")(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,i=this._i;return i>=t.length?{value:void 0,done:!0}:(e=s(t,i),this._i+=e.length,{value:e,done:!1})})},"608f":function(e,t,i){},6719:function(e,t,i){"use strict";var s=i("608f"),r=i.n(s);r.a},6841:function(e,t,i){},"6af2":function(e,t,i){"use strict";i.r(t);var s,r,a=i("80bf"),n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("div",{staticClass:"container"},[i("el-form",{attrs:{"label-position":"left","label-width":"90px",size:"mini"}},[i("el-row",{attrs:{gutter:20}},[i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"订单号"}},[i("el-input",{staticClass:"input-width",attrs:{placeholder:"请输入订单号"},model:{value:e.params.id,callback:function(t){e.$set(e.params,"id",t)},expression:"params.id"}})],1)],1),i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"买家手机号"}},[i("el-input",{staticClass:"input-width",attrs:{placeholder:"请输入买家手机号"},model:{value:e.params.delivermobile,callback:function(t){e.$set(e.params,"delivermobile",t)},expression:"params.delivermobile"}})],1)],1)],1),i("el-row",{attrs:{gutter:20}},[i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"订单类型"}},[i("el-select",{attrs:{placeholder:"请选择订单类型"},model:{value:e.params.ordertype,callback:function(t){e.$set(e.params,"ordertype",t)},expression:"params.ordertype"}},[i("el-option",{attrs:{label:"全部",value:0}}),i("el-option",{attrs:{label:"团购订单",value:1}})],1)],1)],1),i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"是否分销"}},[i("el-select",{attrs:{placeholder:"请选择订单类型"},model:{value:e.params.isprofitsharing,callback:function(t){e.$set(e.params,"isprofitsharing",t)},expression:"params.isprofitsharing"}},[i("el-option",{attrs:{label:"全部",value:0}}),i("el-option",{attrs:{label:"非分销",value:1}}),i("el-option",{attrs:{label:"分销单",value:2}})],1)],1)],1)],1),i("el-row",{attrs:{gutter:20}},[i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"下单时间"}},[i("el-date-picker",{attrs:{"picker-options":e.pickerOptions,"end-placeholder":"结束日期","range-separator":"至","start-placeholder":"开始日期",type:"daterange","unlink-panels":""},model:{value:e.params.time,callback:function(t){e.$set(e.params,"time",t)},expression:"params.time"}})],1)],1)],1)],1),i("el-button",{attrs:{size:"small"},on:{click:e.onClickFilter}},[e._v("筛选")]),i("el-button",{staticStyle:{color:"#4E759E"},attrs:{size:"small",type:"text"},on:{click:e.onClickClearFilter}},[e._v("清空筛选条件")])],1),i("div",{staticClass:"container"},[i("comp-tab",{attrs:{data:e.tabs},model:{value:e.params.status,callback:function(t){e.$set(e.params,"status",t)},expression:"params.status"}})],1),i("div",{staticClass:"container"},[e._l(e.list,function(t){return i("div",{key:t.id,staticClass:"item"},[i("div",{staticClass:"order-detail"},[i("div",[i("span",{staticClass:"order-detail_text"},[e._v(e._s(t.id))]),t.groupuuid?i("span",{staticClass:"invoice m10"},[e._v(e._s("拼团 ID: "+t.groupuuid+" "+(2===t.grouplead?"团长代收":"单独发货")))]):e._e(),t.needinvoice?i("span",{staticClass:"invoice m10"},[e._v("需要开发票")]):e._e()]),i("div",[i("span",{staticClass:"order-detail_text m10"},[e._v(e._s(t.user.nickname)+" "+e._s(t.user.mobile))]),2===t.user.isvip?i("span",{staticClass:"member-tag",staticStyle:{padding:"0 4px"}},[e._v("会员")]):e._e(),i("span",{staticClass:"order-detail_text m10"},[e._v(e._s(new Date(1e3*t.createdat).toLocaleString("zh-CN",{timeZone:"Asia/Shanghai"})))]),i("el-button",{attrs:{size:"small",type:"text"},on:{click:function(i){e.$router.push({name:"order-detail",query:{id:t.id}})}}},[e._v("查看详情")])],1)]),i("div",{staticClass:"table"},[i("div",{staticClass:"products"},e._l(t.orderproductsList,function(t){return i("div",{key:t.id,staticClass:"product"},[i("div",{staticClass:"product-info"},[i("div",{staticClass:"product-img"},[i("comp-imger",{attrs:{src:t.product.imagesList.length?t.product.imagesList[0]:""}})],1),i("div",[i("div",{staticClass:"product-name"},[e._v(e._s(t.product.name))]),i("div",{staticClass:"product-desc"},[e._v(e._s(t.optionname&&"("+Object.values(JSON.parse(t.optionname)).join(", ")+")"))])])]),i("div",{staticClass:"price"},[e._v(e._s(e.$amount1(t.amount))+" 元")]),i("div",{staticClass:"count"},[e._v(e._s(t.quantity)+" 个")])])})),i("div",{staticClass:"action"},[i("span",{staticClass:"action-text"},[e._v(e._s(e.map[t.status]||"非此类型商城该有状态"))]),12==t.status?i("el-button",{attrs:{size:"small",type:"text"},on:{click:function(i){e.updateOrder(t,2)}}},[e._v("拒绝退款")]):e._e(),2==t.status?i("el-button",{attrs:{size:"small",type:"text"},on:{click:function(i){e.updateOrder(t,3)}}},[e._v("发货")]):e._e(),12==t.status?i("el-button",{attrs:{size:"small",type:"text"},on:{click:function(i){e.updateOrder(t,8)}}},[e._v("同意退款")]):e._e(),2==t.status?i("el-button",{attrs:{size:"small",type:"text"},on:{click:function(i){e.updateOrder(t,8)}}},[e._v("缺货直接退款")]):e._e(),7==t.status?i("el-button",{attrs:{size:"small",type:"text"},on:{click:function(i){e.updateOrder(t,8)}}},[e._v("收到退货确认退款")]):e._e(),9==t.status?i("el-button",{attrs:{size:"small",type:"text"},on:{click:function(i){e.updateOrder(t,7)}}},[e._v("同意退货")]):e._e(),9==t.status?i("el-button",{attrs:{size:"small",type:"text"},on:{click:function(i){e.updateOrder(t,10)}}},[e._v("拒绝退货")]):e._e(),7==t.status?i("el-button",{attrs:{size:"small",type:"text"},on:{click:function(i){e.updateOrder(t,11)}}},[e._v("未收到退货等因素拒绝退款")]):e._e()],1)]),i("el-dialog",{attrs:{visible:e.dialogFormVisible,title:"确认发货",width:"400px"},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[i("el-form",{attrs:{"label-width":"80px",size:"small"}},[i("el-form-item",{attrs:{label:"物流公司"}},[i("el-select",{attrs:{placeholder:"请选择物流公司"},model:{value:e.shipindex,callback:function(t){e.shipindex=t},expression:"shipindex"}},e._l(e.shiplist,function(e,t){return i("el-option",{key:t,attrs:{label:e.name,value:t}})}))],1)],1),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),i("el-button",{attrs:{disabled:null===e.shipindex,type:"primary"},on:{click:e.updateOrderShipping}},[e._v("确 定")])],1)],1)],1)}),e.list.length?e._e():i("div",{staticClass:"list-nodata"},[i("div",{staticClass:"fs"},[e._v("暂无数据")])]),e.list.length?i("div",{staticClass:"table-bottom",staticStyle:{"margin-bottom":"10px"}},[e.hasMore?i("el-button",{attrs:{loading:e.loadmore,size:"small",type:"primary"},on:{click:e.getOrders}},[e._v("加载更多")]):i("p",{staticStyle:{color:"#ccc","font-size":"12px"}},[e._v("已加载全部，没有更多了")])],1):e._e()],2)])},o=[],l=(i("20d6"),i("be94")),c=(i("7514"),i("5df3"),i("96cf"),i("1da1")),d=(i("ac6a"),i("ab1c")),u=i("e8e1"),p=i("8e44"),m=i("73cd"),v={shortcuts:[{text:"最近一周",onClick:function(e){var t=new Date,i=new Date;i.setTime(i.getTime()-6048e5),e.$emit("pick",[i,t])}},{text:"最近一个月",onClick:function(e){var t=new Date,i=new Date;i.setTime(i.getTime()-2592e6),e.$emit("pick",[i,t])}}]},h={0:"等待买家支付",1:"拼团中",2:"待发货",3:"等待买家收货",4:"买家已收货",5:"团购失败",6:"买家已取消订单",7:"退货中",8:"已退款",9:"买家申请退货",10:"拒绝买家退货",11:"同意退货但拒绝退款",12:"买家申请退款"},b={components:{"comp-tab":d["a"]},name:"order-list",watch:{"params.status":function(){this.list=[],this.getOrders()}},data:function(){return{tabs:[{label:"全部订单",value:-1},{label:"未支付",value:0},{label:"拼团中",value:1},{label:"待发货",value:2},{label:"待收货",value:3},{label:"已收货",value:4},{label:"团购失败",value:5},{label:"申请退款",value:12},{label:"申请退货",value:9},{label:"已取消",value:6}],pickerOptions:v,dialogFormVisible:!1,list:[],params:{id:"",status:-1,statuslistList:null,idlessthan:0,createdatgreaterthan:0,createdatlessthan:0,sortby:1,sort:1,deliverkind:0,desk:"",daynumber:"",count:20,delivermobile:"",isgroup:0,issubscription:0,isprofitsharing:0,ordertype:0,time:[]},shippingrow:null,shiplist:[],shipindex:null,loadmore:!1,hasMore:!0,map:h}},created:function(){var e=this;this.token=Object(m["e"])(),Object(p["a"])("StoreDeliveryService.GetDeliveryList",Object(u["a"])("DeliveryListQueryRequest",{token:Object(u["a"])("Token",{token:this.token}),count:100})).then(function(t){var i=[];t.deliverylistList.forEach(function(e){"BEST"===e.deliveryid&&i.push({name:"".concat(e.deliveryname,"-标准快递(").concat(e.bizid,")"),shippingcompany:"".concat(e.deliveryname,"-标准快递"),deliveryid:e.deliveryid,bizid:e.bizid,servicetype:1,servicevalue:"标准快递"}),"DB"===e.deliveryid&&(i.push({name:"".concat(e.deliveryname,"-大件快递3.60(").concat(e.bizid,")"),shippingcompany:"".concat(e.deliveryname,"-大件快递3.60"),deliveryid:e.deliveryid,bizid:e.bizid,servicetype:1,servicevalue:"大件快递3.60"}),i.push({name:"".concat(e.deliveryname,"-特准快件(").concat(e.bizid,")"),shippingcompany:"".concat(e.deliveryname,"-特准快件"),deliveryid:e.deliveryid,bizid:e.bizid,servicetype:2,servicevalue:"特准快件"})),"EMS"===e.deliveryid&&(i.push({name:"".concat(e.deliveryname,"-标准快递(").concat(e.bizid,")"),shippingcompany:"".concat(e.deliveryname,"-标准快递"),deliveryid:e.deliveryid,bizid:e.bizid,servicetype:6,servicevalue:"标准快递"}),i.push({name:"".concat(e.deliveryname,"-快递包裹(").concat(e.bizid,")"),shippingcompany:"".concat(e.deliveryname,"-快递包裹"),deliveryid:e.deliveryid,bizid:e.bizid,servicetype:9,servicevalue:"快递包裹"})),"OTP"===e.deliveryid&&i.push({name:"".concat(e.deliveryname,"-标准快递(").concat(e.bizid,")"),shippingcompany:"".concat(e.deliveryname,"-标准快递"),deliveryid:e.deliveryid,bizid:e.bizid,servicetype:1,servicevalue:"标准快递"}),"PJ"===e.deliveryid&&i.push({name:"".concat(e.deliveryname,"-标准快递(").concat(e.bizid,")"),shippingcompany:"".concat(e.deliveryname,"-标准快递"),deliveryid:e.deliveryid,bizid:e.bizid,servicetype:1,servicevalue:"标准快递"}),"SF"===e.deliveryid&&(i.push({name:"".concat(e.deliveryname,"-标准快递(").concat(e.bizid,")"),shippingcompany:"".concat(e.deliveryname,"-标准快递"),deliveryid:e.deliveryid,bizid:e.bizid,servicetype:0,servicevalue:"标准快递"}),i.push({name:"".concat(e.deliveryname,"-顺丰即日(").concat(e.bizid,")"),shippingcompany:"".concat(e.deliveryname,"-顺丰即日"),deliveryid:e.deliveryid,bizid:e.bizid,servicetype:1,servicevalue:"顺丰即日"}),i.push({name:"".concat(e.deliveryname,"-顺丰次晨(").concat(e.bizid,")"),shippingcompany:"".concat(e.deliveryname,"-顺丰次晨"),deliveryid:e.deliveryid,bizid:e.bizid,servicetype:2,servicevalue:"顺丰次晨"}),i.push({name:"".concat(e.deliveryname,"-顺丰标快(").concat(e.bizid,")"),shippingcompany:"".concat(e.deliveryname,"-顺丰标快"),deliveryid:e.deliveryid,bizid:e.bizid,servicetype:3,servicevalue:"顺丰标快"}),i.push({name:"".concat(e.deliveryname,"-顺丰特惠(").concat(e.bizid,")"),shippingcompany:"".concat(e.deliveryname,"-顺丰特惠"),deliveryid:e.deliveryid,bizid:e.bizid,servicetype:4,servicevalue:"顺丰特惠"})),"STO"===e.deliveryid&&i.push({name:"".concat(e.deliveryname,"-标准快递(").concat(e.bizid,")"),shippingcompany:"".concat(e.deliveryname,"-标准快递"),deliveryid:e.deliveryid,bizid:e.bizid,servicetype:1,servicevalue:"标准快递"}),"YTO"===e.deliveryid&&(i.push({name:"".concat(e.deliveryname,"-普通快递(").concat(e.bizid,")"),shippingcompany:"".concat(e.deliveryname,"-普通快递"),deliveryid:e.deliveryid,bizid:e.bizid,servicetype:0,servicevalue:"普通快递"}),i.push({name:"".concat(e.deliveryname,"-圆准达(").concat(e.bizid,")"),shippingcompany:"".concat(e.deliveryname,"-圆准达"),deliveryid:e.deliveryid,bizid:e.bizid,servicetype:1,servicevalue:"圆准达"})),"YUNDA"===e.deliveryid&&i.push({name:"".concat(e.deliveryname,"-标准快件(").concat(e.bizid,")"),shippingcompany:"".concat(e.deliveryname,"-标准快件"),deliveryid:e.deliveryid,bizid:e.bizid,servicetype:0,servicevalue:"标准快件"}),"ZTO"===e.deliveryid&&i.push({name:"".concat(e.deliveryname,"-标准快件(").concat(e.bizid,")"),shippingcompany:"".concat(e.deliveryname,"-标准快件"),deliveryid:e.deliveryid,bizid:e.bizid,servicetype:0,servicevalue:"标准快件"})}),i.push({name:"德邦快递-大件快递3.60(现付)",shippingcompany:"德邦快递-大件快递3.60",deliveryid:"DB",bizid:"DB_CASH",servicetype:1,servicevalue:"大件快递3.60"}),i.push({name:"德邦快递-特准快件(现付)",shippingcompany:"德邦快递-特准快件",deliveryid:"DB",bizid:"DB_CASH",servicetype:2,servicevalue:"特准快件"}),i.push({name:"顺丰速运-标准快递(现付)",shippingcompany:"顺丰速运-标准快递",deliveryid:"SF",bizid:"SF_CASH",servicetype:0,servicevalue:"标准快递"}),i.push({name:"顺丰速运-顺丰即日(现付)",shippingcompany:"顺丰速运-顺丰即日",deliveryid:"SF",bizid:"SF_CASH",servicetype:1,servicevalue:"顺丰即日"}),i.push({name:"顺丰速运-顺丰次晨(现付)",shippingcompany:"顺丰速运-顺丰次晨",deliveryid:"SF",bizid:"SF_CASH",servicetype:2,servicevalue:"顺丰次晨"}),i.push({name:"顺丰速运-顺丰标快(现付)",shippingcompany:"顺丰速运-顺丰标快",deliveryid:"SF",bizid:"SF_CASH",servicetype:3,servicevalue:"顺丰标快"}),i.push({name:"顺丰速运-顺丰特惠(现付)",shippingcompany:"顺丰速运-顺丰特惠",deliveryid:"SF",bizid:"SF_CASH",servicetype:4,servicevalue:"顺丰特惠"}),i.push({name:"商家自配送",shippingcompany:"商家自配送",deliveryid:"",bizid:"",servicetype:0,servicevalue:""}),e.shiplist=i}),this.getOrders(),this.conn=null;var t=function t(){-1!==e.conn&&(e.conn=Object(u["b"])("StoreNotificationService.GetNotification",Object(u["a"])("Token",{token:e.token}),function(){var t=Object(c["a"])(regeneratorRuntime.mark(function t(i){var s,r;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(1===i.kind){t.next=2;break}return t.abrupt("return");case 2:return s=i.order,t.next=5,Promise.all([Object(p["b"])("StoreUserService.GetUser",Object(u["a"])("IDWithTokenRequest",{token:Object(u["a"])("Token",{token:e.token}),id:s.userid})),Object(p["b"])("StoreProductService.GetProductList",Object(u["a"])("ProductListQueryRequest",{token:Object(u["a"])("Token",{token:e.token}),idlistList:s.orderproductsList.map(function(e){return e.productid}),sortby:1,sort:1,count:s.orderproductsList.map(function(e){return e.productid}).length}))]);case 5:r=t.sent,s.user=r[0],s.orderproductsList.forEach(function(e){e.product=r[1].productlistList.find(function(t){return t.id===e.productid})}),e.list.splice(0,0,s);case 9:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),function(e){console.log(e),setTimeout(t,2e3)}))};t()},beforeDestroy:function(){this.conn.close(),this.conn=-1},methods:{getOrders:function(){var e=Object(c["a"])(regeneratorRuntime.mark(function e(){var t,i,s,r,a,n,o;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(this.loadmore=!0,t=window,i=t.scrollY,this.params.createdatgreaterthan=0,this.params.createdatlessthan=0,2===this.params.time.length&&(this.params.createdatgreaterthan=parseInt(this.params.time[0].getTime()/1e3),this.params.createdatlessthan=parseInt(this.params.time[1].getTime()/1e3)),this.params.isgroup=0,0!=this.params.ordertype&&1==this.params.ordertype&&(this.params.isgroup=1),!this.params.delivermobile){e.next=12;break}return e.next=10,Object(p["a"])("StoreUserService.GetUserList",Object(u["a"])("UserListQueryRequest",{token:Object(u["a"])("Token",{token:this.token}),mobile:this.params.delivermobile,count:1,order:0}));case 10:s=e.sent,this.params.userid=s.userlistList.length?s.userlistList[0].id:0;case 12:return this.params.idlessthan=this.list.length?this.list[this.list.length-1].id:0,e.next=15,Object(p["a"])("StoreOrderService.GetOrderList",Object(u["a"])("OrderListQueryRequest",Object(l["a"])({token:Object(u["a"])("Token",{token:this.token})},this.params)));case 15:if(r=e.sent,0!==r.orderlistList.length){e.next=20;break}return this.loadmore=!1,this.hasMore=!1,e.abrupt("return");case 20:return a=r.orderlistList.map(function(e){return e.userid}),n=[],r.orderlistList.forEach(function(e){e.orderproductsList.forEach(function(e){n.push(e.productid)})}),e.next=25,Promise.all([Object(p["a"])("StoreUserService.GetUserList",Object(u["a"])("UserListQueryRequest",{token:Object(u["a"])("Token",{token:this.token}),idlistList:a,count:a.length,order:0})),Object(p["a"])("StoreProductService.GetProductList",Object(u["a"])("ProductListQueryRequest",{token:Object(u["a"])("Token",{token:this.token}),idlistList:n,sortby:1,sort:1,count:n.length}))]);case 25:o=e.sent,r.orderlistList.forEach(function(e){e.user=o[0].userlistList.find(function(t){return t.id===e.userid}),e.orderproductsList.forEach(function(e){e.product=o[1].productlistList.find(function(t){return t.id===e.productid})})}),this.list=this.list.concat(r.orderlistList),this.hasMore=r.orderlistList.length,this.loadmore=!1,0!==this.params.idlessthan&&window.scroll(0,i);case 31:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),updateOrder:function(e,t){var i=this;if(e=JSON.parse(JSON.stringify(e)),3==t)return this.shippingrow=e,void(this.dialogFormVisible=!0);e.status=t,Object(p["a"])("StoreOrderService.UpdateOrder",Object(u["a"])("OrderWithTokenRequest",{token:Object(u["a"])("Token",{token:this.token}),order:Object(u["a"])("Order",Object(l["a"])({},e,{address:Object(u["a"])("Address",e.address),invoice:Object(u["a"])("Invoice",e.invoice),orderproductsList:e.orderproductsList.map(function(e){return Object(u["a"])("OrderProduct",e)})}))})).then(function(t){i.list.splice(i.list.findIndex(function(e){return e.id===t.id}),1,e),i.$message({message:"操作成功",type:"success"})})},updateOrderShipping:function(){var e=this,t=JSON.parse(JSON.stringify(this.shippingrow));t.status=3,t.shippingcompany=this.shiplist[this.shipindex].shippingcompany,Object(p["a"])("StoreOrderService.UpdateOrder",Object(u["a"])("OrderWithTokenRequest",Object(l["a"])({token:Object(u["a"])("Token",{token:this.token}),order:Object(u["a"])("Order",Object(l["a"])({},t,{address:Object(u["a"])("Address",t.address),invoice:Object(u["a"])("Invoice",t.invoice),orderproductsList:t.orderproductsList.map(function(e){return Object(u["a"])("OrderProduct",e)})}))},this.shiplist[this.shipindex]))).then(function(i){e.list.splice(e.list.findIndex(function(e){return e.id===i.id}),1,t),e.dialogFormVisible=!1,e.$message({message:"操作成功",type:"success"})})},onClickFilter:function(){this.list=[],this.getOrders()},onClickClearFilter:function(){this.params={id:"",status:-1,statuslistList:null,idlessthan:0,createdatgreaterthan:0,createdatlessthan:0,sortby:1,sort:1,deliverkind:0,desk:"",daynumber:"",count:20,delivermobile:"",isgroup:0,issubscription:0,ordertype:0,time:[]},this.list=[],this.getOrders()}}},f=b,k=(i("dff5"),i("2877")),y=Object(k["a"])(f,n,o,!1,null,"398f1610",null),g=y.exports,O=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("div",{staticClass:"container"},[i("el-form",{attrs:{"label-position":"left","label-width":"90px",size:"mini"}},[i("el-row",{attrs:{gutter:20}},[i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"订单号"}},[i("el-input",{staticClass:"input-width",attrs:{placeholder:"请输入订单号"},model:{value:e.params.id,callback:function(t){e.$set(e.params,"id",t)},expression:"params.id"}})],1)],1),i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"买家手机号"}},[i("el-input",{staticClass:"input-width",attrs:{placeholder:"请输入买家手机号"},model:{value:e.params.delivermobile,callback:function(t){e.$set(e.params,"delivermobile",t)},expression:"params.delivermobile"}})],1)],1)],1),i("el-row",{attrs:{gutter:20}},[i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"订单类型"}},[i("el-select",{attrs:{placeholder:"请选择订单类型"},model:{value:e.params.ordertype,callback:function(t){e.$set(e.params,"ordertype",t)},expression:"params.ordertype"}},[i("el-option",{attrs:{label:"全部",value:0}}),i("el-option",{attrs:{label:"团购订单",value:1}})],1)],1)],1),i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"是否分销"}},[i("el-select",{attrs:{placeholder:"请选择订单类型"},model:{value:e.params.isprofitsharing,callback:function(t){e.$set(e.params,"isprofitsharing",t)},expression:"params.isprofitsharing"}},[i("el-option",{attrs:{label:"全部",value:0}}),i("el-option",{attrs:{label:"非分销",value:1}}),i("el-option",{attrs:{label:"分销单",value:2}})],1)],1)],1)],1),i("el-row",{attrs:{gutter:20}},[i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"下单时间"}},[i("el-date-picker",{attrs:{"picker-options":e.pickerOptions,"end-placeholder":"结束日期","range-separator":"至","start-placeholder":"开始日期",type:"daterange","unlink-panels":""},model:{value:e.params.time,callback:function(t){e.$set(e.params,"time",t)},expression:"params.time"}})],1)],1)],1)],1),i("el-button",{attrs:{size:"small"},on:{click:e.onClickFilter}},[e._v("筛选")]),i("el-button",{staticStyle:{color:"#4E759E"},attrs:{size:"small",type:"text"},on:{click:e.onClickClearFilter}},[e._v("清空筛选条件")])],1),i("div",{staticClass:"container"},[i("comp-tab",{attrs:{data:e.tabs},model:{value:e.params.status,callback:function(t){e.$set(e.params,"status",t)},expression:"params.status"}})],1),i("div",{staticClass:"container"},[e._l(e.list,function(t){return i("div",{key:t.id,staticClass:"item"},[i("div",{staticClass:"order-detail"},[i("div",[i("span",{staticClass:"order-detail_text"},[e._v(e._s(t.id))]),t.groupuuid?i("span",{staticClass:"invoice m10"},[e._v(e._s("拼团 ID: "+t.groupuuid))]):e._e(),t.needinvoice?i("span",{staticClass:"invoice m10"},[e._v("需要开发票")]):e._e()]),i("div",[i("span",{staticClass:"order-detail_text m10"},[e._v(e._s(t.user.nickname)+" "+e._s(t.user.mobile))]),2===t.user.isvip?i("span",{staticClass:"member-tag",staticStyle:{padding:"0 4px"}},[e._v("会员")]):e._e(),i("span",{staticClass:"order-detail_text m10"},[e._v(e._s(new Date(1e3*t.createdat).toLocaleString("zh-CN",{timeZone:"Asia/Shanghai"})))]),i("el-button",{attrs:{size:"small",type:"text"},on:{click:function(i){e.$router.push({name:"order-detail",query:{id:t.id}})}}},[e._v("查看详情")])],1)]),i("div",{staticClass:"table"},[i("div",{staticClass:"products"},e._l(t.orderproductsList,function(s){return i("div",{key:s.id,staticClass:"product"},[i("div",{staticClass:"product-info"},[i("div",{staticClass:"product-img"},[i("comp-imger",{attrs:{src:s.product.imagesList.length?s.product.imagesList[0]:""}})],1),i("div",[i("div",{staticClass:"product-name"},[e._v(e._s(s.product.name))])])]),i("div",{staticClass:"price"},[e._v(e._s(e.$amount1(s.amount))+" 元")]),i("div",{staticClass:"count"},[e._v(e._s(s.quantity)+" 个")]),2==t.status?i("div",{staticClass:"count"},[1==s.confirmed?i("el-button",{attrs:{size:"small",type:"text"},on:{click:function(i){e.updateOrderProduct(t,s,2)}}},[e._v("核销")]):e._e(),2==s.confirmed?i("span",{staticClass:"action-text"},[e._v("已核销")]):e._e()],1):e._e(),2!=t.status?i("div",{staticClass:"count"},[i("span",{staticClass:"action-text"},[e._v("/")])]):e._e()])})),i("div",{staticClass:"action"},[i("span",{staticClass:"action-text"},[e._v(e._s(e.map[t.status]||"非此类型商城该有状态"))]),12==t.status?i("el-button",{attrs:{size:"small",type:"text"},on:{click:function(i){e.updateOrder(t,2)}}},[e._v("拒绝退款")]):e._e(),2==t.status?i("el-button",{attrs:{size:"small",type:"text"},on:{click:function(i){e.updateOrder(t,3)}}},[e._v("全部核销")]):e._e(),12==t.status?i("el-button",{attrs:{size:"small",type:"text"},on:{click:function(i){e.updateOrder(t,8)}}},[e._v("同意退款")]):e._e(),2!=t.status||t.orderproductsList.find(function(e){return 2==e.confirmed})?e._e():i("el-button",{attrs:{size:"small",type:"text"},on:{click:function(i){e.updateOrder(t,8)}}},[e._v("无法提供服务直接退款")])],1)])])}),e.list.length?e._e():i("div",{staticClass:"list-nodata"},[i("div",{staticClass:"fs"},[e._v("暂无数据")])]),e.list.length?i("div",{staticClass:"table-bottom"},[e.hasMore?i("el-button",{attrs:{loading:e.loadmore,size:"small",type:"primary"},on:{click:e.getOrders}},[e._v("加载更多")]):i("p",{staticStyle:{color:"#ccc","font-size":"12px"}},[e._v("已加载全部，没有更多了")])],1):e._e()],2)])},_=[],x={shortcuts:[{text:"最近一周",onClick:function(e){var t=new Date,i=new Date;i.setTime(i.getTime()-6048e5),e.$emit("pick",[i,t])}},{text:"最近一个月",onClick:function(e){var t=new Date,i=new Date;i.setTime(i.getTime()-2592e6),e.$emit("pick",[i,t])}}]},C={0:"等待买家支付",1:"拼团中",2:"待核销",4:"已核销",5:"团购失败",6:"买家已取消订单",8:"已退款",12:"买家申请退款"},j={components:{"comp-tab":d["a"]},name:"order-list",watch:{"params.status":function(){this.list=[],this.getOrders()}},data:function(){return{tabs:[{label:"全部订单",value:-1},{label:"未支付",value:0},{label:"拼团中",value:1},{label:"待核销",value:2},{label:"已核销",value:4},{label:"团购失败",value:5},{label:"申请退款",value:12},{label:"已退款",value:8},{label:"已取消",value:6}],pickerOptions:x,dialogFormVisible:!1,list:[],params:{id:"",status:-1,statuslistList:null,idlessthan:0,createdatgreaterthan:0,createdatlessthan:0,sortby:1,sort:1,deliverkind:0,desk:"",daynumber:"",count:20,delivermobile:"",isgroup:0,issubscription:0,isprofitsharing:0,ordertype:0,time:[]},loadmore:!1,hasMore:!0,map:C}},created:function(){var e=this;this.token=Object(m["e"])(),this.getOrders(),this.conn=null;var t=function t(){-1!==e.conn&&(e.conn=Object(u["b"])("StoreNotificationService.GetNotification",Object(u["a"])("Token",{token:e.token}),function(){var t=Object(c["a"])(regeneratorRuntime.mark(function t(i){var s,r;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(1===i.kind){t.next=2;break}return t.abrupt("return");case 2:return s=i.order,t.next=5,Promise.all([Object(p["b"])("StoreUserService.GetUser",Object(u["a"])("IDWithTokenRequest",{token:Object(u["a"])("Token",{token:e.token}),id:s.userid})),Object(p["b"])("StoreProductService.GetProductList",Object(u["a"])("ProductListQueryRequest",{token:Object(u["a"])("Token",{token:e.token}),idlistList:s.orderproductsList.map(function(e){return e.productid}),sortby:1,sort:1,count:s.orderproductsList.map(function(e){return e.productid}).length}))]);case 5:r=t.sent,s.user=r[0],s.orderproductsList.forEach(function(e){e.product=r[1].productlistList.find(function(t){return t.id===e.productid})}),e.list.splice(0,0,s);case 9:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),function(e){console.log(e),setTimeout(t,2e3)}))};t()},beforeDestroy:function(){this.conn.close(),this.conn=-1},methods:{getOrders:function(){var e=Object(c["a"])(regeneratorRuntime.mark(function e(){var t,i,s,r,a,n,o;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(this.loadmore=!0,t=window,i=t.scrollY,this.params.createdatgreaterthan=0,this.params.createdatlessthan=0,2===this.params.time.length&&(this.params.createdatgreaterthan=parseInt(this.params.time[0].getTime()/1e3),this.params.createdatlessthan=parseInt(this.params.time[1].getTime()/1e3)),this.params.isgroup=0,0!=this.params.ordertype&&1==this.params.ordertype&&(this.params.isgroup=1),!this.params.delivermobile){e.next=12;break}return e.next=10,Object(p["a"])("StoreUserService.GetUserList",Object(u["a"])("UserListQueryRequest",{token:Object(u["a"])("Token",{token:this.token}),mobile:this.params.delivermobile,count:1,order:0}));case 10:s=e.sent,this.params.userid=s.userlistList.length?s.userlistList[0].id:0;case 12:return this.params.idlessthan=this.list.length?this.list[this.list.length-1].id:0,e.next=15,Object(p["a"])("StoreOrderService.GetOrderList",Object(u["a"])("OrderListQueryRequest",Object(l["a"])({token:Object(u["a"])("Token",{token:this.token})},this.params)));case 15:if(r=e.sent,0!==r.orderlistList.length){e.next=20;break}return this.loadmore=!1,this.hasMore=!1,e.abrupt("return");case 20:return a=r.orderlistList.map(function(e){return e.userid}),n=[],r.orderlistList.forEach(function(e){e.orderproductsList.forEach(function(e){n.push(e.productid)})}),e.next=25,Promise.all([Object(p["a"])("StoreUserService.GetUserList",Object(u["a"])("UserListQueryRequest",{token:Object(u["a"])("Token",{token:this.token}),idlistList:a,count:a.length,order:0})),Object(p["a"])("StoreProductService.GetProductList",Object(u["a"])("ProductListQueryRequest",{token:Object(u["a"])("Token",{token:this.token}),idlistList:n,sortby:1,sort:1,count:n.length}))]);case 25:o=e.sent,r.orderlistList.forEach(function(e){e.user=o[0].userlistList.find(function(t){return t.id===e.userid}),e.orderproductsList.forEach(function(e){e.product=o[1].productlistList.find(function(t){return t.id===e.productid})})}),this.list=this.list.concat(r.orderlistList),this.hasMore=r.orderlistList.length,this.loadmore=!1,0!==this.params.idlessthan&&window.scroll(0,i);case 31:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),updateOrder:function(e,t){var i=this;e=JSON.parse(JSON.stringify(e)),e.status=t,Object(p["a"])("StoreOrderService.UpdateOrder",Object(u["a"])("OrderWithTokenRequest",{token:Object(u["a"])("Token",{token:this.token}),order:Object(u["a"])("Order",Object(l["a"])({},e,{address:Object(u["a"])("Address",e.address),invoice:Object(u["a"])("Invoice",e.invoice),orderproductsList:e.orderproductsList.map(function(e){return Object(u["a"])("OrderProduct",e)})}))})).then(function(s){3===t&&(e.status=4),i.list.splice(i.list.findIndex(function(e){return e.id===s.id}),1,e),i.$message({message:"操作成功",type:"success"})})},updateOrderProduct:function(e,t,i){var s=this;t=JSON.parse(JSON.stringify(t)),t.confirmed=i,Object(p["a"])("StoreOrderService.UpdateOrderProduct",Object(u["a"])("OrderProductWithTokenRequest",{token:Object(u["a"])("Token",{token:this.token}),orderproduct:Object(u["a"])("OrderProduct",t)})).then(function(i){console.log(i),t.updatedat=i.updatedat;var r=s.list.findIndex(function(t){return t.id===e.id}),a=s.list[r].orderproductsList.findIndex(function(e){return e.id===t.id});s.list[r].orderproductsList.splice(a,1,t),s.list[r].orderproductsList.find(function(e){return 2!=e.confirmed})||(s.list[r].status=4,s.list[r].updatedat=i.updatedat),s.$message({message:"操作成功",type:"success"})})},onClickFilter:function(){this.list=[],this.getOrders()},onClickClearFilter:function(){this.params={id:"",status:-1,statuslistList:null,idlessthan:0,createdatgreaterthan:0,createdatlessthan:0,sortby:1,sort:1,deliverkind:0,desk:"",daynumber:"",count:20,delivermobile:"",isgroup:0,issubscription:0,ordertype:0,time:[]},this.list=[],this.getOrders()}}},L=j,S=(i("8f1a"),Object(k["a"])(L,O,_,!1,null,"46444d85",null)),z=S.exports,w=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("div",{staticClass:"container"},[i("el-form",{attrs:{"label-position":"left","label-width":"90px",size:"mini"}},[i("el-row",{attrs:{gutter:20}},[i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"订单号"}},[i("el-input",{staticClass:"input-width",attrs:{placeholder:"请输入订单号"},model:{value:e.params.id,callback:function(t){e.$set(e.params,"id",t)},expression:"params.id"}})],1)],1),i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"买家手机号"}},[i("el-input",{staticClass:"input-width",attrs:{placeholder:"请输入买家手机号"},model:{value:e.params.delivermobile,callback:function(t){e.$set(e.params,"delivermobile",t)},expression:"params.delivermobile"}})],1)],1)],1),i("el-row",{attrs:{gutter:20}},[i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"订单类型"}},[i("el-select",{attrs:{placeholder:"请选择订单类型"},model:{value:e.params.ordertype,callback:function(t){e.$set(e.params,"ordertype",t)},expression:"params.ordertype"}},[i("el-option",{attrs:{label:"全部",value:0}}),i("el-option",{attrs:{label:"团购订单",value:1}})],1)],1)],1),i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"是否分销"}},[i("el-select",{attrs:{placeholder:"请选择订单类型"},model:{value:e.params.isprofitsharing,callback:function(t){e.$set(e.params,"isprofitsharing",t)},expression:"params.isprofitsharing"}},[i("el-option",{attrs:{label:"全部",value:0}}),i("el-option",{attrs:{label:"非分销",value:1}}),i("el-option",{attrs:{label:"分销单",value:2}})],1)],1)],1)],1),i("el-row",{attrs:{gutter:20}},[i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"下单时间"}},[i("el-date-picker",{attrs:{"picker-options":e.pickerOptions,"end-placeholder":"结束日期","range-separator":"至","start-placeholder":"开始日期",type:"daterange","unlink-panels":""},model:{value:e.params.time,callback:function(t){e.$set(e.params,"time",t)},expression:"params.time"}})],1)],1)],1)],1),i("el-button",{attrs:{size:"small"},on:{click:e.onClickFilter}},[e._v("筛选")]),i("el-button",{staticStyle:{color:"#4E759E"},attrs:{size:"small",type:"text"},on:{click:e.onClickClearFilter}},[e._v("清空筛选条件")])],1),i("div",{staticClass:"container"},[i("comp-tab",{attrs:{data:e.tabs},model:{value:e.params.status,callback:function(t){e.$set(e.params,"status",t)},expression:"params.status"}})],1),i("div",{staticClass:"container"},[e._l(e.list,function(t){return i("div",{key:t.id,staticClass:"item"},[i("div",{staticClass:"order-detail"},[i("div",[i("span",{staticClass:"order-detail_text"},[e._v(e._s(t.id))]),t.groupuuid?i("span",{staticClass:"invoice m10"},[e._v(e._s("拼团 ID: "+t.groupuuid+" "+(2===t.grouplead?"团长代收":"单独发货")))]):e._e(),t.needinvoice?i("span",{staticClass:"invoice m10"},[e._v("需要开发票")]):e._e()]),i("div",[i("span",{staticClass:"order-detail_text m10"},[e._v(e._s(t.user.nickname)+" "+e._s(t.user.mobile))]),2===t.user.isvip?i("span",{staticClass:"member-tag",staticStyle:{padding:"0 4px"}},[e._v("会员")]):e._e(),i("span",{staticClass:"order-detail_text m10"},[e._v(e._s(new Date(1e3*t.createdat).toLocaleString("zh-CN",{timeZone:"Asia/Shanghai"})))]),i("el-button",{attrs:{size:"small",type:"text"},on:{click:function(i){e.$router.push({name:"order-detail",query:{id:t.id}})}}},[e._v("查看详情")])],1)]),i("div",{staticClass:"table"},[i("div",{staticClass:"products"},e._l(t.orderproductsList,function(t){return i("div",{key:t.id,staticClass:"product"},[i("div",{staticClass:"product-info"},[i("div",{staticClass:"product-img"},[i("comp-imger",{attrs:{src:t.product.imagesList.length?t.product.imagesList[0]:""}})],1),i("div",[i("div",{staticClass:"product-name"},[e._v(e._s(t.product.name))]),i("div",{staticClass:"product-desc"},[e._v(e._s(t.optionname&&"("+Object.values(JSON.parse(t.optionname)).join(", ")+")"))])])]),i("div",{staticClass:"price"},[e._v(e._s(e.$amount1(t.amount))+" 元")]),i("div",{staticClass:"count"},[e._v(e._s(t.quantity)+" 个")])])})),i("div",{staticClass:"action"},[i("span",{staticClass:"action-text"},[e._v(e._s(e.map[t.status]||"非此类型商城该有状态"))]),12==t.status?i("el-button",{attrs:{size:"small",type:"text"},on:{click:function(i){e.updateOrder(t,2)}}},[e._v("拒绝退款")]):e._e(),2==t.status?i("el-button",{attrs:{size:"small",type:"text"},on:{click:function(i){e.updateOrder(t,3)}}},[e._v("发货")]):e._e(),12==t.status?i("el-button",{attrs:{size:"small",type:"text"},on:{click:function(i){e.updateOrder(t,8)}}},[e._v("同意退款")]):e._e(),2==t.status?i("el-button",{attrs:{size:"small",type:"text"},on:{click:function(i){e.updateOrder(t,8)}}},[e._v("缺货直接退款")]):e._e(),7==t.status?i("el-button",{attrs:{size:"small",type:"text"},on:{click:function(i){e.updateOrder(t,8)}}},[e._v("收到退货确认退款")]):e._e(),9==t.status?i("el-button",{attrs:{size:"small",type:"text"},on:{click:function(i){e.updateOrder(t,7)}}},[e._v("同意退货")]):e._e(),9==t.status?i("el-button",{attrs:{size:"small",type:"text"},on:{click:function(i){e.updateOrder(t,10)}}},[e._v("拒绝退货")]):e._e(),7==t.status?i("el-button",{attrs:{size:"small",type:"text"},on:{click:function(i){e.updateOrder(t,11)}}},[e._v("未收到退货等因素拒绝退款")]):e._e()],1)]),i("el-dialog",{attrs:{visible:e.dialogFormVisible,title:"确认发货",width:"400px"},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[i("el-form",{attrs:{"label-width":"80px",size:"small"}},[i("el-form-item",{attrs:{label:"物流公司"}},[i("el-select",{attrs:{placeholder:"请选择物流公司"},model:{value:e.shipindex,callback:function(t){e.shipindex=t},expression:"shipindex"}},e._l(e.shiplist,function(e,t){return i("el-option",{key:t,attrs:{label:e.name,value:t}})}))],1)],1),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),i("el-button",{attrs:{disabled:null===e.shipindex,type:"primary"},on:{click:e.updateOrderShipping}},[e._v("确 定")])],1)],1)],1)}),e.list.length?e._e():i("div",{staticClass:"list-nodata"},[i("div",{staticClass:"fs"},[e._v("暂无数据")])]),e.list.length?i("div",{staticClass:"table-bottom",staticStyle:{"margin-bottom":"10px"}},[e.hasMore?i("el-button",{attrs:{loading:e.loadmore,size:"small",type:"primary"},on:{click:e.getOrders}},[e._v("加载更多")]):i("p",{staticStyle:{color:"#ccc","font-size":"12px"}},[e._v("已加载全部，没有更多了")])],1):e._e()],2)])},T=[],$={shortcuts:[{text:"最近一周",onClick:function(e){var t=new Date,i=new Date;i.setTime(i.getTime()-6048e5),e.$emit("pick",[i,t])}},{text:"最近一个月",onClick:function(e){var t=new Date,i=new Date;i.setTime(i.getTime()-2592e6),e.$emit("pick",[i,t])}}]},P={0:"等待买家支付",1:"拼团中",2:"待发货",3:"等待买家收货",4:"买家已收货",5:"团购失败",6:"买家已取消订单",7:"退货中",8:"已退款",9:"买家申请退货",10:"拒绝买家退货",11:"同意退货但拒绝退款",12:"买家申请退款"},D={components:{"comp-tab":d["a"]},name:"order-list",watch:{"params.status":function(){this.list=[],this.getOrders()}},data:function(){return{tabs:[{label:"全部订单",value:-1},{label:"未支付",value:0},{label:"拼团中",value:1},{label:"待发货",value:2},{label:"待收货",value:3},{label:"已收货",value:4},{label:"团购失败",value:5},{label:"申请退款",value:12},{label:"申请退货",value:9},{label:"已取消",value:6}],pickerOptions:$,dialogFormVisible:!1,list:[],params:{id:"",status:-1,statuslistList:null,idlessthan:0,createdatgreaterthan:0,createdatlessthan:0,sortby:1,sort:1,deliverkind:0,desk:"",daynumber:"",count:20,delivermobile:"",isgroup:0,issubscription:0,isprofitsharing:0,ordertype:0,time:[]},shippingrow:null,shiplist:[],shipindex:null,loadmore:!1,hasMore:!0,map:P}},created:function(){var e=this;this.token=Object(m["e"])(),Object(p["a"])("StoreDeliveryService.GetDeliveryList",Object(u["a"])("DeliveryListQueryRequest",{token:Object(u["a"])("Token",{token:this.token}),count:100})).then(function(t){var i=[];t.deliverylistList.forEach(function(e){"BEST"===e.deliveryid&&i.push({name:"".concat(e.deliveryname,"-标准快递(").concat(e.bizid,")"),shippingcompany:"".concat(e.deliveryname,"-标准快递"),deliveryid:e.deliveryid,bizid:e.bizid,servicetype:1,servicevalue:"标准快递"}),"DB"===e.deliveryid&&(i.push({name:"".concat(e.deliveryname,"-大件快递3.60(").concat(e.bizid,")"),shippingcompany:"".concat(e.deliveryname,"-大件快递3.60"),deliveryid:e.deliveryid,bizid:e.bizid,servicetype:1,servicevalue:"大件快递3.60"}),i.push({name:"".concat(e.deliveryname,"-特准快件(").concat(e.bizid,")"),shippingcompany:"".concat(e.deliveryname,"-特准快件"),deliveryid:e.deliveryid,bizid:e.bizid,servicetype:2,servicevalue:"特准快件"})),"EMS"===e.deliveryid&&(i.push({name:"".concat(e.deliveryname,"-标准快递(").concat(e.bizid,")"),shippingcompany:"".concat(e.deliveryname,"-标准快递"),deliveryid:e.deliveryid,bizid:e.bizid,servicetype:6,servicevalue:"标准快递"}),i.push({name:"".concat(e.deliveryname,"-快递包裹(").concat(e.bizid,")"),shippingcompany:"".concat(e.deliveryname,"-快递包裹"),deliveryid:e.deliveryid,bizid:e.bizid,servicetype:9,servicevalue:"快递包裹"})),"OTP"===e.deliveryid&&i.push({name:"".concat(e.deliveryname,"-标准快递(").concat(e.bizid,")"),shippingcompany:"".concat(e.deliveryname,"-标准快递"),deliveryid:e.deliveryid,bizid:e.bizid,servicetype:1,servicevalue:"标准快递"}),"PJ"===e.deliveryid&&i.push({name:"".concat(e.deliveryname,"-标准快递(").concat(e.bizid,")"),shippingcompany:"".concat(e.deliveryname,"-标准快递"),deliveryid:e.deliveryid,bizid:e.bizid,servicetype:1,servicevalue:"标准快递"}),"SF"===e.deliveryid&&(i.push({name:"".concat(e.deliveryname,"-标准快递(").concat(e.bizid,")"),shippingcompany:"".concat(e.deliveryname,"-标准快递"),deliveryid:e.deliveryid,bizid:e.bizid,servicetype:0,servicevalue:"标准快递"}),i.push({name:"".concat(e.deliveryname,"-顺丰即日(").concat(e.bizid,")"),shippingcompany:"".concat(e.deliveryname,"-顺丰即日"),deliveryid:e.deliveryid,bizid:e.bizid,servicetype:1,servicevalue:"顺丰即日"}),i.push({name:"".concat(e.deliveryname,"-顺丰次晨(").concat(e.bizid,")"),shippingcompany:"".concat(e.deliveryname,"-顺丰次晨"),deliveryid:e.deliveryid,bizid:e.bizid,servicetype:2,servicevalue:"顺丰次晨"}),i.push({name:"".concat(e.deliveryname,"-顺丰标快(").concat(e.bizid,")"),shippingcompany:"".concat(e.deliveryname,"-顺丰标快"),deliveryid:e.deliveryid,bizid:e.bizid,servicetype:3,servicevalue:"顺丰标快"}),i.push({name:"".concat(e.deliveryname,"-顺丰特惠(").concat(e.bizid,")"),shippingcompany:"".concat(e.deliveryname,"-顺丰特惠"),deliveryid:e.deliveryid,bizid:e.bizid,servicetype:4,servicevalue:"顺丰特惠"})),"STO"===e.deliveryid&&i.push({name:"".concat(e.deliveryname,"-标准快递(").concat(e.bizid,")"),shippingcompany:"".concat(e.deliveryname,"-标准快递"),deliveryid:e.deliveryid,bizid:e.bizid,servicetype:1,servicevalue:"标准快递"}),"YTO"===e.deliveryid&&(i.push({name:"".concat(e.deliveryname,"-普通快递(").concat(e.bizid,")"),shippingcompany:"".concat(e.deliveryname,"-普通快递"),deliveryid:e.deliveryid,bizid:e.bizid,servicetype:0,servicevalue:"普通快递"}),i.push({name:"".concat(e.deliveryname,"-圆准达(").concat(e.bizid,")"),shippingcompany:"".concat(e.deliveryname,"-圆准达"),deliveryid:e.deliveryid,bizid:e.bizid,servicetype:1,servicevalue:"圆准达"})),"YUNDA"===e.deliveryid&&i.push({name:"".concat(e.deliveryname,"-标准快件(").concat(e.bizid,")"),shippingcompany:"".concat(e.deliveryname,"-标准快件"),deliveryid:e.deliveryid,bizid:e.bizid,servicetype:0,servicevalue:"标准快件"}),"ZTO"===e.deliveryid&&i.push({name:"".concat(e.deliveryname,"-标准快件(").concat(e.bizid,")"),shippingcompany:"".concat(e.deliveryname,"-标准快件"),deliveryid:e.deliveryid,bizid:e.bizid,servicetype:0,servicevalue:"标准快件"})}),i.push({name:"德邦快递-大件快递3.60(现付)",shippingcompany:"德邦快递-大件快递3.60",deliveryid:"DB",bizid:"DB_CASH",servicetype:1,servicevalue:"大件快递3.60"}),i.push({name:"德邦快递-特准快件(现付)",shippingcompany:"德邦快递-特准快件",deliveryid:"DB",bizid:"DB_CASH",servicetype:2,servicevalue:"特准快件"}),i.push({name:"顺丰速运-标准快递(现付)",shippingcompany:"顺丰速运-标准快递",deliveryid:"SF",bizid:"SF_CASH",servicetype:0,servicevalue:"标准快递"}),i.push({name:"顺丰速运-顺丰即日(现付)",shippingcompany:"顺丰速运-顺丰即日",deliveryid:"SF",bizid:"SF_CASH",servicetype:1,servicevalue:"顺丰即日"}),i.push({name:"顺丰速运-顺丰次晨(现付)",shippingcompany:"顺丰速运-顺丰次晨",deliveryid:"SF",bizid:"SF_CASH",servicetype:2,servicevalue:"顺丰次晨"}),i.push({name:"顺丰速运-顺丰标快(现付)",shippingcompany:"顺丰速运-顺丰标快",deliveryid:"SF",bizid:"SF_CASH",servicetype:3,servicevalue:"顺丰标快"}),i.push({name:"顺丰速运-顺丰特惠(现付)",shippingcompany:"顺丰速运-顺丰特惠",deliveryid:"SF",bizid:"SF_CASH",servicetype:4,servicevalue:"顺丰特惠"}),i.push({name:"商家自配送",shippingcompany:"商家自配送",deliveryid:"",bizid:"",servicetype:0,servicevalue:""}),e.shiplist=i}),this.getOrders(),this.conn=null;var t=function t(){-1!==e.conn&&(e.conn=Object(u["b"])("StoreNotificationService.GetNotification",Object(u["a"])("Token",{token:e.token}),function(){var t=Object(c["a"])(regeneratorRuntime.mark(function t(i){var s,r;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(1===i.kind){t.next=2;break}return t.abrupt("return");case 2:return s=i.order,t.next=5,Promise.all([Object(p["b"])("StoreUserService.GetUser",Object(u["a"])("IDWithTokenRequest",{token:Object(u["a"])("Token",{token:e.token}),id:s.userid})),Object(p["b"])("StoreProductService.GetProductList",Object(u["a"])("ProductListQueryRequest",{token:Object(u["a"])("Token",{token:e.token}),idlistList:s.orderproductsList.map(function(e){return e.productid}),sortby:1,sort:1,count:s.orderproductsList.map(function(e){return e.productid}).length}))]);case 5:r=t.sent,s.user=r[0],s.orderproductsList.forEach(function(e){e.product=r[1].productlistList.find(function(t){return t.id===e.productid})}),e.list.splice(0,0,s);case 9:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),function(e){console.log(e),setTimeout(t,2e3)}))};t()},beforeDestroy:function(){this.conn.close(),this.conn=-1},methods:{getOrders:function(){var e=Object(c["a"])(regeneratorRuntime.mark(function e(){var t,i,s,r,a,n,o;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(this.loadmore=!0,t=window,i=t.scrollY,this.params.createdatgreaterthan=0,this.params.createdatlessthan=0,2===this.params.time.length&&(this.params.createdatgreaterthan=parseInt(this.params.time[0].getTime()/1e3),this.params.createdatlessthan=parseInt(this.params.time[1].getTime()/1e3)),this.params.isgroup=0,0!=this.params.ordertype&&1==this.params.ordertype&&(this.params.isgroup=1),!this.params.delivermobile){e.next=12;break}return e.next=10,Object(p["a"])("StoreUserService.GetUserList",Object(u["a"])("UserListQueryRequest",{token:Object(u["a"])("Token",{token:this.token}),mobile:this.params.delivermobile,count:1,order:0}));case 10:s=e.sent,this.params.userid=s.userlistList.length?s.userlistList[0].id:0;case 12:return this.params.idlessthan=this.list.length?this.list[this.list.length-1].id:0,e.next=15,Object(p["a"])("StoreOrderService.GetOrderList",Object(u["a"])("OrderListQueryRequest",Object(l["a"])({token:Object(u["a"])("Token",{token:this.token})},this.params)));case 15:if(r=e.sent,0!==r.orderlistList.length){e.next=20;break}return this.loadmore=!1,this.hasMore=!1,e.abrupt("return");case 20:return a=r.orderlistList.map(function(e){return e.userid}),n=[],r.orderlistList.forEach(function(e){e.orderproductsList.forEach(function(e){n.push(e.productid)})}),e.next=25,Promise.all([Object(p["a"])("StoreUserService.GetUserList",Object(u["a"])("UserListQueryRequest",{token:Object(u["a"])("Token",{token:this.token}),idlistList:a,count:a.length,order:0})),Object(p["a"])("StoreProductService.GetProductList",Object(u["a"])("ProductListQueryRequest",{token:Object(u["a"])("Token",{token:this.token}),idlistList:n,sortby:1,sort:1,count:n.length}))]);case 25:o=e.sent,r.orderlistList.forEach(function(e){e.user=o[0].userlistList.find(function(t){return t.id===e.userid}),e.orderproductsList.forEach(function(e){e.product=o[1].productlistList.find(function(t){return t.id===e.productid})})}),this.list=this.list.concat(r.orderlistList),this.hasMore=r.orderlistList.length,this.loadmore=!1,0!==this.params.idlessthan&&window.scroll(0,i);case 31:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),updateOrder:function(e,t){var i=this;if(e=JSON.parse(JSON.stringify(e)),3==t)return this.shippingrow=e,void(this.dialogFormVisible=!0);e.status=t,Object(p["a"])("StoreOrderService.UpdateOrder",Object(u["a"])("OrderWithTokenRequest",{token:Object(u["a"])("Token",{token:this.token}),order:Object(u["a"])("Order",Object(l["a"])({},e,{address:Object(u["a"])("Address",e.address),invoice:Object(u["a"])("Invoice",e.invoice),orderproductsList:e.orderproductsList.map(function(e){return Object(u["a"])("OrderProduct",e)})}))})).then(function(t){i.list.splice(i.list.findIndex(function(e){return e.id===t.id}),1,e),i.$message({message:"操作成功",type:"success"})})},updateOrderShipping:function(){var e=this,t=JSON.parse(JSON.stringify(this.shippingrow));t.status=3,t.shippingcompany=this.shiplist[this.shipindex].shippingcompany,Object(p["a"])("StoreOrderService.UpdateOrder",Object(u["a"])("OrderWithTokenRequest",Object(l["a"])({token:Object(u["a"])("Token",{token:this.token}),order:Object(u["a"])("Order",Object(l["a"])({},t,{address:Object(u["a"])("Address",t.address),invoice:Object(u["a"])("Invoice",t.invoice),orderproductsList:t.orderproductsList.map(function(e){return Object(u["a"])("OrderProduct",e)})}))},this.shiplist[this.shipindex]))).then(function(i){e.list.splice(e.list.findIndex(function(e){return e.id===i.id}),1,t),e.dialogFormVisible=!1,e.$message({message:"操作成功",type:"success"})})},onClickFilter:function(){this.list=[],this.getOrders()},onClickClearFilter:function(){this.params={id:"",status:-1,statuslistList:null,idlessthan:0,createdatgreaterthan:0,createdatlessthan:0,sortby:1,sort:1,deliverkind:0,desk:"",daynumber:"",count:20,delivermobile:"",isgroup:0,issubscription:0,ordertype:0,time:[]},this.list=[],this.getOrders()}}},R=D,q=(i("6719"),Object(k["a"])(R,w,T,!1,null,"5ac4520c",null)),U=q.exports,F=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("div",{staticClass:"container"},[i("el-form",{attrs:{"label-position":"left","label-width":"90px",size:"mini"}},[i("el-row",{attrs:{gutter:20}},[i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"订单号"}},[i("el-input",{staticClass:"input-width",attrs:{placeholder:"请输入订单号"},model:{value:e.params.id,callback:function(t){e.$set(e.params,"id",t)},expression:"params.id"}})],1)],1),i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"买家手机号"}},[i("el-input",{staticClass:"input-width",attrs:{placeholder:"请输入买家手机号"},model:{value:e.params.delivermobile,callback:function(t){e.$set(e.params,"delivermobile",t)},expression:"params.delivermobile"}})],1)],1)],1),i("el-row",{attrs:{gutter:20}},[i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"订单类型"}},[i("el-select",{attrs:{placeholder:"请选择订单类型"},model:{value:e.params.ordertype,callback:function(t){e.$set(e.params,"ordertype",t)},expression:"params.ordertype"}},[i("el-option",{attrs:{label:"全部",value:0}}),i("el-option",{attrs:{label:"团购订单",value:1}})],1)],1)],1),i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"是否分销"}},[i("el-select",{attrs:{placeholder:"请选择订单类型"},model:{value:e.params.isprofitsharing,callback:function(t){e.$set(e.params,"isprofitsharing",t)},expression:"params.isprofitsharing"}},[i("el-option",{attrs:{label:"全部",value:0}}),i("el-option",{attrs:{label:"非分销",value:1}}),i("el-option",{attrs:{label:"分销单",value:2}})],1)],1)],1)],1),i("el-row",{attrs:{gutter:20}},[i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"下单时间"}},[i("el-date-picker",{attrs:{"picker-options":e.pickerOptions,"end-placeholder":"结束日期","range-separator":"至","start-placeholder":"开始日期",type:"daterange","unlink-panels":""},model:{value:e.params.time,callback:function(t){e.$set(e.params,"time",t)},expression:"params.time"}})],1)],1)],1)],1),i("el-button",{attrs:{size:"small"},on:{click:e.onClickFilter}},[e._v("筛选")]),i("el-button",{staticStyle:{color:"#4E759E"},attrs:{size:"small",type:"text"},on:{click:e.onClickClearFilter}},[e._v("清空筛选条件")])],1),i("div",{staticClass:"container"},[i("comp-tab",{attrs:{data:e.tabs},model:{value:e.params.status,callback:function(t){e.$set(e.params,"status",t)},expression:"params.status"}})],1),i("div",{staticClass:"container"},[e._l(e.list,function(t){return i("div",{key:t.id,staticClass:"item"},[i("div",{staticClass:"order-detail"},[i("div",[i("span",{staticClass:"order-detail_text"},[e._v(e._s(t.id))]),t.groupuuid?i("span",{staticClass:"invoice m10"},[e._v(e._s("拼团 ID: "+t.groupuuid))]):e._e(),t.needinvoice?i("span",{staticClass:"invoice m10"},[e._v("需要开发票")]):e._e()]),i("div",[i("span",{staticClass:"order-detail_text m10"},[e._v(e._s(t.user.nickname)+" "+e._s(t.user.mobile))]),2===t.user.isvip?i("span",{staticClass:"member-tag",staticStyle:{padding:"0 4px"}},[e._v("会员")]):e._e(),i("span",{staticClass:"order-detail_text m10"},[e._v(e._s(new Date(1e3*t.createdat).toLocaleString("zh-CN",{timeZone:"Asia/Shanghai"})))]),i("el-button",{attrs:{size:"small",type:"text"},on:{click:function(i){e.$router.push({name:"order-detail",query:{id:t.id}})}}},[e._v("查看详情")])],1)]),i("div",{staticClass:"table"},[i("div",{staticClass:"products"},e._l(t.orderproductsList,function(s){return i("div",{key:s.id,staticClass:"product"},[i("div",{staticClass:"product-info"},[i("div",{staticClass:"product-img"},[i("comp-imger",{attrs:{src:s.product.imagesList.length?s.product.imagesList[0]:""}})],1),i("div",[i("div",{staticClass:"product-name"},[e._v(e._s(s.product.name))]),i("div",{staticClass:"product-desc"},[e._v(e._s(e.week[s.week])+" "+e._s(s.duration/60/60)+"小时 ("+e._s(s.begintime)+" - "+e._s(s.endtime.startsWith(":")?"次日"+s.endtime.slice(1):s.endtime)+")")])])]),i("div",{staticClass:"price"},[e._v(e._s(e.$amount1(s.amount))+" 元")]),i("div",{staticClass:"count"},[e._v(e._s(s.quantity)+" 个")]),2==t.status?i("div",{staticClass:"count"},[1==s.confirmed?i("el-button",{attrs:{size:"small",type:"text"},on:{click:function(i){e.updateOrderProduct(t,s,2)}}},[e._v("核销")]):e._e(),2==s.confirmed?i("span",{staticClass:"action-text"},[e._v("已核销")]):e._e()],1):e._e(),2!=t.status?i("div",{staticClass:"count"},[i("span",{staticClass:"action-text"},[e._v("/")])]):e._e()])})),i("div",{staticClass:"action"},[i("span",{staticClass:"action-text"},[e._v(e._s(e.map[t.status]||"非此类型商城该有状态"))]),12==t.status?i("el-button",{attrs:{size:"small",type:"text"},on:{click:function(i){e.updateOrder(t,2)}}},[e._v("拒绝退款")]):e._e(),2==t.status?i("el-button",{attrs:{size:"small",type:"text"},on:{click:function(i){e.updateOrder(t,3)}}},[e._v("全部核销")]):e._e(),12==t.status?i("el-button",{attrs:{size:"small",type:"text"},on:{click:function(i){e.updateOrder(t,8)}}},[e._v("同意退款")]):e._e(),2!=t.status||t.orderproductsList.find(function(e){return 2==e.confirmed})?e._e():i("el-button",{attrs:{size:"small",type:"text"},on:{click:function(i){e.updateOrder(t,8)}}},[e._v("无法提供服务直接退款")])],1)])])}),e.list.length?e._e():i("div",{staticClass:"list-nodata"},[i("div",{staticClass:"fs"},[e._v("暂无数据")])]),e.list.length?i("div",{staticClass:"table-bottom"},[e.hasMore?i("el-button",{attrs:{loading:e.loadmore,size:"small",type:"primary"},on:{click:e.getOrders}},[e._v("加载更多")]):i("p",{staticStyle:{color:"#ccc","font-size":"12px"}},[e._v("已加载全部，没有更多了")])],1):e._e()],2)])},E=[],N={shortcuts:[{text:"最近一周",onClick:function(e){var t=new Date,i=new Date;i.setTime(i.getTime()-6048e5),e.$emit("pick",[i,t])}},{text:"最近一个月",onClick:function(e){var t=new Date,i=new Date;i.setTime(i.getTime()-2592e6),e.$emit("pick",[i,t])}}]},I={0:"等待买家支付",1:"拼团中",2:"待核销",4:"已核销",5:"团购失败",6:"买家已取消订单",8:"已退款",12:"买家申请退款"},G={1:"周一",2:"周二",3:"周三",4:"周四",5:"周五",6:"周六",7:"周日"},A={components:{"comp-tab":d["a"]},name:"order-list",watch:{"params.status":function(){this.list=[],this.getOrders()}},data:function(){return{tabs:[{label:"全部订单",value:-1},{label:"未支付",value:0},{label:"拼团中",value:1},{label:"待核销",value:2},{label:"已核销",value:4},{label:"团购失败",value:5},{label:"申请退款",value:12},{label:"已退款",value:8},{label:"已取消",value:6}],pickerOptions:N,dialogFormVisible:!1,list:[],params:{id:"",status:-1,statuslistList:null,idlessthan:0,createdatgreaterthan:0,createdatlessthan:0,sortby:1,sort:1,deliverkind:0,desk:"",daynumber:"",count:20,delivermobile:"",isgroup:0,issubscription:0,isprofitsharing:0,ordertype:0,time:[]},loadmore:!1,hasMore:!0,map:I,week:G}},created:function(){var e=this;this.token=Object(m["e"])(),this.getOrders(),this.conn=null;var t=function t(){-1!==e.conn&&(e.conn=Object(u["b"])("StoreNotificationService.GetNotification",Object(u["a"])("Token",{token:e.token}),function(){var t=Object(c["a"])(regeneratorRuntime.mark(function t(i){var s,r;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(1===i.kind){t.next=2;break}return t.abrupt("return");case 2:return s=i.order,t.next=5,Promise.all([Object(p["b"])("StoreUserService.GetUser",Object(u["a"])("IDWithTokenRequest",{token:Object(u["a"])("Token",{token:e.token}),id:s.userid})),Object(p["b"])("StoreProductService.GetProductList",Object(u["a"])("ProductListQueryRequest",{token:Object(u["a"])("Token",{token:e.token}),idlistList:s.orderproductsList.map(function(e){return e.productid}),sortby:1,sort:1,count:s.orderproductsList.map(function(e){return e.productid}).length}))]);case 5:r=t.sent,s.user=r[0],s.orderproductsList.forEach(function(e){e.product=r[1].productlistList.find(function(t){return t.id===e.productid})}),e.list.splice(0,0,s);case 9:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),function(e){console.log(e),setTimeout(t,2e3)}))};t()},beforeDestroy:function(){this.conn.close(),this.conn=-1},methods:{getOrders:function(){var e=Object(c["a"])(regeneratorRuntime.mark(function e(){var t,i,s,r,a,n,o;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(this.loadmore=!0,t=window,i=t.scrollY,this.params.createdatgreaterthan=0,this.params.createdatlessthan=0,2===this.params.time.length&&(this.params.createdatgreaterthan=parseInt(this.params.time[0].getTime()/1e3),this.params.createdatlessthan=parseInt(this.params.time[1].getTime()/1e3)),this.params.isgroup=0,0!=this.params.ordertype&&1==this.params.ordertype&&(this.params.isgroup=1),!this.params.delivermobile){e.next=12;break}return e.next=10,Object(p["a"])("StoreUserService.GetUserList",Object(u["a"])("UserListQueryRequest",{token:Object(u["a"])("Token",{token:this.token}),mobile:this.params.delivermobile,count:1,order:0}));case 10:s=e.sent,this.params.userid=s.userlistList.length?s.userlistList[0].id:0;case 12:return this.params.idlessthan=this.list.length?this.list[this.list.length-1].id:0,e.next=15,Object(p["a"])("StoreOrderService.GetOrderList",Object(u["a"])("OrderListQueryRequest",Object(l["a"])({token:Object(u["a"])("Token",{token:this.token})},this.params)));case 15:if(r=e.sent,0!==r.orderlistList.length){e.next=20;break}return this.loadmore=!1,this.hasMore=!1,e.abrupt("return");case 20:return a=r.orderlistList.map(function(e){return e.userid}),n=[],r.orderlistList.forEach(function(e){e.orderproductsList.forEach(function(e){n.push(e.productid)})}),e.next=25,Promise.all([Object(p["a"])("StoreUserService.GetUserList",Object(u["a"])("UserListQueryRequest",{token:Object(u["a"])("Token",{token:this.token}),idlistList:a,count:a.length,order:0})),Object(p["a"])("StoreProductService.GetProductList",Object(u["a"])("ProductListQueryRequest",{token:Object(u["a"])("Token",{token:this.token}),idlistList:n,sortby:1,sort:1,count:n.length}))]);case 25:o=e.sent,r.orderlistList.forEach(function(e){e.user=o[0].userlistList.find(function(t){return t.id===e.userid}),e.orderproductsList.forEach(function(e){e.product=o[1].productlistList.find(function(t){return t.id===e.productid})})}),this.list=this.list.concat(r.orderlistList),this.hasMore=r.orderlistList.length,this.loadmore=!1,0!==this.params.idlessthan&&window.scroll(0,i);case 31:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),updateOrder:function(e,t){var i=this;e=JSON.parse(JSON.stringify(e)),e.status=t,Object(p["a"])("StoreOrderService.UpdateOrder",Object(u["a"])("OrderWithTokenRequest",{token:Object(u["a"])("Token",{token:this.token}),order:Object(u["a"])("Order",Object(l["a"])({},e,{address:Object(u["a"])("Address",e.address),invoice:Object(u["a"])("Invoice",e.invoice),orderproductsList:e.orderproductsList.map(function(e){return Object(u["a"])("OrderProduct",e)})}))})).then(function(s){3===t&&(e.status=4),i.list.splice(i.list.findIndex(function(e){return e.id===s.id}),1,e),i.$message({message:"操作成功",type:"success"})})},updateOrderProduct:function(e,t,i){var s=this;t=JSON.parse(JSON.stringify(t)),t.confirmed=i,Object(p["a"])("StoreOrderService.UpdateOrderProduct",Object(u["a"])("OrderProductWithTokenRequest",{token:Object(u["a"])("Token",{token:this.token}),orderproduct:Object(u["a"])("OrderProduct",t)})).then(function(i){t.updatedat=i.updatedat;var r=s.list.findIndex(function(t){return t.id===e.id}),a=s.list[r].orderproductsList.findIndex(function(e){return e.id===t.id});s.list[r].orderproductsList.splice(a,1,t),s.list[r].orderproductsList.find(function(e){return 2!=e.confirmed})||(s.list[r].status=4,s.list[r].updatedat=i.updatedat),s.$message({message:"操作成功",type:"success"})})},onClickFilter:function(){this.list=[],this.getOrders()},onClickClearFilter:function(){this.params={id:"",status:-1,statuslistList:null,idlessthan:0,createdatgreaterthan:0,createdatlessthan:0,sortby:1,sort:1,deliverkind:0,desk:"",daynumber:"",count:20,delivermobile:"",isgroup:0,issubscription:0,ordertype:0,time:[]},this.list=[],this.getOrders()}}},Q=A,J=(i("f884"),Object(k["a"])(Q,F,E,!1,null,"5771d99d",null)),M=J.exports,W=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("div",{staticClass:"container"},[i("el-form",{attrs:{"label-position":"left","label-width":"90px",size:"mini"}},[i("el-row",{attrs:{gutter:20}},[i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"订单号"}},[i("el-input",{staticClass:"input-width",attrs:{placeholder:"请输入订单号"},model:{value:e.params.id,callback:function(t){e.$set(e.params,"id",t)},expression:"params.id"}})],1)],1),i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"买家手机号"}},[i("el-input",{staticClass:"input-width",attrs:{placeholder:"请输入买家手机号"},model:{value:e.params.delivermobile,callback:function(t){e.$set(e.params,"delivermobile",t)},expression:"params.delivermobile"}})],1)],1)],1),i("el-row",{attrs:{gutter:20}},[i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"订单类型"}},[i("el-select",{attrs:{placeholder:"请选择订单类型"},model:{value:e.params.ordertype,callback:function(t){e.$set(e.params,"ordertype",t)},expression:"params.ordertype"}},[i("el-option",{attrs:{label:"全部",value:0}}),i("el-option",{attrs:{label:"团购订单",value:1}}),i("el-option",{attrs:{label:"周期购订单",value:2}})],1)],1)],1),i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"是否分销"}},[i("el-select",{attrs:{placeholder:"请选择订单类型"},model:{value:e.params.isprofitsharing,callback:function(t){e.$set(e.params,"isprofitsharing",t)},expression:"params.isprofitsharing"}},[i("el-option",{attrs:{label:"全部",value:0}}),i("el-option",{attrs:{label:"非分销",value:1}}),i("el-option",{attrs:{label:"分销单",value:2}})],1)],1)],1)],1),i("el-row",{attrs:{gutter:20}},[i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"下单时间"}},[i("el-date-picker",{attrs:{"picker-options":e.pickerOptions,"end-placeholder":"结束日期","range-separator":"至","start-placeholder":"开始日期",type:"daterange","unlink-panels":""},model:{value:e.params.time,callback:function(t){e.$set(e.params,"time",t)},expression:"params.time"}})],1)],1)],1)],1),i("el-button",{attrs:{size:"small"},on:{click:e.onClickFilter}},[e._v("筛选")]),i("el-button",{staticStyle:{color:"#4E759E"},attrs:{size:"small",type:"text"},on:{click:e.onClickClearFilter}},[e._v("清空筛选条件")])],1),i("div",{staticClass:"container"},[i("comp-tab",{attrs:{data:e.tabs},model:{value:e.params.status,callback:function(t){e.$set(e.params,"status",t)},expression:"params.status"}})],1),i("div",{staticClass:"container"},[e._l(e.list,function(t){return i("div",{key:t.id,staticClass:"item"},[i("div",{staticClass:"order-detail"},[i("div",[i("span",{staticClass:"order-detail_text"},[e._v(e._s(t.id))]),t.groupuuid?i("span",{staticClass:"invoice m10"},[e._v(e._s("拼团 ID: "+t.groupuuid+" "+(2===t.grouplead?"团长代收":"单独发货")))]):e._e(),t.subscriptionid>0?i("span",{staticClass:"invoice m10"},[e._v("周期购")]):e._e(),i("span",{staticClass:"invoice m10"},[e._v(e._s({1:"自取",2:"配送"}[t.deliverkind]))]),t.needinvoice?i("span",{staticClass:"invoice m10"},[e._v("需要开发票")]):e._e()]),i("div",[i("span",{staticClass:"order-detail_text m10"},[e._v(e._s(t.user.nickname)+" "+e._s(t.user.mobile))]),2===t.user.isvip?i("span",{staticClass:"member-tag",staticStyle:{padding:"0 4px"}},[e._v("会员")]):e._e(),i("span",{staticClass:"order-detail_text m10"},[e._v(e._s(new Date(1e3*t.createdat).toLocaleString("zh-CN",{timeZone:"Asia/Shanghai"})))]),i("el-button",{attrs:{size:"small",type:"text"},on:{click:function(i){e.$router.push({name:"order-detail",query:{id:t.id}})}}},[e._v("查看详情")])],1)]),i("div",{staticClass:"table"},[i("div",{staticClass:"products"},e._l(t.orderproductsList,function(s,r){return i("div",{key:s.id,staticClass:"product"},[i("div",{staticClass:"product-info"},[i("div",{staticClass:"product-img"},[i("comp-imger",{attrs:{src:s.product.imagesList.length?s.product.imagesList[0]:""}})],1),i("div",[i("div",{staticClass:"product-name"},[e._v(e._s(s.product.name))]),i("div",{staticClass:"product-desc"},[e._v(e._s(s.optionname&&"("+Object.values(JSON.parse(s.optionname)).join(", ")+")"))]),t.subscriptionid>0?i("div",{staticClass:"product-desc"},[e._v("第"+e._s(r+1)+"期 送达时间: "+e._s(new Date(1e3*t.createdat).toLocaleString("zh-CN",{timeZone:"Asia/Shanghai"})))]):e._e()])]),i("div",{staticClass:"price"},[e._v(e._s(e.$amount1(s.amount))+" 元")]),i("div",{staticClass:"count"},[e._v(e._s(s.quantity)+" 个")])])})),i("div",{staticClass:"action"},[i("span",{staticClass:"action-text"},[e._v(e._s(e.map[t.status]||"非此类型商城该有状态"))]),12==t.status?i("el-button",{attrs:{size:"small",type:"text"},on:{click:function(i){e.updateOrder(t,2)}}},[e._v("拒绝退款")]):e._e(),12==t.status?i("el-button",{attrs:{size:"small",type:"text"},on:{click:function(i){e.updateOrder(t,8)}}},[e._v("同意退款")]):e._e(),2==t.status&&0==t.subscriptionid?i("el-button",{attrs:{size:"small",type:"text"},on:{click:function(i){e.updateOrder(t,3)}}},[e._v(e._s({1:"接单",2:"发货"}[t.deliverkind]))]):e._e(),2==t.status&&t.subscriptionid>0?i("el-button",{attrs:{size:"small",type:"text"},on:{click:function(i){e.$router.push({name:"order-detail",query:{id:t.id}})}}},[e._v("去发货")]):e._e(),2!=t.status||t.orderproductsList.find(function(e){return 2==e.confirmed})?e._e():i("el-button",{attrs:{size:"small",type:"text"},on:{click:function(i){e.updateOrder(t,8)}}},[e._v("缺货直接退款")])],1)])])}),e.list.length?e._e():i("div",{staticClass:"list-nodata"},[i("div",{staticClass:"fs"},[e._v("暂无数据")])]),e.list.length?i("div",{staticClass:"table-bottom"},[e.hasMore?i("el-button",{attrs:{loading:e.loadmore,size:"small",type:"primary"},on:{click:e.getOrders}},[e._v("加载更多")]):i("p",{staticStyle:{color:"#ccc","font-size":"12px"}},[e._v("已加载全部，没有更多了")])],1):e._e()],2)])},V=[],H={shortcuts:[{text:"最近一周",onClick:function(e){var t=new Date,i=new Date;i.setTime(i.getTime()-6048e5),e.$emit("pick",[i,t])}},{text:"最近一个月",onClick:function(e){var t=new Date,i=new Date;i.setTime(i.getTime()-2592e6),e.$emit("pick",[i,t])}}]},B={0:"等待买家支付",1:"拼团中",2:"待发货",3:"等待买家收货",4:"买家已收货",5:"团购失败",6:"买家已取消订单",8:"已退款",12:"买家申请退款"},Z={components:{"comp-tab":d["a"]},name:"order-list",watch:{"params.status":function(){this.list=[],this.getOrders()}},data:function(){return{tabs:[{label:"全部订单",value:-1},{label:"未支付",value:0},{label:"拼团中",value:1},{label:"待发货",value:2},{label:"待收货",value:3},{label:"已收货",value:4},{label:"团购失败",value:5},{label:"申请退款",value:12},{label:"已退款",value:8},{label:"已取消",value:6}],pickerOptions:H,dialogFormVisible:!1,list:[],params:{id:"",status:-1,statuslistList:null,idlessthan:0,createdatgreaterthan:0,createdatlessthan:0,sortby:1,sort:1,deliverkind:0,desk:"",daynumber:"",count:20,delivermobile:"",isgroup:0,issubscription:0,isprofitsharing:0,ordertype:0,time:[]},loadmore:!1,hasMore:!0,map:B}},created:function(){var e=this;this.token=Object(m["e"])(),this.getOrders(),this.conn=null;var t=function t(){-1!==e.conn&&(e.conn=Object(u["b"])("StoreNotificationService.GetNotification",Object(u["a"])("Token",{token:e.token}),function(){var t=Object(c["a"])(regeneratorRuntime.mark(function t(i){var s,r;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(1===i.kind){t.next=2;break}return t.abrupt("return");case 2:return s=i.order,t.next=5,Promise.all([Object(p["b"])("StoreUserService.GetUser",Object(u["a"])("IDWithTokenRequest",{token:Object(u["a"])("Token",{token:e.token}),id:s.userid})),Object(p["b"])("StoreProductService.GetProductList",Object(u["a"])("ProductListQueryRequest",{token:Object(u["a"])("Token",{token:e.token}),idlistList:s.orderproductsList.map(function(e){return e.productid}),sortby:1,sort:1,count:s.orderproductsList.map(function(e){return e.productid}).length}))]);case 5:r=t.sent,s.user=r[0],s.orderproductsList.forEach(function(e){e.product=r[1].productlistList.find(function(t){return t.id===e.productid})}),e.list.splice(0,0,s);case 9:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),function(e){console.log(e),setTimeout(t,2e3)}))};t()},beforeDestroy:function(){this.conn.close(),this.conn=-1},methods:{getOrders:function(){var e=Object(c["a"])(regeneratorRuntime.mark(function e(){var t,i,s,r,a,n,o;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(this.loadmore=!0,t=window,i=t.scrollY,this.params.createdatgreaterthan=0,this.params.createdatlessthan=0,2===this.params.time.length&&(this.params.createdatgreaterthan=parseInt(this.params.time[0].getTime()/1e3),this.params.createdatlessthan=parseInt(this.params.time[1].getTime()/1e3)),this.params.isgroup=0,this.params.issubscription=0,0!=this.params.ordertype&&(1==this.params.ordertype&&(this.params.isgroup=1),2==this.params.ordertype&&(this.params.issubscription=2)),!this.params.delivermobile){e.next=13;break}return e.next=11,Object(p["a"])("StoreUserService.GetUserList",Object(u["a"])("UserListQueryRequest",{token:Object(u["a"])("Token",{token:this.token}),mobile:this.params.delivermobile,count:1,order:0}));case 11:s=e.sent,this.params.userid=s.userlistList.length?s.userlistList[0].id:0;case 13:return this.params.idlessthan=this.list.length?this.list[this.list.length-1].id:0,e.next=16,Object(p["a"])("StoreOrderService.GetOrderList",Object(u["a"])("OrderListQueryRequest",Object(l["a"])({token:Object(u["a"])("Token",{token:this.token})},this.params)));case 16:if(r=e.sent,0!==r.orderlistList.length){e.next=21;break}return this.loadmore=!1,this.hasMore=!1,e.abrupt("return");case 21:return a=r.orderlistList.map(function(e){return e.userid}),n=[],r.orderlistList.forEach(function(e){e.orderproductsList.forEach(function(e){n.push(e.productid)})}),e.next=26,Promise.all([Object(p["a"])("StoreUserService.GetUserList",Object(u["a"])("UserListQueryRequest",{token:Object(u["a"])("Token",{token:this.token}),idlistList:a,count:a.length,order:0})),Object(p["a"])("StoreProductService.GetProductList",Object(u["a"])("ProductListQueryRequest",{token:Object(u["a"])("Token",{token:this.token}),idlistList:n,sortby:1,sort:1,count:n.length}))]);case 26:o=e.sent,r.orderlistList.forEach(function(e){e.user=o[0].userlistList.find(function(t){return t.id===e.userid}),e.orderproductsList.forEach(function(e){e.product=o[1].productlistList.find(function(t){return t.id===e.productid})})}),this.list=this.list.concat(r.orderlistList),this.hasMore=r.orderlistList.length,this.loadmore=!1,0!==this.params.idlessthan&&window.scroll(0,i);case 32:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),updateOrder:function(e,t){var i=this;e=JSON.parse(JSON.stringify(e)),e.status=t,Object(p["a"])("StoreOrderService.UpdateOrder",Object(u["a"])("OrderWithTokenRequest",{token:Object(u["a"])("Token",{token:this.token}),order:Object(u["a"])("Order",Object(l["a"])({},e,{address:Object(u["a"])("Address",e.address),invoice:Object(u["a"])("Invoice",e.invoice),orderproductsList:e.orderproductsList.map(function(e){return Object(u["a"])("OrderProduct",e)})}))})).then(function(t){i.list.splice(i.list.findIndex(function(e){return e.id===t.id}),1,e),i.$message({message:"操作成功",type:"success"})})},onClickFilter:function(){this.list=[],this.getOrders()},onClickClearFilter:function(){this.params={id:"",status:-1,statuslistList:null,idlessthan:0,createdatgreaterthan:0,createdatlessthan:0,sortby:1,sort:1,deliverkind:0,desk:"",daynumber:"",count:20,delivermobile:"",isgroup:0,issubscription:0,ordertype:0,time:[]},this.list=[],this.getOrders()}}},Y=Z,K=(i("c61b"),Object(k["a"])(Y,W,V,!1,null,"51ee78d0",null)),X=K.exports,ee=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("div",{staticClass:"container"},[i("el-form",{attrs:{"label-position":"right","label-width":"100px",size:"mini"}},[i("el-row",{attrs:{gutter:20}},[i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"订单号"}},[i("el-input",{staticClass:"input-width",attrs:{placeholder:"请输入订单号"},model:{value:e.params.id,callback:function(t){e.$set(e.params,"id",t)},expression:"params.id"}})],1)],1),i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"外卖号"}},[i("el-input",{staticClass:"input-width",attrs:{placeholder:"请输入外卖号"},model:{value:e.params.daynumber,callback:function(t){e.$set(e.params,"daynumber",t)},expression:"params.daynumber"}})],1)],1)],1),i("el-row",{attrs:{gutter:20}},[i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"订单类型"}},[i("el-select",{attrs:{placeholder:"请选择订单类型"},model:{value:e.params.deliverkind,callback:function(t){e.$set(e.params,"deliverkind",t)},expression:"params.deliverkind"}},e._l(e.deliverkinds,function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1)],1),i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"下单人手机号"}},[i("el-input",{staticClass:"input-width",attrs:{placeholder:"请输入下单人手机号"},model:{value:e.params.delivermobile,callback:function(t){e.$set(e.params,"delivermobile",t)},expression:"params.delivermobile"}})],1)],1)],1),i("el-row",{attrs:{gutter:20}},[i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"是否分销"}},[i("el-select",{attrs:{placeholder:"请选择订单类型"},model:{value:e.params.isprofitsharing,callback:function(t){e.$set(e.params,"isprofitsharing",t)},expression:"params.isprofitsharing"}},[i("el-option",{attrs:{label:"全部",value:0}}),i("el-option",{attrs:{label:"非分销",value:1}}),i("el-option",{attrs:{label:"分销单",value:2}})],1)],1)],1),i("el-col",{attrs:{span:16}},[i("el-form-item",{attrs:{label:"下单时间"}},[i("el-date-picker",{attrs:{"picker-options":e.pickerOptions,"end-placeholder":"结束日期","range-separator":"至","start-placeholder":"开始日期",type:"daterange","unlink-panels":""},model:{value:e.params.time,callback:function(t){e.$set(e.params,"time",t)},expression:"params.time"}})],1)],1)],1)],1),i("div",{staticClass:"operation-btns"},[i("el-button",{attrs:{size:"small"},on:{click:e.onClickFilter}},[e._v("筛选")]),i("el-button",{staticStyle:{color:"#4E759E"},attrs:{size:"small",type:"text"},on:{click:e.onClickClearFilter}},[e._v("清空筛选条件")])],1)],1),i("div",{staticClass:"container"},[i("comp-tab",{attrs:{data:e.tabs},model:{value:e.params.status,callback:function(t){e.$set(e.params,"status",t)},expression:"params.status"}})],1),i("div",{staticClass:"container"},[e._l(e.list,function(t){return i("div",{key:t.id,staticClass:"product-card"},[i("div",{staticClass:"product-card-head"},[i("span",{staticClass:"product-id"},[e._v(e._s(t.id))]),i("span",{directives:[{name:"show",rawName:"v-show",value:1==t.needinvoice,expression:"item.needinvoice == 1"}],staticClass:"product-need-voice"},[e._v("需要开发票")]),i("div",{staticClass:"product-other-info"},[i("el-button",{attrs:{size:"small",type:"text"},on:{click:function(i){e.$router.push({name:"order-detail",query:{id:t.id}})}}},[e._v("\n            查看详情\n          ")])],1)]),i("table",{staticClass:"product-card-table"},[i("tr",[i("td",{attrs:{width:"100px"}},[i("span",{staticClass:"product-deliver-type",style:{backgroundColor:e.getProductDeliverTypeColor(t.deliverkind)}},[e._v("\n              "+e._s(e.getProductDeliverType(t.deliverkind))+" ")]),i("br"),1==t.deliverkind?i("span",{staticClass:"product-deliver-time"},[e._v(e._s(new Date(1e3*t.delivertime).toLocaleString("zh-CN",{timeZone:"Asia/Shanghai"}))+" ")]):e._e(),i("br"),1==t.deliverkind&&t.delivertime<parseInt(Date.now()/1e3)&&3==t.status?i("span",{staticClass:"product-out-time"},[e._v("已超时")]):e._e(),2==t.deliverkind?i("span",{staticClass:"product-deliver-time"},[e._v("#"+e._s(t.daynumber)+" ")]):e._e()]),i("td",{staticStyle:{"text-align":"left","vertical-align":"top"},attrs:{width:"240px"}},e._l(t.orderproductsList,function(t){return i("span",{key:t.productid},[e._v(" "+e._s(t.product.name)+" "+e._s(t.optionname&&"("+Object.values(JSON.parse(t.optionname)).join(", ")+")")+" × "+e._s(t.quantity)),i("br")])})),i("td",{attrs:{width:"80px"}},[e._v("\n            "+e._s(t.user.nickname)),i("br"),e._v("\n            "+e._s(t.user.mobile)),i("br"),2===t.user.isvip?i("span",{staticClass:"product-member-tag"},[e._v("会员")]):e._e()]),i("td",{attrs:{width:"80px"}},[e._v("\n            "+e._s(new Date(1e3*t.createdat).toLocaleString("zh-CN",{timeZone:"Asia/Shanghai"}))+"\n          ")]),i("td",{attrs:{width:"80px"}},[e._v("￥"+e._s((t.actualamount+t.freight)/100))]),i("td",{staticStyle:{"text-align":"left","vertical-align":"top"}},[e._v("\n            "+e._s(t.note)+"\n          ")]),i("td",{attrs:{width:"100px"}},[e._v("\n            "+e._s(e.getOrderStatus(t.status,t.deliverkind))+"\n            "),i("tr"),12===t.status?[i("el-button",{attrs:{size:"small",type:"text"},on:{click:function(){return e.updateOrder(t,8)}}},[e._v("\n                退款\n              ")]),i("el-button",{attrs:{size:"small",type:"text"},on:{click:function(){return e.updateOrder(t,2)}}},[e._v("\n                拒绝\n              ")])]:e._e(),2===t.status?[i("el-button",{attrs:{size:"small",type:"text"},on:{click:function(){return e.updateOrder(t,8)}}},[e._v("\n                退款\n              ")]),i("el-button",{attrs:{size:"small",type:"text"},on:{click:function(){return e.updateOrder(t,3)}}},[e._v("\n                "+e._s(2==t.deliverkind?"确认发货":"确认接单")+"\n              ")])]:e._e()],2)])])])}),e.list.length?e._e():i("div",{staticClass:"list-nodata"},[i("div",[e._v("暂无数据")])]),e.list.length?i("div",{staticClass:"table-bottom"},[e.hasMore?i("el-button",{attrs:{loading:e.loadmore,size:"small",type:"primary"},on:{click:e.getOrders}},[e._v("加载更多")]):i("p",{staticStyle:{color:"#ccc","font-size":"12px"}},[e._v("已加载全部，没有更多了")])],1):e._e()],2)])},te=[],ie={shortcuts:[{text:"最近一周",onClick:function(e){var t=new Date,i=new Date;i.setTime(i.getTime()-6048e5),e.$emit("pick",[i,t])}},{text:"最近一个月",onClick:function(e){var t=new Date,i=new Date;i.setTime(i.getTime()-2592e6),e.$emit("pick",[i,t])}}]},se=[{value:0,label:"所有订单"},{value:"1",label:"自提"},{value:"2",label:"外卖"}],re={0:"等待顾客支付","2_1":"等待商家备货","2_2":"等待商家发货","3_1":"等待顾客取货","3_2":"已接单待收货",4:"已完成",6:"顾客已取消订单",8:"已退款",12:"顾客请求退款"},ae=function(e,t){return re[e]||re["".concat(e,"_").concat(t)]},ne={components:{"comp-tab":d["a"]},name:"order-list",watch:{"params.status":function(){this.list=[],this.getOrders()}},data:function(){return{tabs:[{label:"全部订单",value:-1},{label:"待支付",value:0},{label:"待接单",value:2},{label:"待收货",value:3},{label:"已完成",value:4},{label:"申请退款",value:12},{label:"已退款",value:8},{label:"已取消",value:6}],pickerOptions:ie,deliverkinds:se,list:[],params:{id:"",status:-1,statuslistList:null,idlessthan:0,createdatgreaterthan:0,createdatlessthan:0,sortby:1,sort:1,deliverkind:0,desk:"",daynumber:"",count:20,delivermobile:"",isprofitsharing:0,time:[]},token:"",loadmore:!1,hasMore:!0}},created:function(){var e=this;this.token=Object(m["e"])(),this.getOrders(),this.conn=null;var t=function t(){-1!==e.conn&&(e.conn=Object(u["b"])("StoreNotificationService.GetNotification",Object(u["a"])("Token",{token:e.token}),function(){var t=Object(c["a"])(regeneratorRuntime.mark(function t(i){var s,r;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(1===i.kind){t.next=2;break}return t.abrupt("return");case 2:return s=i.order,t.next=5,Promise.all([Object(p["b"])("StoreUserService.GetUser",Object(u["a"])("IDWithTokenRequest",{token:Object(u["a"])("Token",{token:e.token}),id:s.userid})),Object(p["b"])("StoreProductService.GetProductList",Object(u["a"])("ProductListQueryRequest",{token:Object(u["a"])("Token",{token:e.token}),idlistList:s.orderproductsList.map(function(e){return e.productid}),sortby:1,sort:1,count:s.orderproductsList.map(function(e){return e.productid}).length}))]);case 5:r=t.sent,s.user=r[0],s.orderproductsList.forEach(function(e){e.product=r[1].productlistList.find(function(t){return t.id===e.productid})}),e.list.splice(0,0,s);case 9:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),function(e){console.log(e),setTimeout(t,2e3)}))};t()},beforeDestroy:function(){this.conn.close(),this.conn=-1},methods:{getOrders:function(){var e=Object(c["a"])(regeneratorRuntime.mark(function e(){var t,i,s,r,a,n,o;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(this.loadmore=!0,t=window,i=t.scrollY,this.params.createdatgreaterthan=0,this.params.createdatlessthan=0,2===this.params.time.length&&(this.params.createdatgreaterthan=parseInt(this.params.time[0].getTime()/1e3),this.params.createdatlessthan=parseInt(this.params.time[1].getTime()/1e3)),!this.params.delivermobile){e.next=10;break}return e.next=8,Object(p["a"])("StoreUserService.GetUserList",Object(u["a"])("UserListQueryRequest",{token:Object(u["a"])("Token",{token:this.token}),mobile:this.params.delivermobile,count:1,order:0}));case 8:s=e.sent,this.params.userid=s.userlistList.length?s.userlistList[0].id:0;case 10:return this.params.idlessthan=this.list.length?this.list[this.list.length-1].id:0,e.next=13,Object(p["a"])("StoreOrderService.GetOrderList",Object(u["a"])("OrderListQueryRequest",Object(l["a"])({token:Object(u["a"])("Token",{token:this.token})},this.params)));case 13:if(r=e.sent,0!==r.orderlistList.length){e.next=18;break}return this.loadmore=!1,this.hasMore=!1,e.abrupt("return");case 18:return a=r.orderlistList.map(function(e){return e.userid}),n=[],r.orderlistList.forEach(function(e){e.orderproductsList.forEach(function(e){n.push(e.productid)})}),e.next=23,Promise.all([Object(p["a"])("StoreUserService.GetUserList",Object(u["a"])("UserListQueryRequest",{token:Object(u["a"])("Token",{token:this.token}),idlistList:a,count:a.length,order:0})),Object(p["a"])("StoreProductService.GetProductList",Object(u["a"])("ProductListQueryRequest",{token:Object(u["a"])("Token",{token:this.token}),idlistList:n,sortby:1,sort:1,count:n.length}))]);case 23:o=e.sent,r.orderlistList.forEach(function(e){e.user=o[0].userlistList.find(function(t){return t.id===e.userid}),e.orderproductsList.forEach(function(e){e.product=o[1].productlistList.find(function(t){return t.id===e.productid})})}),this.list=this.list.concat(r.orderlistList),this.hasMore=r.orderlistList.length,this.loadmore=!1,0!==this.params.idlessthan&&window.scroll(0,i);case 29:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),onClickFilter:function(){this.list=[],this.getOrders()},onClickClearFilter:function(){this.params={id:"",status:-1,statuslistList:null,idlessthan:0,createdatgreaterthan:0,createdatlessthan:0,sortby:1,sort:1,deliverkind:0,desk:"",daynumber:"",count:20,delivermobile:"",time:[]},this.list=[],this.getOrders()},getProductDeliverType:function(e){return 1===e?"自提":2===e?"外卖":""},getProductDeliverTypeColor:function(e){return 1===e?"#549f44":2===e?"#559cda":""},getOrderStatus:ae,updateOrder:function(e,t){var i=this;e=JSON.parse(JSON.stringify(e)),e.status=t,Object(p["a"])("StoreOrderService.UpdateOrder",Object(u["a"])("OrderWithTokenRequest",{token:Object(u["a"])("Token",{token:this.token}),order:Object(u["a"])("Order",Object(l["a"])({},e,{address:Object(u["a"])("Address",e.address),invoice:Object(u["a"])("Invoice",e.invoice),orderproductsList:e.orderproductsList.map(function(e){return Object(u["a"])("OrderProduct",e)})}))})).then(function(t){i.list.splice(i.list.findIndex(function(e){return e.id===t.id}),1,e),i.$message({message:"操作成功",type:"success"})})}}},oe=ne,le=(i("d3b4"),Object(k["a"])(oe,ee,te,!1,null,"c17055ba",null)),ce=le.exports,de=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("div",{staticClass:"container"},[i("el-form",{attrs:{"label-position":"right","label-width":"100px",size:"mini"}},[i("el-row",{attrs:{gutter:20}},[i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"订单号"}},[i("el-input",{staticClass:"input-width",attrs:{placeholder:"请输入订单号"},model:{value:e.params.id,callback:function(t){e.$set(e.params,"id",t)},expression:"params.id"}})],1)],1),i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"外卖号/叫号"}},[i("el-input",{staticClass:"input-width",attrs:{placeholder:"请输入外卖号或叫号"},model:{value:e.params.daynumber,callback:function(t){e.$set(e.params,"daynumber",t)},expression:"params.daynumber"}})],1)],1),i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"桌号"}},[i("el-input",{staticClass:"input-width",attrs:{placeholder:"请输入桌号号"},model:{value:e.params.desk,callback:function(t){e.$set(e.params,"desk",t)},expression:"params.desk"}})],1)],1)],1),i("el-row",{attrs:{gutter:20}},[i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"订单类型"}},[i("el-select",{attrs:{placeholder:"请选择订单类型"},model:{value:e.params.deliverkind,callback:function(t){e.$set(e.params,"deliverkind",t)},expression:"params.deliverkind"}},e._l(e.deliverkinds,function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1)],1),i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"是否分销"}},[i("el-select",{attrs:{placeholder:"请选择订单类型"},model:{value:e.params.isprofitsharing,callback:function(t){e.$set(e.params,"isprofitsharing",t)},expression:"params.isprofitsharing"}},[i("el-option",{attrs:{label:"全部",value:0}}),i("el-option",{attrs:{label:"非分销",value:1}}),i("el-option",{attrs:{label:"分销单",value:2}})],1)],1)],1)],1),i("el-row",{attrs:{gutter:20}},[i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"下单人手机号"}},[i("el-input",{staticClass:"input-width",attrs:{placeholder:"请输入下单人手机号"},model:{value:e.params.delivermobile,callback:function(t){e.$set(e.params,"delivermobile",t)},expression:"params.delivermobile"}})],1)],1),i("el-col",{attrs:{span:16}},[i("el-form-item",{attrs:{label:"下单时间"}},[i("el-date-picker",{attrs:{"picker-options":e.pickerOptions,"end-placeholder":"结束日期","range-separator":"至","start-placeholder":"开始日期",type:"daterange","unlink-panels":""},model:{value:e.params.time,callback:function(t){e.$set(e.params,"time",t)},expression:"params.time"}})],1)],1)],1)],1),i("div",{staticClass:"operation-btns"},[i("el-button",{attrs:{size:"small"},on:{click:e.onClickFilter}},[e._v("筛选")]),i("el-button",{staticStyle:{color:"#4E759E"},attrs:{size:"small",type:"text"},on:{click:e.onClickClearFilter}},[e._v("清空筛选条件")])],1)],1),i("div",{staticClass:"container"},[i("comp-tab",{attrs:{data:e.tabs},model:{value:e.params.status,callback:function(t){e.$set(e.params,"status",t)},expression:"params.status"}})],1),i("div",{staticClass:"container"},[e._l(e.list,function(t){return i("div",{key:t.id,staticClass:"product-card"},[i("div",{staticClass:"product-card-head"},[i("span",{staticClass:"product-id"},[e._v(e._s(t.id))]),i("span",{directives:[{name:"show",rawName:"v-show",value:1==t.needinvoice,expression:"item.needinvoice == 1"}],staticClass:"product-need-voice"},[e._v("需要开发票")]),i("div",{staticClass:"product-other-info"},[i("el-button",{attrs:{size:"small",type:"text"},on:{click:function(i){e.$router.push({name:"order-detail",query:{id:t.id}})}}},[e._v("\n            查看详情\n          ")])],1)]),i("table",{staticClass:"product-card-table"},[i("tr",[i("td",{attrs:{width:"100px"}},[i("span",{staticClass:"product-deliver-type",style:{backgroundColor:e.getProductDeliverTypeColor(t.deliverkind)}},[e._v("\n              "+e._s(e.getProductDeliverType(t.deliverkind))+" ")]),i("br"),1==t.deliverkind?i("span",{staticClass:"product-deliver-time"},[e._v(e._s(new Date(1e3*t.delivertime).toLocaleString("zh-CN",{timeZone:"Asia/Shanghai"}))+" ")]):e._e(),i("br"),1==t.deliverkind&&t.delivertime<parseInt(Date.now()/1e3)&&3==t.status?i("span",{staticClass:"product-out-time"},[e._v("已超时")]):e._e(),2==t.deliverkind?i("span",{staticClass:"product-deliver-time"},[e._v("#"+e._s(t.daynumber)+" ")]):e._e(),3==t.deliverkind?i("span",{staticClass:"product-deliver-time"},[e._v("#"+e._s(t.desk)+" ")]):e._e(),4==t.deliverkind?i("span",{staticClass:"product-deliver-time"},[e._v("#"+e._s(t.daynumber)+" ")]):e._e()]),i("td",{staticStyle:{"text-align":"left","vertical-align":"top"},attrs:{width:"240px"}},e._l(t.orderproductsList,function(t){return i("span",{key:t.productid},[e._v(" "+e._s(t.product.name)+" "+e._s(t.optionname&&"("+Object.values(JSON.parse(t.optionname)).join(", ")+")")+" × "+e._s(t.quantity)),i("br")])})),i("td",{attrs:{width:"80px"}},[e._v("\n            "+e._s(t.user.nickname)),i("br"),e._v("\n            "+e._s(t.user.mobile)),i("br"),2===t.user.isvip?i("span",{staticClass:"product-member-tag"},[e._v("会员")]):e._e()]),i("td",{attrs:{width:"80px"}},[e._v("\n            "+e._s(new Date(1e3*t.createdat).toLocaleString("zh-CN",{timeZone:"Asia/Shanghai"}))+"\n          ")]),i("td",{attrs:{width:"80px"}},[e._v("￥"+e._s((t.actualamount+t.freight)/100))]),i("td",{staticStyle:{"text-align":"left","vertical-align":"top"}},[e._v("\n            "+e._s(t.note)+"\n          ")]),i("td",{attrs:{width:"100px"}},[e._v("\n            "+e._s(e.getOrderStatus(t.status,t.deliverkind))+"\n            "),i("tr"),12===t.status?[i("el-button",{attrs:{size:"small",type:"text"},on:{click:function(){return e.updateOrder(t,8)}}},[e._v("\n                退款\n              ")]),i("el-button",{attrs:{size:"small",type:"text"},on:{click:function(){return e.updateOrder(t,2)}}},[e._v("\n                拒绝\n              ")])]:e._e(),2===t.status?[i("el-button",{attrs:{size:"small",type:"text"},on:{click:function(){return e.updateOrder(t,8)}}},[e._v("\n                退款\n              ")]),i("el-button",{attrs:{size:"small",type:"text"},on:{click:function(){return e.updateOrder(t,3)}}},[e._v("\n                "+e._s(2==t.deliverkind?"确认发货":"确认接单")+"\n              ")])]:e._e()],2)])])])}),e.list.length?e._e():i("div",{staticClass:"list-nodata"},[i("div",[e._v("暂无数据")])]),e.list.length?i("div",{staticClass:"table-bottom"},[e.hasMore?i("el-button",{attrs:{loading:e.loadmore,size:"small",type:"primary"},on:{click:e.getOrders}},[e._v("加载更多")]):i("p",{staticStyle:{color:"#ccc","font-size":"12px"}},[e._v("已加载全部，没有更多了")])],1):e._e()],2)])},ue=[],pe={shortcuts:[{text:"最近一周",onClick:function(e){var t=new Date,i=new Date;i.setTime(i.getTime()-6048e5),e.$emit("pick",[i,t])}},{text:"最近一个月",onClick:function(e){var t=new Date,i=new Date;i.setTime(i.getTime()-2592e6),e.$emit("pick",[i,t])}}]},me=[{value:0,label:"所有订单"},{value:"3",label:"桌号堂食"},{value:"4",label:"叫号堂食"},{value:"1",label:"自提"},{value:"2",label:"外卖"}],ve={0:"等待顾客支付","2_1":"等待商家备货","2_2":"等待商家发货","2_3":"等待商家上菜","2_4":"等待商家备菜","3_1":"等待顾客取货","3_2":"已接单待收货","3_3":"已接单待收货","3_4":"已接单待收货",4:"已完成",6:"顾客已取消订单",8:"已退款",12:"顾客请求退款"},he=function(e,t){return ve[e]||ve["".concat(e,"_").concat(t)]},be={components:{"comp-tab":d["a"]},name:"order-list",watch:{"params.status":function(){this.list=[],this.getOrders()}},data:function(){return{tabs:[{label:"全部订单",value:-1},{label:"待支付",value:0},{label:"待接单",value:2},{label:"待收货",value:3},{label:"已完成",value:4},{label:"申请退款",value:12},{label:"已退款",value:8},{label:"已取消",value:6}],pickerOptions:pe,deliverkinds:me,list:[],params:{id:"",status:-1,statuslistList:null,idlessthan:0,createdatgreaterthan:0,createdatlessthan:0,sortby:1,sort:1,deliverkind:0,desk:"",daynumber:"",count:20,delivermobile:"",isprofitsharing:0,time:[]},token:"",loadmore:!1,hasMore:!0}},created:function(){var e=this;this.token=Object(m["e"])(),this.getOrders(),this.conn=null;var t=function t(){-1!==e.conn&&(e.conn=Object(u["b"])("StoreNotificationService.GetNotification",Object(u["a"])("Token",{token:e.token}),function(){var t=Object(c["a"])(regeneratorRuntime.mark(function t(i){var s,r;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(1===i.kind){t.next=2;break}return t.abrupt("return");case 2:return s=i.order,t.next=5,Promise.all([Object(p["b"])("StoreUserService.GetUser",Object(u["a"])("IDWithTokenRequest",{token:Object(u["a"])("Token",{token:e.token}),id:s.userid})),Object(p["b"])("StoreProductService.GetProductList",Object(u["a"])("ProductListQueryRequest",{token:Object(u["a"])("Token",{token:e.token}),idlistList:s.orderproductsList.map(function(e){return e.productid}),sortby:1,sort:1,count:s.orderproductsList.map(function(e){return e.productid}).length}))]);case 5:r=t.sent,s.user=r[0],s.orderproductsList.forEach(function(e){e.product=r[1].productlistList.find(function(t){return t.id===e.productid})}),e.list.splice(0,0,s);case 9:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),function(e){console.log(e),setTimeout(t,2e3)}))};t()},beforeDestroy:function(){this.conn.close(),this.conn=-1},methods:{getOrders:function(){var e=Object(c["a"])(regeneratorRuntime.mark(function e(){var t,i,s,r,a,n,o;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(this.loadmore=!0,t=window,i=t.scrollY,this.params.createdatgreaterthan=0,this.params.createdatlessthan=0,2===this.params.time.length&&(this.params.createdatgreaterthan=parseInt(this.params.time[0].getTime()/1e3),this.params.createdatlessthan=parseInt(this.params.time[1].getTime()/1e3)),!this.params.delivermobile){e.next=10;break}return e.next=8,Object(p["a"])("StoreUserService.GetUserList",Object(u["a"])("UserListQueryRequest",{token:Object(u["a"])("Token",{token:this.token}),mobile:this.params.delivermobile,count:1,order:0}));case 8:s=e.sent,this.params.userid=s.userlistList.length?s.userlistList[0].id:0;case 10:return this.params.idlessthan=this.list.length?this.list[this.list.length-1].id:0,e.next=13,Object(p["a"])("StoreOrderService.GetOrderList",Object(u["a"])("OrderListQueryRequest",Object(l["a"])({token:Object(u["a"])("Token",{token:this.token})},this.params)));case 13:if(r=e.sent,0!==r.orderlistList.length){e.next=18;break}return this.loadmore=!1,this.hasMore=!1,e.abrupt("return");case 18:return a=r.orderlistList.map(function(e){return e.userid}),n=[],r.orderlistList.forEach(function(e){e.orderproductsList.forEach(function(e){n.push(e.productid)})}),e.next=23,Promise.all([Object(p["a"])("StoreUserService.GetUserList",Object(u["a"])("UserListQueryRequest",{token:Object(u["a"])("Token",{token:this.token}),idlistList:a,count:a.length,order:0})),Object(p["a"])("StoreProductService.GetProductList",Object(u["a"])("ProductListQueryRequest",{token:Object(u["a"])("Token",{token:this.token}),idlistList:n,sortby:1,sort:1,count:n.length}))]);case 23:o=e.sent,r.orderlistList.forEach(function(e){e.user=o[0].userlistList.find(function(t){return t.id===e.userid}),e.orderproductsList.forEach(function(e){e.product=o[1].productlistList.find(function(t){return t.id===e.productid})})}),this.list=this.list.concat(r.orderlistList),this.hasMore=r.orderlistList.length,this.loadmore=!1,0!==this.params.idlessthan&&window.scroll(0,i);case 29:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),onClickFilter:function(){this.list=[],this.getOrders()},onClickClearFilter:function(){this.params={id:"",status:-1,statuslistList:null,idlessthan:0,createdatgreaterthan:0,createdatlessthan:0,sortby:1,sort:1,deliverkind:0,desk:"",daynumber:"",count:20,delivermobile:"",time:[]},this.list=[],this.getOrders()},getProductDeliverType:function(e){return 1===e?"自提":2===e?"外卖":3===e?"桌号堂食":4===e?"叫号堂食":""},getProductDeliverTypeColor:function(e){return 1===e?"#549f44":2===e?"#559cda":3===e||4===e?"#cd4a58":""},getOrderStatus:he,updateOrder:function(e,t){var i=this;e=JSON.parse(JSON.stringify(e)),e.status=t,Object(p["a"])("StoreOrderService.UpdateOrder",Object(u["a"])("OrderWithTokenRequest",{token:Object(u["a"])("Token",{token:this.token}),order:Object(u["a"])("Order",Object(l["a"])({},e,{address:Object(u["a"])("Address",e.address),invoice:Object(u["a"])("Invoice",e.invoice),orderproductsList:e.orderproductsList.map(function(e){return Object(u["a"])("OrderProduct",e)})}))})).then(function(t){i.list.splice(i.list.findIndex(function(e){return e.id===t.id}),1,e),i.$message({message:"操作成功",type:"success"})})}}},fe=be,ke=(i("bd7a"),Object(k["a"])(fe,de,ue,!1,null,"456a86ea",null)),ye=ke.exports,ge={_0:g,_1:z,_2:U,_3:M,_4:X,_6:ce,_7:ye},Oe={0:"_0",1:"_1",2:"_2",3:"_3",4:"_4",6:"_6",7:"_7"},_e=Object(a["a"])({name:"order-list-entry",components:ge,map:Oe}),xe=_e,Ce=Object(k["a"])(xe,s,r,!1,null,null,null);t["default"]=Ce.exports},"732f":function(e,t,i){},"80bf":function(e,t,i){"use strict";i("96cf");var s=i("1da1"),r=(i("7f7f"),i("a3fb"));t["a"]=function(e){var t=e.name,i=e.components,a=e.map;return{name:t,components:i,data:function(){return{store:{}}},created:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(r["b"])();case 2:this.store=e.sent;case 3:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),render:function(e){return e(a[this.store.kind])}}}},"8f1a":function(e,t,i){"use strict";var s=i("f66a"),r=i.n(s);r.a},ab1c:function(e,t,i){"use strict";var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"tab"},e._l(e.data,function(t){return i("div",{key:t.label,class:["tab-item",{active:e.value===t.value}],on:{click:function(i){e.onClickItem(t.value)}}},[e._v(e._s(t.label))])}))},r=[],a={props:{data:{type:Array,default:function(){return[{label:"test",value:0},{label:"test2",value:1}]},required:!0},value:{default:"",required:!0}},methods:{onClickItem:function(e){this.$emit("input",e)}}},n=a,o=(i("56ee"),i("2877")),l=Object(o["a"])(n,s,r,!1,null,"5e44c4ee",null);t["a"]=l.exports},bd7a:function(e,t,i){"use strict";var s=i("0e8a"),r=i.n(s);r.a},bff6:function(e,t,i){},c61b:function(e,t,i){"use strict";var s=i("1acf"),r=i.n(s);r.a},d3b4:function(e,t,i){"use strict";var s=i("6841"),r=i.n(s);r.a},dff5:function(e,t,i){"use strict";var s=i("13df"),r=i.n(s);r.a},f66a:function(e,t,i){},f884:function(e,t,i){"use strict";var s=i("732f"),r=i.n(s);r.a}}]);
//# sourceMappingURL=order-index.761e589b.js.map