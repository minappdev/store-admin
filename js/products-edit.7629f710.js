(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["products-edit"],{"00b8":function(t,e,i){},"0ed2":function(t,e,i){},"0f66":function(t,e,i){"use strict";var o=i("9759"),r=i.n(o);r.a},"10b9":function(t,e,i){"use strict";var o=i("d2a6"),r=i.n(o);r.a},1377:function(t,e,i){},"146d":function(t,e,i){},2827:function(t,e,i){},3191:function(t,e,i){"use strict";var o=i("1377"),r=i.n(o);r.a},3305:function(t,e,i){"use strict";var o=i("bafd"),r=i.n(o);r.a},"334f":function(t,e,i){},"3c46":function(t,e,i){"use strict";var o=i("3da9"),r=i.n(o);r.a},"3d79":function(t,e,i){"use strict";var o=i("ad13"),r=i.n(o);r.a},"3da9":function(t,e,i){},"427c":function(t,e,i){"use strict";var o=i("146d"),r=i.n(o);r.a},"504c":function(t,e,i){var o=i("0d58"),r=i("6821"),s=i("52a7").f;t.exports=function(t){return function(e){var i,a=r(e),n=o(a),c=n.length,p=0,l=[];while(c>p)s.call(a,i=n[p++])&&l.push(t?[i,a[i]]:a[i]);return l}}},"56cf":function(t,e,i){"use strict";var o=i("334f"),r=i.n(o);r.a},"58ec":function(t,e,i){},"83eb":function(t,e,i){},8615:function(t,e,i){var o=i("5ca1"),r=i("504c")(!1);o(o.S,"Object",{values:function(t){return r(t)}})},9678:function(t,e,i){"use strict";i.r(e);var o,r,s=i("80bf"),a=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"edit-page"},[o("div",{staticClass:"ml-l pl-l mb-l pb-l"},[o("el-button",{attrs:{size:"small"},on:{click:function(e){t.$router.back()}}},[t._v("返回")])],1),o("el-form",{ref:"form",attrs:{model:t.form,rules:t.rules,"label-width":"120px",size:"small"}},[o("div",{staticClass:"container"},[o("h3",{staticClass:"title"},[t._v("基本信息")]),o("el-form-item",{attrs:{label:"商品名"}},[o("el-col",{attrs:{span:"6"}},[o("el-input",{model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1)],1),o("el-form-item",{attrs:{label:"添加商品图"}},[o("upload-file",{attrs:{limit:10,accept:"image/*"},model:{value:t.form.imagesList,callback:function(e){t.$set(t.form,"imagesList",e)},expression:"form.imagesList"}}),o("div",{staticClass:"tips"},[t._v("建议尺寸：800*800像素，最多上传10张")])],1),o("el-form-item",{attrs:{label:"选择分类"}},[o("el-row",[o("el-col",{attrs:{span:6}},[o("el-select",{attrs:{placeholder:"请选择分类",multiple:""},model:{value:t.form.categoryidlistList,callback:function(e){t.$set(t.form,"categoryidlistList",e)},expression:"form.categoryidlistList"}},t._l(t.categories,function(t){return o("el-option",{key:t.id,attrs:{label:t.name.slice(1).split("/")[0]+" - "+t.name.slice(1).split("/")[1],value:t.id}})}))],1),o("el-col",{staticStyle:{"margin-left":"15px"},attrs:{span:2}},[o("el-button",{attrs:{size:"small",type:"text"},on:{click:function(e){t.$router.push({name:"category"})}}},[t._v("新建类目")])],1)],1)],1),o("el-form-item",{attrs:{label:"添加视频(可选)"}},[o("el-row",[o("el-col",{attrs:{span:4}},[o("upload-file",{attrs:{limit:1,accept:"image/*"},model:{value:t.form.videoimage,callback:function(e){t.$set(t.form,"videoimage",e)},expression:"form.videoimage"}}),o("div",{staticClass:"tips"},[o("span",{staticClass:"tips-title"},[t._v("预览图：")]),t._v("建议尺寸：800*800像素")])],1),o("el-col",{staticStyle:{"margin-left":"15px"},attrs:{span:5}},[o("upload-file",{attrs:{limit:1,accept:"video/*"},model:{value:t.form.video,callback:function(e){t.$set(t.form,"video",e)},expression:"form.video"}},[o("div",{staticStyle:{width:"120px",height:"120px"},attrs:{slot:"preview"},slot:"preview"},[o("img",{staticStyle:{width:"120px",height:"120px"},attrs:{alt:"",src:i("c59e")}})])]),o("div",{staticClass:"tips"},[o("span",{staticClass:"tips-title"},[t._v("视频：")]),t._v("目前仅支持在手机端播放，建议时常9-30秒，建议视频宽高比1:1或16:9。")])],1)],1)],1),o("el-form-item",{attrs:{label:"商品详情"}},[o("upload-file",{attrs:{limit:10,accept:"image/*"},model:{value:t.form.descriptionimagesList,callback:function(e){t.$set(t.form,"descriptionimagesList",e)},expression:"form.descriptionimagesList"}}),o("div",{staticClass:"tips upload"},[t._v("上传商品详情页图片，帮助买家进一步了解商品。")]),o("div",{staticClass:"tips nopt"},[t._v("建议图片宽度不大于1500px，质量不大于2M，最多可上传10张。")])],1)],1),o("div",{staticClass:"container"},[o("h3",{staticClass:"title"},[t._v("价格库存")]),o("el-form-item",{attrs:{label:"商品规格"}},[t.form.options.length?o("div",{staticClass:"options"},[t._l(t.form.options,function(e,i){return[o("el-row",{key:e.uid+"x",staticClass:"single oi"},[o("el-col",{staticClass:"options-title",attrs:{span:"3"}},[t._v("规格名：")]),o("el-col",{attrs:{span:"4"}},[o("el-input",{staticClass:"min-input",attrs:{autofocus:""},model:{value:e.name,callback:function(i){t.$set(e,"name",i)},expression:"op.name"}})],1),o("el-col",{staticStyle:{"text-align":"right"},attrs:{offset:"16",span:"1"}},[o("el-button",{staticStyle:{color:"gray"},attrs:{icon:"el-icon-error",type:"text"},on:{click:function(e){t.removeOption(i)}}})],1)],1),o("el-row",{key:e.uid+"y",staticClass:"double oi"},[o("el-col",{staticClass:"options-title",attrs:{span:"3"}},[t._v("规格值：")]),o("el-col",{attrs:{span:"21"}},[o("el-row",{attrs:{gutter:"8"}},[t._l(e.value,function(i,r){return o("el-col",{key:i.uid,staticStyle:{display:"flex"},attrs:{span:5}},[o("el-input",{staticClass:"min-input",staticStyle:{"margin-right":"5px"},model:{value:i.value,callback:function(e){t.$set(i,"value",e)},expression:"v.value"}}),o("el-button",{staticStyle:{color:"gray","margin-right":"5px"},attrs:{icon:"el-icon-error",type:"text"},on:{click:function(i){t.removeOptionItem(e.value,r)}}})],1)}),o("el-col",{staticStyle:{"text-align":"center"},attrs:{span:"4"}},[o("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(i){t.addOptionItem(e.value)}}},[t._v("添加规格值")])],1)],2)],1)],1)]}),o("el-row",{staticClass:"single oi"},[o("el-col",{attrs:{span:"5"}},[o("el-button",{attrs:{disabled:3===t.form.options.length,size:"mini",type:"primary"},on:{click:t.addOption}},[t._v("添加规格项目")])],1),o("el-col",{staticClass:"options-title",attrs:{span:"18"}},[o("span",[t._v("最多支持3种规格")])])],1)],2):o("div",[o("el-button",{on:{click:t.addOption}},[t._v("添加规格")])],1),o("div",{staticClass:"tips",staticStyle:{color:"#ff4f4f"}},[t._v("如有大小, 颜色等不同规格，请添加商品规格, 如无则不必添加。")])]),o("el-form-item",{directives:[{name:"show",rawName:"v-show",value:t.form.optionsDetail.length,expression:"form.optionsDetail.length"}],attrs:{label:"规格明细"}},[o("div",{staticClass:"options-detail"},[o("el-table",{attrs:{data:t.form.optionsDetail,border:""}},[t._l(t.form.optionsDetail[0],function(e,i){return["quantity"===i&&2===t.form.withquantity||"groupprice"===i&&0==t.form.groupuserquantity?t._e():o("el-table-column",{key:i,attrs:{width:["price","discountprice","vipprice","groupprice","costprice"].includes(i)&&135},scopedSlots:t._u([{key:"header",fn:function(e){return[t._v("\n                  "+t._s(t.getTitle(i))+"\n                  "),t.getTitleInfo(i)?o("el-tooltip",{attrs:{effect:"dark",content:t.getTitleInfo(i,e),placement:"top"}},[o("i",{staticClass:"el-icon-warning"})]):t._e()]}},{key:"default",fn:function(e){return["image"!=i?o("el-input",{staticClass:"min-input",model:{value:e.row[i],callback:function(o){t.$set(e.row,i,o)},expression:"scope.row[key]"}}):o("upload-file",{attrs:{height:"50px",width:"50px",limit:1,accept:"image/*"},model:{value:e.row[i],callback:function(o){t.$set(e.row,i,o)},expression:"scope.row[key]"}})]}}])})]})],2)],1)]),o("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!t.form.optionsDetail.length,expression:"!form.optionsDetail.length"}],staticClass:"form-item-price",attrs:{label:"商品价格"}},[o("el-col",{attrs:{span:"4"}},[o("el-input",{model:{value:t.form.price,callback:function(e){t.$set(t.form,"price",e)},expression:"form.price"}},[o("template",{slot:"append"},[t._v("元")])],2)],1)],1),o("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!t.form.optionsDetail.length,expression:"!form.optionsDetail.length"}],staticClass:"form-item-price",attrs:{label:"折扣价格"}},[o("el-row",[o("el-col",{attrs:{span:"4"}},[o("el-input",{model:{value:t.form.discountprice,callback:function(e){t.$set(t.form,"discountprice",e)},expression:"form.discountprice"}},[o("template",{slot:"append"},[t._v("元")])],2)],1)],1),o("div",{staticClass:"tips"},[t._v("设置该商品的折扣价格, 不填或填0代表不设置折扣价。")])],1),o("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!t.form.optionsDetail.length,expression:"!form.optionsDetail.length"}],staticClass:"form-item-price",attrs:{label:"会员价格"}},[o("el-row",[o("el-col",{attrs:{span:"4"}},[o("el-input",{model:{value:t.form.vipprice,callback:function(e){t.$set(t.form,"vipprice",e)},expression:"form.vipprice"}},[o("template",{slot:"append"},[t._v("元")])],2)],1)],1),o("div",{staticClass:"tips"},[t._v("设置该商品会员享有的价格, 不填或填0代表不设置会员价。")])],1),o("el-form-item",{attrs:{label:"成团人数"}},[o("el-row",[o("el-col",{attrs:{span:"4"}},[o("el-select",{model:{value:t.form.groupuserquantity,callback:function(e){t.$set(t.form,"groupuserquantity",e)},expression:"form.groupuserquantity"}},[o("el-option",{attrs:{label:"不选择团购人数",value:0}}),o("el-option",{attrs:{label:"2人",value:2}}),o("el-option",{attrs:{label:"3人",value:3}}),o("el-option",{attrs:{label:"4人",value:4}}),o("el-option",{attrs:{label:"5人",value:5}})],1)],1)],1),o("div",{staticClass:"tips"},[t._v("如不支持团购则不选择")])],1),o("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!(t.form.optionsDetail.length||0==t.form.groupuserquantity),expression:"!(form.optionsDetail.length || form.groupuserquantity == 0)"}],staticClass:"form-item-price",attrs:{label:"团购价格"}},[o("el-row",[o("el-col",{attrs:{span:"4"}},[o("el-input",{model:{value:t.form.groupprice,callback:function(e){t.$set(t.form,"groupprice",e)},expression:"form.groupprice"}},[o("template",{slot:"append"},[t._v("元")])],2)],1)],1)],1),o("el-form-item",{attrs:{label:"商品库存"}},[o("el-row",[o("el-col",{attrs:{span:"5"}},[o("el-switch",{attrs:{"active-text":"有无库存限制","active-value":1,"inactive-value":2},model:{value:t.form.withquantity,callback:function(e){t.$set(t.form,"withquantity",e)},expression:"form.withquantity"}})],1),o("el-col",{attrs:{span:"18"}},[1===t.form.withquantity?o("div",{staticClass:"tips",staticStyle:{"margin-left":"5px","margin-top":"5px"}},[t._v("当前商品有库存限制, 商品库存为0时，将自动移动至 “已售罄” 列表。")]):o("div",{staticClass:"tips",staticStyle:{"margin-left":"5px","margin-top":"5px"}},[t._v("当前商品没有库存限制")])])],1),t.form.optionsDetail.length||1!==t.form.withquantity?t._e():o("el-row",[o("el-col",{attrs:{span:"4"}},[o("el-input",{model:{value:t.form.quantity,callback:function(e){t.$set(t.form,"quantity",e)},expression:"form.quantity"}})],1)],1)],1),o("el-form-item",{attrs:{label:"商品编码"}},[o("el-row",[o("el-col",{attrs:{span:"4"}},[o("el-input",{model:{value:t.form.number,callback:function(e){t.$set(t.form,"number",e)},expression:"form.number"}})],1)],1),o("div",{staticClass:"tips"},[t._v("如无则不填")])],1),o("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!t.form.optionsDetail.length,expression:"!form.optionsDetail.length"}],staticClass:"form-item-price",attrs:{label:"成本价格",prop:"costprice"}},[o("el-row",[o("el-col",{attrs:{span:"4"}},[o("el-input",{model:{value:t.form.costprice,callback:function(e){t.$set(t.form,"costprice",e)},expression:"form.costprice"}},[o("template",{slot:"append"},[t._v("元")])],2)],1)],1),o("div",{staticClass:"tips"},[t._v("成本价将用于利润统计，方便您了解经营收益。")])],1),o("el-form-item",{attrs:{prop:"online"}},[o("el-col",{attrs:{span:"5"}},[o("el-switch",{attrs:{"active-text":"上架商品","active-value":1,"inactive-value":0},model:{value:t.form.online,callback:function(e){t.$set(t.form,"online",e)},expression:"form.online"}})],1),o("el-col",{attrs:{span:"18"}},[0===t.form.online?o("div",{staticClass:"tips",staticStyle:{"margin-left":"5px","margin-top":"5px"}},[t._v("当前商品已下架。")]):o("div",{staticClass:"tips",staticStyle:{"margin-left":"5px","margin-top":"5px"}},[t._v("当前商品已上架。")])])],1)],1)]),o("div",{staticStyle:{height:"100px"}}),o("div",{staticClass:"buttons"},[o("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("发布")])],1)],1)},n=[],c=(i("7f7f"),i("ac4d"),i("8a81"),i("ac6a"),i("be94")),p=(i("96cf"),i("1da1")),l=i("fbcf"),u=i("e8e1"),m=i("8e44"),f=i("73cd"),d=i("a3fb"),v={components:{"upload-file":l["a"]},data:function(){return{categories:[],display:!0,form:{name:"",categoryidlistList:[],videoimage:"",video:"",imagesList:[],description:"",descriptionimagesList:[],supportgroup:0,groupuserquantity:0,quantity:0,price:0,discountprice:0,groupprice:0,withoption:0,optionsList:[],online:1,number:"",costprice:0,withquantity:1,productdescriptionlong:"",productnoticelistList:[],supportreserve:1,vipprice:0,withtimeslot:1,producttimeslotlistList:[],options:[],optionsDetail:[]},token:"",showProDialog:!1}},watch:{"form.options":{deep:!0,handler:function(){this.form.optionsDetail=this.buildOptionJson(this.form.options)}}},created:function(){var t=Object(p["a"])(regeneratorRuntime.mark(function t(){var e=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return this.token=Object(f["e"])(),t.next=3,Object(d["b"])();case 3:t.sent,"edit"===this.$route.query.type&&Object(m["a"])("StoreProductService.GetProduct",Object(u["a"])("IDWithTokenRequest",{token:Object(u["a"])("Token",{token:this.token}),id:this.$route.query.id})).then(function(t){e.form=e.backend2frontend(t),e.form.price=e.$amount1(e.form.price),e.form.discountprice=e.$amount1(e.form.discountprice),e.form.groupprice=e.$amount1(e.form.groupprice),e.form.costprice=e.$amount1(e.form.costprice),e.form.vipprice=e.$amount1(e.form.vipprice),e.form.optionsDetail=e.form.optionsDetail.map(function(t){return Object(c["a"])({},t,{price:e.$amount1(t.price),discountprice:e.$amount1(t.discountprice),groupprice:e.$amount1(t.groupprice),costprice:e.$amount1(t.costprice),vipprice:e.$amount1(t.vipprice)})})}),Object(m["a"])("StoreCategoryService.GetCategoryList",Object(u["a"])("CategoryListQueryRequest",{token:Object(u["a"])("Token",{token:this.token}),ishidden:2,level:2,count:100,sortby:1})).then(function(t){e.categories=t.categorylistList});case 6:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),methods:{test:function(){this.showProDialog=!0},getDetailDesc:function(t){return"discountprice"===t?"优惠价格, 不填或填0代表不设置折扣价":"groupprice"===t?"如不支持团购则不填":""},onSubmit:function(){var t=this;this.$refs.form.validate(function(e){if(e){var i=JSON.parse(JSON.stringify(t.form));if(i.price=t.$amount2(i.price),i.discountprice=t.$amount2(i.discountprice),i.groupprice=t.$amount2(i.groupprice),i.costprice=t.$amount2(i.costprice),i.vipprice=t.$amount2(i.vipprice),i.optionsDetail=i.optionsDetail.map(function(e){return Object(c["a"])({},e,{price:t.$amount2(e.price),discountprice:t.$amount2(e.discountprice),groupprice:t.$amount2(e.groupprice),costprice:t.$amount2(e.costprice),vipprice:t.$amount2(e.vipprice)})}),i=t.frontend2backend(i),i.categoryidlistList.length){if(i.categoryid=i.categoryidlistList[0],0==i.withoption){if(0==i.price)return void t.$message({message:"忘记设置原价了",type:"error"});if(0!=i.discountprice&&i.discountprice>=i.price)return void t.$message({message:"如果设置折扣价, 则折扣价需小于原价",type:"error"});if(0!=i.vipprice){if(i.vipprice>=i.price)return void t.$message({message:"如果设置会员价, 则会员价需小于原价",type:"error"});if(0!=i.discountprice&&i.vipprice>=i.discountprice)return void t.$message({message:"会员价应该小于折扣价",type:"error"})}if(1==i.supportgroup){if(0==i.groupprice)return void t.$message({message:"忘记设置团购价了",type:"error"});if(i.groupprice>=i.price)return void t.$message({message:"团购价需小于原价",type:"error"});if(0!=i.discountprice&&i.groupprice>=i.discountprice)return void t.$message({message:"团购价需小于折扣价",type:"error"});if(0!=i.vipprice&&i.groupprice>=i.vipprice)return void t.$message({message:"团购价需小于会员价",type:"error"})}}if(1==i.withoption){var o=!0,r=!1,s=void 0;try{for(var a,n=i.optionsList[Symbol.iterator]();!(o=(a=n.next()).done);o=!0){var p=a.value,l=p.toObject();if(0==l.price)return void t.$message({message:"忘记设置原价了",type:"error"});if(0!=l.discountprice&&l.discountprice>=l.price)return void t.$message({message:"如果设置折扣价, 则折扣价需小于原价",type:"error"});if(0!=l.vipprice){if(l.vipprice>=l.price)return void t.$message({message:"如果设置会员价, 则会员价需小于原价",type:"error"});if(0!=l.discountprice&&l.vipprice>=l.discountprice)return void t.$message({message:"会员价应该小于折扣价",type:"error"})}if(1==i.supportgroup){if(0==l.groupprice)return void t.$message({message:"忘记设置团购价了",type:"error"});if(l.groupprice>=l.price)return void t.$message({message:"团购价需小于原价",type:"error"});if(0!=l.discountprice&&l.groupprice>=l.discountprice)return void t.$message({message:"团购价需小于折扣价",type:"error"});if(0!=l.vipprice&&l.groupprice>=l.vipprice)return void t.$message({message:"团购价需小于会员价",type:"error"})}}}catch(f){r=!0,s=f}finally{try{o||null==n.return||n.return()}finally{if(r)throw s}}}"edit"!==t.$route.query.type?Object(m["a"])("StoreProductService.CreateProduct",Object(u["a"])("ProductWithTokenRequest",{token:Object(u["a"])("Token",{token:t.token}),product:Object(u["a"])("Product",i)})).then(function(e){t.$router.back()}):Object(m["a"])("StoreProductService.UpdateProduct",Object(u["a"])("ProductWithTokenRequest",{token:Object(u["a"])("Token",{token:t.token}),product:Object(u["a"])("Product",i)})).then(function(e){t.$message({message:"商品保存成功",type:"success"})})}else t.$message({message:"忘记选择分类了",type:"error"})}})},backend2frontend:function(t){for(var e=[],i=[],o={},r=0;r<t.optionsList.length;r++){var s={price:t.optionsList[r].price,discountprice:t.optionsList[r].discountprice,groupprice:t.optionsList[r].groupprice,costprice:t.optionsList[r].costprice,vipprice:t.optionsList[r].vipprice,quantity:t.optionsList[r].quantity,image:t.optionsList[r].image},a=JSON.parse(t.optionsList[r].name);for(var n in a)o.hasOwnProperty(n)||(o[n]=[]),-1===o[n].indexOf(a[n])&&o[n].push(a[n]),s[n]=a[n];i.push(s)}for(var n in t.optionsDetail=i,o)e.push({vid:n,name:n,value:o[n].map(function(t){return{vid:n+":"+t,value:t}})});return t.options=e,t},frontend2backend:function(t){return t.supportgroup=t.groupuserquantity>0?1:0,t.withoption=0,t.optionsList=[],t.optionsDetail.length&&(t.withoption=1,t.optionsList=t.optionsDetail.map(function(t){var e={},i={};for(var o in t)"price"!==o&&"discountprice"!==o&&"vipprice"!==o&&"groupprice"!==o&&"quantity"!==o&&"costprice"!==o&&"image"!==o?i[o]=t[o]:e[o]=t[o];return e.name=JSON.stringify(Object(f["g"])(i)),Object(u["a"])("Option",e)})),t.productnoticelistList=t.productnoticelistList.map(function(t){return Object(u["a"])("ProductNotice",t)}),t.producttimeslotlistList=t.producttimeslotlistList.map(function(t){return Object(u["a"])("ProductTimeSlot",{weeklistList:t.weeklistList,producttimeslotpricelistList:t.producttimeslotpricelistList.map(function(t){return Object(u["a"])("ProductTimeSlotPrice",t)})})}),t},getTitle:function(t){var e={firstValue:"-",secondValue:"-",thirdValue:"-",price:"价格（元）",discountprice:"折扣价（元）",vipprice:"会员价（元）",groupprice:"团购价（元）",quantity:"库存",costprice:"成本价（元）",image:"规格图片"};return e[t]?e[t]:t},getTitleInfo:function(t){var e={price:"原价",discountprice:"当有折扣价时，商品优先显示折扣价，原件则作为划线价展示, 不填或填0代表不设置折扣价",vipprice:"当有会员价时，会员会使用会员价, 不填或填0代表不设置会员价",groupprice:"拼团使用的价格",quantity:"商品库存",costprice:"用于统计商店利润"};return e[t]},removeOption:function(t){this.form.options.splice(t,1)},addOption:function(){this.form.options.push({name:"",value:[{value:"",uid:Math.random()}],uid:Math.random()})},removeOptionItem:function(t,e){t.splice(e,1)},addOptionItem:function(t){t.push({value:"",uid:Math.random()})},buildOptionJson:function(t){var e=[],i=["firstValue","secondValue","thirdValue"];t.forEach(function(t,o){if(t.value.length){var r=t.name||i[o];if(e.length){var s=[];e.forEach(function(e){t.value.forEach(function(t){var i=Object(c["a"])({},e);i[r]=t.value,s.push(i)})}),e=s}else e=t.value.map(function(t){var e={};return e[r]=t.value,e})}});var o=this.form.optionsDetail,r=e.map(function(t,e){var i=o[e]||{},r=i.price,s=void 0===r?0:r,a=i.discountprice,n=void 0===a?0:a,p=i.vipprice,l=void 0===p?0:p,u=i.groupprice,m=void 0===u?0:u,f=i.quantity,d=void 0===f?0:f,v=i.costprice,g=void 0===v?0:v,h=i.image,y=void 0===h?"":h;return Object(c["a"])({},t,{price:s,discountprice:n,vipprice:l,groupprice:m,quantity:d,costprice:g,image:y})});return r}}},g=v,h=(i("3191"),i("3d79"),i("2877")),y=Object(h["a"])(g,a,n,!1,null,"7eb36d2e",null),b=y.exports,k=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"edit-page"},[i("div",{staticClass:"ml-l pl-l mb-l pb-l"},[i("el-button",{attrs:{size:"small"},on:{click:function(e){t.$router.back()}}},[t._v("返回")])],1),i("el-form",{ref:"form",attrs:{model:t.form,rules:t.rules,"label-width":"120px",size:"small"}},[i("div",{staticClass:"container"},[i("h3",{staticClass:"title"},[t._v("基本信息")]),i("el-form-item",{attrs:{label:"商品名"}},[i("el-col",{attrs:{span:"6"}},[i("el-input",{model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1)],1),i("el-form-item",{attrs:{label:"商品描述"}},[i("el-col",{attrs:{span:"12"}},[i("el-input",{model:{value:t.form.description,callback:function(e){t.$set(t.form,"description",e)},expression:"form.description"}})],1)],1),i("el-form-item",{attrs:{label:"添加商品图"}},[i("upload-file",{attrs:{limit:10,accept:"image/*"},model:{value:t.form.imagesList,callback:function(e){t.$set(t.form,"imagesList",e)},expression:"form.imagesList"}}),i("div",{staticClass:"tips"},[t._v("建议尺寸：800*800像素，最多上传10张")])],1),i("el-form-item",{attrs:{label:"商品详情"}},[i("upload-file",{attrs:{limit:10,accept:"image/*"},model:{value:t.form.descriptionimagesList,callback:function(e){t.$set(t.form,"descriptionimagesList",e)},expression:"form.descriptionimagesList"}}),i("div",{staticClass:"tips upload"},[t._v("上传商品详情页图片，帮助买家进一步了解商品。")]),i("div",{staticClass:"tips nopt"},[t._v("建议图片宽度不大于1500px，质量不大于2M，最多可上传10张。")])],1),i("el-form-item",{attrs:{label:"选择分类"}},[i("el-row",[i("el-col",{attrs:{span:6}},[i("el-select",{attrs:{placeholder:"请选择分类",multiple:""},model:{value:t.form.categoryidlistList,callback:function(e){t.$set(t.form,"categoryidlistList",e)},expression:"form.categoryidlistList"}},t._l(t.categories,function(t){return i("el-option",{key:t.id,attrs:{label:t.name.slice(1).split("/")[0],value:t.id}})}))],1),i("el-col",{staticStyle:{"margin-left":"15px"},attrs:{span:2}},[i("el-button",{attrs:{size:"small",type:"text"},on:{click:function(e){t.$router.push({name:"category"})}}},[t._v("新建类目")])],1)],1)],1)],1),i("div",{staticClass:"container"},[i("h3",{staticClass:"title"},[t._v("价格")]),i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!t.form.optionsDetail.length,expression:"!form.optionsDetail.length"}],staticClass:"form-item-price",attrs:{label:"商品价格"}},[i("el-col",{attrs:{span:"4"}},[i("el-input",{model:{value:t.form.price,callback:function(e){t.$set(t.form,"price",e)},expression:"form.price"}},[i("template",{slot:"append"},[t._v("元")])],2)],1)],1),i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!t.form.optionsDetail.length,expression:"!form.optionsDetail.length"}],staticClass:"form-item-price",attrs:{label:"折扣价格"}},[i("el-row",[i("el-col",{attrs:{span:"4"}},[i("el-input",{model:{value:t.form.discountprice,callback:function(e){t.$set(t.form,"discountprice",e)},expression:"form.discountprice"}},[i("template",{slot:"append"},[t._v("元")])],2)],1)],1),i("div",{staticClass:"tips"},[t._v("设置该商品的折扣价格, 不填或填0代表不设置折扣价。")])],1),i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!t.form.optionsDetail.length,expression:"!form.optionsDetail.length"}],staticClass:"form-item-price",attrs:{label:"会员价格"}},[i("el-row",[i("el-col",{attrs:{span:"4"}},[i("el-input",{model:{value:t.form.vipprice,callback:function(e){t.$set(t.form,"vipprice",e)},expression:"form.vipprice"}},[i("template",{slot:"append"},[t._v("元")])],2)],1)],1),i("div",{staticClass:"tips"},[t._v("设置该商品会员享有的价格, 不填或填0代表不设置会员价。")])],1),i("el-form-item",{attrs:{label:"成团人数"}},[i("el-row",[i("el-col",{attrs:{span:"4"}},[i("el-select",{model:{value:t.form.groupuserquantity,callback:function(e){t.$set(t.form,"groupuserquantity",e)},expression:"form.groupuserquantity"}},[i("el-option",{attrs:{label:"不选择团购人数",value:0}}),i("el-option",{attrs:{label:"2人",value:2}}),i("el-option",{attrs:{label:"3人",value:3}}),i("el-option",{attrs:{label:"4人",value:4}}),i("el-option",{attrs:{label:"5人",value:5}})],1)],1)],1),i("div",{staticClass:"tips"},[t._v("如不支持团购则不选择")])],1),i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!(t.form.optionsDetail.length||0==t.form.groupuserquantity),expression:"!(form.optionsDetail.length || form.groupuserquantity == 0)"}],staticClass:"form-item-price",attrs:{label:"团购价格"}},[i("el-row",[i("el-col",{attrs:{span:"4"}},[i("el-input",{model:{value:t.form.groupprice,callback:function(e){t.$set(t.form,"groupprice",e)},expression:"form.groupprice"}},[i("template",{slot:"append"},[t._v("元")])],2)],1)],1)],1),i("el-form-item",{attrs:{label:"商品编码"}},[i("el-row",[i("el-col",{attrs:{span:"4"}},[i("el-input",{model:{value:t.form.number,callback:function(e){t.$set(t.form,"number",e)},expression:"form.number"}})],1)],1),i("div",{staticClass:"tips"},[t._v("如无则不填")])],1),i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!t.form.optionsDetail.length,expression:"!form.optionsDetail.length"}],staticClass:"form-item-price",attrs:{label:"成本价格",prop:"costprice"}},[i("el-row",[i("el-col",{attrs:{span:"4"}},[i("el-input",{model:{value:t.form.costprice,callback:function(e){t.$set(t.form,"costprice",e)},expression:"form.costprice"}},[i("template",{slot:"append"},[t._v("元")])],2)],1)],1),i("div",{staticClass:"tips"},[t._v("成本价将用于利润统计，方便您了解经营收益。")])],1),i("el-form-item",{attrs:{prop:"online"}},[i("el-col",{attrs:{span:"5"}},[i("el-switch",{attrs:{"active-text":"上架商品","active-value":1,"inactive-value":0},model:{value:t.form.online,callback:function(e){t.$set(t.form,"online",e)},expression:"form.online"}})],1),i("el-col",{attrs:{span:"18"}},[0===t.form.online?i("div",{staticClass:"tips",staticStyle:{"margin-left":"5px","margin-top":"5px"}},[t._v("当前商品已下架。")]):i("div",{staticClass:"tips",staticStyle:{"margin-left":"5px","margin-top":"5px"}},[t._v("当前商品已上架。")])])],1)],1)]),i("div",{staticStyle:{height:"100px"}}),i("div",{staticClass:"buttons"},[i("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("发布")])],1)],1)},w=[],$={components:{"upload-file":l["a"]},data:function(){return{showProDialog:!1,categories:[],display:!0,form:{name:"",categoryid:"",videoimage:"",video:"",imagesList:[],description:"",descriptionimagesList:[],supportgroup:0,groupuserquantity:0,quantity:0,price:0,discountprice:0,groupprice:0,withoption:0,optionsList:[],online:1,number:"",costprice:0,withquantity:2,productdescriptionlong:"",productnoticelistList:[],supportreserve:1,vipprice:0,withtimeslot:1,producttimeslotlistList:[],options:[],optionsDetail:[]},token:""}},watch:{"form.options":{deep:!0,handler:function(){this.form.optionsDetail=this.buildOptionJson(this.form.options)}}},created:function(){var t=Object(p["a"])(regeneratorRuntime.mark(function t(){var e=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return this.token=Object(f["e"])(),t.next=3,Object(d["b"])();case 3:t.sent,"edit"===this.$route.query.type&&Object(m["a"])("StoreProductService.GetProduct",Object(u["a"])("IDWithTokenRequest",{token:Object(u["a"])("Token",{token:this.token}),id:this.$route.query.id})).then(function(t){e.form=e.backend2frontend(t),e.form.price=e.$amount1(e.form.price),e.form.discountprice=e.$amount1(e.form.discountprice),e.form.groupprice=e.$amount1(e.form.groupprice),e.form.costprice=e.$amount1(e.form.costprice),e.form.vipprice=e.$amount1(e.form.vipprice),e.form.optionsDetail=e.form.optionsDetail.map(function(t){return Object(c["a"])({},t,{price:e.$amount1(t.price),discountprice:e.$amount1(t.discountprice),groupprice:e.$amount1(t.groupprice),costprice:e.$amount1(t.costprice),vipprice:e.$amount1(t.vipprice)})})}),Object(m["a"])("StoreCategoryService.GetCategoryList",Object(u["a"])("CategoryListQueryRequest",{token:Object(u["a"])("Token",{token:this.token}),ishidden:2,level:1,count:100,sortby:1})).then(function(t){e.categories=t.categorylistList});case 6:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),methods:{getDetailDesc:function(t){return"discountprice"===t?"优惠价格, 不填或填0代表不设置折扣价":"groupprice"===t?"如不支持团购则不填":""},onSubmit:function(){var t=this;this.$refs.form.validate(function(e){if(e){var i=JSON.parse(JSON.stringify(t.form));if(i.price=t.$amount2(i.price),i.discountprice=t.$amount2(i.discountprice),i.groupprice=t.$amount2(i.groupprice),i.costprice=t.$amount2(i.costprice),i.vipprice=t.$amount2(i.vipprice),i.optionsDetail=i.optionsDetail.map(function(e){return Object(c["a"])({},e,{price:t.$amount2(e.price),discountprice:t.$amount2(e.discountprice),groupprice:t.$amount2(e.groupprice),costprice:t.$amount2(e.costprice),vipprice:t.$amount2(e.vipprice)})}),i=t.frontend2backend(i),i.categoryidlistList.length){if(i.categoryid=i.categoryidlistList[0],0==i.withoption){if(0==i.price)return void t.$message({message:"忘记设置原价了",type:"error"});if(0!=i.discountprice&&i.discountprice>=i.price)return void t.$message({message:"如果设置折扣价, 则折扣价需小于原价",type:"error"});if(0!=i.vipprice){if(i.vipprice>=i.price)return void t.$message({message:"如果设置会员价, 则会员价需小于原价",type:"error"});if(0!=i.discountprice&&i.vipprice>=i.discountprice)return void t.$message({message:"会员价应该小于折扣价",type:"error"})}if(1==i.supportgroup){if(0==i.groupprice)return void t.$message({message:"忘记设置团购价了",type:"error"});if(i.groupprice>=i.price)return void t.$message({message:"团购价需小于原价",type:"error"});if(0!=i.discountprice&&i.groupprice>=i.discountprice)return void t.$message({message:"团购价需小于折扣价",type:"error"});if(0!=i.vipprice&&i.groupprice>=i.vipprice)return void t.$message({message:"团购价需小于会员价",type:"error"})}}if(1==i.withoption){var o=!0,r=!1,s=void 0;try{for(var a,n=i.optionsList[Symbol.iterator]();!(o=(a=n.next()).done);o=!0){var p=a.value,l=p.toObject();if(0==l.price)return void t.$message({message:"忘记设置原价了",type:"error"});if(0!=l.discountprice&&l.discountprice>=l.price)return void t.$message({message:"如果设置折扣价, 则折扣价需小于原价",type:"error"});if(0!=l.vipprice){if(l.vipprice>=l.price)return void t.$message({message:"如果设置会员价, 则会员价需小于原价",type:"error"});if(0!=l.discountprice&&l.vipprice>=l.discountprice)return void t.$message({message:"会员价应该小于折扣价",type:"error"})}if(1==i.supportgroup){if(0==l.groupprice)return void t.$message({message:"忘记设置团购价了",type:"error"});if(l.groupprice>=l.price)return void t.$message({message:"团购价需小于原价",type:"error"});if(0!=l.discountprice&&l.groupprice>=l.discountprice)return void t.$message({message:"团购价需小于折扣价",type:"error"});if(0!=l.vipprice&&l.groupprice>=l.vipprice)return void t.$message({message:"团购价需小于会员价",type:"error"})}}}catch(f){r=!0,s=f}finally{try{o||null==n.return||n.return()}finally{if(r)throw s}}}"edit"!==t.$route.query.type?Object(m["a"])("StoreProductService.CreateProduct",Object(u["a"])("ProductWithTokenRequest",{token:Object(u["a"])("Token",{token:t.token}),product:Object(u["a"])("Product",i)})).then(function(e){t.$router.back()}):Object(m["a"])("StoreProductService.UpdateProduct",Object(u["a"])("ProductWithTokenRequest",{token:Object(u["a"])("Token",{token:t.token}),product:Object(u["a"])("Product",i)})).then(function(e){t.$message({message:"商品保存成功",type:"success"})})}else t.$message({message:"忘记选择分类了",type:"error"})}})},backend2frontend:function(t){for(var e=[],i=[],o={},r=0;r<t.optionsList.length;r++){var s={price:t.optionsList[r].price,discountprice:t.optionsList[r].discountprice,groupprice:t.optionsList[r].groupprice,costprice:t.optionsList[r].costprice,vipprice:t.optionsList[r].vipprice,quantity:t.optionsList[r].quantity},a=JSON.parse(t.optionsList[r].name);for(var n in a)o.hasOwnProperty(n)||(o[n]=[]),-1===o[n].indexOf(a[n])&&o[n].push(a[n]),s[n]=a[n];i.push(s)}for(var n in t.optionsDetail=i,o)e.push({vid:n,name:n,value:o[n].map(function(t){return{vid:n+":"+t,value:t}})});return t.options=e,t},frontend2backend:function(t){return t.supportgroup=t.groupuserquantity>0?1:0,t.withoption=0,t.optionsList=[],t.optionsDetail.length&&(t.withoption=1,t.optionsList=t.optionsDetail.map(function(t){var e={},i={};for(var o in t)"price"!==o&&"discountprice"!==o&&"vipprice"!==o&&"groupprice"!==o&&"quantity"!==o&&"costprice"!==o?i[o]=t[o]:e[o]=t[o];return e.name=JSON.stringify(Object(f["g"])(i)),console.log(e),Object(u["a"])("Option",e)})),t.productnoticelistList=t.productnoticelistList.map(function(t){return Object(u["a"])("ProductNotice",t)}),t.producttimeslotlistList=t.producttimeslotlistList.map(function(t){return Object(u["a"])("ProductTimeSlot",{weeklistList:t.weeklistList,producttimeslotpricelistList:t.producttimeslotpricelistList.map(function(t){return Object(u["a"])("ProductTimeSlotPrice",t)})})}),t},getTitle:function(t){var e={firstValue:"-",secondValue:"-",thirdValue:"-",price:"价格（元）",discountprice:"折扣价（元）",vipprice:"会员价（元）",groupprice:"团购价（元）",quantity:"库存",costprice:"成本价（元）"};return e[t]?e[t]:t},getTitleInfo:function(t){var e={price:"原价",discountprice:"当有折扣价时，商品优先显示折扣价，原件则作为划线价展示, 不填或填0代表不设置折扣价",vipprice:"当有会员价时，会员会使用会员价, 不填或填0代表不设置会员价",groupprice:"拼团使用的价格",quantity:"商品库存",costprice:"用于统计商店利润"};return e[t]},removeOption:function(t){this.form.options.splice(t,1)},addOption:function(){this.form.options.push({name:"",value:[{value:"",uid:Math.random()}],uid:Math.random()})},removeOptionItem:function(t,e){t.splice(e,1)},addOptionItem:function(t){t.push({value:"",uid:Math.random()})},buildOptionJson:function(t){var e=[],i=["firstValue","secondValue","thirdValue"];t.forEach(function(t,o){if(t.value.length){var r=t.name||i[o];if(e.length){var s=[];e.forEach(function(e){t.value.forEach(function(t){var i=Object(c["a"])({},e);i[r]=t.value,s.push(i)})}),e=s}else e=t.value.map(function(t){var e={};return e[r]=t.value,e})}});var o=this.form.optionsDetail,r=e.map(function(t,e){var i=o[e]||{},r=i.price,s=void 0===r?0:r,a=i.discountprice,n=void 0===a?0:a,p=i.vipprice,l=void 0===p?0:p,u=i.groupprice,m=void 0===u?0:u,f=i.quantity,d=void 0===f?0:f,v=i.costprice,g=void 0===v?0:v;return Object(c["a"])({},t,{price:s,discountprice:n,vipprice:l,groupprice:m,quantity:d,costprice:g})});return r}}},x=$,O=(i("c494"),i("10b9"),Object(h["a"])(x,k,w,!1,null,"4af95b1a",null)),_=O.exports,L=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"edit-page"},[o("div",{staticClass:"ml-l pl-l mb-l pb-l"},[o("el-button",{attrs:{size:"small"},on:{click:function(e){t.$router.back()}}},[t._v("返回")])],1),o("el-form",{ref:"form",attrs:{model:t.form,rules:t.rules,"label-width":"120px",size:"small"}},[o("div",{staticClass:"container"},[o("h3",{staticClass:"title"},[t._v("基本信息")]),o("el-form-item",{attrs:{label:"商品名"}},[o("el-col",{attrs:{span:"6"}},[o("el-input",{model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1)],1),o("el-form-item",{attrs:{label:"是否可到店体验"}},[o("el-col",{attrs:{span:"3"}},[o("el-switch",{attrs:{"active-text":"是","inactive-text":"否","active-value":2,"inactive-value":1},model:{value:t.form.supportreserve,callback:function(e){t.$set(t.form,"supportreserve",e)},expression:"form.supportreserve"}})],1)],1),o("el-form-item",{attrs:{label:"添加商品图"}},[o("upload-file",{attrs:{limit:10,accept:"image/*"},model:{value:t.form.imagesList,callback:function(e){t.$set(t.form,"imagesList",e)},expression:"form.imagesList"}}),o("div",{staticClass:"tips"},[t._v("建议尺寸：800*800像素，最多上传10张")])],1),o("el-form-item",{attrs:{label:"选择分类"}},[o("el-row",[o("el-col",{attrs:{span:6}},[o("el-select",{attrs:{placeholder:"请选择分类",multiple:""},model:{value:t.form.categoryidlistList,callback:function(e){t.$set(t.form,"categoryidlistList",e)},expression:"form.categoryidlistList"}},t._l(t.categories,function(t){return o("el-option",{key:t.id,attrs:{label:t.name.slice(1).split("/")[0]+" - "+t.name.slice(1).split("/")[1],value:t.id}})}))],1),o("el-col",{staticStyle:{"margin-left":"15px"},attrs:{span:2}},[o("el-button",{attrs:{size:"small",type:"text"},on:{click:function(e){t.$router.push({name:"category"})}}},[t._v("新建类目")])],1)],1)],1),o("el-form-item",{attrs:{label:"添加视频(可选)"}},[o("el-row",[o("el-col",{attrs:{span:4}},[o("upload-file",{attrs:{limit:1,accept:"image/*"},model:{value:t.form.videoimage,callback:function(e){t.$set(t.form,"videoimage",e)},expression:"form.videoimage"}}),o("div",{staticClass:"tips"},[o("span",{staticClass:"tips-title"},[t._v("预览图：")]),t._v("建议尺寸：800*800像素\n            ")])],1),o("el-col",{staticStyle:{"margin-left":"15px"},attrs:{span:5}},[o("upload-file",{attrs:{limit:1,accept:"video/*"},model:{value:t.form.video,callback:function(e){t.$set(t.form,"video",e)},expression:"form.video"}},[o("div",{staticStyle:{width:"120px",height:"120px"},attrs:{slot:"preview"},slot:"preview"},[o("img",{staticStyle:{width:"120px",height:"120px"},attrs:{alt:"",src:i("c59e")}})])]),o("div",{staticClass:"tips"},[o("span",{staticClass:"tips-title"},[t._v("视频：")]),t._v("目前仅支持在手机端播放，建议时常9-30秒，建议视频宽高比1:1或16:9。\n            ")])],1)],1)],1),o("el-form-item",{attrs:{label:"商品详情"}},[o("upload-file",{attrs:{limit:10,accept:"image/*"},model:{value:t.form.descriptionimagesList,callback:function(e){t.$set(t.form,"descriptionimagesList",e)},expression:"form.descriptionimagesList"}}),o("div",{staticClass:"tips upload"},[t._v("上传商品详情页图片，帮助买家进一步了解商品。")]),o("div",{staticClass:"tips nopt"},[t._v("建议图片宽度不大于1500px，质量不大于2M，最多可上传10张。")])],1)],1),o("div",{staticClass:"container"},[o("h3",{staticClass:"title"},[t._v("价格库存")]),o("el-form-item",{attrs:{label:"商品规格"}},[t.form.options.length?o("div",{staticClass:"options"},[t._l(t.form.options,function(e,i){return[o("el-row",{key:e.uid+"x",staticClass:"single oi"},[o("el-col",{staticClass:"options-title",attrs:{span:"3"}},[t._v("规格名：")]),o("el-col",{attrs:{span:"4"}},[o("el-input",{staticClass:"min-input",attrs:{autofocus:""},model:{value:e.name,callback:function(i){t.$set(e,"name",i)},expression:"op.name"}})],1),o("el-col",{staticStyle:{"text-align":"right"},attrs:{offset:"16",span:"1"}},[o("el-button",{staticStyle:{color:"gray"},attrs:{icon:"el-icon-error",type:"text"},on:{click:function(e){t.removeOption(i)}}})],1)],1),o("el-row",{key:e.uid+"y",staticClass:"double oi"},[o("el-col",{staticClass:"options-title",attrs:{span:"3"}},[t._v("规格值：")]),o("el-col",{attrs:{span:"21"}},[o("el-row",{attrs:{gutter:"8"}},[t._l(e.value,function(i,r){return o("el-col",{key:i.uid,staticStyle:{display:"flex"},attrs:{span:5}},[o("el-input",{staticClass:"min-input",staticStyle:{"margin-right":"5px"},model:{value:i.value,callback:function(e){t.$set(i,"value",e)},expression:"v.value"}}),o("el-button",{staticStyle:{color:"gray","margin-right":"5px"},attrs:{icon:"el-icon-error",type:"text"},on:{click:function(i){t.removeOptionItem(e.value,r)}}})],1)}),o("el-col",{staticStyle:{"text-align":"center"},attrs:{span:"4"}},[o("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(i){t.addOptionItem(e.value)}}},[t._v("添加规格值")])],1)],2)],1)],1)]}),o("el-row",{staticClass:"single oi"},[o("el-col",{attrs:{span:"5"}},[o("el-button",{attrs:{disabled:3===t.form.options.length,size:"mini",type:"primary"},on:{click:t.addOption}},[t._v("添加规格项目")])],1),o("el-col",{staticClass:"options-title",attrs:{span:"18"}},[o("span",[t._v("最多支持3种规格")])])],1)],2):o("div",[o("el-button",{on:{click:t.addOption}},[t._v("添加规格")])],1),o("div",{staticClass:"tips",staticStyle:{color:"#ff4f4f"}},[t._v("如有大小, 颜色等不同规格，请添加商品规格, 如无则不必添加。")])]),o("el-form-item",{directives:[{name:"show",rawName:"v-show",value:t.form.optionsDetail.length,expression:"form.optionsDetail.length"}],attrs:{label:"规格明细"}},[o("div",{staticClass:"options-detail"},[o("el-table",{attrs:{data:t.form.optionsDetail,border:""}},[t._l(t.form.optionsDetail[0],function(e,i){return["quantity"===i&&2===t.form.withquantity||"groupprice"===i&&0==t.form.groupuserquantity?t._e():o("el-table-column",{key:i,attrs:{width:["price","discountprice","vipprice","groupprice","costprice"].includes(i)&&135},scopedSlots:t._u([{key:"header",fn:function(e){return[t._v("\n                  "+t._s(t.getTitle(i))+"\n                  "),t.getTitleInfo(i)?o("el-tooltip",{attrs:{effect:"dark",content:t.getTitleInfo(i,e),placement:"top"}},[o("i",{staticClass:"el-icon-warning"})]):t._e()]}},{key:"default",fn:function(e){return["image"!=i?o("el-input",{staticClass:"min-input",model:{value:e.row[i],callback:function(o){t.$set(e.row,i,o)},expression:"scope.row[key]"}}):o("upload-file",{attrs:{height:"50px",width:"50px",limit:1,accept:"image/*"},model:{value:e.row[i],callback:function(o){t.$set(e.row,i,o)},expression:"scope.row[key]"}})]}}])})]})],2)],1)]),o("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!t.form.optionsDetail.length,expression:"!form.optionsDetail.length"}],staticClass:"form-item-price",attrs:{label:"商品价格"}},[o("el-col",{attrs:{span:"4"}},[o("el-input",{model:{value:t.form.price,callback:function(e){t.$set(t.form,"price",e)},expression:"form.price"}},[o("template",{slot:"append"},[t._v("元")])],2)],1)],1),o("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!t.form.optionsDetail.length,expression:"!form.optionsDetail.length"}],staticClass:"form-item-price",attrs:{label:"折扣价格"}},[o("el-row",[o("el-col",{attrs:{span:"4"}},[o("el-input",{model:{value:t.form.discountprice,callback:function(e){t.$set(t.form,"discountprice",e)},expression:"form.discountprice"}},[o("template",{slot:"append"},[t._v("元")])],2)],1)],1),o("div",{staticClass:"tips"},[t._v("设置该商品的折扣价格, 不填或填0代表不设置折扣价。")])],1),o("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!t.form.optionsDetail.length,expression:"!form.optionsDetail.length"}],staticClass:"form-item-price",attrs:{label:"会员价格"}},[o("el-row",[o("el-col",{attrs:{span:"4"}},[o("el-input",{model:{value:t.form.vipprice,callback:function(e){t.$set(t.form,"vipprice",e)},expression:"form.vipprice"}},[o("template",{slot:"append"},[t._v("元")])],2)],1)],1),o("div",{staticClass:"tips"},[t._v("设置该商品会员享有的价格, 不填或填0代表不设置会员价。")])],1),o("el-form-item",{attrs:{label:"成团人数"}},[o("el-row",[o("el-col",{attrs:{span:"4"}},[o("el-select",{model:{value:t.form.groupuserquantity,callback:function(e){t.$set(t.form,"groupuserquantity",e)},expression:"form.groupuserquantity"}},[o("el-option",{attrs:{label:"不选择团购人数",value:0}}),o("el-option",{attrs:{label:"2人",value:2}}),o("el-option",{attrs:{label:"3人",value:3}}),o("el-option",{attrs:{label:"4人",value:4}}),o("el-option",{attrs:{label:"5人",value:5}})],1)],1)],1),o("div",{staticClass:"tips"},[t._v("如不支持团购则不选择")])],1),o("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!(t.form.optionsDetail.length||0==t.form.groupuserquantity),expression:"!(form.optionsDetail.length || form.groupuserquantity == 0)"}],staticClass:"form-item-price",attrs:{label:"团购价格"}},[o("el-row",[o("el-col",{attrs:{span:"4"}},[o("el-input",{model:{value:t.form.groupprice,callback:function(e){t.$set(t.form,"groupprice",e)},expression:"form.groupprice"}},[o("template",{slot:"append"},[t._v("元")])],2)],1)],1)],1),o("el-form-item",{attrs:{label:"商品库存"}},[o("el-row",[o("el-col",{attrs:{span:"5"}},[o("el-switch",{attrs:{"active-text":"有无库存限制","active-value":1,"inactive-value":2},model:{value:t.form.withquantity,callback:function(e){t.$set(t.form,"withquantity",e)},expression:"form.withquantity"}})],1),o("el-col",{attrs:{span:"18"}},[1===t.form.withquantity?o("div",{staticClass:"tips",staticStyle:{"margin-left":"5px","margin-top":"5px"}},[t._v("当前商品有库存限制, 商品库存为0时，将自动移动至 “已售罄” 列表。")]):o("div",{staticClass:"tips",staticStyle:{"margin-left":"5px","margin-top":"5px"}},[t._v("当前商品没有库存限制")])])],1),t.form.optionsDetail.length||1!==t.form.withquantity?t._e():o("el-row",[o("el-col",{attrs:{span:"4"}},[o("el-input",{model:{value:t.form.quantity,callback:function(e){t.$set(t.form,"quantity",e)},expression:"form.quantity"}})],1)],1)],1),o("el-form-item",{attrs:{label:"商品编码"}},[o("el-row",[o("el-col",{attrs:{span:"4"}},[o("el-input",{model:{value:t.form.number,callback:function(e){t.$set(t.form,"number",e)},expression:"form.number"}})],1)],1),o("div",{staticClass:"tips"},[t._v("如无则不填")])],1),o("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!t.form.optionsDetail.length,expression:"!form.optionsDetail.length"}],staticClass:"form-item-price",attrs:{label:"成本价格",prop:"costprice"}},[o("el-row",[o("el-col",{attrs:{span:"4"}},[o("el-input",{model:{value:t.form.costprice,callback:function(e){t.$set(t.form,"costprice",e)},expression:"form.costprice"}},[o("template",{slot:"append"},[t._v("元")])],2)],1)],1),o("div",{staticClass:"tips"},[t._v("成本价将用于利润统计，方便您了解经营收益。")])],1),o("el-form-item",{attrs:{prop:"online"}},[o("el-col",{attrs:{span:"5"}},[o("el-switch",{attrs:{"active-text":"上架商品","active-value":1,"inactive-value":0},model:{value:t.form.online,callback:function(e){t.$set(t.form,"online",e)},expression:"form.online"}})],1),o("el-col",{attrs:{span:"18"}},[0===t.form.online?o("div",{staticClass:"tips",staticStyle:{"margin-left":"5px","margin-top":"5px"}},[t._v("当前商品已下架。")]):o("div",{staticClass:"tips",staticStyle:{"margin-left":"5px","margin-top":"5px"}},[t._v("当前商品已上架。")])])],1)],1)]),o("div",{staticStyle:{height:"100px"}}),o("div",{staticClass:"buttons"},[o("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("发布")])],1)],1)},C=[],S={components:{"upload-file":l["a"]},data:function(){return{showProDialog:!1,categories:[],display:!0,form:{name:"",categoryid:"",videoimage:"",video:"",imagesList:[],description:"",descriptionimagesList:[],supportgroup:0,groupuserquantity:0,quantity:0,price:0,discountprice:0,groupprice:0,withoption:0,optionsList:[],online:1,number:"",costprice:0,withquantity:1,productdescriptionlong:"",productnoticelistList:[],supportreserve:1,vipprice:0,withtimeslot:1,producttimeslotlistList:[],options:[],optionsDetail:[]},token:""}},watch:{"form.options":{deep:!0,handler:function(){this.form.optionsDetail=this.buildOptionJson(this.form.options)}}},created:function(){var t=Object(p["a"])(regeneratorRuntime.mark(function t(){var e=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return this.token=Object(f["e"])(),t.next=3,Object(d["b"])();case 3:t.sent,"edit"===this.$route.query.type&&Object(m["a"])("StoreProductService.GetProduct",Object(u["a"])("IDWithTokenRequest",{token:Object(u["a"])("Token",{token:this.token}),id:this.$route.query.id})).then(function(t){e.form=e.backend2frontend(t),e.form.price=e.$amount1(e.form.price),e.form.discountprice=e.$amount1(e.form.discountprice),e.form.groupprice=e.$amount1(e.form.groupprice),e.form.costprice=e.$amount1(e.form.costprice),e.form.vipprice=e.$amount1(e.form.vipprice),e.form.optionsDetail=e.form.optionsDetail.map(function(t){return Object(c["a"])({},t,{price:e.$amount1(t.price),discountprice:e.$amount1(t.discountprice),groupprice:e.$amount1(t.groupprice),costprice:e.$amount1(t.costprice),vipprice:e.$amount1(t.vipprice)})})}),Object(m["a"])("StoreCategoryService.GetCategoryList",Object(u["a"])("CategoryListQueryRequest",{token:Object(u["a"])("Token",{token:this.token}),ishidden:2,level:2,count:100,sortby:1})).then(function(t){e.categories=t.categorylistList});case 6:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),methods:{getDetailDesc:function(t){return"discountprice"===t?"优惠价格, 不填或填0代表不设置折扣价":"groupprice"===t?"如不支持团购则不填":""},onSubmit:function(){var t=this;this.$refs.form.validate(function(e){if(e){var i=JSON.parse(JSON.stringify(t.form));if(i.price=t.$amount2(i.price),i.discountprice=t.$amount2(i.discountprice),i.groupprice=t.$amount2(i.groupprice),i.costprice=t.$amount2(i.costprice),i.vipprice=t.$amount2(i.vipprice),i.optionsDetail=i.optionsDetail.map(function(e){return Object(c["a"])({},e,{price:t.$amount2(e.price),discountprice:t.$amount2(e.discountprice),groupprice:t.$amount2(e.groupprice),costprice:t.$amount2(e.costprice),vipprice:t.$amount2(e.vipprice)})}),i=t.frontend2backend(i),i.categoryidlistList.length){if(i.categoryid=i.categoryidlistList[0],0==i.withoption){if(0==i.price)return void t.$message({message:"忘记设置原价了",type:"error"});if(0!=i.discountprice&&i.discountprice>=i.price)return void t.$message({message:"如果设置折扣价, 则折扣价需小于原价",type:"error"});if(0!=i.vipprice){if(i.vipprice>=i.price)return void t.$message({message:"如果设置会员价, 则会员价需小于原价",type:"error"});if(0!=i.discountprice&&i.vipprice>=i.discountprice)return void t.$message({message:"会员价应该小于折扣价",type:"error"})}if(1==i.supportgroup){if(0==i.groupprice)return void t.$message({message:"忘记设置团购价了",type:"error"});if(i.groupprice>=i.price)return void t.$message({message:"团购价需小于原价",type:"error"});if(0!=i.discountprice&&i.groupprice>=i.discountprice)return void t.$message({message:"团购价需小于折扣价",type:"error"});if(0!=i.vipprice&&i.groupprice>=i.vipprice)return void t.$message({message:"团购价需小于会员价",type:"error"})}}if(1==i.withoption){var o=!0,r=!1,s=void 0;try{for(var a,n=i.optionsList[Symbol.iterator]();!(o=(a=n.next()).done);o=!0){var p=a.value,l=p.toObject();if(0==l.price)return void t.$message({message:"忘记设置原价了",type:"error"});if(0!=l.discountprice&&l.discountprice>=l.price)return void t.$message({message:"如果设置折扣价, 则折扣价需小于原价",type:"error"});if(0!=l.vipprice){if(l.vipprice>=l.price)return void t.$message({message:"如果设置会员价, 则会员价需小于原价",type:"error"});if(0!=l.discountprice&&l.vipprice>=l.discountprice)return void t.$message({message:"会员价应该小于折扣价",type:"error"})}if(1==i.supportgroup){if(0==l.groupprice)return void t.$message({message:"忘记设置团购价了",type:"error"});if(l.groupprice>=l.price)return void t.$message({message:"团购价需小于原价",type:"error"});if(0!=l.discountprice&&l.groupprice>=l.discountprice)return void t.$message({message:"团购价需小于折扣价",type:"error"});if(0!=l.vipprice&&l.groupprice>=l.vipprice)return void t.$message({message:"团购价需小于会员价",type:"error"})}}}catch(f){r=!0,s=f}finally{try{o||null==n.return||n.return()}finally{if(r)throw s}}}"edit"!==t.$route.query.type?Object(m["a"])("StoreProductService.CreateProduct",Object(u["a"])("ProductWithTokenRequest",{token:Object(u["a"])("Token",{token:t.token}),product:Object(u["a"])("Product",i)})).then(function(e){t.$router.back()}):Object(m["a"])("StoreProductService.UpdateProduct",Object(u["a"])("ProductWithTokenRequest",{token:Object(u["a"])("Token",{token:t.token}),product:Object(u["a"])("Product",i)})).then(function(e){t.$message({message:"商品保存成功",type:"success"})})}else t.$message({message:"忘记选择分类了",type:"error"})}})},backend2frontend:function(t){for(var e=[],i=[],o={},r=0;r<t.optionsList.length;r++){var s={price:t.optionsList[r].price,discountprice:t.optionsList[r].discountprice,groupprice:t.optionsList[r].groupprice,costprice:t.optionsList[r].costprice,vipprice:t.optionsList[r].vipprice,quantity:t.optionsList[r].quantity,image:t.optionsList[r].image},a=JSON.parse(t.optionsList[r].name);for(var n in a)o.hasOwnProperty(n)||(o[n]=[]),-1===o[n].indexOf(a[n])&&o[n].push(a[n]),s[n]=a[n];i.push(s)}for(var n in t.optionsDetail=i,o)e.push({vid:n,name:n,value:o[n].map(function(t){return{vid:n+":"+t,value:t}})});return t.options=e,t},frontend2backend:function(t){return t.supportgroup=t.groupuserquantity>0?1:0,t.withoption=0,t.optionsList=[],t.optionsDetail.length&&(t.withoption=1,t.optionsList=t.optionsDetail.map(function(t){var e={},i={};for(var o in t)"price"!==o&&"discountprice"!==o&&"vipprice"!==o&&"groupprice"!==o&&"quantity"!==o&&"costprice"!==o&&"image"!==o?i[o]=t[o]:e[o]=t[o];return e.name=JSON.stringify(Object(f["g"])(i)),Object(u["a"])("Option",e)})),t.productnoticelistList=t.productnoticelistList.map(function(t){return Object(u["a"])("ProductNotice",t)}),t.producttimeslotlistList=t.producttimeslotlistList.map(function(t){return Object(u["a"])("ProductTimeSlot",{weeklistList:t.weeklistList,producttimeslotpricelistList:t.producttimeslotpricelistList.map(function(t){return Object(u["a"])("ProductTimeSlotPrice",t)})})}),t},getTitle:function(t){var e={firstValue:"-",secondValue:"-",thirdValue:"-",price:"价格（元）",discountprice:"折扣价（元）",vipprice:"会员价（元）",groupprice:"团购价（元）",quantity:"库存",costprice:"成本价（元）",image:"图片"};return e[t]?e[t]:t},getTitleInfo:function(t){var e={price:"原价",discountprice:"当有折扣价时，商品优先显示折扣价，原件则作为划线价展示, 不填或填0代表不设置折扣价",vipprice:"当有会员价时，会员会使用会员价, 不填或填0代表不设置会员价",groupprice:"拼团使用的价格",quantity:"商品库存",costprice:"用于统计商店利润"};return e[t]},removeOption:function(t){this.form.options.splice(t,1)},addOption:function(){this.form.options.push({name:"",value:[{value:"",uid:Math.random()}],uid:Math.random()})},removeOptionItem:function(t,e){t.splice(e,1)},addOptionItem:function(t){t.push({value:"",uid:Math.random()})},buildOptionJson:function(t){var e=[],i=["firstValue","secondValue","thirdValue"];t.forEach(function(t,o){if(t.value.length){var r=t.name||i[o];if(e.length){var s=[];e.forEach(function(e){t.value.forEach(function(t){var i=Object(c["a"])({},e);i[r]=t.value,s.push(i)})}),e=s}else e=t.value.map(function(t){var e={};return e[r]=t.value,e})}});var o=this.form.optionsDetail,r=e.map(function(t,e){var i=o[e]||{},r=i.price,s=void 0===r?0:r,a=i.discountprice,n=void 0===a?0:a,p=i.vipprice,l=void 0===p?0:p,u=i.groupprice,m=void 0===u?0:u,f=i.quantity,d=void 0===f?0:f,v=i.costprice,g=void 0===v?0:v,h=i.image,y=void 0===h?"":h;return Object(c["a"])({},t,{price:s,discountprice:n,vipprice:l,groupprice:m,quantity:d,costprice:g,image:y})});return r}}},q=S,j=(i("56cf"),i("d606"),Object(h["a"])(q,L,C,!1,null,"6a23f60a",null)),D=j.exports,P=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"edit-page"},[i("div",{staticClass:"ml-l pl-l mb-l pb-l"},[i("el-button",{attrs:{size:"small"},on:{click:function(e){t.$router.back()}}},[t._v("返回")])],1),i("el-form",{ref:"form",attrs:{model:t.form,rules:t.rules,"label-width":"120px",size:"small"}},[i("div",{staticClass:"container"},[i("h3",{staticClass:"title"},[t._v("基本信息")]),i("el-form-item",{attrs:{label:"商品名"}},[i("el-col",{attrs:{span:"6"}},[i("el-input",{model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1)],1),i("el-form-item",{attrs:{label:"商品描述"}},[i("el-col",{attrs:{span:"12"}},[i("el-input",{model:{value:t.form.description,callback:function(e){t.$set(t.form,"description",e)},expression:"form.description"}})],1)],1),i("el-form-item",{attrs:{label:"添加商品图"}},[i("upload-file",{attrs:{limit:10,accept:"image/*"},model:{value:t.form.imagesList,callback:function(e){t.$set(t.form,"imagesList",e)},expression:"form.imagesList"}}),i("div",{staticClass:"tips"},[t._v("建议尺寸：800*800像素，最多上传10张")])],1),i("el-form-item",{attrs:{label:"商品详情"}},[i("upload-file",{attrs:{limit:10,accept:"image/*"},model:{value:t.form.descriptionimagesList,callback:function(e){t.$set(t.form,"descriptionimagesList",e)},expression:"form.descriptionimagesList"}}),i("div",{staticClass:"tips upload"},[t._v("上传商品详情页图片，帮助买家进一步了解商品。")]),i("div",{staticClass:"tips nopt"},[t._v("建议图片宽度不大于1500px，质量不大于2M，最多可上传10张。")])],1),i("el-form-item",{attrs:{label:"选择分类"}},[i("el-row",[i("el-col",{attrs:{span:6}},[i("el-select",{attrs:{placeholder:"请选择分类",multiple:""},model:{value:t.form.categoryidlistList,callback:function(e){t.$set(t.form,"categoryidlistList",e)},expression:"form.categoryidlistList"}},t._l(t.categories,function(t){return i("el-option",{key:t.id,attrs:{label:t.name.slice(1).split("/")[0],value:t.id}})}))],1),i("el-col",{staticStyle:{"margin-left":"15px"},attrs:{span:2}},[i("el-button",{attrs:{size:"small",type:"text"},on:{click:function(e){t.$router.push({name:"category"})}}},[t._v("新建类目")])],1)],1)],1)],1),i("div",{staticClass:"container"},[i("el-switch",{attrs:{"inactive-text":"启用售卖时段","active-value":2,"inactive-value":1},model:{value:t.form.withtimeslot,callback:function(e){t.$set(t.form,"withtimeslot",e)},expression:"form.withtimeslot"}}),2==t.form.withtimeslot?i("div",t._l(t.form.producttimeslotlistList,function(e,o){return i("div",{key:o,staticClass:"time-slot"},[i("i",{staticClass:"el-icon-circle-close time-slot_remove",on:{click:function(e){t.onClickRemoveTimeSlot(o)}}}),i("el-row",{attrs:{gutter:"8",type:"flex",justify:"center",align:"center"}},[i("el-col",{staticStyle:{color:"#666","font-size":"14px","margin-top":"2px","margin-left":"4px"},attrs:{span:3}},[t._v("选择日期")]),i("el-col",{attrs:{span:21}},[i("el-checkbox-group",{on:{change:function(e){t.onChangeCheckBox(o,e)}},model:{value:e.weeklistList,callback:function(i){t.$set(e,"weeklistList",i)},expression:"timeSlot.weeklistList"}},t._l(t.weeklist,function(e){return i("el-checkbox",{key:e,attrs:{disabled:-1!==t.disabledWeek.indexOf(e)&&-1===(t.selectedWeek[o]||[]).indexOf(e),label:e}})}))],1)],1),i("el-row",{staticStyle:{height:"30px","line-height":"30px","margin-top":"10px"},attrs:{gutter:"8",type:"flex",justify:"center",align:"center"}},[i("el-col",{staticClass:"time-slot_title",attrs:{span:9}},[t._v("可用时段")]),i("el-col",{staticClass:"time-slot_title",attrs:{span:2}},[t._v("可用时长")]),i("el-col",{staticClass:"time-slot_title",attrs:{span:2}},[t._v("原价")]),i("el-col",{staticClass:"time-slot_title",attrs:{span:2}},[t._v("折扣价")]),i("el-col",{staticClass:"time-slot_title",attrs:{span:2}},[t._v("会员价")]),t.form.groupuserquantity>0?i("el-col",{staticClass:"time-slot_title",attrs:{span:2}},[t._v("团购价")]):t._e(),i("el-col",{staticClass:"time-slot_title",attrs:{span:2}},[t._v("成本价")]),i("el-col",{staticClass:"time-slot_title",attrs:{span:2}},[t._v("开启售卖")]),i("el-col",{staticClass:"time-slot_title",attrs:{span:1}})],1),t._l(e.producttimeslotpricelistList,function(r,s){return i("el-row",{key:s,staticStyle:{"margin-top":"5px"},attrs:{gutter:"8",type:"flex",justify:"center",align:"center"}},[i("el-col",{attrs:{span:9}},[i("el-col",{attrs:{span:9}},[i("el-time-select",{staticStyle:{width:"100%"},attrs:{size:"small",placeholder:"起始时间","picker-options":{start:"00:00",step:"00:15",end:"23:59"}},model:{value:r.begintime,callback:function(e){t.$set(r,"begintime",e)},expression:"item.begintime"}})],1),i("el-col",{attrs:{span:9}},[i("el-time-select",{staticStyle:{width:"100%"},attrs:{size:"small",placeholder:"结束时间","picker-options":{start:"00:00",step:"00:15",end:"23:59",minTime:r.nextday?"":r.begintime}},model:{value:r.endtime,callback:function(e){t.$set(r,"endtime",e)},expression:"item.endtime"}})],1),i("el-col",{staticClass:"time-slot_title",staticStyle:{"margin-top":"5px"},attrs:{span:6}},[i("el-switch",{attrs:{size:"small","active-text":"次日"},model:{value:r.nextday,callback:function(e){t.$set(r,"nextday",e)},expression:"item.nextday"}})],1)],1),i("el-col",{attrs:{span:2}},[i("el-input",{staticStyle:{width:"100%"},attrs:{size:"small",placeholder:"小时"},model:{value:r.duration,callback:function(e){t.$set(r,"duration",e)},expression:"item.duration"}})],1),i("el-col",{attrs:{span:2}},[i("el-input",{staticStyle:{width:"100%"},attrs:{size:"small",placeholder:"原价"},model:{value:r.price,callback:function(e){t.$set(r,"price",e)},expression:"item.price"}})],1),i("el-col",{attrs:{span:2}},[i("el-input",{staticStyle:{width:"100%"},attrs:{size:"small",placeholder:"折扣价"},model:{value:r.discountprice,callback:function(e){t.$set(r,"discountprice",e)},expression:"item.discountprice"}})],1),i("el-col",{attrs:{span:2}},[i("el-input",{staticStyle:{width:"100%"},attrs:{size:"small",placeholder:"会员价"},model:{value:r.vipprice,callback:function(e){t.$set(r,"vipprice",e)},expression:"item.vipprice"}})],1),t.form.groupuserquantity>0?i("el-col",{attrs:{span:2}},[i("el-input",{staticStyle:{width:"100%"},attrs:{size:"small",placeholder:"团购价"},model:{value:r.groupprice,callback:function(e){t.$set(r,"groupprice",e)},expression:"item.groupprice"}})],1):t._e(),i("el-col",{attrs:{span:2}},[i("el-input",{staticStyle:{width:"100%"},attrs:{size:"small",placeholder:"成本价"},model:{value:r.costprice,callback:function(e){t.$set(r,"costprice",e)},expression:"item.costprice"}})],1),i("el-col",{staticStyle:{display:"flex","flex-direction":"row","justify-content":"center"},attrs:{span:2}},[i("el-switch",{attrs:{"active-value":2,"inactive-value":1},model:{value:r.enabled,callback:function(e){t.$set(r,"enabled",e)},expression:"item.enabled"}})],1),i("el-col",{staticClass:"time-slot_title",staticStyle:{"margin-top":"5px"},attrs:{span:1}},[s===e.producttimeslotpricelistList.length-1?i("i",{staticClass:"el-icon-circle-plus",staticStyle:{"font-size":"20px"},on:{click:function(e){t.onClickAddTimeSlotPriceItem(o)}}}):i("i",{staticClass:"el-icon-remove-outline",staticStyle:{"font-size":"20px"},on:{click:function(e){t.onClickRemoveTimeSlotPriceItem(o,s)}}})])],1)})],2)})):t._e(),2==t.form.withtimeslot?i("el-button",{staticClass:"time-slot_add",on:{click:t.onClickAddTimeSlot}},[t._v("添加")]):t._e()],1),i("div",{staticClass:"container"},[i("h3",{staticClass:"title"},[t._v("价格")]),i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:1==t.form.withtimeslot,expression:"form.withtimeslot == 1"}],staticClass:"form-item-price",attrs:{label:"商品价格"}},[i("el-col",{attrs:{span:"4"}},[i("el-input",{model:{value:t.form.price,callback:function(e){t.$set(t.form,"price",e)},expression:"form.price"}},[i("template",{slot:"append"},[t._v("元")])],2)],1)],1),i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:1==t.form.withtimeslot,expression:"form.withtimeslot == 1"}],staticClass:"form-item-price",attrs:{label:"折扣价格"}},[i("el-row",[i("el-col",{attrs:{span:"4"}},[i("el-input",{model:{value:t.form.discountprice,callback:function(e){t.$set(t.form,"discountprice",e)},expression:"form.discountprice"}},[i("template",{slot:"append"},[t._v("元")])],2)],1)],1),i("div",{staticClass:"tips"},[t._v("设置该商品的折扣价格, 不填或填0代表不设置折扣价。")])],1),i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:1==t.form.withtimeslot,expression:"form.withtimeslot == 1"}],staticClass:"form-item-price",attrs:{label:"会员价格"}},[i("el-row",[i("el-col",{attrs:{span:"4"}},[i("el-input",{model:{value:t.form.vipprice,callback:function(e){t.$set(t.form,"vipprice",e)},expression:"form.vipprice"}},[i("template",{slot:"append"},[t._v("元")])],2)],1)],1),i("div",{staticClass:"tips"},[t._v("设置该商品会员享有的价格, 不填或填0代表不设置会员价。")])],1),i("el-form-item",{attrs:{label:"成团人数"}},[i("el-row",[i("el-col",{attrs:{span:"4"}},[i("el-select",{model:{value:t.form.groupuserquantity,callback:function(e){t.$set(t.form,"groupuserquantity",e)},expression:"form.groupuserquantity"}},[i("el-option",{attrs:{label:"不选择团购人数",value:0}}),i("el-option",{attrs:{label:"2人",value:2}}),i("el-option",{attrs:{label:"3人",value:3}}),i("el-option",{attrs:{label:"4人",value:4}}),i("el-option",{attrs:{label:"5人",value:5}})],1)],1)],1),i("div",{staticClass:"tips"},[t._v("如不支持团购则不选择")])],1),i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!(2==t.form.withtimeslot||0==t.form.groupuserquantity),expression:"!(form.withtimeslot == 2 || form.groupuserquantity == 0)"}],staticClass:"form-item-price",attrs:{label:"团购价格"}},[i("el-row",[i("el-col",{attrs:{span:"4"}},[i("el-input",{model:{value:t.form.groupprice,callback:function(e){t.$set(t.form,"groupprice",e)},expression:"form.groupprice"}},[i("template",{slot:"append"},[t._v("元")])],2)],1)],1)],1),i("el-form-item",{attrs:{label:"商品编码"}},[i("el-row",[i("el-col",{attrs:{span:"4"}},[i("el-input",{model:{value:t.form.number,callback:function(e){t.$set(t.form,"number",e)},expression:"form.number"}})],1)],1),i("div",{staticClass:"tips"},[t._v("如无则不填")])],1),i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:1==t.form.withtimeslot,expression:"form.withtimeslot == 1"}],staticClass:"form-item-price",attrs:{label:"成本价格",prop:"costprice"}},[i("el-row",[i("el-col",{attrs:{span:"4"}},[i("el-input",{model:{value:t.form.costprice,callback:function(e){t.$set(t.form,"costprice",e)},expression:"form.costprice"}},[i("template",{slot:"append"},[t._v("元")])],2)],1)],1),i("div",{staticClass:"tips"},[t._v("成本价将用于利润统计，方便您了解经营收益。")])],1),i("el-form-item",[i("el-col",{attrs:{span:"5"}},[i("el-switch",{attrs:{"active-text":"上架商品","active-value":1,"inactive-value":0},model:{value:t.form.online,callback:function(e){t.$set(t.form,"online",e)},expression:"form.online"}})],1),i("el-col",{attrs:{span:"18"}},[0===t.form.online?i("div",{staticClass:"tips",staticStyle:{"margin-left":"5px","margin-top":"5px"}},[t._v("当前商品已下架。")]):i("div",{staticClass:"tips",staticStyle:{"margin-left":"5px","margin-top":"5px"}},[t._v("当前商品已上架。")])])],1)],1)]),i("div",{staticStyle:{height:"100px"}}),i("div",{staticClass:"buttons"},[i("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("发布")])],1)],1)},T=[],N=(i("8615"),i("f559"),{"星期一":1,"星期二":2,"星期三":3,"星期四":4,"星期五":5,"星期六":6,"星期天":7}),I={1:"星期一",2:"星期二",3:"星期三",4:"星期四",5:"星期五",6:"星期六",7:"星期天"},R={components:{"upload-file":l["a"]},data:function(){return{showProDialog:!1,disabledWeek:[],selectedWeek:[],weeklist:["星期一","星期二","星期三","星期四","星期五","星期六","星期天"],categories:[],display:!0,form:{name:"",categoryid:"",videoimage:"",video:"",imagesList:[],description:"",descriptionimagesList:[],supportgroup:0,groupuserquantity:0,quantity:0,price:0,discountprice:0,groupprice:0,withoption:0,optionsList:[],online:1,number:"",costprice:0,withquantity:2,productdescriptionlong:"",productnoticelistList:[],supportreserve:1,vipprice:0,withtimeslot:1,producttimeslotlistList:[],options:[],optionsDetail:[]},token:""}},watch:{"form.options":{deep:!0,handler:function(){this.form.optionsDetail=this.buildOptionJson(this.form.options)}},"form.withtimeslot":function(t){2==t&&0===this.form.producttimeslotlistList.length&&this.onClickAddTimeSlot()},"form.producttimeslotlistList":function(t){0===t.length&&(this.form.withtimeslot=1)}},created:function(){var t=Object(p["a"])(regeneratorRuntime.mark(function t(){var e=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return this.token=Object(f["e"])(),t.next=3,Object(d["b"])();case 3:t.sent,"edit"===this.$route.query.type&&Object(m["a"])("StoreProductService.GetProduct",Object(u["a"])("IDWithTokenRequest",{token:Object(u["a"])("Token",{token:this.token}),id:this.$route.query.id})).then(function(t){e.form=e.backend2frontend(t),e.form.price=e.$amount1(e.form.price),e.form.discountprice=e.$amount1(e.form.discountprice),e.form.groupprice=e.$amount1(e.form.groupprice),e.form.costprice=e.$amount1(e.form.costprice),e.form.vipprice=e.$amount1(e.form.vipprice),e.form.optionsDetail=e.form.optionsDetail.map(function(t){return Object(c["a"])({},t,{price:e.$amount1(t.price),discountprice:e.$amount1(t.discountprice),groupprice:e.$amount1(t.groupprice),costprice:e.$amount1(t.costprice),vipprice:e.$amount1(t.vipprice)})}),e.form.producttimeslotlistList=e.form.producttimeslotlistList.map(function(t){return{weeklistList:t.weeklistList.map(function(t){return I[t]}),producttimeslotpricelistList:t.producttimeslotpricelistList.map(function(t){return Object(c["a"])({},t,{endtime:t.endtime.startsWith(":")?t.endtime.slice(1):t.endtime,nextday:t.endtime.startsWith(":"),duration:t.duration/60/60,price:t.price/100,discountprice:t.discountprice/100,vipprice:t.vipprice/100,groupprice:t.groupprice/100,costprice:t.costprice/100})})}})}),Object(m["a"])("StoreCategoryService.GetCategoryList",Object(u["a"])("CategoryListQueryRequest",{token:Object(u["a"])("Token",{token:this.token}),ishidden:2,level:1,count:100,sortby:1})).then(function(t){e.categories=t.categorylistList});case 6:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),methods:{getDetailDesc:function(t){return"discountprice"===t?"优惠价格, 不填或填0代表不设置折扣价":"groupprice"===t?"如不支持团购则不填":""},onSubmit:function(){var t=this;this.$refs.form.validate(function(e){if(e){var i=JSON.parse(JSON.stringify(t.form));if(i.price=t.$amount2(i.price),i.discountprice=t.$amount2(i.discountprice),i.groupprice=t.$amount2(i.groupprice),i.costprice=t.$amount2(i.costprice),i.vipprice=t.$amount2(i.vipprice),i.optionsDetail=i.optionsDetail.map(function(e){return Object(c["a"])({},e,{price:t.$amount2(e.price),discountprice:t.$amount2(e.discountprice),groupprice:t.$amount2(e.groupprice),costprice:t.$amount2(e.costprice),vipprice:t.$amount2(e.vipprice)})}),i.producttimeslotlistList=i.producttimeslotlistList.map(function(e){return{weeklistList:e.weeklistList.map(function(t){return N[t]}),producttimeslotpricelistList:e.producttimeslotpricelistList.map(function(e){return Object(c["a"])({},e,{endtime:e.nextday?":"+e.endtime:e.endtime,duration:parseInt(60*e.duration*60),price:t.$amount2(e.price),discountprice:t.$amount2(e.discountprice),vipprice:t.$amount2(e.vipprice),groupprice:t.$amount2(e.groupprice),costprice:t.$amount2(e.costprice)})})}}),i=t.frontend2backend(i),i.categoryidlistList.length){if(i.categoryid=i.categoryidlistList[0],1==i.withtimeslot){if(0==i.price)return void t.$message({message:"忘记设置原价了",type:"error"});if(0!=i.discountprice&&i.discountprice>=i.price)return void t.$message({message:"如果设置折扣价, 则折扣价需小于原价",type:"error"});if(0!=i.vipprice){if(i.vipprice>=i.price)return void t.$message({message:"如果设置会员价, 则会员价需小于原价",type:"error"});if(0!=i.discountprice&&i.vipprice>=i.discountprice)return void t.$message({message:"会员价应该小于折扣价",type:"error"})}if(1==i.supportgroup){if(0==i.groupprice)return void t.$message({message:"忘记设置团购价了",type:"error"});if(i.groupprice>=i.price)return void t.$message({message:"团购价需小于原价",type:"error"});if(0!=i.discountprice&&i.groupprice>=i.discountprice)return void t.$message({message:"团购价需小于折扣价",type:"error"});if(0!=i.vipprice&&i.groupprice>=i.vipprice)return void t.$message({message:"团购价需小于会员价",type:"error"})}}if(2==i.withtimeslot){var o=!0,r=!1,s=void 0;try{for(var a,n=i.producttimeslotlistList[Symbol.iterator]();!(o=(a=n.next()).done);o=!0){var p=a.value,l=!0,f=!1,d=void 0;try{for(var v,g=p.toObject().producttimeslotpricelistList[Symbol.iterator]();!(l=(v=g.next()).done);l=!0){var h=v.value;if(0==h.price)return void t.$message({message:"忘记设置原价了",type:"error"});if(0!=h.discountprice&&h.discountprice>=h.price)return void t.$message({message:"如果设置折扣价, 则折扣价需小于原价",type:"error"});if(0!=h.vipprice){if(h.vipprice>=h.price)return void t.$message({message:"如果设置会员价, 则会员价需小于原价",type:"error"});if(0!=h.discountprice&&h.vipprice>=h.discountprice)return void t.$message({message:"会员价应该小于折扣价",type:"error"})}if(1==i.supportgroup){if(0==h.groupprice)return void t.$message({message:"忘记设置团购价了",type:"error"});if(h.groupprice>=h.price)return void t.$message({message:"团购价需小于原价",type:"error"});if(0!=h.discountprice&&h.groupprice>=h.discountprice)return void t.$message({message:"团购价需小于折扣价",type:"error"});if(0!=h.vipprice&&h.groupprice>=h.vipprice)return void t.$message({message:"团购价需小于会员价",type:"error"})}}}catch(y){f=!0,d=y}finally{try{l||null==g.return||g.return()}finally{if(f)throw d}}}}catch(y){r=!0,s=y}finally{try{o||null==n.return||n.return()}finally{if(r)throw s}}}"edit"!==t.$route.query.type?Object(m["a"])("StoreProductService.CreateProduct",Object(u["a"])("ProductWithTokenRequest",{token:Object(u["a"])("Token",{token:t.token}),product:Object(u["a"])("Product",i)})).then(function(e){t.$router.back()}):Object(m["a"])("StoreProductService.UpdateProduct",Object(u["a"])("ProductWithTokenRequest",{token:Object(u["a"])("Token",{token:t.token}),product:Object(u["a"])("Product",i)})).then(function(e){t.$message({message:"商品保存成功",type:"success"})})}else t.$message({message:"忘记选择分类了",type:"error"})}})},backend2frontend:function(t){for(var e=[],i=[],o={},r=0;r<t.optionsList.length;r++){var s={price:t.optionsList[r].price,discountprice:t.optionsList[r].discountprice,groupprice:t.optionsList[r].groupprice,costprice:t.optionsList[r].costprice,vipprice:t.optionsList[r].vipprice,quantity:t.optionsList[r].quantity},a=JSON.parse(t.optionsList[r].name);for(var n in a)o.hasOwnProperty(n)||(o[n]=[]),-1===o[n].indexOf(a[n])&&o[n].push(a[n]),s[n]=a[n];i.push(s)}for(var n in t.optionsDetail=i,o)e.push({vid:n,name:n,value:o[n].map(function(t){return{vid:n+":"+t,value:t}})});return t.options=e,t},frontend2backend:function(t){return t.supportgroup=t.groupuserquantity>0?1:0,t.withoption=0,t.optionsList=[],t.optionsDetail.length&&(t.withoption=1,t.optionsList=t.optionsDetail.map(function(t){var e={},i={};for(var o in t)"price"!==o&&"discountprice"!==o&&"vipprice"!==o&&"groupprice"!==o&&"quantity"!==o&&"costprice"!==o?i[o]=t[o]:e[o]=t[o];return e.name=JSON.stringify(Object(f["g"])(i)),Object(u["a"])("Option",e)})),t.productnoticelistList=t.productnoticelistList.map(function(t){return Object(u["a"])("ProductNotice",t)}),t.producttimeslotlistList=t.producttimeslotlistList.map(function(t){return Object(u["a"])("ProductTimeSlot",{weeklistList:t.weeklistList,producttimeslotpricelistList:t.producttimeslotpricelistList.map(function(t){return Object(u["a"])("ProductTimeSlotPrice",t)})})}),t},getTitle:function(t){var e={firstValue:"-",secondValue:"-",thirdValue:"-",price:"价格（元）",discountprice:"折扣价（元）",vipprice:"会员价（元）",groupprice:"团购价（元）",quantity:"库存",costprice:"成本价（元）"};return e[t]?e[t]:t},getTitleInfo:function(t){var e={price:"原价",discountprice:"当有折扣价时，商品优先显示折扣价，原件则作为划线价展示, 不填或填0代表不设置折扣价",vipprice:"当有会员价时，会员会使用会员价, 不填或填0代表不设置会员价",groupprice:"拼团使用的价格",quantity:"商品库存",costprice:"用于统计商店利润"};return e[t]},removeOption:function(t){this.form.options.splice(t,1)},addOption:function(){this.form.options.push({name:"",value:[{value:"",uid:Math.random()}],uid:Math.random()})},removeOptionItem:function(t,e){t.splice(e,1)},addOptionItem:function(t){t.push({value:"",uid:Math.random()})},buildOptionJson:function(t){var e=[],i=["firstValue","secondValue","thirdValue"];t.forEach(function(t,o){if(t.value.length){var r=t.name||i[o];if(e.length){var s=[];e.forEach(function(e){t.value.forEach(function(t){var i=Object(c["a"])({},e);i[r]=t.value,s.push(i)})}),e=s}else e=t.value.map(function(t){var e={};return e[r]=t.value,e})}});var o=this.form.optionsDetail,r=e.map(function(t,e){var i=o[e]||{},r=i.price,s=void 0===r?0:r,a=i.discountprice,n=void 0===a?0:a,p=i.vipprice,l=void 0===p?0:p,u=i.groupprice,m=void 0===u?0:u,f=i.quantity,d=void 0===f?0:f,v=i.costprice,g=void 0===v?0:v;return Object(c["a"])({},t,{price:s,discountprice:n,vipprice:l,groupprice:m,quantity:d,costprice:g})});return r},onClickAddTimeSlotPriceItem:function(t){this.form.producttimeslotlistList[t].producttimeslotpricelistList.push({begintime:"",endtime:"",duration:"",price:"",discountprice:"",groupprice:"",vipprice:"",nextday:!1,enabled:2})},onClickRemoveTimeSlotPriceItem:function(t,e){this.form.producttimeslotlistList[t].producttimeslotpricelistList.splice(e,1)},onClickAddTimeSlot:function(){this.form.producttimeslotlistList.push({weeklistList:[],producttimeslotpricelistList:[{begintime:"",endtime:"",duration:"",price:"",discountprice:"",groupprice:"",vipprice:"",costprice:"",nextday:!1,enabled:2}]})},onClickRemoveTimeSlot:function(t){this.form.producttimeslotlistList.splice(t,1),this.selectedWeek.splice(t,1),this.disabledWeekHandle()},onChangeCheckBox:function(t,e){this.selectedWeek[t]=e,this.disabledWeekHandle()},disabledWeekHandle:function(){this.disabledWeek=Object.values(this.selectedWeek).filter(function(t){return t}).reduce(function(t,e){return t.concat(e)},[])}}},J=R,z=(i("3305"),i("427c"),Object(h["a"])(J,P,T,!1,null,"5042131e",null)),V=z.exports,W=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"edit-page"},[o("div",{staticClass:"ml-l pl-l mb-l pb-l"},[o("el-button",{attrs:{size:"small"},on:{click:function(e){t.$router.back()}}},[t._v("返回")])],1),o("el-form",{ref:"form",attrs:{model:t.form,rules:t.rules,"label-width":"120px",size:"small"}},[o("div",{staticClass:"container"},[o("h3",{staticClass:"title"},[t._v("基本信息")]),o("el-form-item",{attrs:{label:"商品名"}},[o("el-col",{attrs:{span:"6"}},[o("el-input",{model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1)],1),o("el-form-item",{attrs:{label:"添加商品图"}},[o("upload-file",{attrs:{limit:10,accept:"image/*"},model:{value:t.form.imagesList,callback:function(e){t.$set(t.form,"imagesList",e)},expression:"form.imagesList"}}),o("div",{staticClass:"tips"},[t._v("建议尺寸：800*800像素，最多上传10张")])],1),o("el-form-item",{attrs:{label:"选择分类"}},[o("el-row",[o("el-col",{attrs:{span:6}},[o("el-select",{attrs:{placeholder:"请选择分类",multiple:""},model:{value:t.form.categoryidlistList,callback:function(e){t.$set(t.form,"categoryidlistList",e)},expression:"form.categoryidlistList"}},t._l(t.categories,function(t){return o("el-option",{key:t.id,attrs:{label:t.name.slice(1).split("/")[0]+" - "+t.name.slice(1).split("/")[1],value:t.id}})}))],1),o("el-col",{staticStyle:{"margin-left":"15px"},attrs:{span:2}},[o("el-button",{attrs:{size:"small",type:"text"},on:{click:function(e){t.$router.push({name:"category"})}}},[t._v("新建类目")])],1)],1)],1),o("el-form-item",{attrs:{label:"添加视频(可选)"}},[o("el-row",[o("el-col",{attrs:{span:4}},[o("upload-file",{attrs:{limit:1,accept:"image/*"},model:{value:t.form.videoimage,callback:function(e){t.$set(t.form,"videoimage",e)},expression:"form.videoimage"}}),o("div",{staticClass:"tips"},[o("span",{staticClass:"tips-title"},[t._v("预览图：")]),t._v("建议尺寸：800*800像素")])],1),o("el-col",{staticStyle:{"margin-left":"15px"},attrs:{span:5}},[o("upload-file",{attrs:{limit:1,accept:"video/*"},model:{value:t.form.video,callback:function(e){t.$set(t.form,"video",e)},expression:"form.video"}},[o("div",{staticStyle:{width:"120px",height:"120px"},attrs:{slot:"preview"},slot:"preview"},[o("img",{staticStyle:{width:"120px",height:"120px"},attrs:{alt:"",src:i("c59e")}})])]),o("div",{staticClass:"tips"},[o("span",{staticClass:"tips-title"},[t._v("视频：")]),t._v("目前仅支持在手机端播放，建议时常9-30秒，建议视频宽高比1:1或16:9。")])],1)],1)],1),o("el-form-item",{attrs:{label:"商品详情"}},[o("upload-file",{attrs:{limit:10,accept:"image/*"},model:{value:t.form.descriptionimagesList,callback:function(e){t.$set(t.form,"descriptionimagesList",e)},expression:"form.descriptionimagesList"}}),o("div",{staticClass:"tips upload"},[t._v("上传商品详情页图片，帮助买家进一步了解商品。")]),o("div",{staticClass:"tips nopt"},[t._v("建议图片宽度不大于1500px，质量不大于2M，最多可上传10张。")])],1)],1),o("div",{staticClass:"container"},[o("h3",{staticClass:"title"},[t._v("价格库存")]),o("el-form-item",{attrs:{label:"商品规格"}},[t.form.options.length?o("div",{staticClass:"options"},[t._l(t.form.options,function(e,i){return[o("el-row",{key:e.uid+"x",staticClass:"single oi"},[o("el-col",{staticClass:"options-title",attrs:{span:"3"}},[t._v("规格名：")]),o("el-col",{attrs:{span:"4"}},[o("el-input",{staticClass:"min-input",attrs:{autofocus:""},model:{value:e.name,callback:function(i){t.$set(e,"name",i)},expression:"op.name"}})],1),o("el-col",{staticStyle:{"text-align":"right"},attrs:{offset:"16",span:"1"}},[o("el-button",{staticStyle:{color:"gray"},attrs:{icon:"el-icon-error",type:"text"},on:{click:function(e){t.removeOption(i)}}})],1)],1),o("el-row",{key:e.uid+"y",staticClass:"double oi"},[o("el-col",{staticClass:"options-title",attrs:{span:"3"}},[t._v("规格值：")]),o("el-col",{attrs:{span:"21"}},[o("el-row",{attrs:{gutter:"8"}},[t._l(e.value,function(i,r){return o("el-col",{key:i.uid,staticStyle:{display:"flex"},attrs:{span:5}},[o("el-input",{staticClass:"min-input",staticStyle:{"margin-right":"5px"},model:{value:i.value,callback:function(e){t.$set(i,"value",e)},expression:"v.value"}}),o("el-button",{staticStyle:{color:"gray","margin-right":"5px"},attrs:{icon:"el-icon-error",type:"text"},on:{click:function(i){t.removeOptionItem(e.value,r)}}})],1)}),o("el-col",{staticStyle:{"text-align":"center"},attrs:{span:"4"}},[o("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(i){t.addOptionItem(e.value)}}},[t._v("添加规格值")])],1)],2)],1)],1)]}),o("el-row",{staticClass:"single oi"},[o("el-col",{attrs:{span:"5"}},[o("el-button",{attrs:{disabled:3===t.form.options.length,size:"mini",type:"primary"},on:{click:t.addOption}},[t._v("添加规格项目")])],1),o("el-col",{staticClass:"options-title",attrs:{span:"18"}},[o("span",[t._v("最多支持3种规格")])])],1)],2):o("div",[o("el-button",{on:{click:t.addOption}},[t._v("添加规格")])],1),o("div",{staticClass:"tips",staticStyle:{color:"#ff4f4f"}},[t._v("如有大小, 颜色等不同规格，请添加商品规格, 如无则不必添加。")])]),o("el-form-item",{directives:[{name:"show",rawName:"v-show",value:t.form.optionsDetail.length,expression:"form.optionsDetail.length"}],attrs:{label:"规格明细"}},[o("div",{staticClass:"options-detail"},[o("el-table",{attrs:{data:t.form.optionsDetail,border:""}},[t._l(t.form.optionsDetail[0],function(e,i){return["quantity"===i&&2===t.form.withquantity||"groupprice"===i&&0==t.form.groupuserquantity?t._e():o("el-table-column",{key:i,attrs:{width:["price","discountprice","vipprice","groupprice","costprice"].includes(i)&&135},scopedSlots:t._u([{key:"header",fn:function(e){return[t._v("\n                  "+t._s(t.getTitle(i))+"\n                  "),t.getTitleInfo(i)?o("el-tooltip",{attrs:{effect:"dark",content:t.getTitleInfo(i,e),placement:"top"}},[o("i",{staticClass:"el-icon-warning"})]):t._e()]}},{key:"default",fn:function(e){return["image"!=i?o("el-input",{staticClass:"min-input",model:{value:e.row[i],callback:function(o){t.$set(e.row,i,o)},expression:"scope.row[key]"}}):o("upload-file",{attrs:{height:"50px",width:"50px",limit:1,accept:"image/*"},model:{value:e.row[i],callback:function(o){t.$set(e.row,i,o)},expression:"scope.row[key]"}})]}}])})]})],2)],1)]),o("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!t.form.optionsDetail.length,expression:"!form.optionsDetail.length"}],staticClass:"form-item-price",attrs:{label:"商品价格"}},[o("el-col",{attrs:{span:"4"}},[o("el-input",{model:{value:t.form.price,callback:function(e){t.$set(t.form,"price",e)},expression:"form.price"}},[o("template",{slot:"append"},[t._v("元")])],2)],1)],1),o("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!t.form.optionsDetail.length,expression:"!form.optionsDetail.length"}],staticClass:"form-item-price",attrs:{label:"折扣价格"}},[o("el-row",[o("el-col",{attrs:{span:"4"}},[o("el-input",{model:{value:t.form.discountprice,callback:function(e){t.$set(t.form,"discountprice",e)},expression:"form.discountprice"}},[o("template",{slot:"append"},[t._v("元")])],2)],1)],1),o("div",{staticClass:"tips"},[t._v("设置该商品的折扣价格, 不填或填0代表不设置折扣价。")])],1),o("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!t.form.optionsDetail.length,expression:"!form.optionsDetail.length"}],staticClass:"form-item-price",attrs:{label:"会员价格"}},[o("el-row",[o("el-col",{attrs:{span:"4"}},[o("el-input",{model:{value:t.form.vipprice,callback:function(e){t.$set(t.form,"vipprice",e)},expression:"form.vipprice"}},[o("template",{slot:"append"},[t._v("元")])],2)],1)],1),o("div",{staticClass:"tips"},[t._v("设置该商品会员享有的价格, 不填或填0代表不设置会员价。")])],1),o("el-form-item",{attrs:{label:"成团人数"}},[o("el-row",[o("el-col",{attrs:{span:"4"}},[o("el-select",{model:{value:t.form.groupuserquantity,callback:function(e){t.$set(t.form,"groupuserquantity",e)},expression:"form.groupuserquantity"}},[o("el-option",{attrs:{label:"不选择团购人数",value:0}}),o("el-option",{attrs:{label:"2人",value:2}}),o("el-option",{attrs:{label:"3人",value:3}}),o("el-option",{attrs:{label:"4人",value:4}}),o("el-option",{attrs:{label:"5人",value:5}})],1)],1)],1),o("div",{staticClass:"tips"},[t._v("如不支持团购则不选择")])],1),o("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!(t.form.optionsDetail.length||0==t.form.groupuserquantity),expression:"!(form.optionsDetail.length || form.groupuserquantity == 0)"}],staticClass:"form-item-price",attrs:{label:"团购价格"}},[o("el-row",[o("el-col",{attrs:{span:"4"}},[o("el-input",{model:{value:t.form.groupprice,callback:function(e){t.$set(t.form,"groupprice",e)},expression:"form.groupprice"}},[o("template",{slot:"append"},[t._v("元")])],2)],1)],1)],1),o("el-form-item",{attrs:{label:"商品库存"}},[o("el-row",[o("el-col",{attrs:{span:"5"}},[o("el-switch",{attrs:{"active-text":"有无库存限制","active-value":1,"inactive-value":2},model:{value:t.form.withquantity,callback:function(e){t.$set(t.form,"withquantity",e)},expression:"form.withquantity"}})],1),o("el-col",{attrs:{span:"18"}},[1===t.form.withquantity?o("div",{staticClass:"tips",staticStyle:{"margin-left":"5px","margin-top":"5px"}},[t._v("当前商品有库存限制, 商品库存为0时，将自动移动至 “已售罄” 列表。")]):o("div",{staticClass:"tips",staticStyle:{"margin-left":"5px","margin-top":"5px"}},[t._v("当前商品没有库存限制")])])],1),t.form.optionsDetail.length||1!==t.form.withquantity?t._e():o("el-row",[o("el-col",{attrs:{span:"4"}},[o("el-input",{model:{value:t.form.quantity,callback:function(e){t.$set(t.form,"quantity",e)},expression:"form.quantity"}})],1)],1)],1),o("el-form-item",{attrs:{label:"商品编码"}},[o("el-row",[o("el-col",{attrs:{span:"4"}},[o("el-input",{model:{value:t.form.number,callback:function(e){t.$set(t.form,"number",e)},expression:"form.number"}})],1)],1),o("div",{staticClass:"tips"},[t._v("如无则不填")])],1),o("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!t.form.optionsDetail.length,expression:"!form.optionsDetail.length"}],staticClass:"form-item-price",attrs:{label:"成本价格",prop:"costprice"}},[o("el-row",[o("el-col",{attrs:{span:"4"}},[o("el-input",{model:{value:t.form.costprice,callback:function(e){t.$set(t.form,"costprice",e)},expression:"form.costprice"}},[o("template",{slot:"append"},[t._v("元")])],2)],1)],1),o("div",{staticClass:"tips"},[t._v("成本价将用于利润统计，方便您了解经营收益。")])],1),o("el-form-item",{attrs:{prop:"online"}},[o("el-col",{attrs:{span:"5"}},[o("el-switch",{attrs:{"active-text":"上架商品","active-value":1,"inactive-value":0},model:{value:t.form.online,callback:function(e){t.$set(t.form,"online",e)},expression:"form.online"}})],1),o("el-col",{attrs:{span:"18"}},[0===t.form.online?o("div",{staticClass:"tips",staticStyle:{"margin-left":"5px","margin-top":"5px"}},[t._v("当前商品已下架。")]):o("div",{staticClass:"tips",staticStyle:{"margin-left":"5px","margin-top":"5px"}},[t._v("当前商品已上架。")])])],1)],1)]),o("div",{staticStyle:{height:"100px"}}),o("div",{staticClass:"buttons"},[o("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("发布")])],1)],1)},E=[],M={components:{"upload-file":l["a"]},data:function(){return{showProDialog:!1,categories:[],display:!0,form:{name:"",categoryid:"",videoimage:"",video:"",imagesList:[],description:"",descriptionimagesList:[],supportgroup:0,groupuserquantity:0,quantity:0,price:0,discountprice:0,groupprice:0,withoption:0,optionsList:[],online:1,number:"",costprice:0,withquantity:1,productdescriptionlong:"",productnoticelistList:[],supportreserve:1,vipprice:0,withtimeslot:1,producttimeslotlistList:[],options:[],optionsDetail:[]},token:""}},watch:{"form.options":{deep:!0,handler:function(){this.form.optionsDetail=this.buildOptionJson(this.form.options)}}},created:function(){var t=Object(p["a"])(regeneratorRuntime.mark(function t(){var e=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return this.token=Object(f["e"])(),t.next=3,Object(d["b"])();case 3:t.sent,"edit"===this.$route.query.type&&Object(m["a"])("StoreProductService.GetProduct",Object(u["a"])("IDWithTokenRequest",{token:Object(u["a"])("Token",{token:this.token}),id:this.$route.query.id})).then(function(t){e.form=e.backend2frontend(t),e.form.price=e.$amount1(e.form.price),e.form.discountprice=e.$amount1(e.form.discountprice),e.form.groupprice=e.$amount1(e.form.groupprice),e.form.costprice=e.$amount1(e.form.costprice),e.form.vipprice=e.$amount1(e.form.vipprice),e.form.optionsDetail=e.form.optionsDetail.map(function(t){return Object(c["a"])({},t,{price:e.$amount1(t.price),discountprice:e.$amount1(t.discountprice),groupprice:e.$amount1(t.groupprice),costprice:e.$amount1(t.costprice),vipprice:e.$amount1(t.vipprice)})})}),Object(m["a"])("StoreCategoryService.GetCategoryList",Object(u["a"])("CategoryListQueryRequest",{token:Object(u["a"])("Token",{token:this.token}),ishidden:2,level:2,count:100,sortby:1})).then(function(t){e.categories=t.categorylistList});case 6:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),methods:{getDetailDesc:function(t){return"discountprice"===t?"优惠价格, 不填或填0代表不设置折扣价":"groupprice"===t?"如不支持团购则不填":""},onSubmit:function(){var t=this;this.$refs.form.validate(function(e){if(e){var i=JSON.parse(JSON.stringify(t.form));if(i.price=t.$amount2(i.price),i.discountprice=t.$amount2(i.discountprice),i.groupprice=t.$amount2(i.groupprice),i.costprice=t.$amount2(i.costprice),i.vipprice=t.$amount2(i.vipprice),i.optionsDetail=i.optionsDetail.map(function(e){return Object(c["a"])({},e,{price:t.$amount2(e.price),discountprice:t.$amount2(e.discountprice),groupprice:t.$amount2(e.groupprice),costprice:t.$amount2(e.costprice),vipprice:t.$amount2(e.vipprice)})}),i=t.frontend2backend(i),i.categoryidlistList.length){if(i.categoryid=i.categoryidlistList[0],0==i.withoption){if(0==i.price)return void t.$message({message:"忘记设置原价了",type:"error"});if(0!=i.discountprice&&i.discountprice>=i.price)return void t.$message({message:"如果设置折扣价, 则折扣价需小于原价",type:"error"});if(0!=i.vipprice){if(i.vipprice>=i.price)return void t.$message({message:"如果设置会员价, 则会员价需小于原价",type:"error"});if(0!=i.discountprice&&i.vipprice>=i.discountprice)return void t.$message({message:"会员价应该小于折扣价",type:"error"})}if(1==i.supportgroup){if(0==i.groupprice)return void t.$message({message:"忘记设置团购价了",type:"error"});if(i.groupprice>=i.price)return void t.$message({message:"团购价需小于原价",type:"error"});if(0!=i.discountprice&&i.groupprice>=i.discountprice)return void t.$message({message:"团购价需小于折扣价",type:"error"});if(0!=i.vipprice&&i.groupprice>=i.vipprice)return void t.$message({message:"团购价需小于会员价",type:"error"})}}if(1==i.withoption){var o=!0,r=!1,s=void 0;try{for(var a,n=i.optionsList[Symbol.iterator]();!(o=(a=n.next()).done);o=!0){var p=a.value,l=p.toObject();if(0==l.price)return void t.$message({message:"忘记设置原价了",type:"error"});if(0!=l.discountprice&&l.discountprice>=l.price)return void t.$message({message:"如果设置折扣价, 则折扣价需小于原价",type:"error"});if(0!=l.vipprice){if(l.vipprice>=l.price)return void t.$message({message:"如果设置会员价, 则会员价需小于原价",type:"error"});if(0!=l.discountprice&&l.vipprice>=l.discountprice)return void t.$message({message:"会员价应该小于折扣价",type:"error"})}if(1==i.supportgroup){if(0==l.groupprice)return void t.$message({message:"忘记设置团购价了",type:"error"});if(l.groupprice>=l.price)return void t.$message({message:"团购价需小于原价",type:"error"});if(0!=l.discountprice&&l.groupprice>=l.discountprice)return void t.$message({message:"团购价需小于折扣价",type:"error"});if(0!=l.vipprice&&l.groupprice>=l.vipprice)return void t.$message({message:"团购价需小于会员价",type:"error"})}}}catch(f){r=!0,s=f}finally{try{o||null==n.return||n.return()}finally{if(r)throw s}}}"edit"!==t.$route.query.type?Object(m["a"])("StoreProductService.CreateProduct",Object(u["a"])("ProductWithTokenRequest",{token:Object(u["a"])("Token",{token:t.token}),product:Object(u["a"])("Product",i)})).then(function(e){t.$router.back()}):Object(m["a"])("StoreProductService.UpdateProduct",Object(u["a"])("ProductWithTokenRequest",{token:Object(u["a"])("Token",{token:t.token}),product:Object(u["a"])("Product",i)})).then(function(e){t.$message({message:"商品保存成功",type:"success"})})}else t.$message({message:"忘记选择分类了",type:"error"})}})},backend2frontend:function(t){for(var e=[],i=[],o={},r=0;r<t.optionsList.length;r++){var s={price:t.optionsList[r].price,discountprice:t.optionsList[r].discountprice,groupprice:t.optionsList[r].groupprice,costprice:t.optionsList[r].costprice,vipprice:t.optionsList[r].vipprice,quantity:t.optionsList[r].quantity,image:t.optionsList[r].image},a=JSON.parse(t.optionsList[r].name);for(var n in a)o.hasOwnProperty(n)||(o[n]=[]),-1===o[n].indexOf(a[n])&&o[n].push(a[n]),s[n]=a[n];i.push(s)}for(var n in t.optionsDetail=i,o)e.push({vid:n,name:n,value:o[n].map(function(t){return{vid:n+":"+t,value:t}})});return t.options=e,t},frontend2backend:function(t){return t.supportgroup=t.groupuserquantity>0?1:0,t.withoption=0,t.optionsList=[],t.optionsDetail.length&&(t.withoption=1,t.optionsList=t.optionsDetail.map(function(t){var e={},i={};for(var o in t)"price"!==o&&"discountprice"!==o&&"vipprice"!==o&&"groupprice"!==o&&"quantity"!==o&&"costprice"!==o&&"image"!==o?i[o]=t[o]:e[o]=t[o];return e.name=JSON.stringify(Object(f["g"])(i)),console.log(e),Object(u["a"])("Option",e)})),t.productnoticelistList=t.productnoticelistList.map(function(t){return Object(u["a"])("ProductNotice",t)}),t.producttimeslotlistList=t.producttimeslotlistList.map(function(t){return Object(u["a"])("ProductTimeSlot",{weeklistList:t.weeklistList,producttimeslotpricelistList:t.producttimeslotpricelistList.map(function(t){return Object(u["a"])("ProductTimeSlotPrice",t)})})}),t},getTitle:function(t){var e={firstValue:"-",secondValue:"-",thirdValue:"-",price:"价格（元）",discountprice:"折扣价（元）",vipprice:"会员价（元）",groupprice:"团购价（元）",quantity:"库存",costprice:"成本价（元）",image:"图片"};return e[t]?e[t]:t},getTitleInfo:function(t){var e={price:"原价",discountprice:"当有折扣价时，商品优先显示折扣价，原件则作为划线价展示, 不填或填0代表不设置折扣价",vipprice:"当有会员价时，会员会使用会员价, 不填或填0代表不设置会员价",groupprice:"拼团使用的价格",quantity:"商品库存",costprice:"用于统计商店利润"};return e[t]},removeOption:function(t){this.form.options.splice(t,1)},addOption:function(){this.form.options.push({name:"",value:[{value:"",uid:Math.random()}],uid:Math.random()})},removeOptionItem:function(t,e){t.splice(e,1)},addOptionItem:function(t){t.push({value:"",uid:Math.random()})},buildOptionJson:function(t){var e=[],i=["firstValue","secondValue","thirdValue"];t.forEach(function(t,o){if(t.value.length){var r=t.name||i[o];if(e.length){var s=[];e.forEach(function(e){t.value.forEach(function(t){var i=Object(c["a"])({},e);i[r]=t.value,s.push(i)})}),e=s}else e=t.value.map(function(t){var e={};return e[r]=t.value,e})}});var o=this.form.optionsDetail,r=e.map(function(t,e){var i=o[e]||{},r=i.price,s=void 0===r?0:r,a=i.discountprice,n=void 0===a?0:a,p=i.vipprice,l=void 0===p?0:p,u=i.groupprice,m=void 0===u?0:u,f=i.quantity,d=void 0===f?0:f,v=i.costprice,g=void 0===v?0:v,h=i.image,y=void 0===h?"":h;return Object(c["a"])({},t,{price:s,discountprice:n,vipprice:l,groupprice:m,quantity:d,costprice:g,image:y})});return r}}},G=M,Q=(i("c2cf"),i("992f"),Object(h["a"])(G,W,E,!1,null,"ce7e55ba",null)),U=Q.exports,A=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"edit-page"},[i("div",{staticClass:"ml-l pl-l mb-l pb-l"},[i("el-button",{attrs:{size:"small"},on:{click:function(e){t.$router.back()}}},[t._v("返回")])],1),i("el-form",{ref:"form",attrs:{model:t.form,rules:t.rules,"label-width":"120px",size:"small"}},[i("div",{staticClass:"container"},[i("h3",{staticClass:"title"},[t._v("基本信息")]),i("el-form-item",{attrs:{label:"商品名"}},[i("el-col",{attrs:{span:"6"}},[i("el-input",{model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1)],1),i("el-form-item",{attrs:{label:"商品描述"}},[i("el-col",{attrs:{span:"12"}},[i("el-input",{model:{value:t.form.description,callback:function(e){t.$set(t.form,"description",e)},expression:"form.description"}})],1)],1),i("el-form-item",{attrs:{label:"添加商品图"}},[i("upload-file",{attrs:{limit:10,accept:"image/*"},model:{value:t.form.imagesList,callback:function(e){t.$set(t.form,"imagesList",e)},expression:"form.imagesList"}}),i("div",{staticClass:"tips"},[t._v("建议尺寸：800*800像素，最多上传10张")])],1),i("el-form-item",{attrs:{label:"选择分类"}},[i("el-row",[i("el-col",{attrs:{span:6}},[i("el-select",{attrs:{placeholder:"请选择分类",multiple:""},model:{value:t.form.categoryidlistList,callback:function(e){t.$set(t.form,"categoryidlistList",e)},expression:"form.categoryidlistList"}},t._l(t.categories,function(t){return i("el-option",{key:t.id,attrs:{label:t.name.slice(1).split("/")[0],value:t.id}})}))],1),i("el-col",{staticStyle:{"margin-left":"15px"},attrs:{span:2}},[i("el-button",{attrs:{size:"small",type:"text"},on:{click:function(e){t.$router.push({name:"category"})}}},[t._v("新建类目")])],1)],1)],1)],1),i("div",{staticClass:"container"},[i("h3",{staticClass:"title"},[t._v("价格库存")]),i("el-form-item",{attrs:{label:"商品规格"}},[t.form.options.length?i("div",{staticClass:"options"},[t._l(t.form.options,function(e,o){return[i("el-row",{key:e.uid+"x",staticClass:"single oi"},[i("el-col",{staticClass:"options-title",attrs:{span:"3"}},[t._v("规格名：")]),i("el-col",{attrs:{span:"4"}},[i("el-input",{staticClass:"min-input",attrs:{autofocus:""},model:{value:e.name,callback:function(i){t.$set(e,"name",i)},expression:"op.name"}})],1),i("el-col",{staticStyle:{"text-align":"right"},attrs:{offset:"16",span:"1"}},[i("el-button",{staticStyle:{color:"gray"},attrs:{icon:"el-icon-error",type:"text"},on:{click:function(e){t.removeOption(o)}}})],1)],1),i("el-row",{key:e.uid+"y",staticClass:"double oi"},[i("el-col",{staticClass:"options-title",attrs:{span:"3"}},[t._v("规格值：")]),i("el-col",{attrs:{span:"21"}},[i("el-row",{attrs:{gutter:"8"}},[t._l(e.value,function(o,r){return i("el-col",{key:o.uid,staticStyle:{display:"flex"},attrs:{span:5}},[i("el-input",{staticClass:"min-input",staticStyle:{"margin-right":"5px"},model:{value:o.value,callback:function(e){t.$set(o,"value",e)},expression:"v.value"}}),i("el-button",{staticStyle:{color:"gray","margin-right":"5px"},attrs:{icon:"el-icon-error",type:"text"},on:{click:function(i){t.removeOptionItem(e.value,r)}}})],1)}),i("el-col",{staticStyle:{"text-align":"center"},attrs:{span:"4"}},[i("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(i){t.addOptionItem(e.value)}}},[t._v("添加规格值")])],1)],2)],1)],1)]}),i("el-row",{staticClass:"single oi"},[i("el-col",{attrs:{span:"5"}},[i("el-button",{attrs:{disabled:3===t.form.options.length,size:"mini",type:"primary"},on:{click:t.addOption}},[t._v("添加规格项目")])],1),i("el-col",{staticClass:"options-title",attrs:{span:"18"}},[i("span",[t._v("最多支持3种规格")])])],1)],2):i("div",[i("el-button",{on:{click:t.addOption}},[t._v("添加规格")])],1),i("div",{staticClass:"tips",staticStyle:{color:"#ff4f4f"}},[t._v("如有不同口味或其他规格，请添加商品规格, 如无则不必添加。")])]),i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:t.form.optionsDetail.length,expression:"form.optionsDetail.length"}],attrs:{label:"规格明细"}},[i("div",{staticClass:"options-detail"},[i("el-table",{attrs:{data:t.form.optionsDetail,border:""}},[t._l(t.form.optionsDetail[0],function(e,o){return["quantity"===o&&2===t.form.withquantity||"groupprice"===o?t._e():i("el-table-column",{key:o,attrs:{width:["price","discountprice","vipprice","groupprice","costprice"].includes(o)&&135},scopedSlots:t._u([{key:"header",fn:function(e){return[t._v("\n                  "+t._s(t.getTitle(o))+"\n                  "),t.getTitleInfo(o)?i("el-tooltip",{attrs:{effect:"dark",content:t.getTitleInfo(o,e),placement:"top"}},[i("i",{staticClass:"el-icon-warning"})]):t._e()]}},{key:"default",fn:function(e){return["image"!=o?i("el-input",{staticClass:"min-input",model:{value:e.row[o],callback:function(i){t.$set(e.row,o,i)},expression:"scope.row[key]"}}):i("upload-file",{attrs:{height:"50px",width:"50px",limit:1,accept:"image/*"},model:{value:e.row[o],callback:function(i){t.$set(e.row,o,i)},expression:"scope.row[key]"}})]}}])})]})],2)],1)]),i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!t.form.optionsDetail.length,expression:"!form.optionsDetail.length"}],staticClass:"form-item-price",attrs:{label:"商品价格"}},[i("el-col",{attrs:{span:"4"}},[i("el-input",{model:{value:t.form.price,callback:function(e){t.$set(t.form,"price",e)},expression:"form.price"}},[i("template",{slot:"append"},[t._v("元")])],2)],1)],1),i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!t.form.optionsDetail.length,expression:"!form.optionsDetail.length"}],staticClass:"form-item-price",attrs:{label:"折扣价格"}},[i("el-row",[i("el-col",{attrs:{span:"4"}},[i("el-input",{model:{value:t.form.discountprice,callback:function(e){t.$set(t.form,"discountprice",e)},expression:"form.discountprice"}},[i("template",{slot:"append"},[t._v("元")])],2)],1)],1),i("div",{staticClass:"tips"},[t._v("设置该商品的折扣价格, 不填或填0代表不设置折扣价。")])],1),i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!t.form.optionsDetail.length,expression:"!form.optionsDetail.length"}],staticClass:"form-item-price",attrs:{label:"会员价格"}},[i("el-row",[i("el-col",{attrs:{span:"4"}},[i("el-input",{model:{value:t.form.vipprice,callback:function(e){t.$set(t.form,"vipprice",e)},expression:"form.vipprice"}},[i("template",{slot:"append"},[t._v("元")])],2)],1)],1),i("div",{staticClass:"tips"},[t._v("设置该商品会员享有的价格, 不填或填0代表不设置会员价。")])],1),i("el-form-item",{attrs:{label:"商品库存"}},[i("el-row",[i("el-col",{attrs:{span:"5"}},[i("el-switch",{attrs:{"active-text":"有无库存限制","active-value":1,"inactive-value":2},model:{value:t.form.withquantity,callback:function(e){t.$set(t.form,"withquantity",e)},expression:"form.withquantity"}})],1),i("el-col",{attrs:{span:"18"}},[1===t.form.withquantity?i("div",{staticClass:"tips",staticStyle:{"margin-left":"5px","margin-top":"5px"}},[t._v("当前商品有库存限制, 商品库存为0时，将自动移动至 “已售罄” 列表。")]):i("div",{staticClass:"tips",staticStyle:{"margin-left":"5px","margin-top":"5px"}},[t._v("当前商品没有库存限制")])])],1),t.form.optionsDetail.length||1!==t.form.withquantity?t._e():i("el-row",[i("el-col",{attrs:{span:"4"}},[i("el-input",{model:{value:t.form.quantity,callback:function(e){t.$set(t.form,"quantity",e)},expression:"form.quantity"}})],1)],1)],1),i("el-form-item",{attrs:{label:"商品编码"}},[i("el-row",[i("el-col",{attrs:{span:"4"}},[i("el-input",{model:{value:t.form.number,callback:function(e){t.$set(t.form,"number",e)},expression:"form.number"}})],1)],1),i("div",{staticClass:"tips"},[t._v("如无则不填")])],1),i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!t.form.optionsDetail.length,expression:"!form.optionsDetail.length"}],staticClass:"form-item-price",attrs:{label:"成本价格",prop:"costprice"}},[i("el-row",[i("el-col",{attrs:{span:"4"}},[i("el-input",{model:{value:t.form.costprice,callback:function(e){t.$set(t.form,"costprice",e)},expression:"form.costprice"}},[i("template",{slot:"append"},[t._v("元")])],2)],1)],1),i("div",{staticClass:"tips"},[t._v("成本价将用于利润统计，方便您了解经营收益。")])],1),i("el-form-item",{attrs:{prop:"online"}},[i("el-col",{attrs:{span:"5"}},[i("el-switch",{attrs:{"active-text":"上架商品","active-value":1,"inactive-value":0},model:{value:t.form.online,callback:function(e){t.$set(t.form,"online",e)},expression:"form.online"}})],1),i("el-col",{attrs:{span:"18"}},[0===t.form.online?i("div",{staticClass:"tips",staticStyle:{"margin-left":"5px","margin-top":"5px"}},[t._v("当前商品已下架。")]):i("div",{staticClass:"tips",staticStyle:{"margin-left":"5px","margin-top":"5px"}},[t._v("当前商品已上架。")])])],1)],1)]),i("div",{staticStyle:{height:"100px"}}),i("div",{staticClass:"buttons"},[i("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("发布")])],1)],1)},H=[],B={components:{"upload-file":l["a"]},data:function(){return{categories:[],display:!0,form:{name:"",categoryid:"",videoimage:"",video:"",imagesList:[],description:"",descriptionimagesList:[],supportgroup:0,groupuserquantity:0,quantity:0,price:0,discountprice:0,groupprice:0,withoption:0,optionsList:[],online:1,number:"",costprice:0,withquantity:1,productdescriptionlong:"",productnoticelistList:[],supportreserve:1,vipprice:0,withtimeslot:1,producttimeslotlistList:[],options:[],optionsDetail:[]},token:""}},watch:{"form.options":{deep:!0,handler:function(){this.form.optionsDetail=this.buildOptionJson(this.form.options)}}},created:function(){var t=Object(p["a"])(regeneratorRuntime.mark(function t(){var e=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:this.token=Object(f["e"])(),"edit"===this.$route.query.type&&Object(m["a"])("StoreProductService.GetProduct",Object(u["a"])("IDWithTokenRequest",{token:Object(u["a"])("Token",{token:this.token}),id:this.$route.query.id})).then(function(t){e.form=e.backend2frontend(t),e.form.price=e.$amount1(e.form.price),e.form.discountprice=e.$amount1(e.form.discountprice),e.form.groupprice=e.$amount1(e.form.groupprice),e.form.costprice=e.$amount1(e.form.costprice),e.form.vipprice=e.$amount1(e.form.vipprice),e.form.optionsDetail=e.form.optionsDetail.map(function(t){return Object(c["a"])({},t,{price:e.$amount1(t.price),discountprice:e.$amount1(t.discountprice),groupprice:e.$amount1(t.groupprice),costprice:e.$amount1(t.costprice),vipprice:e.$amount1(t.vipprice)})})}),Object(m["a"])("StoreCategoryService.GetCategoryList",Object(u["a"])("CategoryListQueryRequest",{token:Object(u["a"])("Token",{token:this.token}),ishidden:2,level:1,count:100,sortby:1})).then(function(t){e.categories=t.categorylistList});case 3:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),methods:{getDetailDesc:function(t){return"discountprice"===t?"优惠价格, 不填或填0代表不设置折扣价":"groupprice"===t?"如不支持团购则不填":""},onSubmit:function(){var t=this;this.$refs.form.validate(function(e){if(e){var i=JSON.parse(JSON.stringify(t.form));if(i.price=t.$amount2(i.price),i.discountprice=t.$amount2(i.discountprice),i.groupprice=t.$amount2(i.groupprice),i.costprice=t.$amount2(i.costprice),i.vipprice=t.$amount2(i.vipprice),i.optionsDetail=i.optionsDetail.map(function(e){return Object(c["a"])({},e,{price:t.$amount2(e.price),discountprice:t.$amount2(e.discountprice),groupprice:t.$amount2(e.groupprice),costprice:t.$amount2(e.costprice),vipprice:t.$amount2(e.vipprice)})}),i=t.frontend2backend(i),i.categoryidlistList.length){if(i.categoryid=i.categoryidlistList[0],0==i.withoption){if(0==i.price)return void t.$message({message:"忘记设置原价了",type:"error"});if(0!=i.discountprice&&i.discountprice>=i.price)return void t.$message({message:"如果设置折扣价, 则折扣价需小于原价",type:"error"});if(0!=i.vipprice){if(i.vipprice>=i.price)return void t.$message({message:"如果设置会员价, 则会员价需小于原价",type:"error"});if(0!=i.discountprice&&i.vipprice>=i.discountprice)return void t.$message({message:"会员价应该小于折扣价",type:"error"})}if(1==i.supportgroup){if(0==i.groupprice)return void t.$message({message:"忘记设置团购价了",type:"error"});if(i.groupprice>=i.price)return void t.$message({message:"团购价需小于原价",type:"error"});if(0!=i.discountprice&&i.groupprice>=i.discountprice)return void t.$message({message:"团购价需小于折扣价",type:"error"});if(0!=i.vipprice&&i.groupprice>=i.vipprice)return void t.$message({message:"团购价需小于会员价",type:"error"})}}if(1==i.withoption){var o=!0,r=!1,s=void 0;try{for(var a,n=i.optionsList[Symbol.iterator]();!(o=(a=n.next()).done);o=!0){var p=a.value,l=p.toObject();if(0==l.price)return void t.$message({message:"忘记设置原价了",type:"error"});if(0!=l.discountprice&&l.discountprice>=l.price)return void t.$message({message:"如果设置折扣价, 则折扣价需小于原价",type:"error"});if(0!=l.vipprice){if(l.vipprice>=l.price)return void t.$message({message:"如果设置会员价, 则会员价需小于原价",type:"error"});if(0!=l.discountprice&&l.vipprice>=l.discountprice)return void t.$message({message:"会员价应该小于折扣价",type:"error"})}if(1==i.supportgroup){if(0==l.groupprice)return void t.$message({message:"忘记设置团购价了",type:"error"});if(l.groupprice>=l.price)return void t.$message({message:"团购价需小于原价",type:"error"});if(0!=l.discountprice&&l.groupprice>=l.discountprice)return void t.$message({message:"团购价需小于折扣价",type:"error"});if(0!=l.vipprice&&l.groupprice>=l.vipprice)return void t.$message({message:"团购价需小于会员价",type:"error"})}}}catch(f){r=!0,s=f}finally{try{o||null==n.return||n.return()}finally{if(r)throw s}}}"edit"!==t.$route.query.type?Object(m["a"])("StoreProductService.CreateProduct",Object(u["a"])("ProductWithTokenRequest",{token:Object(u["a"])("Token",{token:t.token}),product:Object(u["a"])("Product",i)})).then(function(e){t.$router.back()}):Object(m["a"])("StoreProductService.UpdateProduct",Object(u["a"])("ProductWithTokenRequest",{token:Object(u["a"])("Token",{token:t.token}),product:Object(u["a"])("Product",i)})).then(function(e){t.$message({message:"商品保存成功",type:"success"})})}else t.$message({message:"忘记选择分类了",type:"error"})}})},backend2frontend:function(t){for(var e=[],i=[],o={},r=0;r<t.optionsList.length;r++){var s={price:t.optionsList[r].price,discountprice:t.optionsList[r].discountprice,groupprice:t.optionsList[r].groupprice,costprice:t.optionsList[r].costprice,vipprice:t.optionsList[r].vipprice,quantity:t.optionsList[r].quantity,image:t.optionsList[r].image},a=JSON.parse(t.optionsList[r].name);for(var n in a)o.hasOwnProperty(n)||(o[n]=[]),-1===o[n].indexOf(a[n])&&o[n].push(a[n]),s[n]=a[n];i.push(s)}for(var n in t.optionsDetail=i,o)e.push({vid:n,name:n,value:o[n].map(function(t){return{vid:n+":"+t,value:t}})});return t.options=e,t},frontend2backend:function(t){return t.supportgroup=t.groupuserquantity>0?1:0,t.withoption=0,t.optionsList=[],t.optionsDetail.length&&(t.withoption=1,t.optionsList=t.optionsDetail.map(function(t){var e={},i={};for(var o in t)"price"!==o&&"discountprice"!==o&&"vipprice"!==o&&"groupprice"!==o&&"quantity"!==o&&"costprice"!==o&&"image"!==o?i[o]=t[o]:e[o]=t[o];return e.name=JSON.stringify(Object(f["g"])(i)),console.log(e),Object(u["a"])("Option",e)})),t.productnoticelistList=t.productnoticelistList.map(function(t){return Object(u["a"])("ProductNotice",t)}),t.producttimeslotlistList=t.producttimeslotlistList.map(function(t){return Object(u["a"])("ProductTimeSlot",{weeklistList:t.weeklistList,producttimeslotpricelistList:t.producttimeslotpricelistList.map(function(t){return Object(u["a"])("ProductTimeSlotPrice",t)})})}),t},getTitle:function(t){var e={firstValue:"-",secondValue:"-",thirdValue:"-",price:"价格（元）",discountprice:"折扣价（元）",vipprice:"会员价（元）",groupprice:"团购价（元）",quantity:"库存",costprice:"成本价（元）",image:"图片"};return e[t]?e[t]:t},getTitleInfo:function(t){var e={price:"原价",discountprice:"当有折扣价时，商品优先显示折扣价，原件则作为划线价展示, 不填或填0代表不设置折扣价",vipprice:"当有会员价时，会员会使用会员价, 不填或填0代表不设置会员价",groupprice:"拼团使用的价格",quantity:"商品库存",costprice:"用于统计商店利润"};return e[t]},removeOption:function(t){this.form.options.splice(t,1)},addOption:function(){this.form.options.push({name:"",value:[{value:"",uid:Math.random()}],uid:Math.random()})},removeOptionItem:function(t,e){t.splice(e,1)},addOptionItem:function(t){t.push({value:"",uid:Math.random()})},buildOptionJson:function(t){var e=[],i=["firstValue","secondValue","thirdValue"];t.forEach(function(t,o){if(t.value.length){var r=t.name||i[o];if(e.length){var s=[];e.forEach(function(e){t.value.forEach(function(t){var i=Object(c["a"])({},e);i[r]=t.value,s.push(i)})}),e=s}else e=t.value.map(function(t){var e={};return e[r]=t.value,e})}});var o=this.form.optionsDetail,r=e.map(function(t,e){var i=o[e]||{},r=i.price,s=void 0===r?0:r,a=i.discountprice,n=void 0===a?0:a,p=i.vipprice,l=void 0===p?0:p,u=i.groupprice,m=void 0===u?0:u,f=i.quantity,d=void 0===f?0:f,v=i.costprice,g=void 0===v?0:v,h=i.image,y=void 0===h?"":h;return Object(c["a"])({},t,{price:s,discountprice:n,vipprice:l,groupprice:m,quantity:d,costprice:g,image:y})});return r}}},F=B,K=(i("f42f"),i("3c46"),Object(h["a"])(F,A,H,!1,null,"56c0411c",null)),X=K.exports,Y=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"edit-page"},[i("div",{staticClass:"ml-l pl-l mb-l pb-l"},[i("el-button",{attrs:{size:"small"},on:{click:function(e){t.$router.back()}}},[t._v("返回")])],1),i("el-form",{ref:"form",attrs:{model:t.form,rules:t.rules,"label-width":"120px",size:"small"}},[i("div",{staticClass:"container"},[i("h3",{staticClass:"title"},[t._v("基本信息")]),i("el-form-item",{attrs:{label:"商品名"}},[i("el-col",{attrs:{span:"6"}},[i("el-input",{model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1)],1),i("el-form-item",{attrs:{label:"商品描述"}},[i("el-col",{attrs:{span:"12"}},[i("el-input",{model:{value:t.form.description,callback:function(e){t.$set(t.form,"description",e)},expression:"form.description"}})],1)],1),i("el-form-item",{attrs:{label:"添加商品图"}},[i("upload-file",{attrs:{limit:10,accept:"image/*"},model:{value:t.form.imagesList,callback:function(e){t.$set(t.form,"imagesList",e)},expression:"form.imagesList"}}),i("div",{staticClass:"tips"},[t._v("建议尺寸：800*800像素，最多上传10张")])],1),i("el-form-item",{attrs:{label:"选择分类"}},[i("el-row",[i("el-col",{attrs:{span:6}},[i("el-select",{attrs:{placeholder:"请选择分类",multiple:""},model:{value:t.form.categoryidlistList,callback:function(e){t.$set(t.form,"categoryidlistList",e)},expression:"form.categoryidlistList"}},t._l(t.categories,function(t){return i("el-option",{key:t.id,attrs:{label:t.name.slice(1).split("/")[0],value:t.id}})}))],1),i("el-col",{staticStyle:{"margin-left":"15px"},attrs:{span:2}},[i("el-button",{attrs:{size:"small",type:"text"},on:{click:function(e){t.$router.push({name:"category"})}}},[t._v("新建类目")])],1)],1)],1)],1),i("div",{staticClass:"container"},[i("h3",{staticClass:"title"},[t._v("价格库存")]),i("el-form-item",{attrs:{label:"商品规格"}},[t.form.options.length?i("div",{staticClass:"options"},[t._l(t.form.options,function(e,o){return[i("el-row",{key:e.uid+"x",staticClass:"single oi"},[i("el-col",{staticClass:"options-title",attrs:{span:"3"}},[t._v("规格名：")]),i("el-col",{attrs:{span:"4"}},[i("el-input",{staticClass:"min-input",attrs:{autofocus:""},model:{value:e.name,callback:function(i){t.$set(e,"name",i)},expression:"op.name"}})],1),i("el-col",{staticStyle:{"text-align":"right"},attrs:{offset:"16",span:"1"}},[i("el-button",{staticStyle:{color:"gray"},attrs:{icon:"el-icon-error",type:"text"},on:{click:function(e){t.removeOption(o)}}})],1)],1),i("el-row",{key:e.uid+"y",staticClass:"double oi"},[i("el-col",{staticClass:"options-title",attrs:{span:"3"}},[t._v("规格值：")]),i("el-col",{attrs:{span:"21"}},[i("el-row",{attrs:{gutter:"8"}},[t._l(e.value,function(o,r){return i("el-col",{key:o.uid,staticStyle:{display:"flex"},attrs:{span:5}},[i("el-input",{staticClass:"min-input",staticStyle:{"margin-right":"5px"},model:{value:o.value,callback:function(e){t.$set(o,"value",e)},expression:"v.value"}}),i("el-button",{staticStyle:{color:"gray","margin-right":"5px"},attrs:{icon:"el-icon-error",type:"text"},on:{click:function(i){t.removeOptionItem(e.value,r)}}})],1)}),i("el-col",{staticStyle:{"text-align":"center"},attrs:{span:"4"}},[i("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(i){t.addOptionItem(e.value)}}},[t._v("添加规格值")])],1)],2)],1)],1)]}),i("el-row",{staticClass:"single oi"},[i("el-col",{attrs:{span:"5"}},[i("el-button",{attrs:{disabled:3===t.form.options.length,size:"mini",type:"primary"},on:{click:t.addOption}},[t._v("添加规格项目")])],1),i("el-col",{staticClass:"options-title",attrs:{span:"18"}},[i("span",[t._v("最多支持3种规格")])])],1)],2):i("div",[i("el-button",{on:{click:t.addOption}},[t._v("添加规格")])],1),i("div",{staticClass:"tips",staticStyle:{color:"#ff4f4f"}},[t._v("如有不同口味或其他规格，请添加商品规格, 如无则不必添加。")])]),i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:t.form.optionsDetail.length,expression:"form.optionsDetail.length"}],attrs:{label:"规格明细"}},[i("div",{staticClass:"options-detail"},[i("el-table",{attrs:{data:t.form.optionsDetail,border:""}},[t._l(t.form.optionsDetail[0],function(e,o){return["quantity"===o&&2===t.form.withquantity||"groupprice"===o?t._e():i("el-table-column",{key:o,attrs:{width:["price","discountprice","vipprice","groupprice","costprice"].includes(o)&&135},scopedSlots:t._u([{key:"header",fn:function(e){return[t._v("\n                  "+t._s(t.getTitle(o))+"\n                  "),t.getTitleInfo(o)?i("el-tooltip",{attrs:{effect:"dark",content:t.getTitleInfo(o,e),placement:"top"}},[i("i",{staticClass:"el-icon-warning"})]):t._e()]}},{key:"default",fn:function(e){return["image"!=o?i("el-input",{staticClass:"min-input",model:{value:e.row[o],callback:function(i){t.$set(e.row,o,i)},expression:"scope.row[key]"}}):i("upload-file",{attrs:{height:"50px",width:"50px",limit:1,accept:"image/*"},model:{value:e.row[o],callback:function(i){t.$set(e.row,o,i)},expression:"scope.row[key]"}})]}}])})]})],2)],1)]),i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!t.form.optionsDetail.length,expression:"!form.optionsDetail.length"}],staticClass:"form-item-price",attrs:{label:"商品价格"}},[i("el-col",{attrs:{span:"4"}},[i("el-input",{model:{value:t.form.price,callback:function(e){t.$set(t.form,"price",e)},expression:"form.price"}},[i("template",{slot:"append"},[t._v("元")])],2)],1)],1),i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!t.form.optionsDetail.length,expression:"!form.optionsDetail.length"}],staticClass:"form-item-price",attrs:{label:"折扣价格"}},[i("el-row",[i("el-col",{attrs:{span:"4"}},[i("el-input",{model:{value:t.form.discountprice,callback:function(e){t.$set(t.form,"discountprice",e)},expression:"form.discountprice"}},[i("template",{slot:"append"},[t._v("元")])],2)],1)],1),i("div",{staticClass:"tips"},[t._v("设置该商品的折扣价格, 不填或填0代表不设置折扣价。")])],1),i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!t.form.optionsDetail.length,expression:"!form.optionsDetail.length"}],staticClass:"form-item-price",attrs:{label:"会员价格"}},[i("el-row",[i("el-col",{attrs:{span:"4"}},[i("el-input",{model:{value:t.form.vipprice,callback:function(e){t.$set(t.form,"vipprice",e)},expression:"form.vipprice"}},[i("template",{slot:"append"},[t._v("元")])],2)],1)],1),i("div",{staticClass:"tips"},[t._v("设置该商品会员享有的价格, 不填或填0代表不设置会员价。")])],1),i("el-form-item",{attrs:{label:"商品库存"}},[i("el-row",[i("el-col",{attrs:{span:"5"}},[i("el-switch",{attrs:{"active-text":"有无库存限制","active-value":1,"inactive-value":2},model:{value:t.form.withquantity,callback:function(e){t.$set(t.form,"withquantity",e)},expression:"form.withquantity"}})],1),i("el-col",{attrs:{span:"18"}},[1===t.form.withquantity?i("div",{staticClass:"tips",staticStyle:{"margin-left":"5px","margin-top":"5px"}},[t._v("当前商品有库存限制, 商品库存为0时，将自动移动至 “已售罄” 列表。")]):i("div",{staticClass:"tips",staticStyle:{"margin-left":"5px","margin-top":"5px"}},[t._v("当前商品没有库存限制")])])],1),t.form.optionsDetail.length||1!==t.form.withquantity?t._e():i("el-row",[i("el-col",{attrs:{span:"4"}},[i("el-input",{model:{value:t.form.quantity,callback:function(e){t.$set(t.form,"quantity",e)},expression:"form.quantity"}})],1)],1)],1),i("el-form-item",{attrs:{label:"商品编码"}},[i("el-row",[i("el-col",{attrs:{span:"4"}},[i("el-input",{model:{value:t.form.number,callback:function(e){t.$set(t.form,"number",e)},expression:"form.number"}})],1)],1),i("div",{staticClass:"tips"},[t._v("如无则不填")])],1),i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!t.form.optionsDetail.length,expression:"!form.optionsDetail.length"}],staticClass:"form-item-price",attrs:{label:"成本价格",prop:"costprice"}},[i("el-row",[i("el-col",{attrs:{span:"4"}},[i("el-input",{model:{value:t.form.costprice,callback:function(e){t.$set(t.form,"costprice",e)},expression:"form.costprice"}},[i("template",{slot:"append"},[t._v("元")])],2)],1)],1),i("div",{staticClass:"tips"},[t._v("成本价将用于利润统计，方便您了解经营收益。")])],1),i("el-form-item",{attrs:{prop:"online"}},[i("el-col",{attrs:{span:"5"}},[i("el-switch",{attrs:{"active-text":"上架商品","active-value":1,"inactive-value":0},model:{value:t.form.online,callback:function(e){t.$set(t.form,"online",e)},expression:"form.online"}})],1),i("el-col",{attrs:{span:"18"}},[0===t.form.online?i("div",{staticClass:"tips",staticStyle:{"margin-left":"5px","margin-top":"5px"}},[t._v("当前商品已下架。")]):i("div",{staticClass:"tips",staticStyle:{"margin-left":"5px","margin-top":"5px"}},[t._v("当前商品已上架。")])])],1)],1)]),i("div",{staticStyle:{height:"100px"}}),i("div",{staticClass:"buttons"},[i("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("发布")])],1)],1)},Z=[],tt={components:{"upload-file":l["a"]},data:function(){return{categories:[],display:!0,form:{name:"",categoryid:"",videoimage:"",video:"",imagesList:[],description:"",descriptionimagesList:[],supportgroup:0,groupuserquantity:0,quantity:0,price:0,discountprice:0,groupprice:0,withoption:0,optionsList:[],online:1,number:"",costprice:0,withquantity:1,productdescriptionlong:"",productnoticelistList:[],supportreserve:1,vipprice:0,withtimeslot:1,producttimeslotlistList:[],options:[],optionsDetail:[]},token:""}},watch:{"form.options":{deep:!0,handler:function(){this.form.optionsDetail=this.buildOptionJson(this.form.options)}}},created:function(){var t=Object(p["a"])(regeneratorRuntime.mark(function t(){var e=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:this.token=Object(f["e"])(),"edit"===this.$route.query.type&&Object(m["a"])("StoreProductService.GetProduct",Object(u["a"])("IDWithTokenRequest",{token:Object(u["a"])("Token",{token:this.token}),id:this.$route.query.id})).then(function(t){e.form=e.backend2frontend(t),e.form.price=e.$amount1(e.form.price),e.form.discountprice=e.$amount1(e.form.discountprice),e.form.groupprice=e.$amount1(e.form.groupprice),e.form.costprice=e.$amount1(e.form.costprice),e.form.vipprice=e.$amount1(e.form.vipprice),e.form.optionsDetail=e.form.optionsDetail.map(function(t){return Object(c["a"])({},t,{price:e.$amount1(t.price),discountprice:e.$amount1(t.discountprice),groupprice:e.$amount1(t.groupprice),costprice:e.$amount1(t.costprice),vipprice:e.$amount1(t.vipprice)})})}),Object(m["a"])("StoreCategoryService.GetCategoryList",Object(u["a"])("CategoryListQueryRequest",{token:Object(u["a"])("Token",{token:this.token}),ishidden:2,level:1,count:100,sortby:1})).then(function(t){e.categories=t.categorylistList});case 3:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),methods:{getDetailDesc:function(t){return"discountprice"===t?"优惠价格, 不填或填0代表不设置折扣价":"groupprice"===t?"如不支持团购则不填":""},onSubmit:function(){var t=this;this.$refs.form.validate(function(e){if(e){var i=JSON.parse(JSON.stringify(t.form));if(i.price=t.$amount2(i.price),i.discountprice=t.$amount2(i.discountprice),i.groupprice=t.$amount2(i.groupprice),i.costprice=t.$amount2(i.costprice),i.vipprice=t.$amount2(i.vipprice),i.optionsDetail=i.optionsDetail.map(function(e){return Object(c["a"])({},e,{price:t.$amount2(e.price),discountprice:t.$amount2(e.discountprice),groupprice:t.$amount2(e.groupprice),costprice:t.$amount2(e.costprice),vipprice:t.$amount2(e.vipprice)})}),i=t.frontend2backend(i),i.categoryidlistList.length){if(i.categoryid=i.categoryidlistList[0],0==i.withoption){if(0==i.price)return void t.$message({message:"忘记设置原价了",type:"error"});if(0!=i.discountprice&&i.discountprice>=i.price)return void t.$message({message:"如果设置折扣价, 则折扣价需小于原价",type:"error"});if(0!=i.vipprice){if(i.vipprice>=i.price)return void t.$message({message:"如果设置会员价, 则会员价需小于原价",type:"error"});if(0!=i.discountprice&&i.vipprice>=i.discountprice)return void t.$message({message:"会员价应该小于折扣价",type:"error"})}if(1==i.supportgroup){if(0==i.groupprice)return void t.$message({message:"忘记设置团购价了",type:"error"});if(i.groupprice>=i.price)return void t.$message({message:"团购价需小于原价",type:"error"});if(0!=i.discountprice&&i.groupprice>=i.discountprice)return void t.$message({message:"团购价需小于折扣价",type:"error"});if(0!=i.vipprice&&i.groupprice>=i.vipprice)return void t.$message({message:"团购价需小于会员价",type:"error"})}}if(1==i.withoption){var o=!0,r=!1,s=void 0;try{for(var a,n=i.optionsList[Symbol.iterator]();!(o=(a=n.next()).done);o=!0){var p=a.value,l=p.toObject();if(0==l.price)return void t.$message({message:"忘记设置原价了",type:"error"});if(0!=l.discountprice&&l.discountprice>=l.price)return void t.$message({message:"如果设置折扣价, 则折扣价需小于原价",type:"error"});if(0!=l.vipprice){if(l.vipprice>=l.price)return void t.$message({message:"如果设置会员价, 则会员价需小于原价",type:"error"});if(0!=l.discountprice&&l.vipprice>=l.discountprice)return void t.$message({message:"会员价应该小于折扣价",type:"error"})}if(1==i.supportgroup){if(0==l.groupprice)return void t.$message({message:"忘记设置团购价了",type:"error"});if(l.groupprice>=l.price)return void t.$message({message:"团购价需小于原价",type:"error"});if(0!=l.discountprice&&l.groupprice>=l.discountprice)return void t.$message({message:"团购价需小于折扣价",type:"error"});if(0!=l.vipprice&&l.groupprice>=l.vipprice)return void t.$message({message:"团购价需小于会员价",type:"error"})}}}catch(f){r=!0,s=f}finally{try{o||null==n.return||n.return()}finally{if(r)throw s}}}"edit"!==t.$route.query.type?Object(m["a"])("StoreProductService.CreateProduct",Object(u["a"])("ProductWithTokenRequest",{token:Object(u["a"])("Token",{token:t.token}),product:Object(u["a"])("Product",i)})).then(function(e){t.$router.back()}):Object(m["a"])("StoreProductService.UpdateProduct",Object(u["a"])("ProductWithTokenRequest",{token:Object(u["a"])("Token",{token:t.token}),product:Object(u["a"])("Product",i)})).then(function(e){t.$message({message:"商品保存成功",type:"success"})})}else t.$message({message:"忘记选择分类了",type:"error"})}})},backend2frontend:function(t){for(var e=[],i=[],o={},r=0;r<t.optionsList.length;r++){var s={price:t.optionsList[r].price,discountprice:t.optionsList[r].discountprice,groupprice:t.optionsList[r].groupprice,costprice:t.optionsList[r].costprice,vipprice:t.optionsList[r].vipprice,quantity:t.optionsList[r].quantity,image:t.optionsList[r].image},a=JSON.parse(t.optionsList[r].name);for(var n in a)o.hasOwnProperty(n)||(o[n]=[]),-1===o[n].indexOf(a[n])&&o[n].push(a[n]),s[n]=a[n];i.push(s)}for(var n in t.optionsDetail=i,o)e.push({vid:n,name:n,value:o[n].map(function(t){return{vid:n+":"+t,value:t}})});return t.options=e,t},frontend2backend:function(t){return t.supportgroup=t.groupuserquantity>0?1:0,t.withoption=0,t.optionsList=[],t.optionsDetail.length&&(t.withoption=1,t.optionsList=t.optionsDetail.map(function(t){var e={},i={};for(var o in t)"price"!==o&&"discountprice"!==o&&"vipprice"!==o&&"groupprice"!==o&&"quantity"!==o&&"costprice"!==o&&"image"!==o?i[o]=t[o]:e[o]=t[o];return e.name=JSON.stringify(Object(f["g"])(i)),console.log(e),Object(u["a"])("Option",e)})),t.productnoticelistList=t.productnoticelistList.map(function(t){return Object(u["a"])("ProductNotice",t)}),t.producttimeslotlistList=t.producttimeslotlistList.map(function(t){return Object(u["a"])("ProductTimeSlot",{weeklistList:t.weeklistList,producttimeslotpricelistList:t.producttimeslotpricelistList.map(function(t){return Object(u["a"])("ProductTimeSlotPrice",t)})})}),t},getTitle:function(t){var e={firstValue:"-",secondValue:"-",thirdValue:"-",price:"价格（元）",discountprice:"折扣价（元）",vipprice:"会员价（元）",groupprice:"团购价（元）",quantity:"库存",costprice:"成本价（元）",image:"图片"};return e[t]?e[t]:t},getTitleInfo:function(t){var e={price:"原价",discountprice:"当有折扣价时，商品优先显示折扣价，原件则作为划线价展示, 不填或填0代表不设置折扣价",vipprice:"当有会员价时，会员会使用会员价, 不填或填0代表不设置会员价",groupprice:"拼团使用的价格",quantity:"商品库存",costprice:"用于统计商店利润"};return e[t]},removeOption:function(t){this.form.options.splice(t,1)},addOption:function(){this.form.options.push({name:"",value:[{value:"",uid:Math.random()}],uid:Math.random()})},removeOptionItem:function(t,e){t.splice(e,1)},addOptionItem:function(t){t.push({value:"",uid:Math.random()})},buildOptionJson:function(t){var e=[],i=["firstValue","secondValue","thirdValue"];t.forEach(function(t,o){if(t.value.length){var r=t.name||i[o];if(e.length){var s=[];e.forEach(function(e){t.value.forEach(function(t){var i=Object(c["a"])({},e);i[r]=t.value,s.push(i)})}),e=s}else e=t.value.map(function(t){var e={};return e[r]=t.value,e})}});var o=this.form.optionsDetail,r=e.map(function(t,e){var i=o[e]||{},r=i.price,s=void 0===r?0:r,a=i.discountprice,n=void 0===a?0:a,p=i.vipprice,l=void 0===p?0:p,u=i.groupprice,m=void 0===u?0:u,f=i.quantity,d=void 0===f?0:f,v=i.costprice,g=void 0===v?0:v,h=i.image,y=void 0===h?"":h;return Object(c["a"])({},t,{price:s,discountprice:n,vipprice:l,groupprice:m,quantity:d,costprice:g,image:y})});return r}}},et=tt,it=(i("9d98b"),i("0f66"),Object(h["a"])(et,Y,Z,!1,null,"14e62a1d",null)),ot=it.exports,rt={_0:b,_1:_,_2:D,_3:V,_4:U,_6:X,_7:ot},st={0:"_0",1:"_1",2:"_2",3:"_3",4:"_4",6:"_6",7:"_7"},at=Object(s["a"])({name:"products-edit-entry",components:rt,map:st}),nt=at,ct=Object(h["a"])(nt,o,r,!1,null,null,null);e["default"]=ct.exports},9759:function(t,e,i){},"992f":function(t,e,i){"use strict";var o=i("83eb"),r=i.n(o);r.a},"9d98b":function(t,e,i){"use strict";var o=i("00b8"),r=i.n(o);r.a},ad13:function(t,e,i){},bafd:function(t,e,i){},c2cf:function(t,e,i){"use strict";var o=i("c9a8"),r=i.n(o);r.a},c494:function(t,e,i){"use strict";var o=i("0ed2"),r=i.n(o);r.a},c9a8:function(t,e,i){},d2a6:function(t,e,i){},d606:function(t,e,i){"use strict";var o=i("58ec"),r=i.n(o);r.a},f42f:function(t,e,i){"use strict";var o=i("2827"),r=i.n(o);r.a}}]);
//# sourceMappingURL=products-edit.7629f710.js.map