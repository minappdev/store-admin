(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["order-detail"],{"030a":function(t,e,r){"use strict";var i=r("7e06"),a=r.n(i);a.a},"0fb6":function(t,e,r){},"138a":function(t,e,r){"use strict";var i=r("e8c0"),a=r.n(i);a.a},"13b0":function(t,e,r){},1402:function(t,e,r){},"1f27":function(t,e,r){"use strict";var i=r("0fb6"),a=r.n(i);a.a},"20d6":function(t,e,r){"use strict";var i=r("5ca1"),a=r("0a49")(6),s="findIndex",n=!0;s in[]&&Array(1)[s](function(){n=!1}),i(i.P+i.F*n,"Array",{findIndex:function(t){return a(this,t,arguments.length>1?arguments[1]:void 0)}}),r("9c6c")(s)},"29de":function(t,e,r){"use strict";var i=r("ba20"),a=r.n(i);a.a},"2a80":function(t,e,r){},"459e":function(t,e,r){"use strict";var i=r("a18c"),a=r.n(i);a.a},"4bd4":function(t,e,r){"use strict";var i=r("97d5"),a=r.n(i);a.a},5588:function(t,e,r){"use strict";var i=r("db8f"),a=r.n(i);a.a},"56f1":function(t,e,r){"use strict";var i=r("5967"),a=r.n(i);a.a},5967:function(t,e,r){},"5c39":function(t,e,r){"use strict";var i=r("f533"),a=r.n(i);a.a},"5df3":function(t,e,r){"use strict";var i=r("02f4")(!0);r("01f9")(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,e=this._t,r=this._i;return r>=e.length?{value:void 0,done:!0}:(t=i(e,r),this._i+=t.length,{value:t,done:!1})})},6935:function(t,e,r){},7895:function(t,e,r){"use strict";var i=r("1402"),a=r.n(i);a.a},7897:function(t,e,r){"use strict";var i=r("13b0"),a=r.n(i);a.a},"7e06":function(t,e,r){},"80bf":function(t,e,r){"use strict";r("96cf");var i=r("1da1"),a=(r("7f7f"),r("a3fb"));e["a"]=function(t){var e=t.name,r=t.components,s=t.map;return{name:e,components:r,data:function(){return{store:{}}},created:function(){var t=Object(i["a"])(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(a["b"])();case 2:this.store=t.sent;case 3:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),render:function(t){return t(s[this.store.kind])}}}},"97d5":function(t,e,r){},a18c:function(t,e,r){},b3a0:function(t,e,r){},ba20:function(t,e,r){},daa0:function(t,e,r){"use strict";r.r(e);var i,a,s=r("80bf"),n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("div",{staticClass:"ml-l pl-l"},[r("el-button",{attrs:{size:"small"},on:{click:function(e){t.$router.back()}}},[t._v("返回")])],1),r("comp-wrap",[r("div",[r("div",{staticClass:"header-wrap"},[r("div",[r("h3",{staticClass:"my-l py-l"},[t._v(t._s(t.map[t.order.status]||"非此商城的状态"))]),r("div",[r("span",{staticClass:"color2"},[t._v("订单号: "+t._s(t.order.id))]),t.order.groupuuid?r("span",{staticClass:"member-tag",staticStyle:{padding:"0 4px","margin-right":"5px"}},[t._v(t._s("拼团 ID: "+t.order.groupuuid+" "+(2===t.order.grouplead?"团长代收":"单独发货")))]):t._e(),2==t.order.user.isvip?r("span",{staticClass:"member-tag",staticStyle:{padding:"0 4px","margin-right":"5px"}},[t._v("会员")]):t._e(),r("span",{staticClass:"member-tag",staticStyle:{padding:"0 4px","margin-right":"5px"}},[t._v(t._s(t.order.user.nickname)+"("+t._s(t.order.user.mobile)+")")])])]),2==t.order.status?r("div",{staticClass:"header-action"},[r("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){t.updateOrder(3)}}},[t._v("\n            确认发货\n          ")]),r("div",{staticClass:"color3 mt-l pt-l"},[t._v("选择物流公司，即可确认发货")])],1):t._e(),3==t.order.status?r("div",{staticClass:"header-action"},[r("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){t.updateOrder(2)}}},[t._v("\n            取消运单\n          ")]),r("div",{staticClass:"color3 mt-l pt-l"},[t._v("如果快递公司无法进行配送")])],1):t._e()])]),12===t.order.status?r("div",{staticClass:"order-detail_banner"},[r("div",{staticClass:"detail-banner_text"},[r("span",[t._v("买家申请退款")]),r("span",{staticClass:"detail-banner_sub-text"},[t._v("未发货状态下买家申请退款")])]),r("div",[r("el-button",{attrs:{size:"small",type:"info"},on:{click:function(e){t.updateOrder(2)}}},[t._v("拒绝退款")]),r("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){t.updateOrder(8)}}},[t._v("确认退款")])],1)]):t._e(),2===t.order.status?r("div",{staticClass:"order-detail_banner"},[r("div",{staticClass:"detail-banner_text"},[r("span",[t._v("直接退款")]),r("span",{staticClass:"detail-banner_sub-text"},[t._v("如果因为库存不足等原因无法发货, 您可以直接直接退款取消订单")])]),r("div",[r("el-button",{attrs:{size:"small",type:"info"},on:{click:function(e){t.updateOrder(8)}}},[t._v("直接退款")])],1)]):t._e(),7===t.order.status?r("div",{staticClass:"order-detail_banner"},[r("div",{staticClass:"detail-banner_text"},[r("span",[t._v("已同意买家退货申请")]),r("span",{staticClass:"detail-banner_sub-text"},[t._v("等待买家寄回商品, 确认退回商品无问题后点击「确认收到」发起退款")])]),r("div",[r("el-button",{attrs:{size:"small",type:"info"},on:{click:function(e){t.updateOrder(11)}}},[t._v("未收到")]),r("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){t.updateOrder(8)}}},[t._v("确认收到")])],1)]):t._e(),9===t.order.status?r("div",{staticClass:"order-detail_banner"},[r("div",{staticClass:"detail-banner_text"},[t._v("买家申请退货")]),r("div",[r("el-button",{attrs:{size:"small",type:"info"},on:{click:function(e){t.updateOrder(7)}}},[t._v("同意退货")]),r("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){t.updateOrder(10)}}},[t._v("拒绝退货")])],1)]):t._e(),r("div",{staticClass:"address-box"},[r("h5",{staticClass:"mb-l pb-l mt-s pt-s"},[t._v("配送信息")]),r("el-row",{attrs:{align:"middle",type:"flex"}},[r("el-col",{staticClass:"color1",attrs:{span:"2"}},[t._v("配送地址")]),r("el-col",{staticClass:"color1",attrs:{offset:"1",span:"6"}},[t._v(t._s(t.order.address.name)+", "+t._s(t.order.address.mobile))])],1),r("el-row",{staticStyle:{"margin-top":"5px"},attrs:{align:"middle",type:"flex"}},[r("el-col",{attrs:{span:"2"}},[r("el-button",{staticStyle:{padding:"2px 10px","font-size":"10px"},attrs:{size:"small",type:"info"}},[t._v("复制")])],1),r("el-col",{staticClass:"color1",attrs:{offset:"1",span:"6"}},[t._v(t._s(t.order.address.province)+" "+t._s(t.order.address.city)+" "+t._s(t.order.address.district)+" "+t._s(t.order.address.address))])],1),2===t.order.status?r("el-row",{staticStyle:{"margin-top":"5px"},attrs:{align:"middle",type:"flex"}},[r("el-col",{staticClass:"color1 my",attrs:{span:"1"}},[t._v("物流信息")]),r("el-col",{attrs:{offset:"1",span:"3"}},[r("el-select",{attrs:{placeholder:"请选择物流公司"},model:{value:t.shipindex,callback:function(e){t.shipindex=e},expression:"shipindex"}},t._l(t.shiplist,function(t,e){return r("el-option",{key:e,attrs:{label:t.name,value:e}})}))],1)],1):t._e()],1),t.order.shippingcompany?r("comp-list",{attrs:{text:t.order.shippingcompany,label:"发货物流公司"}}):t._e(),t.order.shippingnumber?r("comp-list",{attrs:{text:t.order.shippingnumber,gutter:"",label:"发货物流单号"}}):t._e(),t.order.returnshippingcompany?r("comp-list",{attrs:{text:t.order.returnshippingcompany,label:"退货物流公司"}}):t._e(),t.order.returnshippingnumber?r("comp-list",{attrs:{text:t.order.returnshippingnumber,gutter:"",label:"退货物流单号"}}):t._e(),r("comp-list",{attrs:{text:"¥ "+t.$amount1(t.order.amount),label:"商品合计"}}),t.order.couponid?r("comp-list",{attrs:{text:t.getCoupon(t.order.coupon),label:"使用优惠券"}}):t._e(),r("comp-list",{attrs:{text:"¥ "+t.$amount1(t.order.originfreight),label:"配送费"}}),t._l(t.order.marketinglist,function(e){return r("comp-list",{key:e.id,attrs:{label:t.getMarketingLabel(e),text:t.getMarketing(e)}})}),r("comp-list",{attrs:{text:"¥ "+t.$amount1(t.order.actualamount+t.order.freight),gutter:"",label:"实际支付"}}),r("comp-list",{attrs:{gutter:!t.order.needinvoice,text:t.order.note,label:"买家备注"}}),r("comp-list",{attrs:{text:t.order.giftnote,label:"礼卡祝福语"}}),1==t.order.needinvoice?r("comp-list",{attrs:{text:0===t.order.invoice.kind?"个人":"单位",label:"发票类型",nomb:""}}):t._e(),1==t.order.needinvoice?r("comp-list",{attrs:{text:t.order.invoice.name,label:"发票抬头",nomb:""}}):t._e(),1==t.order.needinvoice?r("comp-list",{attrs:{text:t.order.invoice.taxid,gutter:"",label:"发票税号",nomb:""}}):t._e(),r("div",{staticClass:"g-b",staticStyle:{border:"1px solid #e9e9e9","margin-left":"-10px","margin-right":"-10px"}},t._l(t.order.orderproductsList,function(e){return r("div",{key:e.id,staticClass:"product"},[r("div",{staticClass:"product-info"},[r("div",{staticClass:"product-img",on:{click:function(r){t.$router.push({name:"products-edit",query:{id:e.productid,type:"edit"}})}}},[r("comp-imger",{attrs:{src:e.product.imagesList.length?e.product.imagesList[0]:""}})],1),r("div",[r("div",{staticClass:"product-name"},[t._v(t._s(e.product.name))]),r("div",{staticClass:"product-desc"},[t._v(t._s(e.optionname&&"("+Object.values(JSON.parse(e.optionname)).join(", ")+")"))])])]),r("div",{staticClass:"price"},[t._v(t._s(t.$amount1(e.amount))+" 元")]),r("div",{staticClass:"count"},[t._v(t._s(e.quantity)+" 个")])])})),r("comp-list",{attrs:{text:new Date(1e3*t.order.createdat).toLocaleString("zh-CN",{timeZone:"Asia/Shanghai"}),label:"下单时间"}}),r("comp-list",{attrs:{text:new Date(1e3*t.order.updatedat).toLocaleString("zh-CN",{timeZone:"Asia/Shanghai"}),label:"最后更新"}}),0!=t.order.status&&6!=t.order.status?r("comp-list",{attrs:{text:new Date(1e3*t.order.paidat).toLocaleString("zh-CN",{timeZone:"Asia/Shanghai"}),label:"支付时间"}}):t._e(),1==t.order.payway?r("comp-list",{attrs:{text:t.order.transactionid,label:"微信流水号"}}):t._e(),1==t.order.payway?r("comp-list",{attrs:{text:"微信支付",label:"支付方式"}}):t._e(),2==t.order.payway?r("comp-list",{attrs:{text:"余额支付",label:"支付方式"}}):t._e(),0===t.order.brokeragestatus?r("comp-list",{attrs:{text:"无",label:"有无分账"}}):t._e(),0!==t.order.brokeragestatus?r("comp-list",{attrs:{text:"有",label:"有无分账"}}):t._e(),t.order.profitsharinguserid?r("comp-list",{attrs:{text:t.order.profitsharinguser.nickname+"("+t.order.profitsharinguser.mobile+")",label:"分销员"}}):t._e(),0!==t.order.brokerage?r("comp-list",{attrs:{text:t.order.brokerage/100,label:"分销员佣金"}}):t._e(),1!==t.order.brokeragestatus||0!=t.order.status&&1!=t.order.status&&2!=t.order.status&&3!=t.order.status&&4!=t.order.status?t._e():r("comp-list",{attrs:{text:"未结算",label:"分账结算"}}),2===t.order.brokeragestatus?r("comp-list",{attrs:{text:"已结算",label:"分账结算"}}):t._e(),3===t.order.brokeragestatus?r("comp-list",{attrs:{text:"未结算(结算失败)",label:"分账结算"}}):t._e(),1===t.order.brokeragestatus&&0!=t.order.status&&1!=t.order.status&&2!=t.order.status&&3!=t.order.status&&4!=t.order.status?r("comp-list",{attrs:{text:"未结算(结算无效)",label:"分账结算"}}):t._e()],2)],1)},o=[],c=(r("7f7f"),r("be94")),d=(r("7514"),r("5df3"),r("ac6a"),r("96cf"),r("1da1")),l=(r("cadf"),r("551c"),r("097d"),r("5c96"),r("e8e1")),u=r("8e44"),p=r("73cd"),m="",v={functional:!0,render:function(t,e){return t("div",{class:"container"},[t("div",{class:"wrap"},[e.children])])}},b={functional:!0,props:["label","text","gutter","nomb"],render:function(t,e){var r=e.props,i=r.label,a=r.text,s=r.gutter,n=r.nomb,o=["info"];return void 0!==s&&o.push("g-b"),void 0!==n&&void 0===s&&o.push("nomb"),t("div",{class:o.join(" ")},[t("div",{class:"color1 mr-l pr-l title"},[i]),t("div",{class:"color1 ml-l pl-l text"},[a])])}},g={0:"等待买家支付",1:"拼团中",2:"待发货",3:"等待买家收货",4:"买家已收货",5:"团购失败",6:"买家已取消订单",7:"退货中",8:"已退款",9:"买家申请退货",10:"拒绝买家退货",11:"同意退货但拒绝退款",12:"买家申请退款"},h={components:{"comp-list":b,"comp-wrap":v},data:function(){return{shiplist:[],shipindex:null,map:g,order:{address:{},invoice:{},marketinglist:[],orderproductsList:[],user:{},coupon:{}}}},created:function(){var t=Object(d["a"])(regeneratorRuntime.mark(function t(){var e,r,i,a,s,n=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return m=Object(p["e"])(),Object(u["a"])("StoreDeliveryService.GetDeliveryList",Object(l["a"])("DeliveryListQueryRequest",{token:Object(l["a"])("Token",{token:m}),count:100})).then(function(t){var e=[];t.deliverylistList.forEach(function(t){"BEST"===t.deliveryid&&e.push({name:"".concat(t.deliveryname,"-标准快递(").concat(t.bizid,")"),shippingcompany:"".concat(t.deliveryname,"-标准快递"),deliveryid:t.deliveryid,bizid:t.bizid,servicetype:1,servicevalue:"标准快递"}),"DB"===t.deliveryid&&(e.push({name:"".concat(t.deliveryname,"-大件快递3.60(").concat(t.bizid,")"),shippingcompany:"".concat(t.deliveryname,"-大件快递3.60"),deliveryid:t.deliveryid,bizid:t.bizid,servicetype:1,servicevalue:"大件快递3.60"}),e.push({name:"".concat(t.deliveryname,"-特准快件(").concat(t.bizid,")"),shippingcompany:"".concat(t.deliveryname,"-特准快件"),deliveryid:t.deliveryid,bizid:t.bizid,servicetype:2,servicevalue:"特准快件"})),"EMS"===t.deliveryid&&(e.push({name:"".concat(t.deliveryname,"-标准快递(").concat(t.bizid,")"),shippingcompany:"".concat(t.deliveryname,"-标准快递"),deliveryid:t.deliveryid,bizid:t.bizid,servicetype:6,servicevalue:"标准快递"}),e.push({name:"".concat(t.deliveryname,"-快递包裹(").concat(t.bizid,")"),shippingcompany:"".concat(t.deliveryname,"-快递包裹"),deliveryid:t.deliveryid,bizid:t.bizid,servicetype:9,servicevalue:"快递包裹"})),"OTP"===t.deliveryid&&e.push({name:"".concat(t.deliveryname,"-标准快递(").concat(t.bizid,")"),shippingcompany:"".concat(t.deliveryname,"-标准快递"),deliveryid:t.deliveryid,bizid:t.bizid,servicetype:1,servicevalue:"标准快递"}),"PJ"===t.deliveryid&&e.push({name:"".concat(t.deliveryname,"-标准快递(").concat(t.bizid,")"),shippingcompany:"".concat(t.deliveryname,"-标准快递"),deliveryid:t.deliveryid,bizid:t.bizid,servicetype:1,servicevalue:"标准快递"}),"SF"===t.deliveryid&&(e.push({name:"".concat(t.deliveryname,"-标准快递(").concat(t.bizid,")"),shippingcompany:"".concat(t.deliveryname,"-标准快递"),deliveryid:t.deliveryid,bizid:t.bizid,servicetype:0,servicevalue:"标准快递"}),e.push({name:"".concat(t.deliveryname,"-顺丰即日(").concat(t.bizid,")"),shippingcompany:"".concat(t.deliveryname,"-顺丰即日"),deliveryid:t.deliveryid,bizid:t.bizid,servicetype:1,servicevalue:"顺丰即日"}),e.push({name:"".concat(t.deliveryname,"-顺丰次晨(").concat(t.bizid,")"),shippingcompany:"".concat(t.deliveryname,"-顺丰次晨"),deliveryid:t.deliveryid,bizid:t.bizid,servicetype:2,servicevalue:"顺丰次晨"}),e.push({name:"".concat(t.deliveryname,"-顺丰标快(").concat(t.bizid,")"),shippingcompany:"".concat(t.deliveryname,"-顺丰标快"),deliveryid:t.deliveryid,bizid:t.bizid,servicetype:3,servicevalue:"顺丰标快"}),e.push({name:"".concat(t.deliveryname,"-顺丰特惠(").concat(t.bizid,")"),shippingcompany:"".concat(t.deliveryname,"-顺丰特惠"),deliveryid:t.deliveryid,bizid:t.bizid,servicetype:4,servicevalue:"顺丰特惠"})),"STO"===t.deliveryid&&e.push({name:"".concat(t.deliveryname,"-标准快递(").concat(t.bizid,")"),shippingcompany:"".concat(t.deliveryname,"-标准快递"),deliveryid:t.deliveryid,bizid:t.bizid,servicetype:1,servicevalue:"标准快递"}),"YTO"===t.deliveryid&&(e.push({name:"".concat(t.deliveryname,"-普通快递(").concat(t.bizid,")"),shippingcompany:"".concat(t.deliveryname,"-普通快递"),deliveryid:t.deliveryid,bizid:t.bizid,servicetype:0,servicevalue:"普通快递"}),e.push({name:"".concat(t.deliveryname,"-圆准达(").concat(t.bizid,")"),shippingcompany:"".concat(t.deliveryname,"-圆准达"),deliveryid:t.deliveryid,bizid:t.bizid,servicetype:1,servicevalue:"圆准达"})),"YUNDA"===t.deliveryid&&e.push({name:"".concat(t.deliveryname,"-标准快件(").concat(t.bizid,")"),shippingcompany:"".concat(t.deliveryname,"-标准快件"),deliveryid:t.deliveryid,bizid:t.bizid,servicetype:0,servicevalue:"标准快件"}),"ZTO"===t.deliveryid&&e.push({name:"".concat(t.deliveryname,"-标准快件(").concat(t.bizid,")"),shippingcompany:"".concat(t.deliveryname,"-标准快件"),deliveryid:t.deliveryid,bizid:t.bizid,servicetype:0,servicevalue:"标准快件"})}),e.push({name:"德邦快递-大件快递3.60(现付)",shippingcompany:"德邦快递-大件快递3.60",deliveryid:"DB",bizid:"DB_CASH",servicetype:1,servicevalue:"大件快递3.60"}),e.push({name:"德邦快递-特准快件(现付)",shippingcompany:"德邦快递-特准快件",deliveryid:"DB",bizid:"DB_CASH",servicetype:2,servicevalue:"特准快件"}),e.push({name:"顺丰速运-标准快递(现付)",shippingcompany:"顺丰速运-标准快递",deliveryid:"SF",bizid:"SF_CASH",servicetype:0,servicevalue:"标准快递"}),e.push({name:"顺丰速运-顺丰即日(现付)",shippingcompany:"顺丰速运-顺丰即日",deliveryid:"SF",bizid:"SF_CASH",servicetype:1,servicevalue:"顺丰即日"}),e.push({name:"顺丰速运-顺丰次晨(现付)",shippingcompany:"顺丰速运-顺丰次晨",deliveryid:"SF",bizid:"SF_CASH",servicetype:2,servicevalue:"顺丰次晨"}),e.push({name:"顺丰速运-顺丰标快(现付)",shippingcompany:"顺丰速运-顺丰标快",deliveryid:"SF",bizid:"SF_CASH",servicetype:3,servicevalue:"顺丰标快"}),e.push({name:"顺丰速运-顺丰特惠(现付)",shippingcompany:"顺丰速运-顺丰特惠",deliveryid:"SF",bizid:"SF_CASH",servicetype:4,servicevalue:"顺丰特惠"}),e.push({name:"商家自配送",shippingcompany:"商家自配送",deliveryid:"",bizid:"",servicetype:0,servicevalue:""}),n.shiplist=e}),e=this.$route.query.id,t.next=5,Object(u["a"])("StoreOrderService.GetOrder",Object(l["a"])("IDWithTokenRequest",{token:Object(l["a"])("Token",{token:m}),id:e}));case 5:return r=t.sent,console.log(r),i=r.orderproductsList.map(function(t){return t.productid}),t.next=10,Promise.all([Object(u["a"])("StoreUserService.GetUser",Object(l["a"])("IDWithTokenRequest",{token:Object(l["a"])("Token",{token:m}),id:r.userid})),Object(u["a"])("StoreProductService.GetProductList",Object(l["a"])("ProductListQueryRequest",{token:Object(l["a"])("Token",{token:m}),idlistList:i,sortby:1,sort:1,count:i.length})),r.marketingidsList.length?Object(u["a"])("StoreMarketingService.GetMarketingList",Object(l["a"])("MarketingListQueryRequest",{token:Object(l["a"])("Token",{token:m}),kind:-1,idlistList:r.marketingidsList,sortby:1,sort:1,count:r.marketingidsList.length})):null,r.couponid?Object(u["a"])("StoreCouponService.GetCoupon",Object(l["a"])("IDWithTokenRequest",{token:Object(l["a"])("Token",{token:m}),id:r.couponid})):null,r.profitsharinguserid?Object(u["a"])("StoreUserService.GetUser",Object(l["a"])("IDWithTokenRequest",{token:Object(l["a"])("Token",{token:m}),id:r.profitsharinguserid})):null]);case 10:return a=t.sent,r.user=a[0],r.orderproductsList.forEach(function(t){t.product=a[1].productlistList.find(function(e){return e.id===t.productid})}),r.marketinglist=a[2]?a[2].marketinglistList:[],r.coupon=a[3],r.profitsharinguser=a[4],i=[],s=[],r.marketinglist.forEach(function(t){2===t.kind&&(0===t.gifttype&&s.push(t.giftid),1===t.gifttype&&i.push(t.giftid))}),t.next=21,Promise.all([s.length?Object(u["a"])("StoreCouponTemplateService.GetCouponTemplateList",Object(l["a"])("CouponTemplateListQueryRequest",{token:Object(l["a"])("Token",{token:m}),idlistList:s,count:s.length})):null,i.length?Object(u["a"])("StoreProductService.GetProductList",Object(l["a"])("ProductListQueryRequest",{token:Object(l["a"])("Token",{token:m}),idlistList:i,sortby:1,sort:1,count:i.length})):null]);case 21:a=t.sent,r.marketinglist.forEach(function(t){t.coupontemplate=null,t.product=null,2===t.kind&&(0===t.gifttype&&(t.coupontemplate=a[0]?a[0].coupontemplatelistList.find(function(e){return e.id===t.giftid}):null),1===t.gifttype&&(t.product=a[1]?a[1].productlistList.find(function(e){return e.id===t.giftid}):null))}),this.order=r;case 24:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),methods:{updateOrder:function(){var t=Object(d["a"])(regeneratorRuntime.mark(function t(e){var r,i=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,3!=this.order.status||2!==e||""==this.order.shippingnumber){t.next=4;break}return t.next=4,this.$confirm("如果再次发货此订单只能选择商家自配送, 确认取消?","确认取消运单?",{confirmButtonText:"确定",cancelButtonText:"取消"});case 4:t.next=9;break;case 6:return t.prev=6,t.t0=t["catch"](0),t.abrupt("return");case 9:if(r=JSON.parse(JSON.stringify(this.order)),r.status=e,3!==e){t.next=16;break}if(null!==this.shipindex){t.next=15;break}return this.$message({message:"请选择物流公司",type:"error"}),t.abrupt("return");case 15:r.shippingcompany=this.shiplist[this.shipindex].shippingcompany;case 16:Object(u["a"])("StoreOrderService.UpdateOrder",Object(l["a"])("OrderWithTokenRequest",Object(c["a"])({token:Object(l["a"])("Token",{token:m}),order:Object(l["a"])("Order",Object(c["a"])({},r,{address:Object(l["a"])("Address",r.address),invoice:Object(l["a"])("Invoice",r.invoice),orderproductsList:r.orderproductsList.map(function(t){return Object(l["a"])("OrderProduct",t)})}))},this.shiplist[this.shipindex]))).then(function(t){i.order.status=t.status,i.order.shippingcompany=t.shippingcompany,i.order.shippingnumber=t.shippingnumber,i.order.updatedat=t.updatedat,i.$message({message:"操作成功",type:"success"})});case 17:case"end":return t.stop()}},t,this,[[0,6]])}));function e(e){return t.apply(this,arguments)}return e}(),getCoupon:function(t){return"¥ -".concat(this.$amount1(t.amount)," (满").concat(this.$amount1(t.reach),"减").concat(this.$amount1(t.amount),")")},getMarketing:function(t){if(1===t.kind)return"¥ -".concat(this.$amount1(t.reduction)," (满").concat(this.$amount1(t.reach),"减").concat(this.$amount1(t.reduction),")");if(2===t.kind){if(1===t.gifttype)return"满".concat(this.$amount1(t.reach),"赠商品: ").concat(t.product.name);var e="";return 0===t.coupontemplate.amount&&(e="¥ ".concat(t.coupontemplate.amountbegin/100," ~ ¥ ").concat(t.coupontemplate.amountend/100)),1===t.coupontemplate.amount&&(e="¥ ".concat(t.coupontemplate.amount/100)),"满".concat(this.$amount1(t.reach),"赠优惠券: ").concat(t.coupontemplate.name,"(").concat(e,")")}return"¥ -".concat(this.$amount1(this.order.originfreight)," (满").concat(this.$amount1(t.reach),"免运费)")},getMarketingLabel:function(t){var e={1:"满减优惠",2:"满赠优惠",3:"满免运费"};return e[t.kind]}}},f=h,y=(r("5c39"),r("5588"),r("2877")),_=Object(y["a"])(f,n,o,!1,null,"df75dff2",null),k=_.exports,x=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("div",{staticClass:"ml-l pl-l"},[r("el-button",{attrs:{size:"small"},on:{click:function(e){t.$router.back()}}},[t._v("返回")])],1),r("comp-wrap",[r("div",[r("div",{staticClass:"header-wrap"},[r("div",[r("h3",{staticClass:"my-l py-l"},[t._v(t._s(t.map[t.order.status]||"非此商城的状态"))]),r("div",[r("span",{staticClass:"color2"},[t._v("订单号: "+t._s(t.order.id))]),t.order.groupuuid?r("span",{staticClass:"member-tag",staticStyle:{padding:"0 4px","margin-right":"5px"}},[t._v(t._s("拼团 ID: "+t.order.groupuuid))]):t._e(),2==t.order.user.isvip?r("span",{staticClass:"member-tag",staticStyle:{padding:"0 4px","margin-right":"5px"}},[t._v("会员")]):t._e(),r("span",{staticClass:"member-tag",staticStyle:{padding:"0 4px","margin-right":"5px"}},[t._v(t._s(t.order.user.nickname)+"("+t._s(t.order.user.mobile)+")")])])]),2==t.order.status?r("div",{staticClass:"header-action"},[r("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){t.updateOrder(3)}}},[t._v("\n            全部核销\n          ")]),r("div",{staticClass:"color3 mt-l pt-l"},[t._v("请与用户确认无误后再确认核销")])],1):t._e()])]),12===t.order.status?r("div",{staticClass:"order-detail_banner"},[r("div",{staticClass:"detail-banner_text"},[r("span",[t._v("买家申请退款")])]),r("div",[r("el-button",{attrs:{size:"small",type:"info"},on:{click:function(e){t.updateOrder(2)}}},[t._v("拒绝退款")]),r("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){t.updateOrder(8)}}},[t._v("确认退款")])],1)]):t._e(),2!==t.order.status||t.order.orderproductsList.find(function(t){return 2==t.confirmed})?t._e():r("div",{staticClass:"order-detail_banner"},[r("div",{staticClass:"detail-banner_text"},[r("span",[t._v("直接退款")]),r("span",{staticClass:"detail-banner_sub-text"},[t._v("如果因为无法提供服务等原因, 您可以直接直接退款取消订单")])]),r("div",[r("el-button",{attrs:{size:"small",type:"info"},on:{click:function(e){t.updateOrder(8)}}},[t._v("直接退款")])],1)]),r("comp-list",{attrs:{text:"¥ "+t.$amount1(t.order.amount),label:"商品合计"}}),t.order.couponid?r("comp-list",{attrs:{text:t.getCoupon(t.order.coupon),label:"使用优惠券"}}):t._e(),t._l(t.order.marketinglist,function(e){return r("comp-list",{key:e.id,attrs:{label:t.getMarketingLabel(e),text:t.getMarketing(e)}})}),r("comp-list",{attrs:{text:"¥ "+t.$amount1(t.order.actualamount+t.order.freight),gutter:"",label:"实际支付"}}),r("comp-list",{attrs:{gutter:!t.order.needinvoice,text:t.order.note,label:"买家备注"}}),1==t.order.needinvoice?r("comp-list",{attrs:{text:0===t.order.invoice.kind?"个人":"单位",label:"发票类型",nomb:""}}):t._e(),1==t.order.needinvoice?r("comp-list",{attrs:{text:t.order.invoice.name,label:"发票抬头",nomb:""}}):t._e(),1==t.order.needinvoice?r("comp-list",{attrs:{text:t.order.invoice.taxid,gutter:"",label:"发票税号",nomb:""}}):t._e(),r("div",{staticClass:"g-b",staticStyle:{border:"1px solid #e9e9e9","margin-left":"-10px","margin-right":"-10px"}},t._l(t.order.orderproductsList,function(e){return r("div",{key:e.id,staticClass:"product"},[r("div",{staticClass:"product-info"},[r("div",{staticClass:"product-img",on:{click:function(r){t.$router.push({name:"products-edit",query:{id:e.productid,type:"edit"}})}}},[r("comp-imger",{attrs:{src:e.product.imagesList.length?e.product.imagesList[0]:""}})],1),r("div",[r("div",{staticClass:"product-name"},[t._v(t._s(e.product.name))])])]),r("div",{staticClass:"price"},[t._v(t._s(t.$amount1(e.amount))+" 元")]),r("div",{staticClass:"count"},[t._v(t._s(e.quantity)+" 个")]),2==t.order.status||4==t.order.status?r("div",{staticClass:"count",staticStyle:{width:"200px","flex-direction":"column"}},[1==e.confirmed?r("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(r){t.updateOrderProduct(e,2)}}},[t._v("核销")]):t._e(),2==e.confirmed?r("div",[t._v("\n            已核销\n          ")]):t._e(),2==e.confirmed?r("div",[t._v("\n            "+t._s(new Date(1e3*e.updatedat).toLocaleString("zh-CN",{timeZone:"Asia/Shanghai"}))+"\n          ")]):t._e()],1):t._e(),2!=t.order.status&&4!=t.order.status?r("div",{staticClass:"count",staticStyle:{width:"200px","flex-direction":"column"}},[t._v("\n          /\n        ")]):t._e()])})),r("comp-list",{attrs:{text:new Date(1e3*t.order.createdat).toLocaleString("zh-CN",{timeZone:"Asia/Shanghai"}),label:"下单时间"}}),r("comp-list",{attrs:{text:new Date(1e3*t.order.updatedat).toLocaleString("zh-CN",{timeZone:"Asia/Shanghai"}),label:"最后更新"}}),0!=t.order.status&&6!=t.order.status?r("comp-list",{attrs:{text:new Date(1e3*t.order.paidat).toLocaleString("zh-CN",{timeZone:"Asia/Shanghai"}),label:"支付时间"}}):t._e(),1==t.order.payway?r("comp-list",{attrs:{text:t.order.transactionid,label:"微信流水号"}}):t._e(),1==t.order.payway?r("comp-list",{attrs:{text:"微信支付",label:"支付方式"}}):t._e(),2==t.order.payway?r("comp-list",{attrs:{text:"余额支付",label:"支付方式"}}):t._e(),0===t.order.brokeragestatus?r("comp-list",{attrs:{text:"无",label:"有无分账"}}):t._e(),0!==t.order.brokeragestatus?r("comp-list",{attrs:{text:"有",label:"有无分账"}}):t._e(),t.order.profitsharinguserid?r("comp-list",{attrs:{text:t.order.profitsharinguser.nickname+"("+t.order.profitsharinguser.mobile+")",label:"分销员"}}):t._e(),0!==t.order.brokerage?r("comp-list",{attrs:{text:t.order.brokerage/100,label:"分销员佣金"}}):t._e(),1!==t.order.brokeragestatus||0!=t.order.status&&1!=t.order.status&&2!=t.order.status&&3!=t.order.status&&4!=t.order.status?t._e():r("comp-list",{attrs:{text:"未结算",label:"分账结算"}}),2===t.order.brokeragestatus?r("comp-list",{attrs:{text:"已结算",label:"分账结算"}}):t._e(),3===t.order.brokeragestatus?r("comp-list",{attrs:{text:"未结算(结算失败)",label:"分账结算"}}):t._e(),1===t.order.brokeragestatus&&0!=t.order.status&&1!=t.order.status&&2!=t.order.status&&3!=t.order.status&&4!=t.order.status?r("comp-list",{attrs:{text:"未结算(结算无效)",label:"分账结算"}}):t._e()],2)],1)},O=[],S=(r("20d6"),""),C={functional:!0,render:function(t,e){return t("div",{class:"container"},[t("div",{class:"wrap"},[e.children])])}},j={functional:!0,props:["label","text","gutter","nomb"],render:function(t,e){var r=e.props,i=r.label,a=r.text,s=r.gutter,n=r.nomb,o=["info"];return void 0!==s&&o.push("g-b"),void 0!==n&&void 0===s&&o.push("nomb"),t("div",{class:o.join(" ")},[t("div",{class:"color1 mr-l pr-l title"},[i]),t("div",{class:"color1 ml-l pl-l text"},[a])])}},L={0:"等待买家支付",1:"拼团中",2:"待核销",4:"已核销",5:"团购失败",6:"买家已取消订单",8:"已退款",12:"买家申请退款"},z={components:{"comp-list":j,"comp-wrap":C},data:function(){return{map:L,order:{address:{},invoice:{},marketinglist:[],orderproductsList:[],user:{},coupon:{}}}},created:function(){var t=Object(d["a"])(regeneratorRuntime.mark(function t(){var e,r,i,a,s;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return S=Object(p["e"])(),e=this.$route.query.id,t.next=4,Object(u["a"])("StoreOrderService.GetOrder",Object(l["a"])("IDWithTokenRequest",{token:Object(l["a"])("Token",{token:S}),id:e}));case 4:return r=t.sent,i=r.orderproductsList.map(function(t){return t.productid}),t.next=8,Promise.all([Object(u["a"])("StoreUserService.GetUser",Object(l["a"])("IDWithTokenRequest",{token:Object(l["a"])("Token",{token:S}),id:r.userid})),Object(u["a"])("StoreProductService.GetProductList",Object(l["a"])("ProductListQueryRequest",{token:Object(l["a"])("Token",{token:S}),idlistList:i,sortby:1,sort:1,count:i.length})),r.marketingidsList.length?Object(u["a"])("StoreMarketingService.GetMarketingList",Object(l["a"])("MarketingListQueryRequest",{token:Object(l["a"])("Token",{token:S}),kind:-1,idlistList:r.marketingidsList,sortby:1,sort:1,count:r.marketingidsList.length})):null,r.couponid?Object(u["a"])("StoreCouponService.GetCoupon",Object(l["a"])("IDWithTokenRequest",{token:Object(l["a"])("Token",{token:S}),id:r.couponid})):null,r.profitsharinguserid?Object(u["a"])("StoreUserService.GetUser",Object(l["a"])("IDWithTokenRequest",{token:Object(l["a"])("Token",{token:S}),id:r.profitsharinguserid})):null]);case 8:return a=t.sent,r.user=a[0],r.orderproductsList.forEach(function(t){t.product=a[1].productlistList.find(function(e){return e.id===t.productid})}),r.marketinglist=a[2]?a[2].marketinglistList:[],r.coupon=a[3],r.profitsharinguser=a[4],i=[],s=[],r.marketinglist.forEach(function(t){2===t.kind&&(0===t.gifttype&&s.push(t.giftid),1===t.gifttype&&i.push(t.giftid))}),t.next=19,Promise.all([s.length?Object(u["a"])("StoreCouponTemplateService.GetCouponTemplateList",Object(l["a"])("CouponTemplateListQueryRequest",{token:Object(l["a"])("Token",{token:S}),idlistList:s,count:s.length})):null,i.length?Object(u["a"])("StoreProductService.GetProductList",Object(l["a"])("ProductListQueryRequest",{token:Object(l["a"])("Token",{token:S}),idlistList:i,sortby:1,sort:1,count:i.length})):null]);case 19:a=t.sent,r.marketinglist.forEach(function(t){t.coupontemplate=null,t.product=null,2===t.kind&&(0===t.gifttype&&(t.coupontemplate=a[0]?a[0].coupontemplatelistList.find(function(e){return e.id===t.giftid}):null),1===t.gifttype&&(t.product=a[1]?a[1].productlistList.find(function(e){return e.id===t.giftid}):null))}),this.order=r;case 22:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),methods:{updateOrder:function(t){var e=this,r=JSON.parse(JSON.stringify(this.order));r.status=t,Object(u["a"])("StoreOrderService.UpdateOrder",Object(l["a"])("OrderWithTokenRequest",{token:Object(l["a"])("Token",{token:S}),order:Object(l["a"])("Order",Object(c["a"])({},r,{address:Object(l["a"])("Address",r.address),invoice:Object(l["a"])("Invoice",r.invoice),orderproductsList:r.orderproductsList.map(function(t){return Object(l["a"])("OrderProduct",t)})}))})).then(function(r){e.order.status=3==t?4:r.status,e.order.updatedat=r.updatedat,e.order.orderproductsList=e.order.orderproductsList.map(function(t){return 2===t.confirmed?t:(t.confirmed=2,t.updatedat=parseInt(Date.now()/1e3),t)}),e.$message({message:"操作成功",type:"success"})})},updateOrderProduct:function(t,e){var r=this;t=JSON.parse(JSON.stringify(t)),t.confirmed=e,Object(u["a"])("StoreOrderService.UpdateOrderProduct",Object(l["a"])("OrderProductWithTokenRequest",{token:Object(l["a"])("Token",{token:S}),orderproduct:Object(l["a"])("OrderProduct",t)})).then(function(e){t.updatedat=e.updatedat;var i=r.order.orderproductsList.findIndex(function(e){return e.id===t.id});r.order.orderproductsList.splice(i,1,t),r.order.orderproductsList.find(function(t){return 2!=t.confirmed})||(r.order.status=4,r.order.updatedat=e.updatedat),r.$message({message:"操作成功",type:"success"})})},getCoupon:function(t){return"¥ -".concat(this.$amount1(t.amount)," (满").concat(this.$amount1(t.reach),"减").concat(this.$amount1(t.amount),")")},getMarketing:function(t){if(1===t.kind)return"¥ -".concat(this.$amount1(t.reduction)," (满").concat(this.$amount1(t.reach),"减").concat(this.$amount1(t.reduction),")");if(2===t.kind){if(1===t.gifttype)return"满".concat(this.$amount1(t.reach),"赠商品: ").concat(t.product.name);var e="";return 0===t.coupontemplate.amount&&(e="¥ ".concat(t.coupontemplate.amountbegin/100," ~ ¥ ").concat(t.coupontemplate.amountend/100)),1===t.coupontemplate.amount&&(e="¥ ".concat(t.coupontemplate.amount/100)),"满".concat(this.$amount1(t.reach),"赠优惠券: ").concat(t.coupontemplate.name,"(").concat(e,")")}return"¥ -".concat(this.$amount1(this.order.originfreight)," (满").concat(this.$amount1(t.reach),"免运费)")},getMarketingLabel:function(t){var e={1:"满减优惠",2:"满赠优惠",3:"满免运费"};return e[t.kind]}}},T=z,w=(r("fe3b"),r("7895"),Object(y["a"])(T,x,O,!1,null,"66bab8f4",null)),$=w.exports,D=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("div",{staticClass:"ml-l pl-l"},[r("el-button",{attrs:{size:"small"},on:{click:function(e){t.$router.back()}}},[t._v("返回")])],1),r("comp-wrap",[r("div",[r("div",{staticClass:"header-wrap"},[r("div",[r("h3",{staticClass:"my-l py-l"},[t._v(t._s(t.map[t.order.status]||"非此商城的状态"))]),r("div",[r("span",{staticClass:"color2"},[t._v("订单号: "+t._s(t.order.id))]),t.order.groupuuid?r("span",{staticClass:"member-tag",staticStyle:{padding:"0 4px","margin-right":"5px"}},[t._v(t._s("拼团 ID: "+t.order.groupuuid+" "+(2===t.order.grouplead?"团长代收":"单独发货")))]):t._e(),2==t.order.user.isvip?r("span",{staticClass:"member-tag",staticStyle:{padding:"0 4px","margin-right":"5px"}},[t._v("会员")]):t._e(),r("span",{staticClass:"member-tag",staticStyle:{padding:"0 4px","margin-right":"5px"}},[t._v(t._s(t.order.user.nickname)+"("+t._s(t.order.user.mobile)+")")])])]),2==t.order.status?r("div",{staticClass:"header-action"},[r("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){t.updateOrder(3)}}},[t._v("\n            确认发货\n          ")]),r("div",{staticClass:"color3 mt-l pt-l"},[t._v("选择物流公司，即可确认发货")])],1):t._e(),3==t.order.status?r("div",{staticClass:"header-action"},[r("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){t.updateOrder(2)}}},[t._v("\n            取消运单\n          ")]),r("div",{staticClass:"color3 mt-l pt-l"},[t._v("如果快递公司无法进行配送")])],1):t._e()])]),12===t.order.status?r("div",{staticClass:"order-detail_banner"},[r("div",{staticClass:"detail-banner_text"},[r("span",[t._v("买家申请退款")]),r("span",{staticClass:"detail-banner_sub-text"},[t._v("未发货状态下买家申请退款")])]),r("div",[r("el-button",{attrs:{size:"small",type:"info"},on:{click:function(e){t.updateOrder(2)}}},[t._v("拒绝退款")]),r("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){t.updateOrder(8)}}},[t._v("确认退款")])],1)]):t._e(),2===t.order.status?r("div",{staticClass:"order-detail_banner"},[r("div",{staticClass:"detail-banner_text"},[r("span",[t._v("直接退款")]),r("span",{staticClass:"detail-banner_sub-text"},[t._v("如果因为库存不足等原因无法发货, 您可以直接直接退款取消订单")])]),r("div",[r("el-button",{attrs:{size:"small",type:"info"},on:{click:function(e){t.updateOrder(8)}}},[t._v("直接退款")])],1)]):t._e(),7===t.order.status?r("div",{staticClass:"order-detail_banner"},[r("div",{staticClass:"detail-banner_text"},[r("span",[t._v("已同意买家退货申请")]),r("span",{staticClass:"detail-banner_sub-text"},[t._v("等待买家寄回商品, 确认退回商品无问题后点击「确认收到」发起退款")])]),r("div",[r("el-button",{attrs:{size:"small",type:"info"},on:{click:function(e){t.updateOrder(11)}}},[t._v("未收到")]),r("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){t.updateOrder(8)}}},[t._v("确认收到")])],1)]):t._e(),9===t.order.status?r("div",{staticClass:"order-detail_banner"},[r("div",{staticClass:"detail-banner_text"},[t._v("买家申请退货")]),r("div",[r("el-button",{attrs:{size:"small",type:"info"},on:{click:function(e){t.updateOrder(7)}}},[t._v("同意退货")]),r("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){t.updateOrder(10)}}},[t._v("拒绝退货")])],1)]):t._e(),r("div",{staticClass:"address-box"},[r("h5",{staticClass:"mb-l pb-l mt-s pt-s"},[t._v("配送信息")]),r("el-row",{attrs:{align:"middle",type:"flex"}},[r("el-col",{staticClass:"color1",attrs:{span:"2"}},[t._v("配送地址")]),r("el-col",{staticClass:"color1",attrs:{offset:"1",span:"6"}},[t._v(t._s(t.order.address.name)+", "+t._s(t.order.address.mobile))])],1),r("el-row",{staticStyle:{"margin-top":"5px"},attrs:{align:"middle",type:"flex"}},[r("el-col",{attrs:{span:"2"}},[r("el-button",{staticStyle:{padding:"2px 10px","font-size":"10px"},attrs:{size:"small",type:"info"}},[t._v("复制")])],1),r("el-col",{staticClass:"color1",attrs:{offset:"1",span:"6"}},[t._v(t._s(t.order.address.province)+" "+t._s(t.order.address.city)+" "+t._s(t.order.address.district)+" "+t._s(t.order.address.address))])],1),2===t.order.status?r("el-row",{staticStyle:{"margin-top":"5px"},attrs:{align:"middle",type:"flex"}},[r("el-col",{staticClass:"color1 my",attrs:{span:"1"}},[t._v("物流信息")]),r("el-col",{attrs:{offset:"1",span:"3"}},[r("el-select",{attrs:{placeholder:"请选择物流公司"},model:{value:t.shipindex,callback:function(e){t.shipindex=e},expression:"shipindex"}},t._l(t.shiplist,function(t,e){return r("el-option",{key:e,attrs:{label:t.name,value:e}})}))],1)],1):t._e()],1),t.order.shippingcompany?r("comp-list",{attrs:{text:t.order.shippingcompany,label:"发货物流公司"}}):t._e(),t.order.shippingnumber?r("comp-list",{attrs:{text:t.order.shippingnumber,gutter:"",label:"发货物流单号"}}):t._e(),t.order.returnshippingcompany?r("comp-list",{attrs:{text:t.order.returnshippingcompany,label:"退货物流公司"}}):t._e(),t.order.returnshippingnumber?r("comp-list",{attrs:{text:t.order.returnshippingnumber,gutter:"",label:"退货物流单号"}}):t._e(),r("comp-list",{attrs:{text:"¥ "+t.$amount1(t.order.amount),label:"商品合计"}}),t.order.couponid?r("comp-list",{attrs:{text:t.getCoupon(t.order.coupon),label:"使用优惠券"}}):t._e(),r("comp-list",{attrs:{text:"¥ "+t.$amount1(t.order.originfreight),label:"配送费"}}),t._l(t.order.marketinglist,function(e){return r("comp-list",{key:e.id,attrs:{label:t.getMarketingLabel(e),text:t.getMarketing(e)}})}),r("comp-list",{attrs:{text:"¥ "+t.$amount1(t.order.actualamount+t.order.freight),gutter:"",label:"实际支付"}}),r("comp-list",{attrs:{gutter:!t.order.needinvoice,text:t.order.note,label:"买家备注"}}),r("comp-list",{attrs:{text:t.order.giftnote,label:"礼卡祝福语"}}),1==t.order.needinvoice?r("comp-list",{attrs:{text:0===t.order.invoice.kind?"个人":"单位",label:"发票类型",nomb:""}}):t._e(),1==t.order.needinvoice?r("comp-list",{attrs:{text:t.order.invoice.name,label:"发票抬头",nomb:""}}):t._e(),1==t.order.needinvoice?r("comp-list",{attrs:{text:t.order.invoice.taxid,gutter:"",label:"发票税号",nomb:""}}):t._e(),r("div",{staticClass:"g-b",staticStyle:{border:"1px solid #e9e9e9","margin-left":"-10px","margin-right":"-10px"}},t._l(t.order.orderproductsList,function(e){return r("div",{key:e.id,staticClass:"product"},[r("div",{staticClass:"product-info"},[r("div",{staticClass:"product-img",on:{click:function(r){t.$router.push({name:"products-edit",query:{id:e.productid,type:"edit"}})}}},[r("comp-imger",{attrs:{src:e.product.imagesList.length?e.product.imagesList[0]:""}})],1),r("div",[r("div",{staticClass:"product-name"},[t._v(t._s(e.product.name))]),r("div",{staticClass:"product-desc"},[t._v(t._s(e.optionname&&"("+Object.values(JSON.parse(e.optionname)).join(", ")+")"))])])]),r("div",{staticClass:"price"},[t._v(t._s(t.$amount1(e.amount))+" 元")]),r("div",{staticClass:"count"},[t._v(t._s(e.quantity)+" 个")])])})),r("comp-list",{attrs:{text:new Date(1e3*t.order.createdat).toLocaleString("zh-CN",{timeZone:"Asia/Shanghai"}),label:"下单时间"}}),r("comp-list",{attrs:{text:new Date(1e3*t.order.updatedat).toLocaleString("zh-CN",{timeZone:"Asia/Shanghai"}),label:"最后更新"}}),0!=t.order.status&&6!=t.order.status?r("comp-list",{attrs:{text:new Date(1e3*t.order.paidat).toLocaleString("zh-CN",{timeZone:"Asia/Shanghai"}),label:"支付时间"}}):t._e(),1==t.order.payway?r("comp-list",{attrs:{text:t.order.transactionid,label:"微信流水号"}}):t._e(),1==t.order.payway?r("comp-list",{attrs:{text:"微信支付",label:"支付方式"}}):t._e(),2==t.order.payway?r("comp-list",{attrs:{text:"余额支付",label:"支付方式"}}):t._e(),0===t.order.brokeragestatus?r("comp-list",{attrs:{text:"无",label:"有无分账"}}):t._e(),0!==t.order.brokeragestatus?r("comp-list",{attrs:{text:"有",label:"有无分账"}}):t._e(),t.order.profitsharinguserid?r("comp-list",{attrs:{text:t.order.profitsharinguser.nickname+"("+t.order.profitsharinguser.mobile+")",label:"分销员"}}):t._e(),0!==t.order.brokerage?r("comp-list",{attrs:{text:t.order.brokerage/100,label:"分销员佣金"}}):t._e(),1!==t.order.brokeragestatus||0!=t.order.status&&1!=t.order.status&&2!=t.order.status&&3!=t.order.status&&4!=t.order.status?t._e():r("comp-list",{attrs:{text:"未结算",label:"分账结算"}}),2===t.order.brokeragestatus?r("comp-list",{attrs:{text:"已结算",label:"分账结算"}}):t._e(),3===t.order.brokeragestatus?r("comp-list",{attrs:{text:"未结算(结算失败)",label:"分账结算"}}):t._e(),1===t.order.brokeragestatus&&0!=t.order.status&&1!=t.order.status&&2!=t.order.status&&3!=t.order.status&&4!=t.order.status?r("comp-list",{attrs:{text:"未结算(结算无效)",label:"分账结算"}}):t._e()],2)],1)},R=[],q="",P={functional:!0,render:function(t,e){return t("div",{class:"container"},[t("div",{class:"wrap"},[e.children])])}},G={functional:!0,props:["label","text","gutter","nomb"],render:function(t,e){var r=e.props,i=r.label,a=r.text,s=r.gutter,n=r.nomb,o=["info"];return void 0!==s&&o.push("g-b"),void 0!==n&&void 0===s&&o.push("nomb"),t("div",{class:o.join(" ")},[t("div",{class:"color1 mr-l pr-l title"},[i]),t("div",{class:"color1 ml-l pl-l text"},[a])])}},N={0:"等待买家支付",1:"拼团中",2:"待发货",3:"等待买家收货",4:"买家已收货",5:"团购失败",6:"买家已取消订单",7:"退货中",8:"已退款",9:"买家申请退货",10:"拒绝买家退货",11:"同意退货但拒绝退款",12:"买家申请退款"},I={components:{"comp-list":G,"comp-wrap":P},data:function(){return{shiplist:[],shipindex:null,map:N,order:{address:{},invoice:{},marketinglist:[],orderproductsList:[],user:{},coupon:{}}}},created:function(){var t=Object(d["a"])(regeneratorRuntime.mark(function t(){var e,r,i,a,s,n=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return q=Object(p["e"])(),Object(u["a"])("StoreDeliveryService.GetDeliveryList",Object(l["a"])("DeliveryListQueryRequest",{token:Object(l["a"])("Token",{token:q}),count:100})).then(function(t){var e=[];t.deliverylistList.forEach(function(t){"BEST"===t.deliveryid&&e.push({name:"".concat(t.deliveryname,"-标准快递(").concat(t.bizid,")"),shippingcompany:"".concat(t.deliveryname,"-标准快递"),deliveryid:t.deliveryid,bizid:t.bizid,servicetype:1,servicevalue:"标准快递"}),"DB"===t.deliveryid&&(e.push({name:"".concat(t.deliveryname,"-大件快递3.60(").concat(t.bizid,")"),shippingcompany:"".concat(t.deliveryname,"-大件快递3.60"),deliveryid:t.deliveryid,bizid:t.bizid,servicetype:1,servicevalue:"大件快递3.60"}),e.push({name:"".concat(t.deliveryname,"-特准快件(").concat(t.bizid,")"),shippingcompany:"".concat(t.deliveryname,"-特准快件"),deliveryid:t.deliveryid,bizid:t.bizid,servicetype:2,servicevalue:"特准快件"})),"EMS"===t.deliveryid&&(e.push({name:"".concat(t.deliveryname,"-标准快递(").concat(t.bizid,")"),shippingcompany:"".concat(t.deliveryname,"-标准快递"),deliveryid:t.deliveryid,bizid:t.bizid,servicetype:6,servicevalue:"标准快递"}),e.push({name:"".concat(t.deliveryname,"-快递包裹(").concat(t.bizid,")"),shippingcompany:"".concat(t.deliveryname,"-快递包裹"),deliveryid:t.deliveryid,bizid:t.bizid,servicetype:9,servicevalue:"快递包裹"})),"OTP"===t.deliveryid&&e.push({name:"".concat(t.deliveryname,"-标准快递(").concat(t.bizid,")"),shippingcompany:"".concat(t.deliveryname,"-标准快递"),deliveryid:t.deliveryid,bizid:t.bizid,servicetype:1,servicevalue:"标准快递"}),"PJ"===t.deliveryid&&e.push({name:"".concat(t.deliveryname,"-标准快递(").concat(t.bizid,")"),shippingcompany:"".concat(t.deliveryname,"-标准快递"),deliveryid:t.deliveryid,bizid:t.bizid,servicetype:1,servicevalue:"标准快递"}),"SF"===t.deliveryid&&(e.push({name:"".concat(t.deliveryname,"-标准快递(").concat(t.bizid,")"),shippingcompany:"".concat(t.deliveryname,"-标准快递"),deliveryid:t.deliveryid,bizid:t.bizid,servicetype:0,servicevalue:"标准快递"}),e.push({name:"".concat(t.deliveryname,"-顺丰即日(").concat(t.bizid,")"),shippingcompany:"".concat(t.deliveryname,"-顺丰即日"),deliveryid:t.deliveryid,bizid:t.bizid,servicetype:1,servicevalue:"顺丰即日"}),e.push({name:"".concat(t.deliveryname,"-顺丰次晨(").concat(t.bizid,")"),shippingcompany:"".concat(t.deliveryname,"-顺丰次晨"),deliveryid:t.deliveryid,bizid:t.bizid,servicetype:2,servicevalue:"顺丰次晨"}),e.push({name:"".concat(t.deliveryname,"-顺丰标快(").concat(t.bizid,")"),shippingcompany:"".concat(t.deliveryname,"-顺丰标快"),deliveryid:t.deliveryid,bizid:t.bizid,servicetype:3,servicevalue:"顺丰标快"}),e.push({name:"".concat(t.deliveryname,"-顺丰特惠(").concat(t.bizid,")"),shippingcompany:"".concat(t.deliveryname,"-顺丰特惠"),deliveryid:t.deliveryid,bizid:t.bizid,servicetype:4,servicevalue:"顺丰特惠"})),"STO"===t.deliveryid&&e.push({name:"".concat(t.deliveryname,"-标准快递(").concat(t.bizid,")"),shippingcompany:"".concat(t.deliveryname,"-标准快递"),deliveryid:t.deliveryid,bizid:t.bizid,servicetype:1,servicevalue:"标准快递"}),"YTO"===t.deliveryid&&(e.push({name:"".concat(t.deliveryname,"-普通快递(").concat(t.bizid,")"),shippingcompany:"".concat(t.deliveryname,"-普通快递"),deliveryid:t.deliveryid,bizid:t.bizid,servicetype:0,servicevalue:"普通快递"}),e.push({name:"".concat(t.deliveryname,"-圆准达(").concat(t.bizid,")"),shippingcompany:"".concat(t.deliveryname,"-圆准达"),deliveryid:t.deliveryid,bizid:t.bizid,servicetype:1,servicevalue:"圆准达"})),"YUNDA"===t.deliveryid&&e.push({name:"".concat(t.deliveryname,"-标准快件(").concat(t.bizid,")"),shippingcompany:"".concat(t.deliveryname,"-标准快件"),deliveryid:t.deliveryid,bizid:t.bizid,servicetype:0,servicevalue:"标准快件"}),"ZTO"===t.deliveryid&&e.push({name:"".concat(t.deliveryname,"-标准快件(").concat(t.bizid,")"),shippingcompany:"".concat(t.deliveryname,"-标准快件"),deliveryid:t.deliveryid,bizid:t.bizid,servicetype:0,servicevalue:"标准快件"})}),e.push({name:"德邦快递-大件快递3.60(现付)",shippingcompany:"德邦快递-大件快递3.60",deliveryid:"DB",bizid:"DB_CASH",servicetype:1,servicevalue:"大件快递3.60"}),e.push({name:"德邦快递-特准快件(现付)",shippingcompany:"德邦快递-特准快件",deliveryid:"DB",bizid:"DB_CASH",servicetype:2,servicevalue:"特准快件"}),e.push({name:"顺丰速运-标准快递(现付)",shippingcompany:"顺丰速运-标准快递",deliveryid:"SF",bizid:"SF_CASH",servicetype:0,servicevalue:"标准快递"}),e.push({name:"顺丰速运-顺丰即日(现付)",shippingcompany:"顺丰速运-顺丰即日",deliveryid:"SF",bizid:"SF_CASH",servicetype:1,servicevalue:"顺丰即日"}),e.push({name:"顺丰速运-顺丰次晨(现付)",shippingcompany:"顺丰速运-顺丰次晨",deliveryid:"SF",bizid:"SF_CASH",servicetype:2,servicevalue:"顺丰次晨"}),e.push({name:"顺丰速运-顺丰标快(现付)",shippingcompany:"顺丰速运-顺丰标快",deliveryid:"SF",bizid:"SF_CASH",servicetype:3,servicevalue:"顺丰标快"}),e.push({name:"顺丰速运-顺丰特惠(现付)",shippingcompany:"顺丰速运-顺丰特惠",deliveryid:"SF",bizid:"SF_CASH",servicetype:4,servicevalue:"顺丰特惠"}),e.push({name:"商家自配送",shippingcompany:"商家自配送",deliveryid:"",bizid:"",servicetype:0,servicevalue:""}),n.shiplist=e}),e=this.$route.query.id,t.next=5,Object(u["a"])("StoreOrderService.GetOrder",Object(l["a"])("IDWithTokenRequest",{token:Object(l["a"])("Token",{token:q}),id:e}));case 5:return r=t.sent,i=r.orderproductsList.map(function(t){return t.productid}),t.next=9,Promise.all([Object(u["a"])("StoreUserService.GetUser",Object(l["a"])("IDWithTokenRequest",{token:Object(l["a"])("Token",{token:q}),id:r.userid})),Object(u["a"])("StoreProductService.GetProductList",Object(l["a"])("ProductListQueryRequest",{token:Object(l["a"])("Token",{token:q}),idlistList:i,sortby:1,sort:1,count:i.length})),r.marketingidsList.length?Object(u["a"])("StoreMarketingService.GetMarketingList",Object(l["a"])("MarketingListQueryRequest",{token:Object(l["a"])("Token",{token:q}),kind:-1,idlistList:r.marketingidsList,sortby:1,sort:1,count:r.marketingidsList.length})):null,r.couponid?Object(u["a"])("StoreCouponService.GetCoupon",Object(l["a"])("IDWithTokenRequest",{token:Object(l["a"])("Token",{token:q}),id:r.couponid})):null,r.profitsharinguserid?Object(u["a"])("StoreUserService.GetUser",Object(l["a"])("IDWithTokenRequest",{token:Object(l["a"])("Token",{token:q}),id:r.profitsharinguserid})):null]);case 9:return a=t.sent,r.user=a[0],r.orderproductsList.forEach(function(t){t.product=a[1].productlistList.find(function(e){return e.id===t.productid})}),r.marketinglist=a[2]?a[2].marketinglistList:[],r.coupon=a[3],r.profitsharinguser=a[4],i=[],s=[],r.marketinglist.forEach(function(t){2===t.kind&&(0===t.gifttype&&s.push(t.giftid),1===t.gifttype&&i.push(t.giftid))}),t.next=20,Promise.all([s.length?Object(u["a"])("StoreCouponTemplateService.GetCouponTemplateList",Object(l["a"])("CouponTemplateListQueryRequest",{token:Object(l["a"])("Token",{token:q}),idlistList:s,count:s.length})):null,i.length?Object(u["a"])("StoreProductService.GetProductList",Object(l["a"])("ProductListQueryRequest",{token:Object(l["a"])("Token",{token:q}),idlistList:i,sortby:1,sort:1,count:i.length})):null]);case 20:a=t.sent,r.marketinglist.forEach(function(t){t.coupontemplate=null,t.product=null,2===t.kind&&(0===t.gifttype&&(t.coupontemplate=a[0]?a[0].coupontemplatelistList.find(function(e){return e.id===t.giftid}):null),1===t.gifttype&&(t.product=a[1]?a[1].productlistList.find(function(e){return e.id===t.giftid}):null))}),this.order=r;case 23:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),methods:{updateOrder:function(){var t=Object(d["a"])(regeneratorRuntime.mark(function t(e){var r,i=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,3!=this.order.status||2!==e||""==this.order.shippingnumber){t.next=4;break}return t.next=4,this.$confirm("如果再次发货此订单只能选择商家自配送, 确认取消?","确认取消运单?",{confirmButtonText:"确定",cancelButtonText:"取消"});case 4:t.next=9;break;case 6:return t.prev=6,t.t0=t["catch"](0),t.abrupt("return");case 9:if(r=JSON.parse(JSON.stringify(this.order)),r.status=e,3!==e){t.next=16;break}if(null!==this.shipindex){t.next=15;break}return this.$message({message:"请选择物流公司",type:"error"}),t.abrupt("return");case 15:r.shippingcompany=this.shiplist[this.shipindex].shippingcompany;case 16:Object(u["a"])("StoreOrderService.UpdateOrder",Object(l["a"])("OrderWithTokenRequest",Object(c["a"])({token:Object(l["a"])("Token",{token:q}),order:Object(l["a"])("Order",Object(c["a"])({},r,{address:Object(l["a"])("Address",r.address),invoice:Object(l["a"])("Invoice",r.invoice),orderproductsList:r.orderproductsList.map(function(t){return Object(l["a"])("OrderProduct",t)})}))},this.shiplist[this.shipindex]))).then(function(t){i.order.status=t.status,i.order.shippingcompany=t.shippingcompany,i.order.shippingnumber=t.shippingnumber,i.order.updatedat=t.updatedat,i.$message({message:"操作成功",type:"success"})});case 17:case"end":return t.stop()}},t,this,[[0,6]])}));function e(e){return t.apply(this,arguments)}return e}(),getCoupon:function(t){return"¥ -".concat(this.$amount1(t.amount)," (满").concat(this.$amount1(t.reach),"减").concat(this.$amount1(t.amount),")")},getMarketing:function(t){if(1===t.kind)return"¥ -".concat(this.$amount1(t.reduction)," (满").concat(this.$amount1(t.reach),"减").concat(this.$amount1(t.reduction),")");if(2===t.kind){if(1===t.gifttype)return"满".concat(this.$amount1(t.reach),"赠商品: ").concat(t.product.name);var e="";return 0===t.coupontemplate.amount&&(e="¥ ".concat(t.coupontemplate.amountbegin/100," ~ ¥ ").concat(t.coupontemplate.amountend/100)),1===t.coupontemplate.amount&&(e="¥ ".concat(t.coupontemplate.amount/100)),"满".concat(this.$amount1(t.reach),"赠优惠券: ").concat(t.coupontemplate.name,"(").concat(e,")")}return"¥ -".concat(this.$amount1(this.order.originfreight)," (满").concat(this.$amount1(t.reach),"免运费)")},getMarketingLabel:function(t){var e={1:"满减优惠",2:"满赠优惠",3:"满免运费"};return e[t.kind]}}},A=I,M=(r("1f27"),r("29de"),Object(y["a"])(A,D,R,!1,null,"eab12788",null)),W=M.exports,U=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("div",{staticClass:"ml-l pl-l"},[r("el-button",{attrs:{size:"small"},on:{click:function(e){t.$router.back()}}},[t._v("返回")])],1),r("comp-wrap",[r("div",[r("div",{staticClass:"header-wrap"},[r("div",[r("h3",{staticClass:"my-l py-l"},[t._v(t._s(t.map[t.order.status]||"非此商城的状态"))]),r("div",[r("span",{staticClass:"color2"},[t._v("订单号: "+t._s(t.order.id))]),t.order.groupuuid?r("span",{staticClass:"member-tag",staticStyle:{padding:"0 4px","margin-right":"5px"}},[t._v(t._s("拼团 ID: "+t.order.groupuuid))]):t._e(),2==t.order.user.isvip?r("span",{staticClass:"member-tag",staticStyle:{padding:"0 4px","margin-right":"5px"}},[t._v("会员")]):t._e(),r("span",{staticClass:"member-tag",staticStyle:{padding:"0 4px","margin-right":"5px"}},[t._v(t._s(t.order.user.nickname)+"("+t._s(t.order.user.mobile)+")")])])]),2==t.order.status?r("div",{staticClass:"header-action"},[r("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){t.updateOrder(3)}}},[t._v("\n            全部核销\n          ")]),r("div",{staticClass:"color3 mt-l pt-l"},[t._v("请与用户确认无误后再确认核销")])],1):t._e()])]),12===t.order.status?r("div",{staticClass:"order-detail_banner"},[r("div",{staticClass:"detail-banner_text"},[r("span",[t._v("买家申请退款")])]),r("div",[r("el-button",{attrs:{size:"small",type:"info"},on:{click:function(e){t.updateOrder(2)}}},[t._v("拒绝退款")]),r("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){t.updateOrder(8)}}},[t._v("确认退款")])],1)]):t._e(),2!==t.order.status||t.order.orderproductsList.find(function(t){return 2==t.confirmed})?t._e():r("div",{staticClass:"order-detail_banner"},[r("div",{staticClass:"detail-banner_text"},[r("span",[t._v("直接退款")]),r("span",{staticClass:"detail-banner_sub-text"},[t._v("如果因为无法提供服务等原因, 您可以直接直接退款取消订单")])]),r("div",[r("el-button",{attrs:{size:"small",type:"info"},on:{click:function(e){t.updateOrder(8)}}},[t._v("直接退款")])],1)]),r("comp-list",{attrs:{text:"¥ "+t.$amount1(t.order.amount),label:"商品合计"}}),t.order.couponid?r("comp-list",{attrs:{text:t.getCoupon(t.order.coupon),label:"使用优惠券"}}):t._e(),t._l(t.order.marketinglist,function(e){return r("comp-list",{key:e.id,attrs:{label:t.getMarketingLabel(e),text:t.getMarketing(e)}})}),r("comp-list",{attrs:{text:"¥ "+t.$amount1(t.order.actualamount+t.order.freight),gutter:"",label:"实际支付"}}),r("comp-list",{attrs:{gutter:!t.order.needinvoice,text:t.order.note,label:"买家备注"}}),1==t.order.needinvoice?r("comp-list",{attrs:{text:0===t.order.invoice.kind?"个人":"单位",label:"发票类型",nomb:""}}):t._e(),1==t.order.needinvoice?r("comp-list",{attrs:{text:t.order.invoice.name,label:"发票抬头",nomb:""}}):t._e(),1==t.order.needinvoice?r("comp-list",{attrs:{text:t.order.invoice.taxid,gutter:"",label:"发票税号",nomb:""}}):t._e(),r("div",{staticClass:"g-b",staticStyle:{border:"1px solid #e9e9e9","margin-left":"-10px","margin-right":"-10px"}},t._l(t.order.orderproductsList,function(e){return r("div",{key:e.id,staticClass:"product"},[r("div",{staticClass:"product-info"},[r("div",{staticClass:"product-img",on:{click:function(r){t.$router.push({name:"products-edit",query:{id:e.productid,type:"edit"}})}}},[r("comp-imger",{attrs:{src:e.product.imagesList.length?e.product.imagesList[0]:""}})],1),r("div",[r("div",{staticClass:"product-name"},[t._v(t._s(e.product.name))]),r("div",{staticClass:"product-desc"},[t._v(t._s(t.week[e.week])+" "+t._s(e.duration/60/60)+"小时 ("+t._s(e.begintime)+" - "+t._s(e.endtime.startsWith(":")?"次日"+e.endtime.slice(1):e.endtime)+")")])])]),r("div",{staticClass:"price"},[t._v(t._s(t.$amount1(e.amount))+" 元")]),r("div",{staticClass:"count"},[t._v(t._s(e.quantity)+" 个")]),2==t.order.status||4==t.order.status?r("div",{staticClass:"count",staticStyle:{width:"200px","flex-direction":"column"}},[1==e.confirmed?r("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(r){t.updateOrderProduct(e,2)}}},[t._v("核销")]):t._e(),2==e.confirmed?r("div",[t._v("\n            已核销\n          ")]):t._e(),2==e.confirmed?r("div",[t._v("\n            "+t._s(new Date(1e3*e.updatedat).toLocaleString("zh-CN",{timeZone:"Asia/Shanghai"}))+"\n          ")]):t._e()],1):t._e(),2!=t.order.status&&4!=t.order.status?r("div",{staticClass:"count",staticStyle:{width:"200px","flex-direction":"column"}},[t._v("\n          /\n        ")]):t._e()])})),r("comp-list",{attrs:{text:new Date(1e3*t.order.createdat).toLocaleString("zh-CN",{timeZone:"Asia/Shanghai"}),label:"下单时间"}}),r("comp-list",{attrs:{text:new Date(1e3*t.order.updatedat).toLocaleString("zh-CN",{timeZone:"Asia/Shanghai"}),label:"最后更新"}}),0!=t.order.status&&6!=t.order.status?r("comp-list",{attrs:{text:new Date(1e3*t.order.paidat).toLocaleString("zh-CN",{timeZone:"Asia/Shanghai"}),label:"支付时间"}}):t._e(),1==t.order.payway?r("comp-list",{attrs:{text:t.order.transactionid,label:"微信流水号"}}):t._e(),1==t.order.payway?r("comp-list",{attrs:{text:"微信支付",label:"支付方式"}}):t._e(),2==t.order.payway?r("comp-list",{attrs:{text:"余额支付",label:"支付方式"}}):t._e(),0===t.order.brokeragestatus?r("comp-list",{attrs:{text:"无",label:"有无分账"}}):t._e(),0!==t.order.brokeragestatus?r("comp-list",{attrs:{text:"有",label:"有无分账"}}):t._e(),t.order.profitsharinguserid?r("comp-list",{attrs:{text:t.order.profitsharinguser.nickname+"("+t.order.profitsharinguser.mobile+")",label:"分销员"}}):t._e(),0!==t.order.brokerage?r("comp-list",{attrs:{text:t.order.brokerage/100,label:"分销员佣金"}}):t._e(),1!==t.order.brokeragestatus||0!=t.order.status&&1!=t.order.status&&2!=t.order.status&&3!=t.order.status&&4!=t.order.status?t._e():r("comp-list",{attrs:{text:"未结算",label:"分账结算"}}),2===t.order.brokeragestatus?r("comp-list",{attrs:{text:"已结算",label:"分账结算"}}):t._e(),3===t.order.brokeragestatus?r("comp-list",{attrs:{text:"未结算(结算失败)",label:"分账结算"}}):t._e(),1===t.order.brokeragestatus&&0!=t.order.status&&1!=t.order.status&&2!=t.order.status&&3!=t.order.status&&4!=t.order.status?r("comp-list",{attrs:{text:"未结算(结算无效)",label:"分账结算"}}):t._e()],2)],1)},E=[],J="",Q={functional:!0,render:function(t,e){return t("div",{class:"container"},[t("div",{class:"wrap"},[e.children])])}},Z={functional:!0,props:["label","text","gutter","nomb"],render:function(t,e){var r=e.props,i=r.label,a=r.text,s=r.gutter,n=r.nomb,o=["info"];return void 0!==s&&o.push("g-b"),void 0!==n&&void 0===s&&o.push("nomb"),t("div",{class:o.join(" ")},[t("div",{class:"color1 mr-l pr-l title"},[i]),t("div",{class:"color1 ml-l pl-l text"},[a])])}},F={0:"等待买家支付",1:"拼团中",2:"待核销",4:"已核销",5:"团购失败",6:"买家已取消订单",8:"已退款",12:"买家申请退款"},B={1:"周一",2:"周二",3:"周三",4:"周四",5:"周五",6:"周六",7:"周日"},H={components:{"comp-list":Z,"comp-wrap":Q},data:function(){return{map:F,order:{address:{},invoice:{},marketinglist:[],orderproductsList:[],user:{},coupon:{}},week:B}},created:function(){var t=Object(d["a"])(regeneratorRuntime.mark(function t(){var e,r,i,a,s;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return J=Object(p["e"])(),e=this.$route.query.id,t.next=4,Object(u["a"])("StoreOrderService.GetOrder",Object(l["a"])("IDWithTokenRequest",{token:Object(l["a"])("Token",{token:J}),id:e}));case 4:return r=t.sent,i=r.orderproductsList.map(function(t){return t.productid}),t.next=8,Promise.all([Object(u["a"])("StoreUserService.GetUser",Object(l["a"])("IDWithTokenRequest",{token:Object(l["a"])("Token",{token:J}),id:r.userid})),Object(u["a"])("StoreProductService.GetProductList",Object(l["a"])("ProductListQueryRequest",{token:Object(l["a"])("Token",{token:J}),idlistList:i,sortby:1,sort:1,count:i.length})),r.marketingidsList.length?Object(u["a"])("StoreMarketingService.GetMarketingList",Object(l["a"])("MarketingListQueryRequest",{token:Object(l["a"])("Token",{token:J}),kind:-1,idlistList:r.marketingidsList,sortby:1,sort:1,count:r.marketingidsList.length})):null,r.couponid?Object(u["a"])("StoreCouponService.GetCoupon",Object(l["a"])("IDWithTokenRequest",{token:Object(l["a"])("Token",{token:J}),id:r.couponid})):null,r.profitsharinguserid?Object(u["a"])("StoreUserService.GetUser",Object(l["a"])("IDWithTokenRequest",{token:Object(l["a"])("Token",{token:J}),id:r.profitsharinguserid})):null]);case 8:return a=t.sent,r.user=a[0],r.orderproductsList.forEach(function(t){t.product=a[1].productlistList.find(function(e){return e.id===t.productid})}),r.marketinglist=a[2]?a[2].marketinglistList:[],r.coupon=a[3],r.profitsharinguser=a[4],i=[],s=[],r.marketinglist.forEach(function(t){2===t.kind&&(0===t.gifttype&&s.push(t.giftid),1===t.gifttype&&i.push(t.giftid))}),t.next=19,Promise.all([s.length?Object(u["a"])("StoreCouponTemplateService.GetCouponTemplateList",Object(l["a"])("CouponTemplateListQueryRequest",{token:Object(l["a"])("Token",{token:J}),idlistList:s,count:s.length})):null,i.length?Object(u["a"])("StoreProductService.GetProductList",Object(l["a"])("ProductListQueryRequest",{token:Object(l["a"])("Token",{token:J}),idlistList:i,sortby:1,sort:1,count:i.length})):null]);case 19:a=t.sent,r.marketinglist.forEach(function(t){t.coupontemplate=null,t.product=null,2===t.kind&&(0===t.gifttype&&(t.coupontemplate=a[0]?a[0].coupontemplatelistList.find(function(e){return e.id===t.giftid}):null),1===t.gifttype&&(t.product=a[1]?a[1].productlistList.find(function(e){return e.id===t.giftid}):null))}),this.order=r;case 22:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),methods:{updateOrder:function(t){var e=this,r=JSON.parse(JSON.stringify(this.order));r.status=t,Object(u["a"])("StoreOrderService.UpdateOrder",Object(l["a"])("OrderWithTokenRequest",{token:Object(l["a"])("Token",{token:J}),order:Object(l["a"])("Order",Object(c["a"])({},r,{address:Object(l["a"])("Address",r.address),invoice:Object(l["a"])("Invoice",r.invoice),orderproductsList:r.orderproductsList.map(function(t){return Object(l["a"])("OrderProduct",t)})}))})).then(function(r){e.order.status=3==t?4:r.status,e.order.updatedat=r.updatedat,e.order.orderproductsList=e.order.orderproductsList.map(function(t){return 2===t.confirmed?t:(t.confirmed=2,t.updatedat=parseInt(Date.now()/1e3),t)}),e.$message({message:"操作成功",type:"success"})})},updateOrderProduct:function(t,e){var r=this;t=JSON.parse(JSON.stringify(t)),t.confirmed=e,Object(u["a"])("StoreOrderService.UpdateOrderProduct",Object(l["a"])("OrderProductWithTokenRequest",{token:Object(l["a"])("Token",{token:J}),orderproduct:Object(l["a"])("OrderProduct",t)})).then(function(e){t.updatedat=e.updatedat;var i=r.order.orderproductsList.findIndex(function(e){return e.id===t.id});r.order.orderproductsList.splice(i,1,t),r.order.orderproductsList.find(function(t){return 2!=t.confirmed})||(r.order.status=4,r.order.updatedat=e.updatedat),r.$message({message:"操作成功",type:"success"})})},getCoupon:function(t){return"¥ -".concat(this.$amount1(t.amount)," (满").concat(this.$amount1(t.reach),"减").concat(this.$amount1(t.amount),")")},getMarketing:function(t){if(1===t.kind)return"¥ -".concat(this.$amount1(t.reduction)," (满").concat(this.$amount1(t.reach),"减").concat(this.$amount1(t.reduction),")");if(2===t.kind){if(1===t.gifttype)return"满".concat(this.$amount1(t.reach),"赠商品: ").concat(t.product.name);var e="";return 0===t.coupontemplate.amount&&(e="¥ ".concat(t.coupontemplate.amountbegin/100," ~ ¥ ").concat(t.coupontemplate.amountend/100)),1===t.coupontemplate.amount&&(e="¥ ".concat(t.coupontemplate.amount/100)),"满".concat(this.$amount1(t.reach),"赠优惠券: ").concat(t.coupontemplate.name,"(").concat(e,")")}return"¥ -".concat(this.$amount1(this.order.originfreight)," (满").concat(this.$amount1(t.reach),"免运费)")},getMarketingLabel:function(t){var e={1:"满减优惠",2:"满赠优惠",3:"满免运费"};return e[t.kind]}}},Y=H,K=(r("459e"),r("56f1"),Object(y["a"])(Y,U,E,!1,null,"62da5487",null)),V=K.exports,X=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("div",{staticClass:"ml-l pl-l",staticStyle:{display:"flex","justify-content":"space-between","flex-direction":"row","padding-right":"15px"}},[r("el-button",{attrs:{size:"small"},on:{click:function(e){t.$router.back()}}},[t._v("返回")]),r("el-button",{attrs:{size:"small"},on:{click:t.printOrder}},[t._v("打印")])],1),r("comp-wrap",[r("div",[r("div",{staticClass:"header-wrap"},[r("div",[r("h3",{staticClass:"my-l py-l"},[t._v(t._s(t.map[t.order.status]||"非此商城的状态"))]),r("div",[r("span",{staticClass:"color2"},[t._v("订单号: "+t._s(t.order.id))]),t.order.subscriptionid>0?r("span",{staticClass:"member-tag",staticStyle:{padding:"0 4px","margin-right":"5px"}},[t._v("周期购")]):t._e(),r("span",{staticClass:"member-tag",staticStyle:{padding:"0 4px","margin-right":"5px"}},[t._v(t._s({1:"自取",2:"配送"}[t.order.deliverkind]))]),t.order.groupuuid?r("span",{staticClass:"member-tag",staticStyle:{padding:"0 4px","margin-right":"5px"}},[t._v(t._s("拼团 ID: "+t.order.groupuuid+" "+(2===t.order.grouplead?"团长代收":"单独发货")))]):t._e(),0==t.order.subscriptionid?r("span",{staticClass:"member-tag",staticStyle:{padding:"0 4px","margin-right":"5px"}},[t._v("应交付时间 "+t._s(new Date(1e3*t.order.delivertime).toLocaleString()))]):t._e(),2==t.order.user.isvip?r("span",{staticClass:"member-tag",staticStyle:{padding:"0 4px","margin-right":"5px"}},[t._v("会员")]):t._e(),r("span",{staticClass:"member-tag",staticStyle:{padding:"0 4px","margin-right":"5px"}},[t._v(t._s(t.order.user.nickname)+"("+t._s(t.order.user.mobile)+")")])])]),2==t.order.status&&0==t.order.subscriptionid?r("div",{staticClass:"header-action"},[r("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){t.updateOrder(3)}}},[t._v("\n            "+t._s({1:"接单",2:"发货"}[t.order.deliverkind])+"\n          ")])],1):t._e(),3==t.order.status&&0==t.order.subscriptionid?r("div",{staticClass:"header-action"},[r("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){t.updateOrder(2)}}},[t._v("\n            取消发货\n          ")])],1):t._e()])]),12===t.order.status?r("div",{staticClass:"order-detail_banner"},[r("div",{staticClass:"detail-banner_text"},[r("span",[t._v("买家申请退款")])]),r("div",[r("el-button",{attrs:{size:"small",type:"info"},on:{click:function(e){t.updateOrder(2)}}},[t._v("拒绝退款")]),r("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){t.updateOrder(8)}}},[t._v("确认退款")])],1)]):t._e(),2!==t.order.status||t.order.orderproductsList.find(function(t){return 2==t.confirmed})?t._e():r("div",{staticClass:"order-detail_banner"},[r("div",{staticClass:"detail-banner_text"},[r("span",[t._v("直接退款")]),r("span",{staticClass:"detail-banner_sub-text"},[t._v("如果因为库存不足等原因无法发货, 您可以直接直接退款取消订单")])]),r("div",[r("el-button",{attrs:{size:"small",type:"info"},on:{click:function(e){t.updateOrder(8)}}},[t._v("直接退款")])],1)]),2===t.order.deliverkind?r("div",{staticClass:"address-box"},[r("h5",{staticClass:"mb-l pb-l mt-s pt-s"},[t._v("配送信息")]),r("el-row",{attrs:{align:"middle",type:"flex"}},[r("el-col",{staticClass:"color1",attrs:{span:"2"}},[t._v("配送地址")]),r("el-col",{staticClass:"color1",attrs:{offset:"1",span:"6"}},[t._v(t._s(t.order.address.name)+", "+t._s(t.order.address.mobile))])],1),r("el-row",{staticStyle:{"margin-top":"5px"},attrs:{align:"middle",type:"flex"}},[r("el-col",{attrs:{span:"2"}},[r("el-button",{staticStyle:{padding:"2px 10px","font-size":"10px"},attrs:{size:"small",type:"info"}},[t._v("复制")])],1),r("el-col",{staticClass:"color1",attrs:{offset:"1",span:"6"}},[t._v(t._s(t.order.address.province)+" "+t._s(t.order.address.city)+" "+t._s(t.order.address.district)+" "+t._s(t.order.address.address))])],1)],1):t._e(),r("comp-list",{attrs:{text:"¥ "+t.$amount1(t.order.amount),label:"商品合计"}}),t.order.couponid?r("comp-list",{attrs:{text:t.getCoupon(t.order.coupon),label:"使用优惠券"}}):t._e(),r("comp-list",{attrs:{text:"¥ "+t.$amount1(t.order.originfreight),label:"配送费"}}),t._l(t.order.marketinglist,function(e){return r("comp-list",{key:e.id,attrs:{label:t.getMarketingLabel(e),text:t.getMarketing(e)}})}),r("comp-list",{attrs:{text:"¥ "+t.$amount1(t.order.actualamount+t.order.freight),gutter:"",label:"实际支付"}}),r("comp-list",{attrs:{gutter:!t.order.needinvoice,text:t.order.note,label:"买家备注"}}),r("comp-list",{attrs:{text:t.order.giftnote,label:"礼卡祝福语"}}),1==t.order.needinvoice?r("comp-list",{attrs:{text:0===t.order.invoice.kind?"个人":"单位",label:"发票类型",nomb:""}}):t._e(),1==t.order.needinvoice?r("comp-list",{attrs:{text:t.order.invoice.name,label:"发票抬头",nomb:""}}):t._e(),1==t.order.needinvoice?r("comp-list",{attrs:{text:t.order.invoice.taxid,gutter:"",label:"发票税号",nomb:""}}):t._e(),r("div",{staticClass:"g-b",staticStyle:{border:"1px solid #e9e9e9","margin-left":"-10px","margin-right":"-10px"}},t._l(t.order.orderproductsList,function(e,i){return r("div",{key:e.id,staticClass:"product"},[r("div",{staticClass:"product-info"},[r("div",{staticClass:"product-img",on:{click:function(r){t.$router.push({name:"products-edit",query:{id:e.productid,type:"edit"}})}}},[r("comp-imger",{attrs:{src:e.product.imagesList.length?e.product.imagesList[0]:""}})],1),r("div",[r("div",{staticClass:"product-name"},[t._v(t._s(e.product.name))]),r("div",{staticClass:"product-desc"},[t._v(t._s(e.optionname&&"("+Object.values(JSON.parse(e.optionname)).join(", ")+")"))]),t.order.subscriptionid>0?r("div",{staticClass:"product-desc"},[t._v("\n              ID: "+t._s(e.id)+" 第"+t._s(i+1)+"期 应于 "+t._s(new Date(1e3*e.delivertime).toLocaleString("zh-CN",{timeZone:"Asia/Shanghai"}))+" 交付\n              "),1==e.confirmed?r("el-button",{attrs:{size:"small",type:"text"},on:{click:function(r){t.onClickChangeDeliverTime(e)}}},[t._v("修改交付时间")]):t._e()],1):t._e()])]),r("div",{staticClass:"price"},[t._v(t._s(t.$amount1(e.amount))+" 元")]),r("div",{staticClass:"count"},[t._v(t._s(e.quantity)+" 个")]),t.order.subscriptionid>0&&2==t.order.status?r("div",{staticClass:"count",staticStyle:{width:"200px","flex-direction":"column"}},[1==e.confirmed?r("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(r){t.updateOrderProductConfirmed(e,2)}}},[t._v("发货")]):t._e(),2==e.confirmed?r("div",[t._v("\n            已发货\n          ")]):t._e(),2==e.confirmed?r("div",[t._v("\n            "+t._s(new Date(1e3*e.updatedat).toLocaleString("zh-CN",{timeZone:"Asia/Shanghai"}))+"\n          ")]):t._e()],1):t._e(),0==t.order.subscriptionid||2!=t.order.status?r("div",{staticClass:"count",staticStyle:{width:"200px","flex-direction":"column"}},[t._v("\n          /\n        ")]):t._e()])})),r("comp-list",{attrs:{text:new Date(1e3*t.order.createdat).toLocaleString("zh-CN",{timeZone:"Asia/Shanghai"}),label:"下单时间"}}),r("comp-list",{attrs:{text:new Date(1e3*t.order.updatedat).toLocaleString("zh-CN",{timeZone:"Asia/Shanghai"}),label:"最后更新"}}),0!=t.order.status&&6!=t.order.status?r("comp-list",{attrs:{text:new Date(1e3*t.order.paidat).toLocaleString("zh-CN",{timeZone:"Asia/Shanghai"}),label:"支付时间"}}):t._e(),1==t.order.payway?r("comp-list",{attrs:{text:t.order.transactionid,label:"微信流水号"}}):t._e(),1==t.order.payway?r("comp-list",{attrs:{text:"微信支付",label:"支付方式"}}):t._e(),2==t.order.payway?r("comp-list",{attrs:{text:"余额支付",label:"支付方式"}}):t._e(),t.order.dadastatus?r("comp-list",{attrs:{text:{1:"待接单",2:"待取货",3:"配送中",4:"已完成",5:"已取消",7:"已过期",8:"指派单",9:"妥投异常之物品返回中",10:"妥投异常之物品返回完成",100:"骑士到店",1000:"创建运单失败"}[t.order.dadastatus],label:"骑手状态"}}):t._e(),t.order.dadacancelreason?r("comp-list",{attrs:{text:t.order.dadacancelreason,label:"骑手取消原因"}}):t._e(),t.order.dadadmname?r("comp-list",{attrs:{text:t.order.dadadmname,label:"骑手姓名"}}):t._e(),t.order.dadadmmobile?r("comp-list",{attrs:{text:t.order.dadadmmobile,label:"骑手电话"}}):t._e(),0===t.order.brokeragestatus?r("comp-list",{attrs:{text:"无",label:"有无分账"}}):t._e(),0!==t.order.brokeragestatus?r("comp-list",{attrs:{text:"有",label:"有无分账"}}):t._e(),t.order.profitsharinguserid?r("comp-list",{attrs:{text:t.order.profitsharinguser.nickname+"("+t.order.profitsharinguser.mobile+")",label:"分销员"}}):t._e(),0!==t.order.brokerage?r("comp-list",{attrs:{text:t.order.brokerage/100,label:"分销员佣金"}}):t._e(),1!==t.order.brokeragestatus||0!=t.order.status&&1!=t.order.status&&2!=t.order.status&&3!=t.order.status&&4!=t.order.status?t._e():r("comp-list",{attrs:{text:"未结算",label:"分账结算"}}),2===t.order.brokeragestatus?r("comp-list",{attrs:{text:"已结算",label:"分账结算"}}):t._e(),3===t.order.brokeragestatus?r("comp-list",{attrs:{text:"未结算(结算失败)",label:"分账结算"}}):t._e(),1===t.order.brokeragestatus&&0!=t.order.status&&1!=t.order.status&&2!=t.order.status&&3!=t.order.status&&4!=t.order.status?r("comp-list",{attrs:{text:"未结算(结算无效)",label:"分账结算"}}):t._e()],2),r("el-dialog",{attrs:{title:"修改交付时间",visible:t.showTimerDialog,width:"30%"},on:{"update:visible":function(e){t.showTimerDialog=e}}},[r("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime",size:"small",placeholder:"选择日期时间"},model:{value:t.DialogDeliverTimer,callback:function(e){t.DialogDeliverTimer=e},expression:"DialogDeliverTimer"}}),r("div",{staticStyle:{display:"flex","justify-content":"flex-end"}},[r("el-button",{staticStyle:{"margin-top":"10px"},attrs:{type:"primary",size:"small"},on:{click:t.onClickTimerDialogConfirm}},[t._v("确 定")])],1)],1)],1)},tt=[],et=r("a3fb"),rt="",it={functional:!0,render:function(t,e){return t("div",{class:"container"},[t("div",{class:"wrap"},[e.children])])}},at={functional:!0,props:["label","text","gutter","nomb"],render:function(t,e){var r=e.props,i=r.label,a=r.text,s=r.gutter,n=r.nomb,o=["info"];return void 0!==s&&o.push("g-b"),void 0!==n&&void 0===s&&o.push("nomb"),t("div",{class:o.join(" ")},[t("div",{class:"color1 mr-l pr-l title"},[i]),t("div",{class:"color1 ml-l pl-l text"},[a])])}},st={0:"等待买家支付",1:"拼团中",2:"待发货",3:"待收货",4:"已收货",5:"团购失败",6:"买家已取消订单",8:"已退款",12:"买家申请退款"},nt={components:{"comp-list":at,"comp-wrap":it},data:function(){return{map:st,DialogDeliverTimer:"",showTimerDialog:!1,order:{address:{},invoice:{},marketinglist:[],orderproductsList:[],user:{},coupon:{}}}},created:function(){var t=Object(d["a"])(regeneratorRuntime.mark(function t(){var e,r,i,a,s;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return rt=Object(p["e"])(),e=this.$route.query.id,t.next=4,Object(u["a"])("StoreOrderService.GetOrder",Object(l["a"])("IDWithTokenRequest",{token:Object(l["a"])("Token",{token:rt}),id:e}));case 4:return r=t.sent,i=r.orderproductsList.map(function(t){return t.productid}),t.next=8,Promise.all([Object(u["a"])("StoreUserService.GetUser",Object(l["a"])("IDWithTokenRequest",{token:Object(l["a"])("Token",{token:rt}),id:r.userid})),Object(u["a"])("StoreProductService.GetProductList",Object(l["a"])("ProductListQueryRequest",{token:Object(l["a"])("Token",{token:rt}),idlistList:i,sortby:1,sort:1,count:i.length})),r.marketingidsList.length?Object(u["a"])("StoreMarketingService.GetMarketingList",Object(l["a"])("MarketingListQueryRequest",{token:Object(l["a"])("Token",{token:rt}),kind:-1,idlistList:r.marketingidsList,sortby:1,sort:1,count:r.marketingidsList.length})):null,r.couponid?Object(u["a"])("StoreCouponService.GetCoupon",Object(l["a"])("IDWithTokenRequest",{token:Object(l["a"])("Token",{token:rt}),id:r.couponid})):null,r.profitsharinguserid?Object(u["a"])("StoreUserService.GetUser",Object(l["a"])("IDWithTokenRequest",{token:Object(l["a"])("Token",{token:rt}),id:r.profitsharinguserid})):null]);case 8:return a=t.sent,r.user=a[0],r.orderproductsList.forEach(function(t){t.product=a[1].productlistList.find(function(e){return e.id===t.productid})}),r.marketinglist=a[2]?a[2].marketinglistList:[],r.coupon=a[3],r.profitsharinguser=a[4],i=[],s=[],r.marketinglist.forEach(function(t){2===t.kind&&(0===t.gifttype&&s.push(t.giftid),1===t.gifttype&&i.push(t.giftid))}),t.next=19,Promise.all([s.length?Object(u["a"])("StoreCouponTemplateService.GetCouponTemplateList",Object(l["a"])("CouponTemplateListQueryRequest",{token:Object(l["a"])("Token",{token:rt}),idlistList:s,count:s.length})):null,i.length?Object(u["a"])("StoreProductService.GetProductList",Object(l["a"])("ProductListQueryRequest",{token:Object(l["a"])("Token",{token:rt}),idlistList:i,sortby:1,sort:1,count:i.length})):null]);case 19:a=t.sent,r.marketinglist.forEach(function(t){t.coupontemplate=null,t.product=null,2===t.kind&&(0===t.gifttype&&(t.coupontemplate=a[0]?a[0].coupontemplatelistList.find(function(e){return e.id===t.giftid}):null),1===t.gifttype&&(t.product=a[1]?a[1].productlistList.find(function(e){return e.id===t.giftid}):null))}),this.order=r;case 22:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),methods:{printOrder:function(){var t=this;Object(u["a"])("StoreOrderService.PrintOrder",Object(l["a"])("IDWithTokenRequest",{token:Object(l["a"])("Token",{token:rt}),id:this.order.id})).then(function(e){t.$message({message:"已发送打印指令",type:"success"})})},updateOrder:function(){var t=Object(d["a"])(regeneratorRuntime.mark(function t(e){var r,i,a=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(et["b"])();case 2:if(r=t.sent,t.prev=3,3!=this.order.status||2!==e||2!=this.order.deliverkind||2!=r.shippingway){t.next=7;break}return t.next=7,this.$confirm("如果再次发货此订单只能选择商家自配送, 确认取消?","确认取消?",{confirmButtonText:"确定",cancelButtonText:"取消"});case 7:t.next=12;break;case 9:return t.prev=9,t.t0=t["catch"](3),t.abrupt("return");case 12:i=JSON.parse(JSON.stringify(this.order)),i.status=e,Object(u["a"])("StoreOrderService.UpdateOrder",Object(l["a"])("OrderWithTokenRequest",{token:Object(l["a"])("Token",{token:rt}),order:Object(l["a"])("Order",Object(c["a"])({},i,{address:Object(l["a"])("Address",i.address),invoice:Object(l["a"])("Invoice",i.invoice),orderproductsList:i.orderproductsList.map(function(t){return Object(l["a"])("OrderProduct",t)})}))})).then(function(t){a.order.status=e,a.order.updatedat=t.updatedat,a.$message({message:"操作成功",type:"success"})});case 15:case"end":return t.stop()}},t,this,[[3,9]])}));function e(e){return t.apply(this,arguments)}return e}(),updateOrderProductConfirmed:function(t,e){var r=this;t=JSON.parse(JSON.stringify(t)),t.confirmed=e,Object(u["a"])("StoreOrderService.UpdateOrderProduct",Object(l["a"])("OrderProductWithTokenRequest",{token:Object(l["a"])("Token",{token:rt}),orderproduct:Object(l["a"])("OrderProduct",t)})).then(function(e){t.updatedat=e.updatedat;var i=r.order.orderproductsList.findIndex(function(e){return e.id===t.id});r.order.orderproductsList.splice(i,1,t),r.order.orderproductsList.find(function(t){return 2!=t.confirmed})||(r.order.status=3,r.order.updatedat=e.updatedat),r.$message({message:"操作成功",type:"success"})})},updateOrderProductDelivertime:function(t,e){var r=this;t=JSON.parse(JSON.stringify(t)),t.delivertime=e,Object(u["a"])("StoreOrderService.UpdateOrderProduct",Object(l["a"])("OrderProductWithTokenRequest",{token:Object(l["a"])("Token",{token:rt}),orderproduct:Object(l["a"])("OrderProduct",t)})).then(function(e){t.updatedat=e.updatedat;var i=r.order.orderproductsList.findIndex(function(e){return e.id===t.id});r.order.orderproductsList.splice(i,1,t),r.order.orderproductsList.find(function(t){return 2!=t.confirmed})||(r.order.status=3,r.order.updatedat=e.updatedat),r.$message({message:"操作成功",type:"success"})})},getCoupon:function(t){return"¥ -".concat(this.$amount1(t.amount)," (满").concat(this.$amount1(t.reach),"减").concat(this.$amount1(t.amount),")")},getMarketing:function(t){if(1===t.kind)return"¥ -".concat(this.$amount1(t.reduction)," (满").concat(this.$amount1(t.reach),"减").concat(this.$amount1(t.reduction),")");if(2===t.kind){if(1===t.gifttype)return"满".concat(this.$amount1(t.reach),"赠商品: ").concat(t.product.name);var e="";return 0===t.coupontemplate.amount&&(e="¥ ".concat(t.coupontemplate.amountbegin/100," ~ ¥ ").concat(t.coupontemplate.amountend/100)),1===t.coupontemplate.amount&&(e="¥ ".concat(t.coupontemplate.amount/100)),"满".concat(this.$amount1(t.reach),"赠优惠券: ").concat(t.coupontemplate.name,"(").concat(e,")")}return"¥ -".concat(this.$amount1(this.order.originfreight)," (满").concat(this.$amount1(t.reach),"免运费)")},getMarketingLabel:function(t){var e={1:"满减优惠",2:"满赠优惠",3:"满免运费"};return e[t.kind]},onClickTimerDialogConfirm:function(){this.showTimerDialog=!1;var t=parseInt(this.DialogDeliverTimer.getTime()/1e3);this.updateOrderProductDelivertime(this.currentoproduct,t)},onClickChangeDeliverTime:function(t){var e=this;this.$confirm("请确认已与客户提前沟通").then(function(){e.showTimerDialog=!0,e.currentoproduct=t}).catch(function(){})}}},ot=nt,ct=(r("030a"),r("4bd4"),Object(y["a"])(ot,X,tt,!1,null,"1e8ccd40",null)),dt=ct.exports,lt=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("div",{staticClass:"ml-l pl-l",staticStyle:{display:"flex","justify-content":"space-between","flex-direction":"row","padding-right":"15px"}},[r("el-button",{attrs:{size:"small"},on:{click:function(e){t.$router.back()}}},[t._v("返回")]),r("el-button",{attrs:{size:"small"},on:{click:t.printOrder}},[t._v("打印")])],1),r("comp-wrap",[r("div",[r("div",{staticClass:"header-wrap"},[r("div",[r("h3",{staticClass:"my-l py-l"},[t._v(t._s(t.getOrderStatus(t.order.status,t.order.deliverkind)||"非此商城的状态"))]),r("div",[r("span",{staticClass:"color2"},[t._v("订单号: "+t._s(t.order.id))]),r("span",{staticClass:"member-tag",staticStyle:{padding:"0 4px","margin-right":"5px"}},[t._v(t._s({1:"自取",2:"配送"}[t.order.deliverkind]))]),1==t.order.deliverkind?r("span",{staticClass:"member-tag",staticStyle:{padding:"0 4px","margin-right":"5px"}},[t._v(t._s(new Date(1e3*t.order.delivertime).toLocaleString("zh-CN",{timeZone:"Asia/Shanghai"})))]):t._e(),1==t.order.deliverkind&&t.order.delivertime<parseInt(Date.now()/1e3)&&3==t.order.status?r("span",{staticClass:"member-tag",staticStyle:{padding:"0 4px","margin-right":"5px"}},[t._v("已超时")]):t._e(),1==t.order.deliverkind?r("span",{staticClass:"member-tag",staticStyle:{padding:"0 4px","margin-right":"5px"}},[t._v("自取手机号: "+t._s(t.order.delivermobile))]):t._e(),2==t.order.deliverkind?r("span",{staticClass:"member-tag",staticStyle:{padding:"0 4px","margin-right":"5px"}},[t._v("#"+t._s(t.order.daynumber))]):t._e(),2==t.order.user.isvip?r("span",{staticClass:"member-tag",staticStyle:{padding:"0 4px","margin-right":"5px"}},[t._v("会员")]):t._e(),r("span",{staticClass:"member-tag",staticStyle:{padding:"0 4px","margin-right":"5px"}},[t._v(t._s(t.order.user.nickname)+"("+t._s(t.order.user.mobile)+")")])])]),2==t.order.status?r("div",{staticClass:"header-action"},[r("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){t.updateOrder(3)}}},[t._v("\n            "+t._s(2==t.order.deliverkind?"确认发货":"确认接单")+"\n          ")])],1):t._e(),3==t.order.status&&0==t.order.subscriptionid?r("div",{staticClass:"header-action"},[r("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){t.updateOrder(2)}}},[t._v("\n            取消发货\n          ")])],1):t._e()])]),12===t.order.status?r("div",{staticClass:"order-detail_banner"},[r("div",{staticClass:"detail-banner_text"},[r("span",[t._v("买家申请退款")])]),r("div",[r("el-button",{attrs:{size:"small",type:"info"},on:{click:function(e){t.updateOrder(2)}}},[t._v("拒绝退款")]),r("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){t.updateOrder(8)}}},[t._v("确认退款")])],1)]):t._e(),2===t.order.status?r("div",{staticClass:"order-detail_banner"},[r("div",{staticClass:"detail-banner_text"},[r("span",[t._v("直接退款")]),r("span",{staticClass:"detail-banner_sub-text"},[t._v("如果因为库存不足等原因无法接单, 您可以直接直接退款取消订单")])]),r("div",[r("el-button",{attrs:{size:"small",type:"info"},on:{click:function(e){t.updateOrder(8)}}},[t._v("直接退款")])],1)]):t._e(),2==t.order.deliverkind?r("div",{staticClass:"address-box"},[r("h5",{staticClass:"mb-l pb-l mt-s pt-s"},[t._v("配送信息")]),r("el-row",{attrs:{align:"middle",type:"flex"}},[r("el-col",{staticClass:"color1",attrs:{span:"2"}},[t._v("配送地址")]),r("el-col",{staticClass:"color1",attrs:{offset:"1",span:"6"}},[t._v(t._s(t.order.address.name)+", "+t._s(t.order.address.mobile))])],1),r("el-row",{staticStyle:{"margin-top":"5px"},attrs:{align:"middle",type:"flex"}},[r("el-col",{attrs:{span:"2"}},[r("el-button",{staticStyle:{padding:"2px 10px","font-size":"10px"},attrs:{size:"small",type:"info"}},[t._v("复制")])],1),r("el-col",{staticClass:"color1",attrs:{offset:"1",span:"6"}},[t._v(t._s(t.order.address.province)+" "+t._s(t.order.address.city)+" "+t._s(t.order.address.district)+" "+t._s(t.order.address.address))])],1)],1):t._e(),r("comp-list",{attrs:{text:"¥ "+t.$amount1(t.order.amount),label:"商品合计"}}),t.order.couponid?r("comp-list",{attrs:{text:t.getCoupon(t.order.coupon),label:"使用优惠券"}}):t._e(),r("comp-list",{attrs:{text:"¥ "+t.$amount1(t.order.originfreight),label:"配送费"}}),t._l(t.order.marketinglist,function(e){return r("comp-list",{key:e.id,attrs:{label:t.getMarketingLabel(e),text:t.getMarketing(e)}})}),r("comp-list",{attrs:{text:"¥ "+t.$amount1(t.order.actualamount+t.order.freight),gutter:"",label:"实际支付"}}),r("comp-list",{attrs:{gutter:!t.order.needinvoice,text:t.order.note,label:"买家备注"}}),r("comp-list",{attrs:{text:t.order.giftnote,label:"礼卡祝福语"}}),1==t.order.needinvoice?r("comp-list",{attrs:{text:0===t.order.invoice.kind?"个人":"单位",label:"发票类型",nomb:""}}):t._e(),1==t.order.needinvoice?r("comp-list",{attrs:{text:t.order.invoice.name,label:"发票抬头",nomb:""}}):t._e(),1==t.order.needinvoice?r("comp-list",{attrs:{text:t.order.invoice.taxid,gutter:"",label:"发票税号",nomb:""}}):t._e(),r("div",{staticClass:"g-b",staticStyle:{border:"1px solid #e9e9e9","margin-left":"-10px","margin-right":"-10px"}},t._l(t.order.orderproductsList,function(e){return r("div",{key:e.id,staticClass:"product"},[r("div",{staticClass:"product-info"},[r("div",{staticClass:"product-img",on:{click:function(r){t.$router.push({name:"products-edit",query:{id:e.productid,type:"edit"}})}}},[r("comp-imger",{attrs:{src:e.product.imagesList.length?e.product.imagesList[0]:""}})],1),r("div",[r("div",{staticClass:"product-name"},[t._v(t._s(e.product.name))]),r("div",{staticClass:"product-desc"},[t._v(t._s(e.optionname&&"("+Object.values(JSON.parse(e.optionname)).join(", ")+")"))])])]),r("div",{staticClass:"price"},[t._v(t._s(t.$amount1(e.amount))+" 元")]),r("div",{staticClass:"count"},[t._v(t._s(e.quantity)+" 个")])])})),r("comp-list",{attrs:{text:new Date(1e3*t.order.createdat).toLocaleString("zh-CN",{timeZone:"Asia/Shanghai"}),label:"下单时间"}}),r("comp-list",{attrs:{text:new Date(1e3*t.order.updatedat).toLocaleString("zh-CN",{timeZone:"Asia/Shanghai"}),label:"最后更新"}}),0!=t.order.status&&6!=t.order.status?r("comp-list",{attrs:{text:new Date(1e3*t.order.paidat).toLocaleString("zh-CN",{timeZone:"Asia/Shanghai"}),label:"支付时间"}}):t._e(),1==t.order.payway?r("comp-list",{attrs:{text:t.order.transactionid,label:"微信流水号"}}):t._e(),1==t.order.payway?r("comp-list",{attrs:{text:"微信支付",label:"支付方式"}}):t._e(),2==t.order.payway?r("comp-list",{attrs:{text:"余额支付",label:"支付方式"}}):t._e(),t.order.dadastatus?r("comp-list",{attrs:{text:{1:"待接单",2:"待取货",3:"配送中",4:"已完成",5:"已取消",7:"已过期",8:"指派单",9:"妥投异常之物品返回中",10:"妥投异常之物品返回完成",100:"骑士到店",1000:"创建运单失败"}[t.order.datastatus],label:"骑手状态"}}):t._e(),t.order.dadacancelreason?r("comp-list",{attrs:{text:t.order.dadacancelreason,label:"骑手取消原因"}}):t._e(),t.order.dadadmname?r("comp-list",{attrs:{text:t.order.dadadmname,label:"骑手姓名"}}):t._e(),t.order.dadadmmobile?r("comp-list",{attrs:{text:t.order.dadadmmobile,label:"骑手电话"}}):t._e(),0===t.order.brokeragestatus?r("comp-list",{attrs:{text:"无",label:"有无分账"}}):t._e(),0!==t.order.brokeragestatus?r("comp-list",{attrs:{text:"有",label:"有无分账"}}):t._e(),t.order.profitsharinguserid?r("comp-list",{attrs:{text:t.order.profitsharinguser.nickname+"("+t.order.profitsharinguser.mobile+")",label:"分销员"}}):t._e(),0!==t.order.brokerage?r("comp-list",{attrs:{text:t.order.brokerage/100,label:"分销员佣金"}}):t._e(),1!==t.order.brokeragestatus||0!=t.order.status&&1!=t.order.status&&2!=t.order.status&&3!=t.order.status&&4!=t.order.status?t._e():r("comp-list",{attrs:{text:"未结算",label:"分账结算"}}),2===t.order.brokeragestatus?r("comp-list",{attrs:{text:"已结算",label:"分账结算"}}):t._e(),3===t.order.brokeragestatus?r("comp-list",{attrs:{text:"未结算(结算失败)",label:"分账结算"}}):t._e(),1===t.order.brokeragestatus&&0!=t.order.status&&1!=t.order.status&&2!=t.order.status&&3!=t.order.status&&4!=t.order.status?r("comp-list",{attrs:{text:"未结算(结算无效)",label:"分账结算"}}):t._e()],2)],1)},ut=[],pt="",mt={functional:!0,render:function(t,e){return t("div",{class:"container"},[t("div",{class:"wrap"},[e.children])])}},vt={functional:!0,props:["label","text","gutter","nomb"],render:function(t,e){var r=e.props,i=r.label,a=r.text,s=r.gutter,n=r.nomb,o=["info"];return void 0!==s&&o.push("g-b"),void 0!==n&&void 0===s&&o.push("nomb"),t("div",{class:o.join(" ")},[t("div",{class:"color1 mr-l pr-l title"},[i]),t("div",{class:"color1 ml-l pl-l text"},[a])])}},bt={0:"等待顾客支付","2_1":"等待商家备货","2_2":"等待商家发货","3_1":"等待顾客取货","3_2":"已接单待收货",4:"已完成",6:"顾客已取消订单",8:"已退款",12:"顾客请求退款"},gt=function(t,e){return bt[t]||bt["".concat(t,"_").concat(e)]},ht={components:{"comp-list":vt,"comp-wrap":mt},data:function(){return{order:{address:{},invoice:{},marketinglist:[],orderproductsList:[],user:{},coupon:{}}}},created:function(){var t=Object(d["a"])(regeneratorRuntime.mark(function t(){var e,r,i,a,s;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return pt=Object(p["e"])(),e=this.$route.query.id,t.next=4,Object(u["a"])("StoreOrderService.GetOrder",Object(l["a"])("IDWithTokenRequest",{token:Object(l["a"])("Token",{token:pt}),id:e}));case 4:return r=t.sent,i=r.orderproductsList.map(function(t){return t.productid}),t.next=8,Promise.all([Object(u["a"])("StoreUserService.GetUser",Object(l["a"])("IDWithTokenRequest",{token:Object(l["a"])("Token",{token:pt}),id:r.userid})),Object(u["a"])("StoreProductService.GetProductList",Object(l["a"])("ProductListQueryRequest",{token:Object(l["a"])("Token",{token:pt}),idlistList:i,sortby:1,sort:1,count:i.length})),r.marketingidsList.length?Object(u["a"])("StoreMarketingService.GetMarketingList",Object(l["a"])("MarketingListQueryRequest",{token:Object(l["a"])("Token",{token:pt}),kind:-1,idlistList:r.marketingidsList,sortby:1,sort:1,count:r.marketingidsList.length})):null,r.couponid?Object(u["a"])("StoreCouponService.GetCoupon",Object(l["a"])("IDWithTokenRequest",{token:Object(l["a"])("Token",{token:pt}),id:r.couponid})):null,r.profitsharinguserid?Object(u["a"])("StoreUserService.GetUser",Object(l["a"])("IDWithTokenRequest",{token:Object(l["a"])("Token",{token:pt}),id:r.profitsharinguserid})):null]);case 8:return a=t.sent,r.user=a[0],r.orderproductsList.forEach(function(t){t.product=a[1].productlistList.find(function(e){return e.id===t.productid})}),r.marketinglist=a[2]?a[2].marketinglistList:[],r.coupon=a[3],r.profitsharinguser=a[4],i=[],s=[],r.marketinglist.forEach(function(t){2===t.kind&&(0===t.gifttype&&s.push(t.giftid),1===t.gifttype&&i.push(t.giftid))}),t.next=19,Promise.all([s.length?Object(u["a"])("StoreCouponTemplateService.GetCouponTemplateList",Object(l["a"])("CouponTemplateListQueryRequest",{token:Object(l["a"])("Token",{token:pt}),idlistList:s,count:s.length})):null,i.length?Object(u["a"])("StoreProductService.GetProductList",Object(l["a"])("ProductListQueryRequest",{token:Object(l["a"])("Token",{token:pt}),idlistList:i,sortby:1,sort:1,count:i.length})):null]);case 19:a=t.sent,r.marketinglist.forEach(function(t){t.coupontemplate=null,t.product=null,2===t.kind&&(0===t.gifttype&&(t.coupontemplate=a[0]?a[0].coupontemplatelistList.find(function(e){return e.id===t.giftid}):null),1===t.gifttype&&(t.product=a[1]?a[1].productlistList.find(function(e){return e.id===t.giftid}):null))}),this.order=r;case 22:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),methods:{printOrder:function(){var t=this;Object(u["a"])("StoreOrderService.PrintOrder",Object(l["a"])("IDWithTokenRequest",{token:Object(l["a"])("Token",{token:pt}),id:this.order.id})).then(function(e){t.$message({message:"已发送打印指令",type:"success"})})},updateOrder:function(){var t=Object(d["a"])(regeneratorRuntime.mark(function t(e){var r,i,a=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(et["b"])();case 2:if(r=t.sent,t.prev=3,3!=this.order.status||2!==e||2!=this.order.deliverkind||2!=r.shippingway){t.next=7;break}return t.next=7,this.$confirm("如果再次发货此订单只能选择商家自配送, 确认取消?","确认取消?",{confirmButtonText:"确定",cancelButtonText:"取消"});case 7:t.next=12;break;case 9:return t.prev=9,t.t0=t["catch"](3),t.abrupt("return");case 12:i=JSON.parse(JSON.stringify(this.order)),i.status=e,Object(u["a"])("StoreOrderService.UpdateOrder",Object(l["a"])("OrderWithTokenRequest",{token:Object(l["a"])("Token",{token:pt}),order:Object(l["a"])("Order",Object(c["a"])({},i,{address:Object(l["a"])("Address",i.address),invoice:Object(l["a"])("Invoice",i.invoice),orderproductsList:i.orderproductsList.map(function(t){return Object(l["a"])("OrderProduct",t)})}))})).then(function(t){a.order.status=e,a.order.updatedat=t.updatedat,a.$message({message:"操作成功",type:"success"})});case 15:case"end":return t.stop()}},t,this,[[3,9]])}));function e(e){return t.apply(this,arguments)}return e}(),getOrderStatus:gt,getCoupon:function(t){return"¥ -".concat(this.$amount1(t.amount)," (满").concat(this.$amount1(t.reach),"减").concat(this.$amount1(t.amount),")")},getMarketing:function(t){if(1===t.kind)return"¥ -".concat(this.$amount1(t.reduction)," (满").concat(this.$amount1(t.reach),"减").concat(this.$amount1(t.reduction),")");if(2===t.kind){if(1===t.gifttype)return"满".concat(this.$amount1(t.reach),"赠商品: ").concat(t.product.name);var e="";return 0===t.coupontemplate.amount&&(e="¥ ".concat(t.coupontemplate.amountbegin/100," ~ ¥ ").concat(t.coupontemplate.amountend/100)),1===t.coupontemplate.amount&&(e="¥ ".concat(t.coupontemplate.amount/100)),"满".concat(this.$amount1(t.reach),"赠优惠券: ").concat(t.coupontemplate.name,"(").concat(e,")")}return"¥ -".concat(this.$amount1(this.order.originfreight)," (满").concat(this.$amount1(t.reach),"免运费)")},getMarketingLabel:function(t){var e={1:"满减优惠",2:"满赠优惠",3:"满免运费"};return e[t.kind]}}},ft=ht,yt=(r("ea86"),r("7897"),Object(y["a"])(ft,lt,ut,!1,null,"6d360038",null)),_t=yt.exports,kt=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("div",{staticClass:"ml-l pl-l",staticStyle:{display:"flex","justify-content":"space-between","flex-direction":"row","padding-right":"15px"}},[r("el-button",{attrs:{size:"small"},on:{click:function(e){t.$router.back()}}},[t._v("返回")]),r("el-button",{attrs:{size:"small"},on:{click:t.printOrder}},[t._v("打印")])],1),r("comp-wrap",[r("div",[r("div",{staticClass:"header-wrap"},[r("div",[r("h3",{staticClass:"my-l py-l"},[t._v(t._s(t.getOrderStatus(t.order.status,t.order.deliverkind)||"非此商城的状态"))]),r("div",[r("span",{staticClass:"color2"},[t._v("订单号: "+t._s(t.order.id))]),r("span",{staticClass:"member-tag",staticStyle:{padding:"0 4px","margin-right":"5px"}},[t._v(t._s({1:"自取",2:"配送",3:"桌号堂食",4:"叫号堂食"}[t.order.deliverkind]))]),1==t.order.deliverkind?r("span",{staticClass:"member-tag",staticStyle:{padding:"0 4px","margin-right":"5px"}},[t._v(t._s(new Date(1e3*t.order.delivertime).toLocaleString("zh-CN",{timeZone:"Asia/Shanghai"})))]):t._e(),1==t.order.deliverkind&&t.order.delivertime<parseInt(Date.now()/1e3)&&3==t.order.status?r("span",{staticClass:"member-tag",staticStyle:{padding:"0 4px","margin-right":"5px"}},[t._v("已超时")]):t._e(),1==t.order.deliverkind?r("span",{staticClass:"member-tag",staticStyle:{padding:"0 4px","margin-right":"5px"}},[t._v("自取手机号: "+t._s(t.order.delivermobile))]):t._e(),2==t.order.deliverkind?r("span",{staticClass:"member-tag",staticStyle:{padding:"0 4px","margin-right":"5px"}},[t._v("#"+t._s(t.order.daynumber))]):t._e(),3==t.order.deliverkind?r("span",{staticClass:"member-tag",staticStyle:{padding:"0 4px","margin-right":"5px"}},[t._v("#"+t._s(t.order.desk))]):t._e(),4==t.order.deliverkind?r("span",{staticClass:"member-tag",staticStyle:{padding:"0 4px","margin-right":"5px"}},[t._v("#"+t._s(t.order.daynumber))]):t._e(),2==t.order.user.isvip?r("span",{staticClass:"member-tag",staticStyle:{padding:"0 4px","margin-right":"5px"}},[t._v("会员")]):t._e(),r("span",{staticClass:"member-tag",staticStyle:{padding:"0 4px","margin-right":"5px"}},[t._v(t._s(t.order.user.nickname)+"("+t._s(t.order.user.mobile)+")")])])]),2==t.order.status?r("div",{staticClass:"header-action"},[r("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){t.updateOrder(3)}}},[t._v("\n            "+t._s(2==t.order.deliverkind?"确认发货":"确认接单")+"\n          ")])],1):t._e(),3==t.order.status&&0==t.order.subscriptionid?r("div",{staticClass:"header-action"},[r("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){t.updateOrder(2)}}},[t._v("\n            取消发货\n          ")])],1):t._e()])]),12===t.order.status?r("div",{staticClass:"order-detail_banner"},[r("div",{staticClass:"detail-banner_text"},[r("span",[t._v("买家申请退款")])]),r("div",[r("el-button",{attrs:{size:"small",type:"info"},on:{click:function(e){t.updateOrder(2)}}},[t._v("拒绝退款")]),r("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){t.updateOrder(8)}}},[t._v("确认退款")])],1)]):t._e(),2===t.order.status?r("div",{staticClass:"order-detail_banner"},[r("div",{staticClass:"detail-banner_text"},[r("span",[t._v("直接退款")]),r("span",{staticClass:"detail-banner_sub-text"},[t._v("如果因为库存不足等原因无法接单, 您可以直接直接退款取消订单")])]),r("div",[r("el-button",{attrs:{size:"small",type:"info"},on:{click:function(e){t.updateOrder(8)}}},[t._v("直接退款")])],1)]):t._e(),2==t.order.deliverkind?r("div",{staticClass:"address-box"},[r("h5",{staticClass:"mb-l pb-l mt-s pt-s"},[t._v("配送信息")]),r("el-row",{attrs:{align:"middle",type:"flex"}},[r("el-col",{staticClass:"color1",attrs:{span:"2"}},[t._v("配送地址")]),r("el-col",{staticClass:"color1",attrs:{offset:"1",span:"6"}},[t._v(t._s(t.order.address.name)+", "+t._s(t.order.address.mobile))])],1),r("el-row",{staticStyle:{"margin-top":"5px"},attrs:{align:"middle",type:"flex"}},[r("el-col",{attrs:{span:"2"}},[r("el-button",{staticStyle:{padding:"2px 10px","font-size":"10px"},attrs:{size:"small",type:"info"}},[t._v("复制")])],1),r("el-col",{staticClass:"color1",attrs:{offset:"1",span:"6"}},[t._v(t._s(t.order.address.province)+" "+t._s(t.order.address.city)+" "+t._s(t.order.address.district)+" "+t._s(t.order.address.address))])],1)],1):t._e(),r("comp-list",{attrs:{text:"¥ "+t.$amount1(t.order.amount),label:"商品合计"}}),t.order.couponid?r("comp-list",{attrs:{text:t.getCoupon(t.order.coupon),label:"使用优惠券"}}):t._e(),r("comp-list",{attrs:{text:"¥ "+t.$amount1(t.order.originfreight),label:"配送费"}}),t._l(t.order.marketinglist,function(e){return r("comp-list",{key:e.id,attrs:{label:t.getMarketingLabel(e),text:t.getMarketing(e)}})}),r("comp-list",{attrs:{text:"¥ "+t.$amount1(t.order.actualamount+t.order.freight),gutter:"",label:"实际支付"}}),r("comp-list",{attrs:{gutter:!t.order.needinvoice,text:t.order.note,label:"买家备注"}}),r("comp-list",{attrs:{text:t.order.giftnote,label:"礼卡祝福语"}}),1==t.order.needinvoice?r("comp-list",{attrs:{text:0===t.order.invoice.kind?"个人":"单位",label:"发票类型",nomb:""}}):t._e(),1==t.order.needinvoice?r("comp-list",{attrs:{text:t.order.invoice.name,label:"发票抬头",nomb:""}}):t._e(),1==t.order.needinvoice?r("comp-list",{attrs:{text:t.order.invoice.taxid,gutter:"",label:"发票税号",nomb:""}}):t._e(),r("div",{staticClass:"g-b",staticStyle:{border:"1px solid #e9e9e9","margin-left":"-10px","margin-right":"-10px"}},t._l(t.order.orderproductsList,function(e){return r("div",{key:e.id,staticClass:"product"},[r("div",{staticClass:"product-info"},[r("div",{staticClass:"product-img",on:{click:function(r){t.$router.push({name:"products-edit",query:{id:e.productid,type:"edit"}})}}},[r("comp-imger",{attrs:{src:e.product.imagesList.length?e.product.imagesList[0]:""}})],1),r("div",[r("div",{staticClass:"product-name"},[t._v(t._s(e.product.name))]),r("div",{staticClass:"product-desc"},[t._v(t._s(e.optionname&&"("+Object.values(JSON.parse(e.optionname)).join(", ")+")"))])])]),r("div",{staticClass:"price"},[t._v(t._s(t.$amount1(e.amount))+" 元")]),r("div",{staticClass:"count"},[t._v(t._s(e.quantity)+" 个")])])})),r("comp-list",{attrs:{text:new Date(1e3*t.order.createdat).toLocaleString("zh-CN",{timeZone:"Asia/Shanghai"}),label:"下单时间"}}),r("comp-list",{attrs:{text:new Date(1e3*t.order.updatedat).toLocaleString("zh-CN",{timeZone:"Asia/Shanghai"}),label:"最后更新"}}),0!=t.order.status&&6!=t.order.status?r("comp-list",{attrs:{text:new Date(1e3*t.order.paidat).toLocaleString("zh-CN",{timeZone:"Asia/Shanghai"}),label:"支付时间"}}):t._e(),1==t.order.payway?r("comp-list",{attrs:{text:t.order.transactionid,label:"微信流水号"}}):t._e(),1==t.order.payway?r("comp-list",{attrs:{text:"微信支付",label:"支付方式"}}):t._e(),2==t.order.payway?r("comp-list",{attrs:{text:"余额支付",label:"支付方式"}}):t._e(),t.order.dadastatus?r("comp-list",{attrs:{text:{1:"待接单",2:"待取货",3:"配送中",4:"已完成",5:"已取消",7:"已过期",8:"指派单",9:"妥投异常之物品返回中",10:"妥投异常之物品返回完成",100:"骑士到店",1000:"创建运单失败"}[t.order.datastatus],label:"骑手状态"}}):t._e(),t.order.dadacancelreason?r("comp-list",{attrs:{text:t.order.dadacancelreason,label:"骑手取消原因"}}):t._e(),t.order.dadadmname?r("comp-list",{attrs:{text:t.order.dadadmname,label:"骑手姓名"}}):t._e(),t.order.dadadmmobile?r("comp-list",{attrs:{text:t.order.dadadmmobile,label:"骑手电话"}}):t._e(),0===t.order.brokeragestatus?r("comp-list",{attrs:{text:"无",label:"有无分账"}}):t._e(),0!==t.order.brokeragestatus?r("comp-list",{attrs:{text:"有",label:"有无分账"}}):t._e(),t.order.profitsharinguserid?r("comp-list",{attrs:{text:t.order.profitsharinguser.nickname+"("+t.order.profitsharinguser.mobile+")",label:"分销员"}}):t._e(),0!==t.order.brokerage?r("comp-list",{attrs:{text:t.order.brokerage/100,label:"分销员佣金"}}):t._e(),1!==t.order.brokeragestatus||0!=t.order.status&&1!=t.order.status&&2!=t.order.status&&3!=t.order.status&&4!=t.order.status?t._e():r("comp-list",{attrs:{text:"未结算",label:"分账结算"}}),2===t.order.brokeragestatus?r("comp-list",{attrs:{text:"已结算",label:"分账结算"}}):t._e(),3===t.order.brokeragestatus?r("comp-list",{attrs:{text:"未结算(结算失败)",label:"分账结算"}}):t._e(),1===t.order.brokeragestatus&&0!=t.order.status&&1!=t.order.status&&2!=t.order.status&&3!=t.order.status&&4!=t.order.status?r("comp-list",{attrs:{text:"未结算(结算无效)",label:"分账结算"}}):t._e()],2)],1)},xt=[],Ot="",St={functional:!0,render:function(t,e){return t("div",{class:"container"},[t("div",{class:"wrap"},[e.children])])}},Ct={functional:!0,props:["label","text","gutter","nomb"],render:function(t,e){var r=e.props,i=r.label,a=r.text,s=r.gutter,n=r.nomb,o=["info"];return void 0!==s&&o.push("g-b"),void 0!==n&&void 0===s&&o.push("nomb"),t("div",{class:o.join(" ")},[t("div",{class:"color1 mr-l pr-l title"},[i]),t("div",{class:"color1 ml-l pl-l text"},[a])])}},jt={0:"等待顾客支付","2_1":"等待商家备货","2_2":"等待商家发货","2_3":"等待商家上菜","2_4":"等待商家备菜","3_1":"等待顾客取货","3_2":"已接单待收货","3_3":"已接单待收货","3_4":"已接单待收货",4:"已完成",6:"顾客已取消订单",8:"已退款",12:"顾客请求退款"},Lt=function(t,e){return jt[t]||jt["".concat(t,"_").concat(e)]},zt={components:{"comp-list":Ct,"comp-wrap":St},data:function(){return{order:{address:{},invoice:{},marketinglist:[],orderproductsList:[],user:{},coupon:{}}}},created:function(){var t=Object(d["a"])(regeneratorRuntime.mark(function t(){var e,r,i,a,s;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return Ot=Object(p["e"])(),e=this.$route.query.id,t.next=4,Object(u["a"])("StoreOrderService.GetOrder",Object(l["a"])("IDWithTokenRequest",{token:Object(l["a"])("Token",{token:Ot}),id:e}));case 4:return r=t.sent,i=r.orderproductsList.map(function(t){return t.productid}),t.next=8,Promise.all([Object(u["a"])("StoreUserService.GetUser",Object(l["a"])("IDWithTokenRequest",{token:Object(l["a"])("Token",{token:Ot}),id:r.userid})),Object(u["a"])("StoreProductService.GetProductList",Object(l["a"])("ProductListQueryRequest",{token:Object(l["a"])("Token",{token:Ot}),idlistList:i,sortby:1,sort:1,count:i.length})),r.marketingidsList.length?Object(u["a"])("StoreMarketingService.GetMarketingList",Object(l["a"])("MarketingListQueryRequest",{token:Object(l["a"])("Token",{token:Ot}),kind:-1,idlistList:r.marketingidsList,sortby:1,sort:1,count:r.marketingidsList.length})):null,r.couponid?Object(u["a"])("StoreCouponService.GetCoupon",Object(l["a"])("IDWithTokenRequest",{token:Object(l["a"])("Token",{token:Ot}),id:r.couponid})):null,r.profitsharinguserid?Object(u["a"])("StoreUserService.GetUser",Object(l["a"])("IDWithTokenRequest",{token:Object(l["a"])("Token",{token:Ot}),id:r.profitsharinguserid})):null]);case 8:return a=t.sent,r.user=a[0],r.orderproductsList.forEach(function(t){t.product=a[1].productlistList.find(function(e){return e.id===t.productid})}),r.marketinglist=a[2]?a[2].marketinglistList:[],r.coupon=a[3],r.profitsharinguser=a[4],i=[],s=[],r.marketinglist.forEach(function(t){2===t.kind&&(0===t.gifttype&&s.push(t.giftid),1===t.gifttype&&i.push(t.giftid))}),t.next=19,Promise.all([s.length?Object(u["a"])("StoreCouponTemplateService.GetCouponTemplateList",Object(l["a"])("CouponTemplateListQueryRequest",{token:Object(l["a"])("Token",{token:Ot}),idlistList:s,count:s.length})):null,i.length?Object(u["a"])("StoreProductService.GetProductList",Object(l["a"])("ProductListQueryRequest",{token:Object(l["a"])("Token",{token:Ot}),idlistList:i,sortby:1,sort:1,count:i.length})):null]);case 19:a=t.sent,r.marketinglist.forEach(function(t){t.coupontemplate=null,t.product=null,2===t.kind&&(0===t.gifttype&&(t.coupontemplate=a[0]?a[0].coupontemplatelistList.find(function(e){return e.id===t.giftid}):null),1===t.gifttype&&(t.product=a[1]?a[1].productlistList.find(function(e){return e.id===t.giftid}):null))}),this.order=r;case 22:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),methods:{printOrder:function(){var t=this;Object(u["a"])("StoreOrderService.PrintOrder",Object(l["a"])("IDWithTokenRequest",{token:Object(l["a"])("Token",{token:Ot}),id:this.order.id})).then(function(e){t.$message({message:"已发送打印指令",type:"success"})})},updateOrder:function(){var t=Object(d["a"])(regeneratorRuntime.mark(function t(e){var r,i,a=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(et["b"])();case 2:if(r=t.sent,t.prev=3,3!=this.order.status||2!==e||2!=this.order.deliverkind||2!=r.shippingway){t.next=7;break}return t.next=7,this.$confirm("如果再次发货此订单只能选择商家自配送, 确认取消?","确认取消?",{confirmButtonText:"确定",cancelButtonText:"取消"});case 7:t.next=12;break;case 9:return t.prev=9,t.t0=t["catch"](3),t.abrupt("return");case 12:i=JSON.parse(JSON.stringify(this.order)),i.status=e,Object(u["a"])("StoreOrderService.UpdateOrder",Object(l["a"])("OrderWithTokenRequest",{token:Object(l["a"])("Token",{token:Ot}),order:Object(l["a"])("Order",Object(c["a"])({},i,{address:Object(l["a"])("Address",i.address),invoice:Object(l["a"])("Invoice",i.invoice),orderproductsList:i.orderproductsList.map(function(t){return Object(l["a"])("OrderProduct",t)})}))})).then(function(t){a.order.status=e,a.order.updatedat=t.updatedat,a.$message({message:"操作成功",type:"success"})});case 15:case"end":return t.stop()}},t,this,[[3,9]])}));function e(e){return t.apply(this,arguments)}return e}(),getOrderStatus:Lt,getCoupon:function(t){return"¥ -".concat(this.$amount1(t.amount)," (满").concat(this.$amount1(t.reach),"减").concat(this.$amount1(t.amount),")")},getMarketing:function(t){if(1===t.kind)return"¥ -".concat(this.$amount1(t.reduction)," (满").concat(this.$amount1(t.reach),"减").concat(this.$amount1(t.reduction),")");if(2===t.kind){if(1===t.gifttype)return"满".concat(this.$amount1(t.reach),"赠商品: ").concat(t.product.name);var e="";return 0===t.coupontemplate.amount&&(e="¥ ".concat(t.coupontemplate.amountbegin/100," ~ ¥ ").concat(t.coupontemplate.amountend/100)),1===t.coupontemplate.amount&&(e="¥ ".concat(t.coupontemplate.amount/100)),"满".concat(this.$amount1(t.reach),"赠优惠券: ").concat(t.coupontemplate.name,"(").concat(e,")")}return"¥ -".concat(this.$amount1(this.order.originfreight)," (满").concat(this.$amount1(t.reach),"免运费)")},getMarketingLabel:function(t){var e={1:"满减优惠",2:"满赠优惠",3:"满免运费"};return e[t.kind]}}},Tt=zt,wt=(r("fbed"),r("138a"),Object(y["a"])(Tt,kt,xt,!1,null,"340d09d3",null)),$t=wt.exports,Dt={_0:k,_1:$,_2:W,_3:V,_4:dt,_6:_t,_7:$t},Rt={0:"_0",1:"_1",2:"_2",3:"_3",4:"_4",6:"_6",7:"_7"},qt=Object(s["a"])({name:"order-detail-entry",components:Dt,map:Rt}),Pt=qt,Gt=Object(y["a"])(Pt,i,a,!1,null,null,null);e["default"]=Gt.exports},db8f:function(t,e,r){},e8c0:function(t,e,r){},ea86:function(t,e,r){"use strict";var i=r("b3a0"),a=r.n(i);a.a},f533:function(t,e,r){},fbed:function(t,e,r){"use strict";var i=r("6935"),a=r.n(i);a.a},fe3b:function(t,e,r){"use strict";var i=r("2a80"),a=r.n(i);a.a}}]);
//# sourceMappingURL=order-detail.249fd712.js.map