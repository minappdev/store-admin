(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["reservation-list"],{"20d6":function(t,e,i){"use strict";var s=i("5ca1"),r=i("0a49")(6),a="findIndex",n=!0;a in[]&&Array(1)[a](function(){n=!1}),s(s.P+s.F*n,"Array",{findIndex:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}}),i("9c6c")(a)},"5df3":function(t,e,i){"use strict";var s=i("02f4")(!0);i("01f9")(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,e=this._t,i=this._i;return i>=e.length?{value:void 0,done:!0}:(t=s(e,i),this._i+=t.length,{value:t,done:!1})})},"80bf":function(t,e,i){"use strict";i("96cf");var s=i("1da1"),r=(i("7f7f"),i("a3fb"));e["a"]=function(t){var e=t.name,i=t.components,a=t.map;return{name:e,components:i,data:function(){return{store:{}}},created:function(){var t=Object(s["a"])(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(r["b"])();case 2:this.store=t.sent;case 3:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),render:function(t){return t(a[this.store.kind])}}}},aafe:function(t,e,i){},ca22:function(t,e,i){"use strict";var s=i("aafe"),r=i.n(s);r.a},db06:function(t,e,i){"use strict";i.r(e);var s,r,a=i("80bf"),n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"reservation-list"},[i("div",{staticClass:"container"},[i("div",{staticClass:"color3 mb-l pb-l"},[t._v("填写任意选项进行筛选")]),i("el-form",{ref:"form",attrs:{size:"mini"}},[i("el-row",{attrs:{gutter:20}},[i("el-col",{attrs:{span:6}},[i("el-form-item",{attrs:{label:"用户手机号","label-width":"95px"}},[i("el-input",{attrs:{placeholder:"请输入手机号"},model:{value:t.params.mobile,callback:function(e){t.$set(t.params,"mobile",e)},expression:"params.mobile"}})],1)],1),i("el-col",{attrs:{span:14}},[i("el-form-item",{attrs:{label:"提交预约时间","label-width":"100px"}},[i("el-date-picker",{attrs:{type:"datetimerange","picker-options":t.pickerOptions,"range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"timestamp",align:"right"},model:{value:t.params.time,callback:function(e){t.$set(t.params,"time",e)},expression:"params.time"}})],1)],1),i("el-col",{attrs:{span:4}},[i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.search}},[t._v("筛选")]),i("el-button",{attrs:{size:"mini"},on:{click:t.clear}},[t._v("清空")])],1)],1)],1)],1),i("div",{staticClass:"container"},[i("el-radio-group",{staticStyle:{margin:"10px 0"},attrs:{size:"mini"},model:{value:t.params.status,callback:function(e){t.$set(t.params,"status",e)},expression:"params.status"}},[i("el-radio-button",{attrs:{label:"0"}},[t._v("全部预约")]),i("el-radio-button",{attrs:{label:"1"}},[t._v("待反馈")]),i("el-radio-button",{attrs:{label:"2"}},[t._v("已确认预约")]),i("el-radio-button",{attrs:{label:"3"}},[t._v("体验完成")]),i("el-radio-button",{attrs:{label:"4"}},[t._v("已拒绝")])],1),i("el-table",{staticStyle:{width:"100%"},attrs:{data:t.list}},[i("el-table-column",{attrs:{label:"预约服务",width:"360px"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("div",{staticClass:"img",style:{backgroundImage:"url("+(e.row.product.imagesList.length?e.row.product.imagesList[0]:"")+")"}}),i("div",{staticStyle:{"padding-top":"14px"}},[i("h4",{staticClass:"title",staticStyle:{"margin-bottom":"3px"}},[t._v(t._s(e.row.product.name))]),i("p",{staticClass:"submit-time"},[t._v("提交时间 "+t._s(new Date(1e3*e.row.createdat).toLocaleString()))])])]}}])}),i("el-table-column",{attrs:{prop:"user.nickname",label:"预约人",width:"120px"}}),i("el-table-column",{attrs:{label:"手机号",width:"110px"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n          "+t._s(e.row.mobile||e.row.user.mobile)+"\n        ")]}}])}),i("el-table-column",{attrs:{prop:"note",label:"给顾客留言"}}),i("el-table-column",{attrs:{label:"到店时间",width:"160px"},scopedSlots:t._u([{key:"default",fn:function(e){return[1==e.row.status?i("span",[t._v("待商户确认")]):t._e(),2==e.row.status||3==e.row.status?i("span",[t._v(t._s(e.row.time?t.$utils.formatTimestamp(1e3*e.row.time):"随时可到店"))]):t._e(),4==e.row.status?i("span",[t._v("/")]):t._e()]}}])}),i("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-button",{directives:[{name:"show",rawName:"v-show",value:1==e.row.status,expression:"scope.row.status == 1"}],attrs:{size:"mini"},on:{click:function(){return t.refuse(e.row)}}},[t._v("拒绝")]),i("el-button",{directives:[{name:"show",rawName:"v-show",value:1==e.row.status,expression:"scope.row.status == 1"}],attrs:{type:"primary",size:"mini"},on:{click:function(){return t.confirm(e.row)}}},[t._v("确认")]),i("el-button",{directives:[{name:"show",rawName:"v-show",value:2==e.row.status,expression:"scope.row.status == 2"}],attrs:{size:"mini",type:"primary"},on:{click:function(){return t.finish(e.row)}}},[t._v("顾客已体验")]),i("el-tag",{directives:[{name:"show",rawName:"v-show",value:3==e.row.status,expression:"scope.row.status == 3"}],attrs:{type:"success"}},[t._v("已完成")]),i("el-tag",{directives:[{name:"show",rawName:"v-show",value:4==e.row.status,expression:"scope.row.status == 4"}],attrs:{type:"warning"}},[t._v("已拒绝")])]}}])})],1),t.list.length?i("div",{staticClass:"table-bottom"},[t.hasMore?i("el-button",{attrs:{loading:t.loadmore,size:"small",type:"primary"},on:{click:t.getList}},[t._v("加载更多")]):i("p",{staticStyle:{color:"#ccc","font-size":"12px"}},[t._v("已加载全部，没有更多了")])],1):t._e()],1),i("el-dialog",{attrs:{title:2==t.current.status?"确认预约":"拒绝预约",visible:t.dialogVisible,width:"40%"},on:{"update:visible":function(e){t.dialogVisible=e}}},[i("el-form",{attrs:{size:"mini"}},[2==t.current.status?i("el-form-item",{attrs:{label:"顾客到店时间"}},[i("el-date-picker",{attrs:{type:"datetime",disabled:t.noLimit,"default-value":new Date,"picker-options":{disabledDate:t.disabledDate},placeholder:"请选择顾客到店时间"},model:{value:t.current.time,callback:function(e){t.$set(t.current,"time",e)},expression:"current.time"}})],1):t._e(),2==t.current.status?i("el-form-item",[i("el-checkbox",{model:{value:t.noLimit,callback:function(e){t.noLimit=e},expression:"noLimit"}},[t._v("不限制顾客到店时间")]),i("span",{staticClass:"tip"},[t._v("营业期间随时可到店")])],1):t._e(),i("el-form-item",{attrs:{label:"留言给顾客"}},[i("el-input",{attrs:{type:"textarea",placeholder:"请输入留言"},model:{value:t.current.note,callback:function(e){t.$set(t.current,"note",e)},expression:"current.note"}})],1)],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"mini"},on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),i("el-button",{attrs:{size:"mini",type:"primary",disabled:2==t.current.status&&!t.current.time&&!t.noLimit,loading:t.okLoading},on:{click:t.update}},[t._v("确 定")])],1)],1)],1)},o=[],c=(i("20d6"),i("7514"),i("ac6a"),i("5df3"),i("be94")),l=(i("96cf"),i("1da1")),u=i("e8e1"),m=i("8e44"),d=i("73cd"),p={name:"reservation-list",data:function(){return{params:{idlessthan:0,count:20,status:0,userid:0,usermobile:"",createdatgreaterthan:0,createdatlessthan:0,time:[]},list:[],pickerOptions:{shortcuts:[{text:"最近一周",onClick:function(t){var e=new Date,i=new Date;i.setTime(i.getTime()-6048e5),t.$emit("pick",[i,e])}},{text:"最近一个月",onClick:function(t){var e=new Date,i=new Date;i.setTime(i.getTime()-2592e6),t.$emit("pick",[i,e])}},{text:"最近三个月",onClick:function(t){var e=new Date,i=new Date;i.setTime(i.getTime()-7776e6),t.$emit("pick",[i,e])}}]},hasMore:!0,loadmore:!1,dialogVisible:!1,current:{time:new Date},noLimit:!1,okLoading:!1}},watch:{"params.status":function(){this.list=[],this.getList()},dialogVisible:function(t){t||(this.noLimit=!1,this.current={time:new Date},this.okLoading=!1)}},created:function(){this.token=Object(d["e"])(),this.getList()},methods:{getList:function(){var t=Object(l["a"])(regeneratorRuntime.mark(function t(){var e,i,s,r,a,n,o;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(this.dialogVisible=!1,this.loadmore=!0,e=window,i=e.scrollY,this.params.createdatgreaterthan=0,this.params.createdatlessthan=0,2===this.params.time.length&&(this.params.createdatgreaterthan=parseInt(this.params.time[0].getTime()/1e3),this.params.createdatlessthan=parseInt(this.params.time[1].getTime()/1e3)),!this.params.mobile){t.next=11;break}return t.next=9,Object(m["a"])("StoreUserService.GetUserList",Object(u["a"])("UserListQueryRequest",{token:Object(u["a"])("Token",{token:this.token}),mobile:this.params.mobile,count:1,order:0}));case 9:s=t.sent,this.params.userid=s.userlistList.length?s.userlistList[0].id:0;case 11:return this.params.idlessthan=this.list.length?this.list[this.list.length-1].id:0,t.next=14,Object(m["a"])("StoreReservationService.GetReservationList",Object(u["a"])("ReservationListQueryRequest",Object(c["a"])({token:Object(u["a"])("Token",{token:this.token})},this.params)));case 14:if(r=t.sent,0!==r.reservationlistList.length){t.next=19;break}return this.loadmore=!1,this.hasMore=!1,t.abrupt("return");case 19:return a=r.reservationlistList.map(function(t){return t.userid}),n=r.reservationlistList.map(function(t){return t.productid}),t.next=23,Promise.all([Object(m["a"])("StoreUserService.GetUserList",Object(u["a"])("UserListQueryRequest",{token:Object(u["a"])("Token",{token:this.token}),idlistList:a,count:a.length,order:0})),Object(m["a"])("StoreProductService.GetProductList",Object(u["a"])("ProductListQueryRequest",{token:Object(u["a"])("Token",{token:this.token}),idlistList:n,sortby:1,sort:1,count:n.length}))]);case 23:o=t.sent,r.reservationlistList.forEach(function(t){t.user=o[0].userlistList.find(function(e){return e.id===t.userid}),t.product=o[1].productlistList.find(function(e){return e.id===t.productid})}),this.list=this.list.concat(r.reservationlistList),this.hasMore=r.reservationlistList.length,this.loadmore=!1,0!==this.params.idlessthan&&window.scroll(0,i);case 29:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),search:function(){this.list=[],this.getList()},clear:function(){this.params={idlessthan:0,count:20,status:0,userid:0,usermobile:"",createdatgreaterthan:0,createdatlessthan:0,time:[]},this.list=[],this.getList()},refuse:function(t){this.current=JSON.parse(JSON.stringify(t)),this.current.time=this.current.time?new Date(1e3*this.current.time):new Date,this.current.status=4,this.dialogVisible=!0},confirm:function(t){this.current=JSON.parse(JSON.stringify(t)),this.current.time=this.current.time?new Date(1e3*this.current.time):new Date,this.current.status=2,this.dialogVisible=!0},finish:function(t){var e=this;this.$confirm("确认已到店体验?","顾客是否已经到店体验完毕？",{confirmButtonText:"确定",cancelButtonText:"取消",type:"success"}).then(function(){e.current=JSON.parse(JSON.stringify(t)),e.current.time=e.current.time?new Date(1e3*e.current.time):new Date,e.current.status=3,e.update()}).catch(function(){})},update:function(){var t=this;this.okLoading=!0,this.current.time=parseInt(this.current.time.getTime()/1e3),2==this.current.status&&this.noLimit&&(this.current.time=0),Object(m["a"])("StoreReservationService.UpdateReservation",Object(u["a"])("ReservationWithTokenRequest",{token:Object(u["a"])("Token",{token:this.token}),reservation:Object(u["a"])("Reservation",this.current)})).then(function(e){var i=t.list.find(function(t){return t.id===e.id});e.user=i.user,e.product=i.product,t.list.splice(t.list.findIndex(function(t){return t.id===e.id}),1,e),t.okLoading=!1,t.dialogVisible=!1,t.$message({message:"操作成功",type:"success"})})},disabledDate:function(t){return t<new Date}}},h=p,f=(i("ca22"),i("2877")),b=Object(f["a"])(h,n,o,!1,null,"e124b7b4",null),v=b.exports,w={_2:v},g={2:"_2"},k=Object(a["a"])({name:"reservation-list-entry",components:w,map:g}),_=k,L=Object(f["a"])(_,s,r,!1,null,null,null);e["default"]=L.exports}}]);
//# sourceMappingURL=reservation-list.2384659e.js.map